  <a target="_blank" rel="noopener" href="https://zxalive.com" class="special-link">新站点zxalive.com</a>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"zxblog.eu.org","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="黑马-传智健康-项目笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="【项目】传智健康">
<meta property="og:url" content="https://zxblog.eu.org/posts/a12c/index.html">
<meta property="og:site_name" content="知行博客">
<meta property="og:description" content="黑马-传智健康-项目笔记">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://zxblog.eu.org/assets/aa6880a7877dfd47b7350311641d3874.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/fcc90198e99bf91d538c6462b9f483f1.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/7bd34f26974c665c81dea98fe941443b.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/94c32fc9c14e53255330f0e411867154.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/19daf9b518737cf515fc8333fbff4805.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/10dc0039137fd720f01381388d3c7d6d.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/9f2b785069ced5a2c456c03df9aa24b9.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/0a2c6a4ed5444f3b7cd9f6b4c715a7cf.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/08c3e495f20e155f1a4742c9f8c3e794.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/79d591be5cc86d61bc15a13b7c7af1f8.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/ad24cf567c91568a9ea8aaf89922456b.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/dae9c1ffcf02a66522e18bc2066b2b96.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/87b09381e090561a6b879ef256607cb1.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/243e1a5ebe32f046016463732296f7bf.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/22af4a3ba613be252e3e19826bf83475.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/036fc8cb85af69b61c04ac142694a6e9.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/ffef375682676443517a3a9c76b0b313.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/4b2b31ddd0b67c1a46154a6daf11db8b.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/f199855c4b206fa912a1220c32fe4358.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/806e50c86a165ba8fea1974d2133bb80.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/b78c2a909e765029d22078bca29a10a6.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/498116dd0031dee123138a8747425e6a.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/557b1636c29fe04b12c6c8a236a83841.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/5a7e0dd01ac7c9a8a93569b16ab88711.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2bd692aadd298dbe19daf89613eb1d49.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/8e45480e5dea7e8a9066d77a808fc9de.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/a7386a0ad0376b7b34b146dbdfb8e7bf.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/aa6880a7877dfd47b7350311641d3874.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/image-20220907090350307.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/image-20220907090400114.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/4(1).png">
<meta property="og:image" content="https://zxblog.eu.org/assets/image-20220907090444733.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/image-20220907095210364.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826111027898-1484280306.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826111034926-52537537.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/image-20220907103607666.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/image-20220907103626199.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/image-20220907103646595.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/image-20220907103700164.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/image-20220907103741223.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/10(1).png">
<meta property="og:image" content="https://zxblog.eu.org/assets/11.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/image-20220907103825628.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/image-20220907103837301.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/image-20220907103854226.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/image-20220907103920772.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/image-20220907103932038.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/image-20220907104018984.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/image-20220907104032651.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/image-20220907104116597.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/1(1).png">
<meta property="og:image" content="https://zxblog.eu.org/assets/image-20220907104243371.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826120859472-922067926.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826120906627-429601157.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826120914340-607375467.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826120920118-511695951.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826120928287-1414207880.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826120938410-579478690.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826120943627-254173533.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826120949788-570724317.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826120957326-1709666878.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826121005067-405953044.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826121024225-1315372073.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826121037713-1254637614.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826121103716-746316408.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826121113517-1728252678.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826121120607-899392780.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826121130077-2115665530.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826121137219-355293852.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826121144716-1099846315.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826121155518-624283398.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826121204468-1970097683.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826121214257-1397436018.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826121220891-1217659523.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826121227815-805698344.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826121235016-1253599395.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826121241437-13481678.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826121247431-1261848585.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826121519148-1081717292.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826121907777-463739585.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826121913433-1609264363.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826121931015-87114230.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826121938276-1920392419.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826122444162-1547231698.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826122503356-1593807669.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826122510985-145090442.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826122516573-1966004505.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826122522262-1147088803.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826122532960-449355402.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826122538480-800031109.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826122544302-2098450476.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826122550894-2087218695.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826122745885-810161627.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826122801146-1732377011.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826122828883-1045661049.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123326153-1116927167.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123338278-1727038568.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123345906-188450573.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123351331-1836821684.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123400432-356297333.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123407372-1342319791.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123413116-2051980424.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123418897-1388484071.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123426894-1502834698.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123434120-1349843518.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123440835-1581436465.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123446892-451024945.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123453452-308927035.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123459485-545807458.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123507571-1326044476.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123514564-1438842690.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123523199-257806343.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123532973-1206441878.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123541900-1625814062.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123548365-245211442.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123554426-1120030856.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123600825-503570818.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123606867-1815909773.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123613849-1563472957.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123622740-161044450.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123631552-83408885.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123638416-876890596.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123648144-760279152.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123654989-1901871885.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123702450-487120277.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123709591-1809647402.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123717515-1645604439.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123729661-1744985926.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123738920-324459032.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123746530-1708698505.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123754314-1679645655.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123801562-2108032458.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123811504-979209160.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123822855-1797370369.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123829804-1083491128.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123838233-1269165315.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123847096-1759166264.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123855584-704323731.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123906527-1293322217.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123915062-1294138600.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123924802-1887013158.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123932358-446522561.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123949241-1958651062.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826123957828-1135377977.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124007481-1439198384.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124016351-1424676942.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124023863-1039527747.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124031422-834658810.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124040913-1547402875.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124051411-463011616.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124058923-1312076502.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124105773-1718974655.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124116291-1072989880.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124124983-1932606575.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124135033-1364484144.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124146968-849876863.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124157301-1385335208.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124206152-1371485413.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124217747-127881544.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124226980-992916758.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124235293-1602476623.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124243337-78188306.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124251690-1762840201.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124304680-1961150138.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124313333-1908695285.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124319596-1983576562.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124326876-716045578.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124334178-1013965075.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124720009-1706751419.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124728845-697346755.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124740674-1905817887.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124749207-265082394.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124755738-1868715804.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124804648-874019440.png">
<meta property="og:image" content="https://zxblog.eu.org/assets/2143930-20210826124815834-1936200519.png">
<meta property="article:published_time" content="2022-01-01T08:10:32.000Z">
<meta property="article:modified_time" content="2024-08-18T10:14:29.241Z">
<meta property="article:author" content="zhangxin">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zxblog.eu.org/assets/aa6880a7877dfd47b7350311641d3874.png">


<link rel="canonical" href="https://zxblog.eu.org/posts/a12c/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://zxblog.eu.org/posts/a12c/","path":"posts/a12c/","title":"【项目】传智健康"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>【项目】传智健康 | 知行博客</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">知行博客</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">新站点：zxalive.com</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC1%E7%AB%A0-%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0%E5%92%8C%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="nav-number">1.</span> <span class="nav-text">第1章 项目概述和环境搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0"><span class="nav-number">1.1.</span> <span class="nav-text">1. 项目概述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.1.1.</span> <span class="nav-text">1.1 项目介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E5%8E%9F%E5%9E%8B%E5%B1%95%E7%A4%BA"><span class="nav-number">1.1.2.</span> <span class="nav-text">1.2 原型展示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84"><span class="nav-number">1.1.3.</span> <span class="nav-text">1.3 技术架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-%E5%8A%9F%E8%83%BD%E6%9E%B6%E6%9E%84"><span class="nav-number">1.1.4.</span> <span class="nav-text">1.4 功能架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-5-%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B"><span class="nav-number">1.1.5.</span> <span class="nav-text">1.5 软件开发流程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="nav-number">1.2.</span> <span class="nav-text">2. 环境搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="nav-number">1.2.1.</span> <span class="nav-text">2.1 项目结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-maven%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA"><span class="nav-number">1.2.2.</span> <span class="nav-text">2.2 maven项目搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-health-parent"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">2.2.1 health_parent</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-health-common"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">2.2.2 health_common</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-5-health-interface"><span class="nav-number">1.2.2.3.</span> <span class="nav-text">2.2.5 health_interface</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-6-health-service-provider"><span class="nav-number">1.2.2.4.</span> <span class="nav-text">2.2.6 health_service_provider</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-7-health-backend"><span class="nav-number">1.2.2.5.</span> <span class="nav-text">2.2.7 health_backend</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Power-Designer"><span class="nav-number">1.3.</span> <span class="nav-text">3. Power Designer</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-Power-Designer%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.3.1.</span> <span class="nav-text">3.1 Power Designer介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-Power-Designer%E4%BD%BF%E7%94%A8"><span class="nav-number">1.3.2.</span> <span class="nav-text">3.2 Power Designer使用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1-%E5%88%9B%E5%BB%BA%E7%89%A9%E7%90%86%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">3.2.1 创建物理数据模型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-2-%E4%BB%8EPDM%E5%AF%BC%E5%87%BASQL%E8%84%9A%E6%9C%AC"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">3.2.2 从PDM导出SQL脚本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-3-%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B"><span class="nav-number">1.3.2.3.</span> <span class="nav-text">3.2.3 逆向工程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-4-%E7%94%9F%E6%88%90%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8A%A5%E8%A1%A8%E6%96%87%E4%BB%B6"><span class="nav-number">1.3.2.4.</span> <span class="nav-text">3.2.4 生成数据库报表文件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-ElementUI"><span class="nav-number">1.4.</span> <span class="nav-text">4. ElementUI</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-ElementUI%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.4.1.</span> <span class="nav-text">4.1 ElementUI介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6"><span class="nav-number">1.4.2.</span> <span class="nav-text">4.2 常用组件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-1-Container-%E5%B8%83%E5%B1%80%E5%AE%B9%E5%99%A8"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">4.2.1 Container 布局容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-2-Dropdown-%E4%B8%8B%E6%8B%89%E8%8F%9C%E5%8D%95"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">4.2.2 Dropdown 下拉菜单</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-3-NavMenu-%E5%AF%BC%E8%88%AA%E8%8F%9C%E5%8D%95"><span class="nav-number">1.4.2.3.</span> <span class="nav-text">4.2.3 NavMenu 导航菜单</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-4-Table-%E8%A1%A8%E6%A0%BC"><span class="nav-number">1.4.2.4.</span> <span class="nav-text">4.2.4 Table 表格</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-5-Pagination-%E5%88%86%E9%A1%B5"><span class="nav-number">1.4.2.5.</span> <span class="nav-text">4.2.5 Pagination 分页</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-6-Message-%E6%B6%88%E6%81%AF%E6%8F%90%E7%A4%BA"><span class="nav-number">1.4.2.6.</span> <span class="nav-text">4.2.6 Message 消息提示</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-7-Tabs-%E6%A0%87%E7%AD%BE%E9%A1%B5"><span class="nav-number">1.4.2.7.</span> <span class="nav-text">4.2.7 Tabs 标签页</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-8-Form-%E8%A1%A8%E5%8D%95"><span class="nav-number">1.4.2.8.</span> <span class="nav-text">4.2.8 Form 表单</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC2%E7%AB%A0-%E9%A2%84%E7%BA%A6%E7%AE%A1%E7%90%86-%E6%A3%80%E6%9F%A5%E9%A1%B9%E7%AE%A1%E7%90%86"><span class="nav-number">2.</span> <span class="nav-text">第2章 预约管理-检查项管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="nav-number">2.1.</span> <span class="nav-text">1. 需求分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="nav-number">2.2.</span> <span class="nav-text">2. 基础环境搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E5%AF%BC%E5%85%A5%E9%A2%84%E7%BA%A6%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97%E6%95%B0%E6%8D%AE%E8%A1%A8"><span class="nav-number">2.2.1.</span> <span class="nav-text">2.1 导入预约管理模块数据表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%AF%BC%E5%85%A5%E9%A2%84%E7%BA%A6%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="nav-number">2.2.2.</span> <span class="nav-text">2.2 导入预约管理模块实体类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E5%AF%BC%E5%85%A5%E9%A1%B9%E7%9B%AE%E6%89%80%E9%9C%80%E5%85%AC%E5%85%B1%E8%B5%84%E6%BA%90"><span class="nav-number">2.2.3.</span> <span class="nav-text">2.3 导入项目所需公共资源</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E6%96%B0%E5%A2%9E%E6%A3%80%E6%9F%A5%E9%A1%B9"><span class="nav-number">2.3.</span> <span class="nav-text">3. 新增检查项</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E5%AE%8C%E5%96%84%E9%A1%B5%E9%9D%A2"><span class="nav-number">2.3.1.</span> <span class="nav-text">3.1 完善页面</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-1-%E5%BC%B9%E5%87%BA%E6%96%B0%E5%A2%9E%E7%AA%97%E5%8F%A3"><span class="nav-number">2.3.1.1.</span> <span class="nav-text">3.1.1 弹出新增窗口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-2-%E8%BE%93%E5%85%A5%E6%A0%A1%E9%AA%8C"><span class="nav-number">2.3.1.2.</span> <span class="nav-text">3.1.2 输入校验</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-3-%E6%8F%90%E4%BA%A4%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE"><span class="nav-number">2.3.1.3.</span> <span class="nav-text">3.1.3 提交表单数据</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81"><span class="nav-number">2.3.2.</span> <span class="nav-text">3.2 后台代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1-Controller"><span class="nav-number">2.3.2.1.</span> <span class="nav-text">3.2.1 Controller</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-2-%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3"><span class="nav-number">2.3.2.2.</span> <span class="nav-text">3.2.2 服务接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-3-%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="nav-number">2.3.2.3.</span> <span class="nav-text">3.2.3 服务实现类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-4-Dao%E6%8E%A5%E5%8F%A3"><span class="nav-number">2.3.2.4.</span> <span class="nav-text">3.2.4 Dao接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-5-Mapper%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6"><span class="nav-number">2.3.2.5.</span> <span class="nav-text">3.2.5 Mapper映射文件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E6%A3%80%E6%9F%A5%E9%A1%B9%E5%88%86%E9%A1%B5"><span class="nav-number">2.4.</span> <span class="nav-text">4. 检查项分页</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E5%AE%8C%E5%96%84%E9%A1%B5%E9%9D%A2"><span class="nav-number">2.4.1.</span> <span class="nav-text">4.1 完善页面</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-1-%E5%AE%9A%E4%B9%89%E5%88%86%E9%A1%B5%E7%9B%B8%E5%85%B3%E6%A8%A1%E5%9E%8B%E6%95%B0%E6%8D%AE"><span class="nav-number">2.4.1.1.</span> <span class="nav-text">4.1.1 定义分页相关模型数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-2-%E5%AE%9A%E4%B9%89%E5%88%86%E9%A1%B5%E6%96%B9%E6%B3%95"><span class="nav-number">2.4.1.2.</span> <span class="nav-text">4.1.2 定义分页方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-3-%E5%AE%8C%E5%96%84%E5%88%86%E9%A1%B5%E6%96%B9%E6%B3%95%E6%89%A7%E8%A1%8C%E6%97%B6%E6%9C%BA"><span class="nav-number">2.4.1.3.</span> <span class="nav-text">4.1.3 完善分页方法执行时机</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81"><span class="nav-number">2.4.2.</span> <span class="nav-text">4.2 后台代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-1-Controller"><span class="nav-number">2.4.2.1.</span> <span class="nav-text">4.2.1 Controller</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-2-%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3"><span class="nav-number">2.4.2.2.</span> <span class="nav-text">4.2.2 服务接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-3-%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="nav-number">2.4.2.3.</span> <span class="nav-text">4.2.3 服务实现类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-4-Dao%E6%8E%A5%E5%8F%A3"><span class="nav-number">2.4.2.4.</span> <span class="nav-text">4.2.4 Dao接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-5-Mapper%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6"><span class="nav-number">2.4.2.5.</span> <span class="nav-text">4.2.5 Mapper映射文件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E5%88%A0%E9%99%A4%E6%A3%80%E6%9F%A5%E9%A1%B9"><span class="nav-number">2.5.</span> <span class="nav-text">5. 删除检查项</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-%E5%AE%8C%E5%96%84%E9%A1%B5%E9%9D%A2"><span class="nav-number">2.5.1.</span> <span class="nav-text">5.1 完善页面</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-1-%E7%BB%91%E5%AE%9A%E5%8D%95%E5%87%BB%E4%BA%8B%E4%BB%B6"><span class="nav-number">2.5.1.1.</span> <span class="nav-text">5.1.1 绑定单击事件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-2-%E5%BC%B9%E5%87%BA%E7%A1%AE%E8%AE%A4%E6%93%8D%E4%BD%9C%E6%8F%90%E7%A4%BA"><span class="nav-number">2.5.1.2.</span> <span class="nav-text">5.1.2 弹出确认操作提示</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-3-%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82"><span class="nav-number">2.5.1.3.</span> <span class="nav-text">5.1.3 发送请求</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81"><span class="nav-number">2.5.2.</span> <span class="nav-text">5.2 后台代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-1-Controller"><span class="nav-number">2.5.2.1.</span> <span class="nav-text">5.2.1 Controller</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-2-%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3"><span class="nav-number">2.5.2.2.</span> <span class="nav-text">5.2.2 服务接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-3-%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="nav-number">2.5.2.3.</span> <span class="nav-text">5.2.3 服务实现类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-4-Dao%E6%8E%A5%E5%8F%A3"><span class="nav-number">2.5.2.4.</span> <span class="nav-text">5.2.4 Dao接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-5-Mapper%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6"><span class="nav-number">2.5.2.5.</span> <span class="nav-text">5.2.5 Mapper映射文件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E7%BC%96%E8%BE%91%E6%A3%80%E6%9F%A5%E9%A1%B9"><span class="nav-number">2.6.</span> <span class="nav-text">6. 编辑检查项</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-%E5%AE%8C%E5%96%84%E9%A1%B5%E9%9D%A2"><span class="nav-number">2.6.1.</span> <span class="nav-text">6.1 完善页面</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-1-1-%E7%BB%91%E5%AE%9A%E5%8D%95%E5%87%BB%E4%BA%8B%E4%BB%B6"><span class="nav-number">2.6.1.1.</span> <span class="nav-text">6.1.1 绑定单击事件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-1-2-%E5%BC%B9%E5%87%BA%E7%BC%96%E8%BE%91%E7%AA%97%E5%8F%A3%E5%9B%9E%E6%98%BE%E6%95%B0%E6%8D%AE"><span class="nav-number">2.6.1.2.</span> <span class="nav-text">6.1.2 弹出编辑窗口回显数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-1-3-%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82"><span class="nav-number">2.6.1.3.</span> <span class="nav-text">6.1.3 发送请求</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81"><span class="nav-number">2.6.2.</span> <span class="nav-text">6.2 后台代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-1-Controller"><span class="nav-number">2.6.2.1.</span> <span class="nav-text">6.2.1 Controller</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-2-%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3"><span class="nav-number">2.6.2.2.</span> <span class="nav-text">6.2.2 服务接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-3-%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="nav-number">2.6.2.3.</span> <span class="nav-text">6.2.3 服务实现类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-4-Dao%E6%8E%A5%E5%8F%A3"><span class="nav-number">2.6.2.4.</span> <span class="nav-text">6.2.4 Dao接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-5-Mapper%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6"><span class="nav-number">2.6.2.5.</span> <span class="nav-text">6.2.5 Mapper映射文件</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC3%E7%AB%A0-%E9%A2%84%E7%BA%A6%E7%AE%A1%E7%90%86-%E6%A3%80%E6%9F%A5%E7%BB%84%E7%AE%A1%E7%90%86"><span class="nav-number">3.</span> <span class="nav-text">第3章 预约管理-检查组管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-1"><span class="nav-number">3.1.</span> <span class="nav-text">1. 需求分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%96%B0%E5%A2%9E%E6%A3%80%E6%9F%A5%E7%BB%84"><span class="nav-number">3.2.</span> <span class="nav-text">2. 新增检查组</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E5%AE%8C%E5%96%84%E9%A1%B5%E9%9D%A2"><span class="nav-number">3.2.1.</span> <span class="nav-text">2.1 完善页面</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-1-%E5%BC%B9%E5%87%BA%E6%96%B0%E5%A2%9E%E7%AA%97%E5%8F%A3"><span class="nav-number">3.2.1.1.</span> <span class="nav-text">2.1.1 弹出新增窗口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-2-%E5%8A%A8%E6%80%81%E5%B1%95%E7%A4%BA%E6%A3%80%E6%9F%A5%E9%A1%B9%E5%88%97%E8%A1%A8"><span class="nav-number">3.2.1.2.</span> <span class="nav-text">2.1.2 动态展示检查项列表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-3-%E6%8F%90%E4%BA%A4%E8%AF%B7%E6%B1%82"><span class="nav-number">3.2.1.3.</span> <span class="nav-text">2.1.3 提交请求</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81"><span class="nav-number">3.2.2.</span> <span class="nav-text">2.2 后台代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-Controller"><span class="nav-number">3.2.2.1.</span> <span class="nav-text">2.2.1 Controller</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3"><span class="nav-number">3.2.2.2.</span> <span class="nav-text">2.2.2 服务接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-3-%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="nav-number">3.2.2.3.</span> <span class="nav-text">2.2.3 服务实现类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-4-Dao%E6%8E%A5%E5%8F%A3"><span class="nav-number">3.2.2.4.</span> <span class="nav-text">2.2.4 Dao接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-5-Mapper%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6"><span class="nav-number">3.2.2.5.</span> <span class="nav-text">2.2.5 Mapper映射文件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E6%A3%80%E6%9F%A5%E7%BB%84%E5%88%86%E9%A1%B5"><span class="nav-number">3.3.</span> <span class="nav-text">3. 检查组分页</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E5%AE%8C%E5%96%84%E9%A1%B5%E9%9D%A2-1"><span class="nav-number">3.3.1.</span> <span class="nav-text">3.1 完善页面</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-1-%E5%AE%9A%E4%B9%89%E5%88%86%E9%A1%B5%E7%9B%B8%E5%85%B3%E6%A8%A1%E5%9E%8B%E6%95%B0%E6%8D%AE"><span class="nav-number">3.3.1.1.</span> <span class="nav-text">3.1.1 定义分页相关模型数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-2-%E5%AE%9A%E4%B9%89%E5%88%86%E9%A1%B5%E6%96%B9%E6%B3%95"><span class="nav-number">3.3.1.2.</span> <span class="nav-text">3.1.2 定义分页方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-3-%E5%AE%8C%E5%96%84%E5%88%86%E9%A1%B5%E6%96%B9%E6%B3%95%E6%89%A7%E8%A1%8C%E6%97%B6%E6%9C%BA"><span class="nav-number">3.3.1.3.</span> <span class="nav-text">3.1.3 完善分页方法执行时机</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81-1"><span class="nav-number">3.3.2.</span> <span class="nav-text">3.2 后台代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1-Controller-1"><span class="nav-number">3.3.2.1.</span> <span class="nav-text">3.2.1 Controller</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-2-%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3-1"><span class="nav-number">3.3.2.2.</span> <span class="nav-text">3.2.2 服务接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-3-%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E7%B1%BB-1"><span class="nav-number">3.3.2.3.</span> <span class="nav-text">3.2.3 服务实现类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-4-Dao%E6%8E%A5%E5%8F%A3-1"><span class="nav-number">3.3.2.4.</span> <span class="nav-text">3.2.4 Dao接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-5-Mapper%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-1"><span class="nav-number">3.3.2.5.</span> <span class="nav-text">3.2.5 Mapper映射文件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E7%BC%96%E8%BE%91%E6%A3%80%E6%9F%A5%E7%BB%84"><span class="nav-number">3.4.</span> <span class="nav-text">4. 编辑检查组</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E5%AE%8C%E5%96%84%E9%A1%B5%E9%9D%A2-1"><span class="nav-number">3.4.1.</span> <span class="nav-text">4.1 完善页面</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-1-%E7%BB%91%E5%AE%9A%E5%8D%95%E5%87%BB%E4%BA%8B%E4%BB%B6"><span class="nav-number">3.4.1.1.</span> <span class="nav-text">4.1.1 绑定单击事件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-2-%E5%BC%B9%E5%87%BA%E7%BC%96%E8%BE%91%E7%AA%97%E5%8F%A3%E5%9B%9E%E6%98%BE%E6%95%B0%E6%8D%AE"><span class="nav-number">3.4.1.2.</span> <span class="nav-text">4.1.2 弹出编辑窗口回显数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-3-%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82"><span class="nav-number">3.4.1.3.</span> <span class="nav-text">4.1.3 发送请求</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81-1"><span class="nav-number">3.4.2.</span> <span class="nav-text">4.2 后台代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-1-Controller-1"><span class="nav-number">3.4.2.1.</span> <span class="nav-text">4.2.1 Controller</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-2-%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3-1"><span class="nav-number">3.4.2.2.</span> <span class="nav-text">4.2.2 服务接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-3-%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E7%B1%BB-1"><span class="nav-number">3.4.2.3.</span> <span class="nav-text">4.2.3 服务实现类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-4-Dao%E6%8E%A5%E5%8F%A3-1"><span class="nav-number">3.4.2.4.</span> <span class="nav-text">4.2.4 Dao接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-5-Mapper%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-1"><span class="nav-number">3.4.2.5.</span> <span class="nav-text">4.2.5 Mapper映射文件</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC4%E7%AB%A0-%E9%A2%84%E7%BA%A6%E7%AE%A1%E7%90%86-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86"><span class="nav-number">4.</span> <span class="nav-text">第4章 预约管理-套餐管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%9B%BE%E7%89%87%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88"><span class="nav-number">4.1.</span> <span class="nav-text">1. 图片存储方案</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E4%BB%8B%E7%BB%8D"><span class="nav-number">4.1.1.</span> <span class="nav-text">1.1 介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E4%B8%83%E7%89%9B%E4%BA%91%E5%AD%98%E5%82%A8"><span class="nav-number">4.1.2.</span> <span class="nav-text">1.2 七牛云存储</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-1-%E6%B3%A8%E5%86%8C%E3%80%81%E7%99%BB%E5%BD%95"><span class="nav-number">4.1.2.1.</span> <span class="nav-text">1.2.1 注册、登录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-2-%E6%96%B0%E5%BB%BA%E5%AD%98%E5%82%A8%E7%A9%BA%E9%97%B4"><span class="nav-number">4.1.2.2.</span> <span class="nav-text">1.2.2 新建存储空间</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-3-%E6%9F%A5%E7%9C%8B%E5%AD%98%E5%82%A8%E7%A9%BA%E9%97%B4%E4%BF%A1%E6%81%AF"><span class="nav-number">4.1.2.3.</span> <span class="nav-text">1.2.3 查看存储空间信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-4-%E5%BC%80%E5%8F%91%E8%80%85%E4%B8%AD%E5%BF%83"><span class="nav-number">4.1.2.4.</span> <span class="nav-text">1.2.4 开发者中心</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-5-%E9%89%B4%E6%9D%83"><span class="nav-number">4.1.2.5.</span> <span class="nav-text">1.2.5 鉴权</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-6-Java-SDK%E6%93%8D%E4%BD%9C%E4%B8%83%E7%89%9B%E4%BA%91"><span class="nav-number">4.1.2.6.</span> <span class="nav-text">1.2.6 Java SDK操作七牛云</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-7-%E5%B0%81%E8%A3%85%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="nav-number">4.1.2.7.</span> <span class="nav-text">1.2.7 封装工具类</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%96%B0%E5%A2%9E%E5%A5%97%E9%A4%90"><span class="nav-number">4.2.</span> <span class="nav-text">2. 新增套餐</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="nav-number">4.2.1.</span> <span class="nav-text">2.1 需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%AE%8C%E5%96%84%E9%A1%B5%E9%9D%A2"><span class="nav-number">4.2.2.</span> <span class="nav-text">2.2 完善页面</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-%E5%BC%B9%E5%87%BA%E6%96%B0%E5%A2%9E%E7%AA%97%E5%8F%A3"><span class="nav-number">4.2.2.1.</span> <span class="nav-text">2.2.1 弹出新增窗口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-%E5%8A%A8%E6%80%81%E5%B1%95%E7%A4%BA%E6%A3%80%E6%9F%A5%E7%BB%84%E5%88%97%E8%A1%A8"><span class="nav-number">4.2.2.2.</span> <span class="nav-text">2.2.2 动态展示检查组列表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-3-%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0%E5%B9%B6%E9%A2%84%E8%A7%88"><span class="nav-number">4.2.2.3.</span> <span class="nav-text">2.2.3 图片上传并预览</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-4-%E6%8F%90%E4%BA%A4%E8%AF%B7%E6%B1%82"><span class="nav-number">4.2.2.4.</span> <span class="nav-text">2.2.4 提交请求</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81"><span class="nav-number">4.2.3.</span> <span class="nav-text">2.3 后台代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-1-Controller"><span class="nav-number">4.2.3.1.</span> <span class="nav-text">2.3.1 Controller</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-2-%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3"><span class="nav-number">4.2.3.2.</span> <span class="nav-text">2.3.2 服务接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-3-%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="nav-number">4.2.3.3.</span> <span class="nav-text">2.3.3 服务实现类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-4-Dao%E6%8E%A5%E5%8F%A3"><span class="nav-number">4.2.3.4.</span> <span class="nav-text">2.3.4 Dao接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-5-Mapper%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6"><span class="nav-number">4.2.3.5.</span> <span class="nav-text">2.3.5 Mapper映射文件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-%E5%AE%8C%E5%96%84%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="nav-number">4.2.4.</span> <span class="nav-text">2.4 完善文件上传</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E4%BD%93%E6%A3%80%E5%A5%97%E9%A4%90%E5%88%86%E9%A1%B5"><span class="nav-number">4.3.</span> <span class="nav-text">3. 体检套餐分页</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E5%AE%8C%E5%96%84%E9%A1%B5%E9%9D%A2-2"><span class="nav-number">4.3.1.</span> <span class="nav-text">3.1 完善页面</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-1-%E5%AE%9A%E4%B9%89%E5%88%86%E9%A1%B5%E7%9B%B8%E5%85%B3%E6%A8%A1%E5%9E%8B%E6%95%B0%E6%8D%AE-1"><span class="nav-number">4.3.1.1.</span> <span class="nav-text">3.1.1 定义分页相关模型数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-2-%E5%AE%9A%E4%B9%89%E5%88%86%E9%A1%B5%E6%96%B9%E6%B3%95-1"><span class="nav-number">4.3.1.2.</span> <span class="nav-text">3.1.2 定义分页方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-3-%E5%AE%8C%E5%96%84%E5%88%86%E9%A1%B5%E6%96%B9%E6%B3%95%E6%89%A7%E8%A1%8C%E6%97%B6%E6%9C%BA-1"><span class="nav-number">4.3.1.3.</span> <span class="nav-text">3.1.3 完善分页方法执行时机</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81-2"><span class="nav-number">4.3.2.</span> <span class="nav-text">3.2 后台代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1-Controller-2"><span class="nav-number">4.3.2.1.</span> <span class="nav-text">3.2.1 Controller</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-2-%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3-2"><span class="nav-number">4.3.2.2.</span> <span class="nav-text">3.2.2 服务接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-3-%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E7%B1%BB-2"><span class="nav-number">4.3.2.3.</span> <span class="nav-text">3.2.3 服务实现类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-4-Dao%E6%8E%A5%E5%8F%A3-2"><span class="nav-number">4.3.2.4.</span> <span class="nav-text">3.2.4 Dao接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-5-Mapper%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-2"><span class="nav-number">4.3.2.5.</span> <span class="nav-text">3.2.5 Mapper映射文件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E7%BB%84%E4%BB%B6Quartz"><span class="nav-number">4.4.</span> <span class="nav-text">4. 定时任务组件Quartz</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-Quartz%E4%BB%8B%E7%BB%8D"><span class="nav-number">4.4.1.</span> <span class="nav-text">4.1 Quartz介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-Quartz%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B"><span class="nav-number">4.4.2.</span> <span class="nav-text">4.2 Quartz入门案例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-cron%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">4.4.3.</span> <span class="nav-text">4.3 cron表达式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-cron%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%9C%A8%E7%BA%BF%E7%94%9F%E6%88%90%E5%99%A8"><span class="nav-number">4.4.4.</span> <span class="nav-text">4.4 cron表达式在线生成器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E5%AE%9A%E6%97%B6%E6%B8%85%E7%90%86%E5%9E%83%E5%9C%BE%E5%9B%BE%E7%89%87"><span class="nav-number">4.5.</span> <span class="nav-text">5. 定时清理垃圾图片</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC5%E7%AB%A0-%E9%A2%84%E7%BA%A6%E7%AE%A1%E7%90%86-%E9%A2%84%E7%BA%A6%E8%AE%BE%E7%BD%AE"><span class="nav-number">5.</span> <span class="nav-text">第5章 预约管理-预约设置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-2"><span class="nav-number">5.1.</span> <span class="nav-text">1. 需求分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Apache-POI"><span class="nav-number">5.2.</span> <span class="nav-text">2. Apache POI</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-POI%E4%BB%8B%E7%BB%8D"><span class="nav-number">5.2.1.</span> <span class="nav-text">2.1 POI介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B"><span class="nav-number">5.2.2.</span> <span class="nav-text">2.2 入门案例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-%E4%BB%8EExcel%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="nav-number">5.2.2.1.</span> <span class="nav-text">2.2.1 从Excel文件读取数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-%E5%90%91Excel%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="nav-number">5.2.2.2.</span> <span class="nav-text">2.2.2 向Excel文件写入数据</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E6%89%B9%E9%87%8F%E5%AF%BC%E5%85%A5%E9%A2%84%E7%BA%A6%E8%AE%BE%E7%BD%AE%E4%BF%A1%E6%81%AF"><span class="nav-number">5.3.</span> <span class="nav-text">3. 批量导入预约设置信息</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E5%AE%8C%E5%96%84%E9%A1%B5%E9%9D%A2-3"><span class="nav-number">5.3.1.</span> <span class="nav-text">3.1 完善页面</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-1-%E6%8F%90%E4%BE%9B%E6%A8%A1%E6%9D%BF%E6%96%87%E4%BB%B6"><span class="nav-number">5.3.1.1.</span> <span class="nav-text">3.1.1 提供模板文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-2-%E5%AE%9E%E7%8E%B0%E6%A8%A1%E6%9D%BF%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD"><span class="nav-number">5.3.1.2.</span> <span class="nav-text">3.1.2 实现模板文件下载</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-3-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="nav-number">5.3.1.3.</span> <span class="nav-text">3.1.3 文件上传</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81-3"><span class="nav-number">5.3.2.</span> <span class="nav-text">3.2 后台代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1-Controller-3"><span class="nav-number">5.3.2.1.</span> <span class="nav-text">3.2.1 Controller</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-2-%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3-3"><span class="nav-number">5.3.2.2.</span> <span class="nav-text">3.2.2 服务接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-3-%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E7%B1%BB-3"><span class="nav-number">5.3.2.3.</span> <span class="nav-text">3.2.3 服务实现类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-4-Dao%E6%8E%A5%E5%8F%A3-3"><span class="nav-number">5.3.2.4.</span> <span class="nav-text">3.2.4 Dao接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-5-Mapper%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-3"><span class="nav-number">5.3.2.5.</span> <span class="nav-text">3.2.5 Mapper映射文件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E6%97%A5%E5%8E%86%E5%B1%95%E7%A4%BA%E9%A2%84%E7%BA%A6%E8%AE%BE%E7%BD%AE%E4%BF%A1%E6%81%AF"><span class="nav-number">5.4.</span> <span class="nav-text">4. 日历展示预约设置信息</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E5%AE%8C%E5%96%84%E9%A1%B5%E9%9D%A2-2"><span class="nav-number">5.4.1.</span> <span class="nav-text">4.1 完善页面</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-1-%E4%BD%BF%E7%94%A8%E9%9D%99%E6%80%81%E6%95%B0%E6%8D%AE%E8%B0%83%E8%AF%95"><span class="nav-number">5.4.1.1.</span> <span class="nav-text">4.1.1 使用静态数据调试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-2-%E5%8F%91%E9%80%81ajax%E8%8E%B7%E5%8F%96%E5%8A%A8%E6%80%81%E6%95%B0%E6%8D%AE"><span class="nav-number">5.4.1.2.</span> <span class="nav-text">4.1.2 发送ajax获取动态数据</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81-2"><span class="nav-number">5.4.2.</span> <span class="nav-text">4.2 后台代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-1-Controller-2"><span class="nav-number">5.4.2.1.</span> <span class="nav-text">4.2.1 Controller</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-2-%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3-2"><span class="nav-number">5.4.2.2.</span> <span class="nav-text">4.2.2 服务接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-3-%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E7%B1%BB-2"><span class="nav-number">5.4.2.3.</span> <span class="nav-text">4.2.3 服务实现类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-4-Dao%E6%8E%A5%E5%8F%A3-2"><span class="nav-number">5.4.2.4.</span> <span class="nav-text">4.2.4 Dao接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-5-Mapper%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-2"><span class="nav-number">5.4.2.5.</span> <span class="nav-text">4.2.5 Mapper映射文件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E5%9F%BA%E4%BA%8E%E6%97%A5%E5%8E%86%E5%AE%9E%E7%8E%B0%E9%A2%84%E7%BA%A6%E8%AE%BE%E7%BD%AE"><span class="nav-number">5.5.</span> <span class="nav-text">5. 基于日历实现预约设置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-%E5%AE%8C%E5%96%84%E9%A1%B5%E9%9D%A2-1"><span class="nav-number">5.5.1.</span> <span class="nav-text">5.1 完善页面</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-1-%E4%B8%BA%E8%AE%BE%E7%BD%AE%E6%8C%89%E9%92%AE%E7%BB%91%E5%AE%9A%E4%BA%8B%E4%BB%B6"><span class="nav-number">5.5.1.1.</span> <span class="nav-text">5.1.1 为设置按钮绑定事件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-2-%E5%BC%B9%E5%87%BA%E9%A2%84%E7%BA%A6%E8%AE%BE%E7%BD%AE%E7%AA%97%E5%8F%A3%E5%B9%B6%E5%8F%91%E9%80%81ajax%E8%AF%B7%E6%B1%82"><span class="nav-number">5.5.1.2.</span> <span class="nav-text">5.1.2 弹出预约设置窗口并发送ajax请求</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81-1"><span class="nav-number">5.5.2.</span> <span class="nav-text">5.2 后台代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-1-Controller-1"><span class="nav-number">5.5.2.1.</span> <span class="nav-text">5.2.1 Controller</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-2-%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3-1"><span class="nav-number">5.5.2.2.</span> <span class="nav-text">5.2.2 服务接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-3-%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E7%B1%BB-1"><span class="nav-number">5.5.2.3.</span> <span class="nav-text">5.2.3 服务实现类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-4-Dao%E6%8E%A5%E5%8F%A3-1"><span class="nav-number">5.5.2.4.</span> <span class="nav-text">5.2.4 Dao接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-5-Mapper%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-1"><span class="nav-number">5.5.2.5.</span> <span class="nav-text">5.2.5 Mapper映射文件</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC6%E7%AB%A0-%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%BC%80%E5%8F%91-%E4%BD%93%E6%A3%80%E9%A2%84%E7%BA%A6"><span class="nav-number">6.</span> <span class="nav-text">第6章 移动端开发-体检预约</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%BC%80%E5%8F%91"><span class="nav-number">6.1.</span> <span class="nav-text">1. 移动端开发</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%BC%80%E5%8F%91%E6%96%B9%E5%BC%8F"><span class="nav-number">6.1.1.</span> <span class="nav-text">1.1 移动端开发方式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-1-%E5%9F%BA%E4%BA%8E%E6%89%8B%E6%9C%BAAPI%E5%BC%80%E5%8F%91"><span class="nav-number">6.1.1.1.</span> <span class="nav-text">1.1.1 基于手机API开发</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-2-%E5%9F%BA%E4%BA%8E%E6%89%8B%E6%9C%BA%E6%B5%8F%E8%A7%88%E5%99%A8%E5%BC%80%E5%8F%91"><span class="nav-number">6.1.1.2.</span> <span class="nav-text">1.1.2 基于手机浏览器开发</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-3-%E6%B7%B7%E5%90%88%E5%BC%80%E5%8F%91"><span class="nav-number">6.1.1.3.</span> <span class="nav-text">1.1.3 混合开发</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91"><span class="nav-number">6.1.2.</span> <span class="nav-text">1.2 微信公众号开发</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-1-%E5%B8%90%E5%8F%B7%E5%88%86%E7%B1%BB"><span class="nav-number">6.1.2.1.</span> <span class="nav-text">1.2.1 帐号分类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-2-%E6%B3%A8%E5%86%8C%E5%B8%90%E5%8F%B7"><span class="nav-number">6.1.2.2.</span> <span class="nav-text">1.2.2 注册帐号</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-3-%E8%87%AA%E5%AE%9A%E4%B9%89%E8%8F%9C%E5%8D%95"><span class="nav-number">6.1.2.3.</span> <span class="nav-text">1.2.3 自定义菜单</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-4-%E4%B8%8A%E7%BA%BF%E8%A6%81%E6%B1%82"><span class="nav-number">6.1.2.4.</span> <span class="nav-text">1.2.4 上线要求</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="nav-number">6.2.</span> <span class="nav-text">2. 需求分析和环境搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-1"><span class="nav-number">6.2.1.</span> <span class="nav-text">2.1 需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E6%90%AD%E5%BB%BA%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%B7%A5%E7%A8%8B"><span class="nav-number">6.2.2.</span> <span class="nav-text">2.2 搭建移动端工程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-%E5%AF%BC%E5%85%A5maven%E5%9D%90%E6%A0%87"><span class="nav-number">6.2.2.1.</span> <span class="nav-text">2.2.1 导入maven坐标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-%E5%AF%BC%E5%85%A5%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6"><span class="nav-number">6.2.2.2.</span> <span class="nav-text">2.2.2 导入通用组件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-3-health-mobile"><span class="nav-number">6.2.2.3.</span> <span class="nav-text">2.2.3 health_mobile</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%A5%97%E9%A4%90%E5%88%97%E8%A1%A8%E9%A1%B5%E9%9D%A2%E5%8A%A8%E6%80%81%E5%B1%95%E7%A4%BA"><span class="nav-number">6.3.</span> <span class="nav-text">3. 套餐列表页面动态展示</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E5%AE%8C%E5%96%84%E9%A1%B5%E9%9D%A2-4"><span class="nav-number">6.3.1.</span> <span class="nav-text">3.1 完善页面</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-1-%E5%B1%95%E7%A4%BA%E5%A5%97%E9%A4%90%E4%BF%A1%E6%81%AF"><span class="nav-number">6.3.1.1.</span> <span class="nav-text">3.1.1 展示套餐信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-2-%E8%8E%B7%E5%8F%96%E5%A5%97%E9%A4%90%E5%88%97%E8%A1%A8%E6%95%B0%E6%8D%AE"><span class="nav-number">6.3.1.2.</span> <span class="nav-text">3.1.2 获取套餐列表数据</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81-4"><span class="nav-number">6.3.2.</span> <span class="nav-text">3.2 后台代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1-Controller-4"><span class="nav-number">6.3.2.1.</span> <span class="nav-text">3.2.1 Controller</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-2-%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3-4"><span class="nav-number">6.3.2.2.</span> <span class="nav-text">3.2.2 服务接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-3-%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E7%B1%BB-4"><span class="nav-number">6.3.2.3.</span> <span class="nav-text">3.2.3 服务实现类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-4-Dao%E6%8E%A5%E5%8F%A3-4"><span class="nav-number">6.3.2.4.</span> <span class="nav-text">3.2.4 Dao接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-5-Mapper%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-4"><span class="nav-number">6.3.2.5.</span> <span class="nav-text">3.2.5 Mapper映射文件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E5%A5%97%E9%A4%90%E8%AF%A6%E6%83%85%E9%A1%B5%E9%9D%A2%E5%8A%A8%E6%80%81%E5%B1%95%E7%A4%BA"><span class="nav-number">6.4.</span> <span class="nav-text">4. 套餐详情页面动态展示</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E5%AE%8C%E5%96%84%E9%A1%B5%E9%9D%A2-3"><span class="nav-number">6.4.1.</span> <span class="nav-text">4.1 完善页面</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-1-%E8%8E%B7%E5%8F%96%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E4%B8%AD%E5%A5%97%E9%A4%90id"><span class="nav-number">6.4.1.1.</span> <span class="nav-text">4.1.1 获取请求参数中套餐id</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-2-%E8%8E%B7%E5%8F%96%E5%A5%97%E9%A4%90%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF"><span class="nav-number">6.4.1.2.</span> <span class="nav-text">4.1.2 获取套餐详细信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-3-%E5%B1%95%E7%A4%BA%E5%A5%97%E9%A4%90%E4%BF%A1%E6%81%AF"><span class="nav-number">6.4.1.3.</span> <span class="nav-text">4.1.3 展示套餐信息</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81-3"><span class="nav-number">6.4.2.</span> <span class="nav-text">4.2 后台代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-1-Controller-3"><span class="nav-number">6.4.2.1.</span> <span class="nav-text">4.2.1 Controller</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-2-%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3-3"><span class="nav-number">6.4.2.2.</span> <span class="nav-text">4.2.2 服务接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-3-%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E7%B1%BB-3"><span class="nav-number">6.4.2.3.</span> <span class="nav-text">4.2.3 服务实现类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-4-Dao%E6%8E%A5%E5%8F%A3-3"><span class="nav-number">6.4.2.4.</span> <span class="nav-text">4.2.4 Dao接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-5-Mapper%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-3"><span class="nav-number">6.4.2.5.</span> <span class="nav-text">4.2.5 Mapper映射文件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E7%9F%AD%E4%BF%A1%E5%8F%91%E9%80%81"><span class="nav-number">6.5.</span> <span class="nav-text">5. 短信发送</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-%E7%9F%AD%E4%BF%A1%E6%9C%8D%E5%8A%A1%E4%BB%8B%E7%BB%8D"><span class="nav-number">6.5.1.</span> <span class="nav-text">5.1 短信服务介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-%E6%B3%A8%E5%86%8C%E9%98%BF%E9%87%8C%E4%BA%91%E8%B4%A6%E5%8F%B7"><span class="nav-number">6.5.2.</span> <span class="nav-text">5.2 注册阿里云账号</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-%E8%AE%BE%E7%BD%AE%E7%9F%AD%E4%BF%A1%E7%AD%BE%E5%90%8D"><span class="nav-number">6.5.3.</span> <span class="nav-text">5.3 设置短信签名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-%E8%AE%BE%E7%BD%AE%E7%9F%AD%E4%BF%A1%E6%A8%A1%E6%9D%BF"><span class="nav-number">6.5.4.</span> <span class="nav-text">5.4 设置短信模板</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-5-%E8%AE%BE%E7%BD%AEaccess-keys"><span class="nav-number">6.5.5.</span> <span class="nav-text">5.5 设置access keys</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-6-%E5%8F%91%E9%80%81%E7%9F%AD%E4%BF%A1"><span class="nav-number">6.5.6.</span> <span class="nav-text">5.6 发送短信</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-6-1-%E5%AF%BC%E5%85%A5maven%E5%9D%90%E6%A0%87"><span class="nav-number">6.5.6.1.</span> <span class="nav-text">5.6.1 导入maven坐标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-6-2-%E5%B0%81%E8%A3%85%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="nav-number">6.5.6.2.</span> <span class="nav-text">5.6.2 封装工具类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-6-3-%E6%B5%8B%E8%AF%95%E7%9F%AD%E4%BF%A1%E5%8F%91%E9%80%81"><span class="nav-number">6.5.6.3.</span> <span class="nav-text">5.6.3 测试短信发送</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC7%E7%AB%A0-%E9%A1%B5%E9%9D%A2%E9%9D%99%E6%80%81%E5%8C%96"><span class="nav-number">7.</span> <span class="nav-text">第7章 页面静态化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E9%A1%B5%E9%9D%A2%E9%9D%99%E6%80%81%E5%8C%96%E4%BB%8B%E7%BB%8D"><span class="nav-number">7.1.</span> <span class="nav-text">1. 页面静态化介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Freemarker%E4%BB%8B%E7%BB%8D"><span class="nav-number">7.2.</span> <span class="nav-text">2. Freemarker介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Freemarker%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B"><span class="nav-number">7.3.</span> <span class="nav-text">3. Freemarker入门案例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="nav-number">7.3.1.</span> <span class="nav-text">3.1 环境搭建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E5%88%9B%E5%BB%BA%E6%A8%A1%E6%9D%BF%E6%96%87%E4%BB%B6"><span class="nav-number">7.3.2.</span> <span class="nav-text">3.2 创建模板文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E7%94%9F%E6%88%90%E6%96%87%E4%BB%B6"><span class="nav-number">7.3.3.</span> <span class="nav-text">3.3 生成文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-Freemarker%E6%8C%87%E4%BB%A4"><span class="nav-number">7.4.</span> <span class="nav-text">4. Freemarker指令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-assign%E6%8C%87%E4%BB%A4"><span class="nav-number">7.4.1.</span> <span class="nav-text">4.1 assign指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-include%E6%8C%87%E4%BB%A4"><span class="nav-number">7.4.2.</span> <span class="nav-text">4.2 include指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-if%E6%8C%87%E4%BB%A4"><span class="nav-number">7.4.3.</span> <span class="nav-text">4.3 if指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-list%E6%8C%87%E4%BB%A4"><span class="nav-number">7.4.4.</span> <span class="nav-text">4.4 list指令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E7%94%9F%E6%88%90%E7%A7%BB%E5%8A%A8%E7%AB%AF%E9%9D%99%E6%80%81%E9%A1%B5%E9%9D%A2"><span class="nav-number">7.5.</span> <span class="nav-text">5. 生成移动端静态页面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="nav-number">7.5.1.</span> <span class="nav-text">5.1 环境搭建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-%E5%88%9B%E5%BB%BA%E6%A8%A1%E6%9D%BF%E6%96%87%E4%BB%B6"><span class="nav-number">7.5.2.</span> <span class="nav-text">5.2 创建模板文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">7.5.3.</span> <span class="nav-text">5.3 配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-%E7%94%9F%E6%88%90%E9%9D%99%E6%80%81%E9%A1%B5%E9%9D%A2"><span class="nav-number">7.5.4.</span> <span class="nav-text">5.4 生成静态页面</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC8%E7%AB%A0-%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%BC%80%E5%8F%91-%E4%BD%93%E6%A3%80%E9%A2%84%E7%BA%A6"><span class="nav-number">8.</span> <span class="nav-text">第8章 移动端开发-体检预约</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E4%BD%93%E6%A3%80%E9%A2%84%E7%BA%A6%E6%B5%81%E7%A8%8B"><span class="nav-number">8.1.</span> <span class="nav-text">1. 体检预约流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E4%BD%93%E6%A3%80%E9%A2%84%E7%BA%A6"><span class="nav-number">8.2.</span> <span class="nav-text">2. 体检预约</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E9%A1%B5%E9%9D%A2%E8%B0%83%E6%95%B4"><span class="nav-number">8.2.1.</span> <span class="nav-text">2.1 页面调整</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-1-%E5%B1%95%E7%A4%BA%E9%A2%84%E7%BA%A6%E7%9A%84%E5%A5%97%E9%A4%90%E4%BF%A1%E6%81%AF"><span class="nav-number">8.2.1.1.</span> <span class="nav-text">2.1.1 展示预约的套餐信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-2-%E6%89%8B%E6%9C%BA%E5%8F%B7%E6%A0%A1%E9%AA%8C"><span class="nav-number">8.2.1.2.</span> <span class="nav-text">2.1.2 手机号校验</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-3-30%E7%A7%92%E5%80%92%E8%AE%A1%E6%97%B6%E6%95%88%E6%9E%9C"><span class="nav-number">8.2.1.3.</span> <span class="nav-text">2.1.3 30秒倒计时效果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-4-%E5%8F%91%E9%80%81ajax%E8%AF%B7%E6%B1%82"><span class="nav-number">8.2.1.4.</span> <span class="nav-text">2.1.4 发送ajax请求</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-5-%E6%97%A5%E5%8E%86%E5%B1%95%E7%A4%BA"><span class="nav-number">8.2.1.5.</span> <span class="nav-text">2.1.5 日历展示</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-6-%E6%8F%90%E4%BA%A4%E9%A2%84%E7%BA%A6%E8%AF%B7%E6%B1%82"><span class="nav-number">8.2.1.6.</span> <span class="nav-text">2.1.6 提交预约请求</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81-1"><span class="nav-number">8.2.2.</span> <span class="nav-text">2.2 后台代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-Controller-1"><span class="nav-number">8.2.2.1.</span> <span class="nav-text">2.2.1 Controller</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3-1"><span class="nav-number">8.2.2.2.</span> <span class="nav-text">2.2.2 服务接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-3-%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E7%B1%BB-1"><span class="nav-number">8.2.2.3.</span> <span class="nav-text">2.2.3 服务实现类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-4-Dao%E6%8E%A5%E5%8F%A3-1"><span class="nav-number">8.2.2.4.</span> <span class="nav-text">2.2.4 Dao接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-5-Mapper%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-1"><span class="nav-number">8.2.2.5.</span> <span class="nav-text">2.2.5 Mapper映射文件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E9%A2%84%E7%BA%A6%E6%88%90%E5%8A%9F%E9%A1%B5%E9%9D%A2%E5%B1%95%E7%A4%BA"><span class="nav-number">8.3.</span> <span class="nav-text">3. 预约成功页面展示</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E9%A1%B5%E9%9D%A2%E8%B0%83%E6%95%B4"><span class="nav-number">8.3.1.</span> <span class="nav-text">3.1 页面调整</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81-5"><span class="nav-number">8.3.2.</span> <span class="nav-text">3.2 后台代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1-Controller-5"><span class="nav-number">8.3.2.1.</span> <span class="nav-text">3.2.1 Controller</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-2-%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3-5"><span class="nav-number">8.3.2.2.</span> <span class="nav-text">3.2.2 服务接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-3-%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E7%B1%BB-5"><span class="nav-number">8.3.2.3.</span> <span class="nav-text">3.2.3 服务实现类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-4-Dao%E6%8E%A5%E5%8F%A3-5"><span class="nav-number">8.3.2.4.</span> <span class="nav-text">3.2.4 Dao接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-5-Mapper%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-5"><span class="nav-number">8.3.2.5.</span> <span class="nav-text">3.2.5 Mapper映射文件</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC9%E7%AB%A0-%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%BC%80%E5%8F%91-%E6%89%8B%E6%9C%BA%E5%BF%AB%E9%80%9F%E7%99%BB%E5%BD%95%E3%80%81%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6"><span class="nav-number">9.</span> <span class="nav-text">第9章 移动端开发-手机快速登录、权限控制</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-3"><span class="nav-number">9.1.</span> <span class="nav-text">1. 需求分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%89%8B%E6%9C%BA%E5%BF%AB%E9%80%9F%E7%99%BB%E5%BD%95"><span class="nav-number">9.2.</span> <span class="nav-text">2. 手机快速登录</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E9%A1%B5%E9%9D%A2%E8%B0%83%E6%95%B4-1"><span class="nav-number">9.2.1.</span> <span class="nav-text">2.1 页面调整</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-1-%E5%8F%91%E9%80%81%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="nav-number">9.2.1.1.</span> <span class="nav-text">2.1.1 发送验证码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-2-%E6%8F%90%E4%BA%A4%E7%99%BB%E5%BD%95%E8%AF%B7%E6%B1%82"><span class="nav-number">9.2.1.2.</span> <span class="nav-text">2.1.2 提交登录请求</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81-2"><span class="nav-number">9.2.2.</span> <span class="nav-text">2.2 后台代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-Controller-2"><span class="nav-number">9.2.2.1.</span> <span class="nav-text">2.2.1 Controller</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3-2"><span class="nav-number">9.2.2.2.</span> <span class="nav-text">2.2.2 服务接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-3-%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E7%B1%BB-2"><span class="nav-number">9.2.2.3.</span> <span class="nav-text">2.2.3 服务实现类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-4-Dao%E6%8E%A5%E5%8F%A3-2"><span class="nav-number">9.2.2.4.</span> <span class="nav-text">2.2.4 Dao接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-5-Mapper%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-2"><span class="nav-number">9.2.2.5.</span> <span class="nav-text">2.2.5 Mapper映射文件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6"><span class="nav-number">9.3.</span> <span class="nav-text">3. 权限控制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83%E6%A6%82%E5%BF%B5"><span class="nav-number">9.3.1.</span> <span class="nav-text">3.1 认证和授权概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E6%9D%83%E9%99%90%E6%A8%A1%E5%9D%97%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="nav-number">9.3.2.</span> <span class="nav-text">3.2 权限模块数据模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-Spring-Security%E7%AE%80%E4%BB%8B"><span class="nav-number">9.3.3.</span> <span class="nav-text">3.3 Spring Security简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-Spring-Security%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B"><span class="nav-number">9.3.4.</span> <span class="nav-text">3.4 Spring Security入门案例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-1-%E5%B7%A5%E7%A8%8B%E6%90%AD%E5%BB%BA"><span class="nav-number">9.3.4.1.</span> <span class="nav-text">3.4.1 工程搭建</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-2-%E9%85%8D%E7%BD%AEweb-xml"><span class="nav-number">9.3.4.2.</span> <span class="nav-text">3.4.2 配置web.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-3-%E9%85%8D%E7%BD%AEspring-security-xml"><span class="nav-number">9.3.4.3.</span> <span class="nav-text">3.4.3 配置spring-security.xml</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-%E5%AF%B9%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B%E6%94%B9%E8%BF%9B"><span class="nav-number">9.3.5.</span> <span class="nav-text">3.5 对入门案例改进</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-1-%E9%85%8D%E7%BD%AE%E5%8F%AF%E5%8C%BF%E5%90%8D%E8%AE%BF%E9%97%AE%E7%9A%84%E8%B5%84%E6%BA%90"><span class="nav-number">9.3.5.1.</span> <span class="nav-text">3.5.1 配置可匿名访问的资源</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-2-%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AE%9A%E7%9A%84%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2"><span class="nav-number">9.3.5.2.</span> <span class="nav-text">3.5.2 使用指定的登录页面</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-3-%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9F%A5%E8%AF%A2%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="nav-number">9.3.5.3.</span> <span class="nav-text">3.5.3 从数据库查询用户信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-4-%E5%AF%B9%E5%AF%86%E7%A0%81%E8%BF%9B%E8%A1%8C%E5%8A%A0%E5%AF%86"><span class="nav-number">9.3.5.4.</span> <span class="nav-text">3.5.4 对密码进行加密</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-5-%E9%85%8D%E7%BD%AE%E5%A4%9A%E7%A7%8D%E6%A0%A1%E9%AA%8C%E8%A7%84%E5%88%99"><span class="nav-number">9.3.5.5.</span> <span class="nav-text">3.5.5 配置多种校验规则</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-6-%E6%B3%A8%E8%A7%A3%E6%96%B9%E5%BC%8F%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6"><span class="nav-number">9.3.5.6.</span> <span class="nav-text">3.5.6 注解方式权限控制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-7-%E9%80%80%E5%87%BA%E7%99%BB%E5%BD%95"><span class="nav-number">9.3.5.7.</span> <span class="nav-text">3.5.7 退出登录</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC10%E7%AB%A0-%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E3%80%81%E5%9B%BE%E5%BD%A2%E6%8A%A5%E8%A1%A8"><span class="nav-number">10.</span> <span class="nav-text">第10章 权限控制、图形报表</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%BA%94%E7%94%A8Spring-Security"><span class="nav-number">10.1.</span> <span class="nav-text">1. 在项目中应用Spring Security</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E5%AF%BC%E5%85%A5Spring-Security%E7%8E%AF%E5%A2%83"><span class="nav-number">10.1.1.</span> <span class="nav-text">1.1 导入Spring Security环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E5%AE%9E%E7%8E%B0%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83"><span class="nav-number">10.1.2.</span> <span class="nav-text">1.2 实现认证和授权</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E6%98%BE%E7%A4%BA%E7%94%A8%E6%88%B7%E5%90%8D"><span class="nav-number">10.1.3.</span> <span class="nav-text">1.3 显示用户名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-%E7%94%A8%E6%88%B7%E9%80%80%E5%87%BA"><span class="nav-number">10.1.4.</span> <span class="nav-text">1.4 用户退出</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%9B%BE%E5%BD%A2%E6%8A%A5%E8%A1%A8ECharts"><span class="nav-number">10.2.</span> <span class="nav-text">2. 图形报表ECharts</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-ECharts%E7%AE%80%E4%BB%8B"><span class="nav-number">10.2.1.</span> <span class="nav-text">2.1 ECharts简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-5%E5%88%86%E9%92%9F%E4%B8%8A%E6%89%8BECharts"><span class="nav-number">10.2.2.</span> <span class="nav-text">2.2 5分钟上手ECharts</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E6%9F%A5%E7%9C%8BECharts%E5%AE%98%E6%96%B9%E5%AE%9E%E4%BE%8B"><span class="nav-number">10.2.3.</span> <span class="nav-text">2.3 查看ECharts官方实例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E4%BC%9A%E5%91%98%E6%95%B0%E9%87%8F%E6%8A%98%E7%BA%BF%E5%9B%BE"><span class="nav-number">10.3.</span> <span class="nav-text">3. 会员数量折线图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="nav-number">10.3.1.</span> <span class="nav-text">3.1 需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E5%AE%8C%E5%96%84%E9%A1%B5%E9%9D%A2"><span class="nav-number">10.3.2.</span> <span class="nav-text">3.2 完善页面</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1-%E5%AF%BC%E5%85%A5ECharts%E5%BA%93"><span class="nav-number">10.3.2.1.</span> <span class="nav-text">3.2.1 导入ECharts库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-2-%E5%8F%82%E7%85%A7%E5%AE%98%E6%96%B9%E5%AE%9E%E4%BE%8B%E5%AF%BC%E5%85%A5%E6%8A%98%E7%BA%BF%E5%9B%BE"><span class="nav-number">10.3.2.2.</span> <span class="nav-text">3.2.2 参照官方实例导入折线图</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81"><span class="nav-number">10.3.3.</span> <span class="nav-text">3.3 后台代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-1-Controller"><span class="nav-number">10.3.3.1.</span> <span class="nav-text">3.3.1 Controller</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-2-%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3"><span class="nav-number">10.3.3.2.</span> <span class="nav-text">3.3.2 服务接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-3-%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E7%B1%BB-6"><span class="nav-number">10.3.3.3.</span> <span class="nav-text">3.2.3 服务实现类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-4-Dao%E6%8E%A5%E5%8F%A3"><span class="nav-number">10.3.3.4.</span> <span class="nav-text">3.3.4 Dao接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-5-Mapper%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6"><span class="nav-number">10.3.3.5.</span> <span class="nav-text">3.3.5 Mapper映射文件</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC11%E7%AB%A0-%E5%9B%BE%E5%BD%A2%E6%8A%A5%E8%A1%A8%E3%80%81POI%E6%8A%A5%E8%A1%A8"><span class="nav-number">11.</span> <span class="nav-text">第11章 图形报表、POI报表</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%A5%97%E9%A4%90%E9%A2%84%E7%BA%A6%E5%8D%A0%E6%AF%94%E9%A5%BC%E5%BD%A2%E5%9B%BE"><span class="nav-number">11.1.</span> <span class="nav-text">1. 套餐预约占比饼形图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="nav-number">11.1.1.</span> <span class="nav-text">1.1 需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E5%AE%8C%E5%96%84%E9%A1%B5%E9%9D%A2"><span class="nav-number">11.1.2.</span> <span class="nav-text">1.2 完善页面</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-1-%E5%AF%BC%E5%85%A5ECharts%E5%BA%93"><span class="nav-number">11.1.2.1.</span> <span class="nav-text">1.2.1 导入ECharts库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-2-%E5%8F%82%E7%85%A7%E5%AE%98%E6%96%B9%E5%AE%9E%E4%BE%8B%E5%AF%BC%E5%85%A5%E9%A5%BC%E5%BD%A2%E5%9B%BE"><span class="nav-number">11.1.2.2.</span> <span class="nav-text">1.2.2 参照官方实例导入饼形图</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81"><span class="nav-number">11.1.3.</span> <span class="nav-text">1.3 后台代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-1-Controller"><span class="nav-number">11.1.3.1.</span> <span class="nav-text">1.3.1 Controller</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-2-%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3"><span class="nav-number">11.1.3.2.</span> <span class="nav-text">1.3.2 服务接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-3-%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="nav-number">11.1.3.3.</span> <span class="nav-text">1.3.3 服务实现类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-4-Dao%E6%8E%A5%E5%8F%A3"><span class="nav-number">11.1.3.4.</span> <span class="nav-text">1.3.4 Dao接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-5-Mapper%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6"><span class="nav-number">11.1.3.5.</span> <span class="nav-text">1.3.5 Mapper映射文件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E8%BF%90%E8%90%A5%E6%95%B0%E6%8D%AE%E7%BB%9F%E8%AE%A1"><span class="nav-number">11.2.</span> <span class="nav-text">2. 运营数据统计</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-2"><span class="nav-number">11.2.1.</span> <span class="nav-text">2.1 需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%AE%8C%E5%96%84%E9%A1%B5%E9%9D%A2-1"><span class="nav-number">11.2.2.</span> <span class="nav-text">2.2 完善页面</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-%E5%AE%9A%E4%B9%89%E6%A8%A1%E5%9E%8B%E6%95%B0%E6%8D%AE"><span class="nav-number">11.2.2.1.</span> <span class="nav-text">2.2.1 定义模型数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82%E8%8E%B7%E5%8F%96%E5%8A%A8%E6%80%81%E6%95%B0%E6%8D%AE"><span class="nav-number">11.2.2.2.</span> <span class="nav-text">2.2.2 发送请求获取动态数据</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81-1"><span class="nav-number">11.2.3.</span> <span class="nav-text">2.3 后台代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-1-Controller-1"><span class="nav-number">11.2.3.1.</span> <span class="nav-text">2.3.1 Controller</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-2-%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3-1"><span class="nav-number">11.2.3.2.</span> <span class="nav-text">2.3.2 服务接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-3-%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E7%B1%BB-1"><span class="nav-number">11.2.3.3.</span> <span class="nav-text">2.3.3 服务实现类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-4-Dao%E6%8E%A5%E5%8F%A3-1"><span class="nav-number">11.2.3.4.</span> <span class="nav-text">2.3.4 Dao接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-5-Mapper%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-1"><span class="nav-number">11.2.3.5.</span> <span class="nav-text">2.3.5 Mapper映射文件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E8%BF%90%E8%90%A5%E6%95%B0%E6%8D%AE%E7%BB%9F%E8%AE%A1%E6%8A%A5%E8%A1%A8%E5%AF%BC%E5%87%BA"><span class="nav-number">11.3.</span> <span class="nav-text">3. 运营数据统计报表导出</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-1"><span class="nav-number">11.3.1.</span> <span class="nav-text">3.1 需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E6%8F%90%E4%BE%9B%E6%A8%A1%E6%9D%BF%E6%96%87%E4%BB%B6"><span class="nav-number">11.3.2.</span> <span class="nav-text">3.2 提供模板文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E5%AE%8C%E5%96%84%E9%A1%B5%E9%9D%A2"><span class="nav-number">11.3.3.</span> <span class="nav-text">3.3 完善页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81"><span class="nav-number">11.3.4.</span> <span class="nav-text">3.4 后台代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC12%E7%AB%A0-PDF%E6%8A%A5%E8%A1%A8"><span class="nav-number">12.</span> <span class="nav-text">第12章 PDF报表</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%B8%B8%E8%A7%81%E7%9A%84PDF%E6%8A%A5%E8%A1%A8%E7%94%9F%E6%88%90%E6%96%B9%E5%BC%8F"><span class="nav-number">12.1.</span> <span class="nav-text">1. 常见的PDF报表生成方式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-iText"><span class="nav-number">12.1.1.</span> <span class="nav-text">1.1 iText</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-JasperReports"><span class="nav-number">12.1.2.</span> <span class="nav-text">1.2 JasperReports</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-JasperReports%E6%A6%82%E8%BF%B0"><span class="nav-number">12.2.</span> <span class="nav-text">2. JasperReports概述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-JasperReports%E5%BF%AB%E9%80%9F%E4%BD%93%E9%AA%8C"><span class="nav-number">12.2.1.</span> <span class="nav-text">2.1 JasperReports快速体验</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-JasperReports%E5%8E%9F%E7%90%86"><span class="nav-number">12.2.2.</span> <span class="nav-text">2.2 JasperReports原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B"><span class="nav-number">12.2.3.</span> <span class="nav-text">2.3 开发流程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E6%A8%A1%E6%9D%BF%E8%AE%BE%E8%AE%A1%E5%99%A8Jaspersoft-Studio"><span class="nav-number">12.3.</span> <span class="nav-text">3. 模板设计器Jaspersoft Studio</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-Jaspersoft-Studio%E9%9D%A2%E6%9D%BF%E4%BB%8B%E7%BB%8D"><span class="nav-number">12.3.1.</span> <span class="nav-text">3.1 Jaspersoft Studio面板介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E5%88%9B%E5%BB%BA%E5%B7%A5%E7%A8%8B%E5%92%8C%E6%A8%A1%E6%9D%BF%E6%96%87%E4%BB%B6"><span class="nav-number">12.3.2.</span> <span class="nav-text">3.2 创建工程和模板文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E6%9D%BF%E6%96%87%E4%BB%B6"><span class="nav-number">12.3.3.</span> <span class="nav-text">3.3 设计模板文件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-1-%E5%A2%9E%E5%87%8FBand"><span class="nav-number">12.3.3.1.</span> <span class="nav-text">3.3.1 增减Band</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-2-%E5%B0%86%E5%85%83%E7%B4%A0%E5%BA%94%E7%94%A8%E5%88%B0%E6%A8%A1%E6%9D%BF%E4%B8%AD"><span class="nav-number">12.3.3.2.</span> <span class="nav-text">3.3.2 将元素应用到模板中</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-2-1-Image%E5%85%83%E7%B4%A0"><span class="nav-number">12.3.3.2.1.</span> <span class="nav-text">3.3.2.1 Image元素</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-2-2-Static-Text%E5%85%83%E7%B4%A0"><span class="nav-number">12.3.3.2.2.</span> <span class="nav-text">3.3.2.2 Static Text元素</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-2-3-Current-Date%E5%85%83%E7%B4%A0"><span class="nav-number">12.3.3.2.3.</span> <span class="nav-text">3.3.2.3 Current Date元素</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-3-%E5%8A%A8%E6%80%81%E6%95%B0%E6%8D%AE%E5%A1%AB%E5%85%85"><span class="nav-number">12.3.3.3.</span> <span class="nav-text">3.3.3 动态数据填充</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-3-1-Parameters"><span class="nav-number">12.3.3.3.1.</span> <span class="nav-text">3.3.3.1 Parameters</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-3-2-Fields"><span class="nav-number">12.3.3.3.2.</span> <span class="nav-text">3.3.3.2 Fields</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-%E7%BB%93%E5%90%88JasperReports%E8%BE%93%E5%87%BA%E6%8A%A5%E8%A1%A8"><span class="nav-number">12.3.4.</span> <span class="nav-text">3.4 结合JasperReports输出报表</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-1-JDBC%E6%95%B0%E6%8D%AE%E6%BA%90%E6%96%B9%E5%BC%8F%E5%A1%AB%E5%85%85%E6%95%B0%E6%8D%AE"><span class="nav-number">12.3.4.1.</span> <span class="nav-text">3.4.1 JDBC数据源方式填充数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-2-JavaBean%E6%95%B0%E6%8D%AE%E6%BA%90%E6%96%B9%E5%BC%8F%E5%A1%AB%E5%85%85%E6%95%B0%E6%8D%AE"><span class="nav-number">12.3.4.2.</span> <span class="nav-text">3.4.2 JavaBean数据源方式填充数据</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E8%BE%93%E5%87%BA%E8%BF%90%E8%90%A5%E6%95%B0%E6%8D%AEPDF%E6%8A%A5%E8%A1%A8"><span class="nav-number">12.4.</span> <span class="nav-text">4. 在项目中输出运营数据PDF报表</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E8%AE%BE%E8%AE%A1PDF%E6%A8%A1%E6%9D%BF%E6%96%87%E4%BB%B6"><span class="nav-number">12.4.1.</span> <span class="nav-text">4.1 设计PDF模板文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83"><span class="nav-number">12.4.2.</span> <span class="nav-text">4.2 搭建环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-%E4%BF%AE%E6%94%B9%E9%A1%B5%E9%9D%A2"><span class="nav-number">12.4.3.</span> <span class="nav-text">4.3 修改页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-Java%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="nav-number">12.4.4.</span> <span class="nav-text">4.4 Java代码实现</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC13%E7%AB%A0-Redis%E7%BC%93%E5%AD%98"><span class="nav-number">13.</span> <span class="nav-text">第13章 Redis缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Redis%E7%BC%93%E5%AD%98%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98"><span class="nav-number">13.1.</span> <span class="nav-text">1. Redis缓存相关问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F"><span class="nav-number">13.1.1.</span> <span class="nav-text">1.1 缓存穿透</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9"><span class="nav-number">13.1.2.</span> <span class="nav-text">1.2 缓存雪崩</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF"><span class="nav-number">13.1.3.</span> <span class="nav-text">1.3 缓存击穿</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Redis%E9%9B%86%E7%BE%A4%E6%96%B9%E6%A1%88"><span class="nav-number">13.2.</span> <span class="nav-text">2. Redis集群方案</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6Replication"><span class="nav-number">13.2.1.</span> <span class="nav-text">2.1 主从复制Replication</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%93%A8%E5%85%B5sentinel"><span class="nav-number">13.2.2.</span> <span class="nav-text">2.2 哨兵sentinel</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-%E9%AB%98%E5%8F%AF%E7%94%A8%E4%BB%8B%E7%BB%8D"><span class="nav-number">13.2.2.1.</span> <span class="nav-text">2.2.1 高可用介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-Redis-sentinel%E4%BB%8B%E7%BB%8D"><span class="nav-number">13.2.2.2.</span> <span class="nav-text">2.2.2 Redis sentinel介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-3-Redis-sentinel%E4%BD%BF%E7%94%A8"><span class="nav-number">13.2.2.3.</span> <span class="nav-text">2.2.3 Redis sentinel使用</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-3-1-%E9%85%8D%E7%BD%AEsentinel"><span class="nav-number">13.2.2.3.1.</span> <span class="nav-text">2.2.3.1 配置sentinel</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-3-2-%E5%90%AF%E5%8A%A8sentinel"><span class="nav-number">13.2.2.3.2.</span> <span class="nav-text">2.2.3.2 启动sentinel</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-3-3-%E6%B5%8B%E8%AF%95sentinel"><span class="nav-number">13.2.2.3.3.</span> <span class="nav-text">2.2.3.3 测试sentinel</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-Redis%E5%86%85%E7%BD%AE%E9%9B%86%E7%BE%A4cluster"><span class="nav-number">13.2.3.</span> <span class="nav-text">2.3 Redis内置集群cluster</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-1-Redis-cluster%E4%BB%8B%E7%BB%8D"><span class="nav-number">13.2.3.1.</span> <span class="nav-text">2.3.1 Redis cluster介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-2-%E5%93%88%E5%B8%8C%E6%A7%BD%E6%96%B9%E5%BC%8F%E5%88%86%E9%85%8D%E6%95%B0%E6%8D%AE"><span class="nav-number">13.2.3.2.</span> <span class="nav-text">2.3.2 哈希槽方式分配数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-3-Redis-cluster%E7%9A%84%E4%B8%BB%E4%BB%8E%E6%A8%A1%E5%BC%8F"><span class="nav-number">13.2.3.3.</span> <span class="nav-text">2.3.3 Redis cluster的主从模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-4-Redis-cluster%E6%90%AD%E5%BB%BA"><span class="nav-number">13.2.3.4.</span> <span class="nav-text">2.3.4 Redis cluster搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-3-4-1-%E5%87%86%E5%A4%87Redis%E8%8A%82%E7%82%B9"><span class="nav-number">13.2.3.4.1.</span> <span class="nav-text">2.3.4.1 准备Redis节点</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-3-4-2-%E5%90%AF%E5%8A%A8Redis%E9%9B%86%E7%BE%A4"><span class="nav-number">13.2.3.4.2.</span> <span class="nav-text">2.3.4.2 启动Redis集群</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-5-%E4%BD%BF%E7%94%A8Redis%E9%9B%86%E7%BE%A4"><span class="nav-number">13.2.3.5.</span> <span class="nav-text">2.3.5 使用Redis集群</span></a></li></ol></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">zhangxin</p>
  <div class="site-description" itemprop="description">新站点：zxalive.com</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">267</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">35</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


  <a target="_blank" rel="noopener" href="https://zxalive.com" class="special-link">新站点zxalive.com</a>


    </div>

    <div class="main-inner post posts-expand">

  <a target="_blank" rel="noopener" href="https://zxalive.com" class="special-link">新站点zxalive.com</a>

  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://zxblog.eu.org/posts/a12c/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zhangxin">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="知行博客">
      <meta itemprop="description" content="新站点：zxalive.com">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="【项目】传智健康 | 知行博客">
      <meta itemprop="description" content="黑马-传智健康-项目笔记">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          【项目】传智健康
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-01-01 16:10:32" itemprop="dateCreated datePublished" datetime="2022-01-01T16:10:32+08:00">2022-01-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-08-18 18:14:29" itemprop="dateModified" datetime="2024-08-18T18:14:29+08:00">2024-08-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">Java开发</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>276k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4:11</span>
    </span>
</div>

            <div class="post-description">黑马-传智健康-项目笔记</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p><strong>全文目录</strong></p>
<ul>
<li><a href="#%E7%AC%AC1%E7%AB%A0-%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0%E5%92%8C%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA">第1章 项目概述和环境搭建</a></li>
<li><a href="#%E7%AC%AC2%E7%AB%A0-%E9%A2%84%E7%BA%A6%E7%AE%A1%E7%90%86-%E6%A3%80%E6%9F%A5%E9%A1%B9%E7%AE%A1%E7%90%86">第2章 预约管理-检查项管理</a></li>
<li><a href="#%E7%AC%AC3%E7%AB%A0-%E9%A2%84%E7%BA%A6%E7%AE%A1%E7%90%86-%E6%A3%80%E6%9F%A5%E7%BB%84%E7%AE%A1%E7%90%86">第3章 预约管理-检查组管理</a></li>
<li><a href="#%E7%AC%AC4%E7%AB%A0-%E9%A2%84%E7%BA%A6%E7%AE%A1%E7%90%86-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86">第4章 预约管理-套餐管理</a></li>
<li><a href="#%E7%AC%AC5%E7%AB%A0-%E9%A2%84%E7%BA%A6%E7%AE%A1%E7%90%86-%E9%A2%84%E7%BA%A6%E8%AE%BE%E7%BD%AE">第5章 预约管理-预约设置</a></li>
<li><a href="#%E7%AC%AC6%E7%AB%A0-%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%BC%80%E5%8F%91-%E4%BD%93%E6%A3%80%E9%A2%84%E7%BA%A6">第6章 移动端开发-体检预约</a></li>
<li><a href="#%E7%AC%AC7%E7%AB%A0-%E9%A1%B5%E9%9D%A2%E9%9D%99%E6%80%81%E5%8C%96">第7章 页面静态化</a></li>
<li><a href="#%E7%AC%AC8%E7%AB%A0-%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%BC%80%E5%8F%91-%E4%BD%93%E6%A3%80%E9%A2%84%E7%BA%A6">第8章 移动端开发-体检预约</a></li>
<li><a href="#%E7%AC%AC9%E7%AB%A0-%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%BC%80%E5%8F%91-%E6%89%8B%E6%9C%BA%E5%BF%AB%E9%80%9F%E7%99%BB%E5%BD%95%E3%80%81%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6">第9章 移动端开发-手机快速登录、权限控制</a></li>
<li><a href="#%E7%AC%AC10%E7%AB%A0-%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E3%80%81%E5%9B%BE%E5%BD%A2%E6%8A%A5%E8%A1%A8">第10章 权限控制、图形报表</a></li>
<li><a href="#%E7%AC%AC11%E7%AB%A0-%E5%9B%BE%E5%BD%A2%E6%8A%A5%E8%A1%A8%E3%80%81POI%E6%8A%A5%E8%A1%A8">第11章 图形报表、POI报表</a></li>
<li><a href="#%E7%AC%AC12%E7%AB%A0-PDF%E6%8A%A5%E8%A1%A8">第12章 PDF报表</a></li>
<li><a href="#%E7%AC%AC13%E7%AB%A0-Redis%E7%BC%93%E5%AD%98">第13章 Redis缓存</a></li>
</ul>
<h1 id="第1章-项目概述和环境搭建"><a href="#第1章-项目概述和环境搭建" class="headerlink" title="第1章 项目概述和环境搭建"></a>第1章 项目概述和环境搭建</h1><h2 id="1-项目概述"><a href="#1-项目概述" class="headerlink" title="1. 项目概述"></a>1. 项目概述</h2><h3 id="1-1-项目介绍"><a href="#1-1-项目介绍" class="headerlink" title="1.1 项目介绍"></a>1.1 项目介绍</h3><p>传智健康管理系统是一款应用于健康管理机构的业务系统，实现健康管理机构工作内容可视化、会员管理专业化、健康评估数字化、健康干预流程化、知识库集成化，从而提高健康管理师的工作效率，加强与会员间的互动，增强管理者对健康管理机构运营情况的了解。</p>
<p>详见：资料中的传智健康PRD文档.docx</p>
<h3 id="1-2-原型展示"><a href="#1-2-原型展示" class="headerlink" title="1.2 原型展示"></a>1.2 原型展示</h3><p>参见资料中的静态原型。</p>
<h3 id="1-3-技术架构"><a href="#1-3-技术架构" class="headerlink" title="1.3 技术架构"></a>1.3 技术架构</h3><p><img src="/../../assets/aa6880a7877dfd47b7350311641d3874.png" alt="1"></p>
<h3 id="1-4-功能架构"><a href="#1-4-功能架构" class="headerlink" title="1.4 功能架构"></a>1.4 功能架构</h3><p><img src="/../../assets/fcc90198e99bf91d538c6462b9f483f1.png" alt="2"></p>
<h3 id="1-5-软件开发流程"><a href="#1-5-软件开发流程" class="headerlink" title="1.5 软件开发流程"></a>1.5 软件开发流程</h3><p>软件开发一般会经历如下几个阶段，整个过程是顺序展开，所以通常称为瀑布模型。</p>
<p><img src="/../../assets/7bd34f26974c665c81dea98fe941443b.png" alt="11"></p>
<h2 id="2-环境搭建"><a href="#2-环境搭建" class="headerlink" title="2. 环境搭建"></a>2. 环境搭建</h2><h3 id="2-1-项目结构"><a href="#2-1-项目结构" class="headerlink" title="2.1 项目结构"></a>2.1 项目结构</h3><p>本项目采用maven分模块开发方式，即对整个项目拆分为几个maven工程，每个maven工程存放特定的一类代码，具体如下：</p>
<p><img src="/../../assets/94c32fc9c14e53255330f0e411867154.png" alt="10"></p>
<p>各模块职责定位：</p>
<p>health_parent：父工程，打包方式为pom，统一锁定依赖的版本，同时聚合其他子模块便于统一执行maven命令</p>
<p>health_common：通用模块，打包方式为jar，存放项目中使用到的一些工具类、实体类、返回结果和常量类</p>
<p>health_interface：打包方式为jar，存放服务接口</p>
<p>health_service_provider：Dubbo服务模块，打包方式为war，存放服务实现类、Dao接口、Mapper映射文件等，作为服务提供方，需要部署到tomcat运行</p>
<p>health_backend：传智健康管理后台，打包方式为war，作为Dubbo服务消费方，存放Controller、HTML页面、js、css、spring配置文件等，需要部署到tomcat运行</p>
<p>health_mobile：移动端前台，打包方式为war，作为Dubbo服务消费方，存放Controller、HTML页面、js、css、spring配置文件等，需要部署到tomcat运行</p>
<h3 id="2-2-maven项目搭建"><a href="#2-2-maven项目搭建" class="headerlink" title="2.2 maven项目搭建"></a>2.2 maven项目搭建</h3><p>通过前面的项目功能架构图可以知道本项目分为传智健康管理后台和传智健康前台（微信端）</p>
<h4 id="2-2-1-health-parent"><a href="#2-2-1-health-parent" class="headerlink" title="2.2.1 health_parent"></a>2.2.1 health_parent</h4><p>创建health_parent，父工程，打包方式为pom，用于统一管理依赖版本</p>
<p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 </span></span></span><br><span class="line"><span class="string"><span class="tag">		 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itheima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>health_parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 集中定义依赖版本号 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">junit.version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">junit.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>5.0.5.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pagehelper.version</span>&gt;</span>4.1.4<span class="tag">&lt;/<span class="name">pagehelper.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-api.version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">servlet-api.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dubbo.version</span>&gt;</span>2.6.0<span class="tag">&lt;/<span class="name">dubbo.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">zookeeper.version</span>&gt;</span>3.4.7<span class="tag">&lt;/<span class="name">zookeeper.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">zkclient.version</span>&gt;</span>0.1<span class="tag">&lt;/<span class="name">zkclient.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mybatis.version</span>&gt;</span>3.4.5<span class="tag">&lt;/<span class="name">mybatis.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mybatis.spring.version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">mybatis.spring.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mybatis.paginator.version</span>&gt;</span>1.2.15<span class="tag">&lt;/<span class="name">mybatis.paginator.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>5.1.32<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">druid.version</span>&gt;</span>1.0.9<span class="tag">&lt;/<span class="name">druid.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">commons-fileupload.version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">commons-fileupload.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring.security.version</span>&gt;</span>5.0.5.RELEASE<span class="tag">&lt;/<span class="name">spring.security.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">poi.version</span>&gt;</span>3.14<span class="tag">&lt;/<span class="name">poi.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jedis.version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">jedis.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">quartz.version</span>&gt;</span>2.2.1<span class="tag">&lt;/<span class="name">quartz.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 依赖管理标签  必须加 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- Spring --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jms<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- dubbo相关 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;dubbo.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;zookeeper.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.sgroschupf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zkclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;zkclient.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javassist<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javassist<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.12.1.GA<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;pagehelper.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- Mybatis --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.miemiedev<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-paginator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.paginator.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- MySql --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 连接池 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;druid.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 文件上传组件 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;commons-fileupload.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.quartz-scheduler<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>quartz<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;quartz.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.quartz-scheduler<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>quartz-jobs<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;quartz.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sun.jersey<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jersey-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.qiniu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>qiniu-java-sdk<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--POI报表--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;poi.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;poi.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jedis.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 安全框架 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.security<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-security-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.security.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.security<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-security-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.security.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.security<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-security-taglibs<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.security.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.penggle<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kaptcha<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dom4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dom4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>xml-apis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xml-apis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.01<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;servlet-api.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- java编译插件 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-2-2-health-common"><a href="#2-2-2-health-common" class="headerlink" title="2.2.2 health_common"></a>2.2.2 health_common</h4><p>创建health_common，子工程，打包方式为jar，存放通用组件，例如工具类、实体类等</p>
<p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 </span></span></span><br><span class="line"><span class="string"><span class="tag">		 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>health_parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itheima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>health_common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Mybatis --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.miemiedev<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-paginator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- MySql --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 连接池 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Spring --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jms<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- dubbo相关 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.sgroschupf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zkclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javassist<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javassist<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.qiniu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>qiniu-java-sdk<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sun.jersey<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jersey-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.security<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-security-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.security<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-security-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.security<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-security-taglibs<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-2-5-health-interface"><a href="#2-2-5-health-interface" class="headerlink" title="2.2.5 health_interface"></a>2.2.5 health_interface</h4><p>创建health_interface，子工程，打包方式为jar，存放服务接口</p>
<p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0</span></span></span><br><span class="line"><span class="string"><span class="tag">                             http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>health_parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itheima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>health_interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itheima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>health_common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-2-6-health-service-provider"><a href="#2-2-6-health-service-provider" class="headerlink" title="2.2.6 health_service_provider"></a>2.2.6 health_service_provider</h4><p>创建health_service_provider，子工程，打包方式为war，作为服务单独部署，存放服务类、Dao接口和Mapper映射文件等</p>
<p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0</span></span></span><br><span class="line"><span class="string"><span class="tag">                            http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itheima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>health_parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>health_service_provider<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itheima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>health_interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 指定端口 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>81<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 请求路径 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">path</span>&gt;</span>/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>log4j.properties</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">### direct log messages to stdout ###</span></span><br><span class="line"><span class="attr">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.Target</span>=<span class="string">System.err</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%d&#123;ABSOLUTE&#125; %5p %c&#123;1&#125;:%L - %m%n</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">### direct messages to file mylog.log ###</span></span><br><span class="line"><span class="attr">log4j.appender.file</span>=<span class="string">org.apache.log4j.FileAppender</span></span><br><span class="line"><span class="attr">log4j.appender.file.File</span>=<span class="string">c:\\mylog.log</span></span><br><span class="line"><span class="attr">log4j.appender.file.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.file.layout.ConversionPattern</span>=<span class="string">%d&#123;ABSOLUTE&#125; %5p %c&#123;1&#125;:%L - %m%n</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">### set log levels - for more verbose logging change &#x27;info&#x27; to &#x27;debug&#x27; ###</span></span><br><span class="line"></span><br><span class="line"><span class="attr">log4j.rootLogger</span>=<span class="string">debug, stdout</span></span><br></pre></td></tr></table></figure>

<p>SqlMapConfig.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">		<span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- com.github.pagehelper 为 PageHelper 类所在包名 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.github.pagehelper.PageHelper&quot;</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 设置数据库类型 Oracle,Mysql,MariaDB,SQLite,Hsqldb,PostgreSQL 六种数据库--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dialect&quot;</span> <span class="attr">value</span>=<span class="string">&quot;mysql&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>spring-dao.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">							http://www.springframework.org/schema/beans/spring-beans-4.2.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">							http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">							http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">							http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">							http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">							http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="string"><span class="tag">							http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">							http://www.springframework.org/schema/util</span></span></span><br><span class="line"><span class="string"><span class="tag">							http://www.springframework.org/schema/util/spring-util.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--数据源--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> </span></span><br><span class="line"><span class="tag">      	  <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;close&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/health&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--spring和mybatis整合的工厂bean--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:SqlMapConfig.xml&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--批量扫描接口生成代理对象--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--指定接口所在的包--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.itheima.dao&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>spring-tx.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">                        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">                        http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="string"><span class="tag">                        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">                        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 事务管理器  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        开启事务控制的注解支持</span></span><br><span class="line"><span class="comment">        注意：此处必须加入proxy-target-class=&quot;true&quot;，</span></span><br><span class="line"><span class="comment">              需要进行事务控制，会由Spring框架产生代理对象，</span></span><br><span class="line"><span class="comment">              Dubbo需要将Service发布为服务，要求必须使用cglib创建代理对象。</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span> </span></span><br><span class="line"><span class="tag">                          <span class="attr">proxy-target-class</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>spring-service.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:dubbo</span>=<span class="string">&quot;http://code.alibabatech.com/schema/dubbo&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">                            http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                            http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">                            http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                            http://code.alibabatech.com/schema/dubbo</span></span></span><br><span class="line"><span class="string"><span class="tag">                            http://code.alibabatech.com/schema/dubbo/dubbo.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                            http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">                            http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定应用名称 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">&quot;health_service_provider&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--指定暴露服务的端口，如果不指定默认为20880--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">&quot;dubbo&quot;</span> <span class="attr">port</span>=<span class="string">&quot;20887&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--指定服务注册中心地址--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">&quot;zookeeper://127.0.0.1:2181&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--批量扫描，发布服务--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:annotation</span> <span class="attr">package</span>=<span class="string">&quot;com.itheima.service&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>web.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">web-app</span> <span class="keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta"> <span class="string">&quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot;</span></span></span><br><span class="line"><span class="meta"> <span class="string">&quot;http://java.sun.com/dtd/web-app_2_3.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Archetype Created Web Application<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 加载spring容器 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath*:applicationContext*.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-2-7-health-backend"><a href="#2-2-7-health-backend" class="headerlink" title="2.2.7 health_backend"></a>2.2.7 health_backend</h4><p>创建health_backend，子工程，打包方式为war，单独部署，存放Controller、页面等</p>
<p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0</span></span></span><br><span class="line"><span class="string"><span class="tag">                            http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>health_parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itheima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>health_backend<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itheima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>health_interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 指定端口 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>82<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 请求路径 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">path</span>&gt;</span>/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>log4j.properties</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">### direct log messages to stdout ###</span></span><br><span class="line"><span class="attr">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.Target</span>=<span class="string">System.err</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%d&#123;ABSOLUTE&#125; %5p %c&#123;1&#125;:%L - %m%n</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">### direct messages to file mylog.log ###</span></span><br><span class="line"><span class="attr">log4j.appender.file</span>=<span class="string">org.apache.log4j.FileAppender</span></span><br><span class="line"><span class="attr">log4j.appender.file.File</span>=<span class="string">c:\\mylog.log</span></span><br><span class="line"><span class="attr">log4j.appender.file.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.file.layout.ConversionPattern</span>=<span class="string">%d&#123;ABSOLUTE&#125; %5p %c&#123;1&#125;:%L - %m%n</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">### set log levels - for more verbose logging change &#x27;info&#x27; to &#x27;debug&#x27; ###</span></span><br><span class="line"></span><br><span class="line"><span class="attr">log4j.rootLogger</span>=<span class="string">info, stdout</span></span><br></pre></td></tr></table></figure>

<p>springmvc.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:dubbo</span>=<span class="string">&quot;http://code.alibabatech.com/schema/dubbo&quot;</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://code.alibabatech.com/schema/dubbo</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://code.alibabatech.com/schema/dubbo/dubbo.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">mvc:message-converters</span> <span class="attr">register-defaults</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.fastjson.support.spring.FastJsonHttpMessageConverter&quot;</span>&gt;</span></span><br><span class="line">	      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;supportedMediaTypes&quot;</span> <span class="attr">value</span>=<span class="string">&quot;application/json&quot;</span>/&gt;</span></span><br><span class="line">	      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;features&quot;</span>&gt;</span></span><br><span class="line">	        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">	          <span class="tag">&lt;<span class="name">value</span>&gt;</span>WriteMapNullValue<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	          <span class="tag">&lt;<span class="name">value</span>&gt;</span>WriteDateUseDateFormat<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">	      <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;/<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 指定应用名称 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">&quot;health_backend&quot;</span> /&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--指定服务注册中心地址--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">&quot;zookeeper://127.0.0.1:2181&quot;</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--批量扫描--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dubbo:annotation</span> <span class="attr">package</span>=<span class="string">&quot;com.itheima.controller&quot;</span> /&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">		超时全局设置 10分钟</span></span><br><span class="line"><span class="comment">		check=false 不检查服务提供方，开发阶段建议设置为false</span></span><br><span class="line"><span class="comment">		check=true 启动时检查服务提供方，如果服务提供方没有启动则报错</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dubbo:consumer</span> <span class="attr">timeout</span>=<span class="string">&quot;600000&quot;</span> <span class="attr">check</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--文件上传组件--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;multipartResolver&quot;</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxUploadSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;104857600&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxInMemorySize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;4096&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultEncoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>web.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">web-app</span> <span class="keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta"> <span class="string">&quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot;</span></span></span><br><span class="line"><span class="meta"> <span class="string">&quot;http://java.sun.com/dtd/web-app_2_3.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Archetype Created Web Application<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 解决post乱码 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定加载的配置文件 ，通过参数contextConfigLocation加载 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-Power-Designer"><a href="#3-Power-Designer" class="headerlink" title="3. Power Designer"></a>3. Power Designer</h2><h3 id="3-1-Power-Designer介绍"><a href="#3-1-Power-Designer介绍" class="headerlink" title="3.1 Power Designer介绍"></a>3.1 Power Designer介绍</h3><p>PowerDesigner是Sybase公司的一款软件，使用它可以方便地对系统进行分析设计，他几乎包括了数据库模型设计的全过程。利用PowerDesigner可以制作数据流程图、概念数据模型、物理数据模型、面向对象模型。</p>
<p>在项目设计阶段通常会使用PowerDesigner进行数据库设计。使用PowerDesigner可以更加直观的表现出数据库中表之间的关系，并且可以直接导出相应的建表语句。</p>
<h3 id="3-2-Power-Designer使用"><a href="#3-2-Power-Designer使用" class="headerlink" title="3.2 Power Designer使用"></a>3.2 Power Designer使用</h3><h4 id="3-2-1-创建物理数据模型"><a href="#3-2-1-创建物理数据模型" class="headerlink" title="3.2.1 创建物理数据模型"></a>3.2.1 创建物理数据模型</h4><p>操作步骤：</p>
<p>（1）创建数据模型PDM</p>
<p><img src="/../../assets/19daf9b518737cf515fc8333fbff4805.png" alt="12"></p>
<p>（2）选择数据库类型</p>
<p><img src="/../../assets/10dc0039137fd720f01381388d3c7d6d.png" alt="13"></p>
<p>（3）创建表和字段</p>
<p><img src="/../../assets/9f2b785069ced5a2c456c03df9aa24b9.png" alt="14"></p>
<p>指定表名</p>
<p><img src="/../../assets/0a2c6a4ed5444f3b7cd9f6b4c715a7cf.png" alt="15"></p>
<p>创建字段</p>
<p><img src="/../../assets/08c3e495f20e155f1a4742c9f8c3e794.png" alt="16"></p>
<p>设置某个字段属性，在字段上右键</p>
<p><img src="/../../assets/79d591be5cc86d61bc15a13b7c7af1f8.png" alt="17"></p>
<p>添加外键约束</p>
<p><img src="/../../assets/ad24cf567c91568a9ea8aaf89922456b.png" alt="18"></p>
<p><img src="/../../assets/dae9c1ffcf02a66522e18bc2066b2b96.png" alt="19"></p>
<p><img src="/../../assets/87b09381e090561a6b879ef256607cb1.png" alt="20"></p>
<p><img src="/../../assets/243e1a5ebe32f046016463732296f7bf.png" alt="21"></p>
<p><img src="/../../assets/22af4a3ba613be252e3e19826bf83475.png" alt="22"></p>
<h4 id="3-2-2-从PDM导出SQL脚本"><a href="#3-2-2-从PDM导出SQL脚本" class="headerlink" title="3.2.2 从PDM导出SQL脚本"></a>3.2.2 从PDM导出SQL脚本</h4><p>可以通过PowerDesigner设计的PDM模型导出为SQL脚本，如下：</p>
<p><img src="/../../assets/036fc8cb85af69b61c04ac142694a6e9.png" alt="23"></p>
<p><img src="/../../assets/ffef375682676443517a3a9c76b0b313.png" alt="24"></p>
<h4 id="3-2-3-逆向工程"><a href="#3-2-3-逆向工程" class="headerlink" title="3.2.3 逆向工程"></a>3.2.3 逆向工程</h4><p>上面我们是首先创建PDM模型，然后通过PowerDesigner提供的功能导出SQL脚本。实际上这个过程也可以反过来，也就是我们可以通过SQL脚本逆向生成PDM模型，这称为逆向工程，操作如下：</p>
<p><img src="/../../assets/4b2b31ddd0b67c1a46154a6daf11db8b.png" alt="25"></p>
<p><img src="/../../assets/f199855c4b206fa912a1220c32fe4358.png" alt="26"></p>
<p><img src="/../../assets/806e50c86a165ba8fea1974d2133bb80.png" alt="27"></p>
<p><img src="/../../assets/b78c2a909e765029d22078bca29a10a6.png" alt="28"></p>
<h4 id="3-2-4-生成数据库报表文件"><a href="#3-2-4-生成数据库报表文件" class="headerlink" title="3.2.4 生成数据库报表文件"></a>3.2.4 生成数据库报表文件</h4><p>通过PowerDesigner提供的功能，可以将PDM模型生成报表文件，具体操作如下：</p>
<p>（1）打开报表向导窗口</p>
<p><img src="/../../assets/498116dd0031dee123138a8747425e6a.png" alt="29"></p>
<p>（2）指定报表名称和语言</p>
<p><img src="/../../assets/557b1636c29fe04b12c6c8a236a83841.png" alt="30"></p>
<p>（3）选择报表格式和样式</p>
<p><img src="/../../assets/5a7e0dd01ac7c9a8a93569b16ab88711.png" alt="31"></p>
<p><img src="/../../assets/2bd692aadd298dbe19daf89613eb1d49.png" alt="32"></p>
<p>（4）选择对象类型</p>
<p><img src="/../../assets/8e45480e5dea7e8a9066d77a808fc9de.png" alt="33"></p>
<p>（5）执行生成操作</p>
<p><img src="/../../assets/a7386a0ad0376b7b34b146dbdfb8e7bf.png" alt="34"></p>
<h2 id="4-ElementUI"><a href="#4-ElementUI" class="headerlink" title="4. ElementUI"></a>4. ElementUI</h2><h3 id="4-1-ElementUI介绍"><a href="#4-1-ElementUI介绍" class="headerlink" title="4.1 ElementUI介绍"></a>4.1 ElementUI介绍</h3><p>ElementUI是一套基于VUE2.0的桌面端组件库，ElementUI提供了丰富的组件帮助开发人员快速构建功能强大、风格统一的页面。</p>
<p>官网地址：<a target="_blank" rel="noopener" href="http://element-cn.eleme.io/#/zh-CN">http://element-cn.eleme.io/#/zh-CN</a></p>
<p>传智健康项目后台系统就是使用ElementUI来构建页面，在页面上引入 js 和 css 文件即可开始使用，如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入ElementUI样式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://unpkg.com/element-ui/lib/theme-chalk/index.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 引入ElementUI组件库 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/element-ui/lib/index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-常用组件"><a href="#4-2-常用组件" class="headerlink" title="4.2 常用组件"></a>4.2 常用组件</h3><h4 id="4-2-1-Container-布局容器"><a href="#4-2-1-Container-布局容器" class="headerlink" title="4.2.1 Container 布局容器"></a>4.2.1 Container 布局容器</h4><p>用于布局的容器组件，方便快速搭建页面的基本结构：</p>
<p><code>&lt;el-container&gt;</code>：外层容器。当子元素中包含 <code>&lt;el-header&gt;</code> 或 <code>&lt;el-footer&gt;</code> 时，全部子元素会垂直上下排列，否则会水平左右排列</p>
<p><code>&lt;el-header&gt;</code>：顶栏容器</p>
<p><code>&lt;el-aside&gt;</code>：侧边栏容器</p>
<p><code>&lt;el-main&gt;</code>：主要区域容器</p>
<p><code>&lt;el-footer&gt;</code>：底栏容器</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-container</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-header</span>&gt;</span>Header<span class="tag">&lt;/<span class="name">el-header</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-container</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-aside</span> <span class="attr">width</span>=<span class="string">&quot;200px&quot;</span>&gt;</span>Aside<span class="tag">&lt;/<span class="name">el-aside</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-container</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-main</span>&gt;</span>Main<span class="tag">&lt;/<span class="name">el-main</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-footer</span>&gt;</span>Footer<span class="tag">&lt;/<span class="name">el-footer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-container</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-container</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-container</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.el-header</span>, <span class="selector-class">.el-footer</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background-color</span>: <span class="number">#B3C0D1</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">text-align</span>: left;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">line-height</span>: <span class="number">60px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.el-aside</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background-color</span>: <span class="number">#D3DCE6</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">line-height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.el-main</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background-color</span>: <span class="number">#E9EEF3</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">line-height</span>: <span class="number">590px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">el</span>:<span class="string">&#x27;#app&#x27;</span></span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-2-2-Dropdown-下拉菜单"><a href="#4-2-2-Dropdown-下拉菜单" class="headerlink" title="4.2.2 Dropdown 下拉菜单"></a>4.2.2 Dropdown 下拉菜单</h4><p>将动作或菜单折叠到下拉菜单中。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-dropdown</span> <span class="attr">split-button</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">trigger</span>=<span class="string">&quot;click&quot;</span>&gt;</span></span><br><span class="line">  个人中心</span><br><span class="line">  <span class="tag">&lt;<span class="name">el-dropdown-menu</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-dropdown-item</span> &gt;</span>退出系统<span class="tag">&lt;/<span class="name">el-dropdown-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-dropdown-item</span> <span class="attr">divided</span>&gt;</span>修改密码<span class="tag">&lt;/<span class="name">el-dropdown-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-dropdown-item</span> <span class="attr">divided</span>&gt;</span>联系管理员<span class="tag">&lt;/<span class="name">el-dropdown-item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-dropdown-menu</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-dropdown</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-2-3-NavMenu-导航菜单"><a href="#4-2-3-NavMenu-导航菜单" class="headerlink" title="4.2.3 NavMenu 导航菜单"></a>4.2.3 NavMenu 导航菜单</h4><p>为网站提供导航功能的菜单。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-menu</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-submenu</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot</span>=<span class="string">&quot;title&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;el-icon-location&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">slot</span>=<span class="string">&quot;title&quot;</span>&gt;</span>导航一<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-menu-item</span>&gt;</span>选项1<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-menu-item</span>&gt;</span>选项2<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-menu-item</span>&gt;</span>选项3<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-submenu</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-submenu</span> <span class="attr">index</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot</span>=<span class="string">&quot;title&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;el-icon-menu&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">slot</span>=<span class="string">&quot;title&quot;</span>&gt;</span>导航二<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-menu-item</span>&gt;</span>选项1<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-menu-item</span>&gt;</span>选项2<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-menu-item</span>&gt;</span>选项3<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-submenu</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-menu</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-2-4-Table-表格"><a href="#4-2-4-Table-表格" class="headerlink" title="4.2.4 Table 表格"></a>4.2.4 Table 表格</h4><p>用于展示多条结构类似的数据，可对数据进行排序、筛选、对比或其他自定义操作。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-table</span> <span class="attr">:data</span>=<span class="string">&quot;tableData&quot;</span> <span class="attr">stripe</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">prop</span>=<span class="string">&quot;date&quot;</span> <span class="attr">label</span>=<span class="string">&quot;日期&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">prop</span>=<span class="string">&quot;name&quot;</span> <span class="attr">label</span>=<span class="string">&quot;姓名&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">prop</span>=<span class="string">&quot;address&quot;</span> <span class="attr">label</span>=<span class="string">&quot;地址&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;操作&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">		slot-scope：作用域插槽，可以获取表格数据</span></span><br><span class="line"><span class="comment">    	scope：代表表格数据，可以通过scope.row来获取表格当前行数据，scope不是固定写法</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot-scope</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleUpdate(scope.row)&quot;</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span>  @<span class="attr">click</span>=<span class="string">&quot;handleDelete(scope.row)&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">el</span>:<span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">data</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">tableData</span>: [&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">date</span>: <span class="string">&#x27;2016-05-02&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">name</span>: <span class="string">&#x27;王小虎&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">address</span>: <span class="string">&#x27;上海市普陀区金沙江路 1518 弄&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;, &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">date</span>: <span class="string">&#x27;2016-05-04&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">name</span>: <span class="string">&#x27;王小虎&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">address</span>: <span class="string">&#x27;上海市普陀区金沙江路 1517 弄&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;, &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">date</span>: <span class="string">&#x27;2016-05-01&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">name</span>: <span class="string">&#x27;王小虎&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">address</span>: <span class="string">&#x27;上海市普陀区金沙江路 1519 弄&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;]</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">handleUpdate</span>(<span class="params">row</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">alert</span>(row.<span class="property">date</span>);</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">handleDelete</span>(<span class="params">row</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">alert</span>(row.<span class="property">date</span>);</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-2-5-Pagination-分页"><a href="#4-2-5-Pagination-分页" class="headerlink" title="4.2.5 Pagination 分页"></a>4.2.5 Pagination 分页</h4><p>当数据量过多时，使用分页分解数据。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	current-change：内置的事件，当前页码改变时会触发，可以获取到改变之后的页码</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-pagination</span></span></span><br><span class="line"><span class="tag">               @<span class="attr">current-change</span>=<span class="string">&quot;handleCurrentChange&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">current-page</span>=<span class="string">&quot;5&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">page-size</span>=<span class="string">&quot;10&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">layout</span>=<span class="string">&quot;total, prev, pager, next, jumper&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">:total</span>=<span class="string">&quot;305&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-pagination</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">el</span>:<span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">handleCurrentChange</span>(<span class="params">page</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">alert</span>(page);</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-2-6-Message-消息提示"><a href="#4-2-6-Message-消息提示" class="headerlink" title="4.2.6 Message 消息提示"></a>4.2.6 Message 消息提示</h4><p>常用于主动操作后的反馈提示。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">:plain</span>=<span class="string">&quot;true&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;open1&quot;</span>&gt;</span>消息<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">:plain</span>=<span class="string">&quot;true&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;open2&quot;</span>&gt;</span>成功<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">:plain</span>=<span class="string">&quot;true&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;open3&quot;</span>&gt;</span>警告<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">:plain</span>=<span class="string">&quot;true&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;open4&quot;</span>&gt;</span>错误<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">open1</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.$message(<span class="string">&#x27;这是一条消息提示&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">open2</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.$message(&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">message</span>: <span class="string">&#x27;恭喜你，这是一条成功消息&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">open3</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.$message(&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">message</span>: <span class="string">&#x27;警告哦，这是一条警告消息&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">type</span>: <span class="string">&#x27;warning&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">open4</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&#x27;错了哦，这是一条错误消息&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-2-7-Tabs-标签页"><a href="#4-2-7-Tabs-标签页" class="headerlink" title="4.2.7 Tabs 标签页"></a>4.2.7 Tabs 标签页</h4><p>分隔内容上有关联但属于不同类别的数据集合。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>基础的、简洁的标签页<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	通过value属性来指定当前选中的标签页</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-tabs</span> <span class="attr">value</span>=<span class="string">&quot;first&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-tab-pane</span> <span class="attr">label</span>=<span class="string">&quot;用户管理&quot;</span> <span class="attr">name</span>=<span class="string">&quot;first&quot;</span>&gt;</span>用户管理<span class="tag">&lt;/<span class="name">el-tab-pane</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-tab-pane</span> <span class="attr">label</span>=<span class="string">&quot;配置管理&quot;</span> <span class="attr">name</span>=<span class="string">&quot;second&quot;</span>&gt;</span>配置管理<span class="tag">&lt;/<span class="name">el-tab-pane</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-tab-pane</span> <span class="attr">label</span>=<span class="string">&quot;角色管理&quot;</span> <span class="attr">name</span>=<span class="string">&quot;third&quot;</span>&gt;</span>角色管理<span class="tag">&lt;/<span class="name">el-tab-pane</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-tab-pane</span> <span class="attr">label</span>=<span class="string">&quot;定时任务补偿&quot;</span> <span class="attr">name</span>=<span class="string">&quot;fourth&quot;</span>&gt;</span>定时任务补偿<span class="tag">&lt;/<span class="name">el-tab-pane</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-tabs</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>选项卡样式的标签页<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-tabs</span> <span class="attr">value</span>=<span class="string">&quot;first&quot;</span> <span class="attr">type</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-tab-pane</span> <span class="attr">label</span>=<span class="string">&quot;用户管理&quot;</span> <span class="attr">name</span>=<span class="string">&quot;first&quot;</span>&gt;</span>用户管理<span class="tag">&lt;/<span class="name">el-tab-pane</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-tab-pane</span> <span class="attr">label</span>=<span class="string">&quot;配置管理&quot;</span> <span class="attr">name</span>=<span class="string">&quot;second&quot;</span>&gt;</span>配置管理<span class="tag">&lt;/<span class="name">el-tab-pane</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-tab-pane</span> <span class="attr">label</span>=<span class="string">&quot;角色管理&quot;</span> <span class="attr">name</span>=<span class="string">&quot;third&quot;</span>&gt;</span>角色管理<span class="tag">&lt;/<span class="name">el-tab-pane</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-tab-pane</span> <span class="attr">label</span>=<span class="string">&quot;定时任务补偿&quot;</span> <span class="attr">name</span>=<span class="string">&quot;fourth&quot;</span>&gt;</span>定时任务补偿<span class="tag">&lt;/<span class="name">el-tab-pane</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-tabs</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>卡片化的标签页<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-tabs</span> <span class="attr">value</span>=<span class="string">&quot;first&quot;</span> <span class="attr">type</span>=<span class="string">&quot;border-card&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-tab-pane</span> <span class="attr">label</span>=<span class="string">&quot;用户管理&quot;</span> <span class="attr">name</span>=<span class="string">&quot;first&quot;</span>&gt;</span>用户管理<span class="tag">&lt;/<span class="name">el-tab-pane</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-tab-pane</span> <span class="attr">label</span>=<span class="string">&quot;配置管理&quot;</span> <span class="attr">name</span>=<span class="string">&quot;second&quot;</span>&gt;</span>配置管理<span class="tag">&lt;/<span class="name">el-tab-pane</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-tab-pane</span> <span class="attr">label</span>=<span class="string">&quot;角色管理&quot;</span> <span class="attr">name</span>=<span class="string">&quot;third&quot;</span>&gt;</span>角色管理<span class="tag">&lt;/<span class="name">el-tab-pane</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-tab-pane</span> <span class="attr">label</span>=<span class="string">&quot;定时任务补偿&quot;</span> <span class="attr">name</span>=<span class="string">&quot;fourth&quot;</span>&gt;</span>定时任务补偿<span class="tag">&lt;/<span class="name">el-tab-pane</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-tabs</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span></span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-2-8-Form-表单"><a href="#4-2-8-Form-表单" class="headerlink" title="4.2.8 Form 表单"></a>4.2.8 Form 表单</h4><p>由输入框、选择器、单选框、多选框等控件组成，用以收集、校验、提交数据。在 Form 组件中，每一个表单域由一个 Form-Item 组件构成，表单域中可以放置各种类型的表单控件，包括 Input、Select、Checkbox、Radio、Switch、DatePicker、TimePicker。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	rules：表单验证规则</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-form</span> <span class="attr">ref</span>=<span class="string">&quot;form&quot;</span> <span class="attr">:model</span>=<span class="string">&quot;form&quot;</span> <span class="attr">:rules</span>=<span class="string">&quot;rules&quot;</span> <span class="attr">label-width</span>=<span class="string">&quot;80px&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  	prop：表单域 model 字段，在使用 validate、resetFields 方法的情况下，该属性是必填的</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;活动名称&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;form.name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;活动区域&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;region&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-select</span> <span class="attr">v-model</span>=<span class="string">&quot;form.region&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请选择活动区域&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">label</span>=<span class="string">&quot;区域一&quot;</span> <span class="attr">value</span>=<span class="string">&quot;shanghai&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">label</span>=<span class="string">&quot;区域二&quot;</span> <span class="attr">value</span>=<span class="string">&quot;beijing&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-select</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;活动时间&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;11&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-date-picker</span> <span class="attr">type</span>=<span class="string">&quot;date&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;选择日期&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;form.date1&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-date-picker</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">class</span>=<span class="string">&quot;line&quot;</span> <span class="attr">:span</span>=<span class="string">&quot;2&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;11&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-time-picker</span> <span class="attr">type</span>=<span class="string">&quot;fixed-time&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;选择时间&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;form.date2&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-time-picker</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;即时配送&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-switch</span> <span class="attr">v-model</span>=<span class="string">&quot;form.delivery&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-switch</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;活动性质&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-checkbox-group</span> <span class="attr">v-model</span>=<span class="string">&quot;form.type&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-checkbox</span> <span class="attr">label</span>=<span class="string">&quot;美食/餐厅线上活动&quot;</span> <span class="attr">name</span>=<span class="string">&quot;type&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-checkbox</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-checkbox</span> <span class="attr">label</span>=<span class="string">&quot;地推活动&quot;</span> <span class="attr">name</span>=<span class="string">&quot;type&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-checkbox</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-checkbox</span> <span class="attr">label</span>=<span class="string">&quot;线下主题活动&quot;</span> <span class="attr">name</span>=<span class="string">&quot;type&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-checkbox</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-checkbox</span> <span class="attr">label</span>=<span class="string">&quot;单纯品牌曝光&quot;</span> <span class="attr">name</span>=<span class="string">&quot;type&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-checkbox</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-checkbox-group</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;特殊资源&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-radio-group</span> <span class="attr">v-model</span>=<span class="string">&quot;form.resource&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-radio</span> <span class="attr">label</span>=<span class="string">&quot;线上品牌商赞助&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-radio</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-radio</span> <span class="attr">label</span>=<span class="string">&quot;线下场地免费&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-radio</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-radio-group</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;活动形式&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">type</span>=<span class="string">&quot;textarea&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;form.desc&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;onSubmit&quot;</span>&gt;</span>立即创建<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">data</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">form</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">region</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">date1</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">date2</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">delivery</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">type</span>: [],</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">resource</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">desc</span>: <span class="string">&#x27;&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">//定义校验规则</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">rules</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">name</span>: [</span></span><br><span class="line"><span class="language-javascript">          &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请输入活动名称&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">          &#123; <span class="attr">min</span>: <span class="number">3</span>, <span class="attr">max</span>: <span class="number">5</span>, <span class="attr">message</span>: <span class="string">&#x27;长度在 3 到 5 个字符&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;</span></span><br><span class="line"><span class="language-javascript">        ],</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">region</span>: [</span></span><br><span class="line"><span class="language-javascript">          &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;请选择活动区域&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;change&#x27;</span> &#125;</span></span><br><span class="line"><span class="language-javascript">        ]</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">onSubmit</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">form</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//validate：对整个表单进行校验的方法，参数为一个回调函数。</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//该回调函数会在校验结束后被调用，并传入两个参数：是否校验成功和未通过校验的字段。</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">$refs</span>[<span class="string">&#x27;form&#x27;</span>].<span class="title function_">validate</span>(<span class="function">(<span class="params">valid</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (valid) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(<span class="string">&#x27;submit!&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">          &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;error submit!!&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="第2章-预约管理-检查项管理"><a href="#第2章-预约管理-检查项管理" class="headerlink" title="第2章 预约管理-检查项管理"></a>第2章 预约管理-检查项管理</h1><h2 id="1-需求分析"><a href="#1-需求分析" class="headerlink" title="1. 需求分析"></a>1. 需求分析</h2><p>传智健康管理系统是一款应用于健康管理机构的业务系统，实现健康管理机构工作内容可视化、患者管理专业化、健康评估数字化、健康干预流程化、知识库集成化，从而提高健康管理师的工作效率，加强与患者间的互动，增强管理者对健康管理机构运营情况的了解。</p>
<p>系统分为传智健康后台管理系统和移动端应用两部分。其中后台系统提供给健康管理机构内部人员（包括系统管理员、健康管理师等）使用，微信端应用提供给健康管理机构的用户（体检用户）使用。</p>
<p>本项目功能架构图：</p>
<p><img src="/../../assets/aa6880a7877dfd47b7350311641d3874.png" alt="1"></p>
<p>通过上面的功能架构图可以看到，传智健康后台管理系统有会员管理、预约管理、健康评估、健康干预等功能。移动端有会员管理、体检预约、体检报告等功能。后台系统和移动端应用都会通过Dubbo调用服务层发布的服务来完成具体的操作。本项目属于典型的SOA架构形式。</p>
<p>本章节完成的功能开发是预约管理功能，包括检查项管理、检查组管理、体检套餐管理、预约设置等（参见产品原型）。预约管理属于系统的基础功能，主要就是管理一些体检的基础数据。</p>
<h2 id="2-基础环境搭建"><a href="#2-基础环境搭建" class="headerlink" title="2. 基础环境搭建"></a>2. 基础环境搭建</h2><h3 id="2-1-导入预约管理模块数据表"><a href="#2-1-导入预约管理模块数据表" class="headerlink" title="2.1 导入预约管理模块数据表"></a>2.1 导入预约管理模块数据表</h3><p>操作步骤：</p>
<p>（1）根据资料中提供的itcasthealth.pdm文件导出SQL脚本</p>
<p><img src="/../../assets/image-20220907090350307.png" alt="image-20220907090350307"></p>
<p><img src="/../../assets/image-20220907090400114.png" alt="image-20220907090400114"></p>
<p>（2）创建本项目使用的数据库itcast_health</p>
<p><img src="/../../assets/4(1).png" alt="4(1)"></p>
<p>（3）将PowerDesigner导出的SQL脚本导入itcast_health数据库进行建表</p>
<p><img src="/../../assets/image-20220907090444733.png" alt="image-20220907090444733"></p>
<h3 id="2-2-导入预约管理模块实体类"><a href="#2-2-导入预约管理模块实体类" class="headerlink" title="2.2 导入预约管理模块实体类"></a>2.2 导入预约管理模块实体类</h3><p>将资料中提供的POJO实体类复制到health_common工程中。</p>
<h3 id="2-3-导入项目所需公共资源"><a href="#2-3-导入项目所需公共资源" class="headerlink" title="2.3 导入项目所需公共资源"></a>2.3 导入项目所需公共资源</h3><p>项目开发过程中一般会提供一些公共资源，供多个模块或者系统来使用。</p>
<p>本章节我们导入的公共资源有：</p>
<p>（1）返回消息常量类MessageConstant，放到health_common工程中</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.constant;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 消息常量</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageConstant</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DELETE_CHECKITEM_FAIL</span> <span class="operator">=</span> <span class="string">&quot;删除检查项失败&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DELETE_CHECKITEM_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;删除检查项成功&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ADD_CHECKITEM_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;新增检查项成功&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ADD_CHECKITEM_FAIL</span> <span class="operator">=</span> <span class="string">&quot;新增检查项失败&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EDIT_CHECKITEM_FAIL</span> <span class="operator">=</span> <span class="string">&quot;编辑检查项失败&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EDIT_CHECKITEM_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;编辑检查项成功&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUERY_CHECKITEM_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;查询检查项成功&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUERY_CHECKITEM_FAIL</span> <span class="operator">=</span> <span class="string">&quot;查询检查项失败&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">UPLOAD_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;上传成功&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ADD_CHECKGROUP_FAIL</span> <span class="operator">=</span> <span class="string">&quot;新增检查组失败&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ADD_CHECKGROUP_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;新增检查组成功&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DELETE_CHECKGROUP_FAIL</span> <span class="operator">=</span> <span class="string">&quot;删除检查组失败&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DELETE_CHECKGROUP_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;删除检查组成功&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUERY_CHECKGROUP_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;查询检查组成功&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUERY_CHECKGROUP_FAIL</span> <span class="operator">=</span> <span class="string">&quot;查询检查组失败&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EDIT_CHECKGROUP_FAIL</span> <span class="operator">=</span> <span class="string">&quot;编辑检查组失败&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EDIT_CHECKGROUP_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;编辑检查组成功&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PIC_UPLOAD_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;图片上传成功&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PIC_UPLOAD_FAIL</span> <span class="operator">=</span> <span class="string">&quot;图片上传失败&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ADD_SETMEAL_FAIL</span> <span class="operator">=</span> <span class="string">&quot;新增套餐失败&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ADD_SETMEAL_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;新增套餐成功&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">IMPORT_ORDERSETTING_FAIL</span> <span class="operator">=</span> <span class="string">&quot;批量导入预约设置数据失败&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">IMPORT_ORDERSETTING_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;批量导入预约设置数据成功&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">GET_ORDERSETTING_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;获取预约设置数据成功&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">GET_ORDERSETTING_FAIL</span> <span class="operator">=</span> <span class="string">&quot;获取预约设置数据失败&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ORDERSETTING_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;预约设置成功&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ORDERSETTING_FAIL</span> <span class="operator">=</span> <span class="string">&quot;预约设置失败&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ADD_MEMBER_FAIL</span> <span class="operator">=</span> <span class="string">&quot;新增会员失败&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ADD_MEMBER_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;新增会员成功&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DELETE_MEMBER_FAIL</span> <span class="operator">=</span> <span class="string">&quot;删除会员失败&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DELETE_MEMBER_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;删除会员成功&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EDIT_MEMBER_FAIL</span> <span class="operator">=</span> <span class="string">&quot;编辑会员失败&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EDIT_MEMBER_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;编辑会员成功&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TELEPHONE_VALIDATECODE_NOTNULL</span> <span class="operator">=</span> <span class="string">&quot;手机号和验证码都不能为空&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">LOGIN_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;登录成功&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">VALIDATECODE_ERROR</span> <span class="operator">=</span> <span class="string">&quot;验证码输入错误&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUERY_ORDER_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;查询预约信息成功&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUERY_ORDER_FAIL</span> <span class="operator">=</span> <span class="string">&quot;查询预约信息失败&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUERY_SETMEALLIST_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;查询套餐列表数据成功&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUERY_SETMEALLIST_FAIL</span> <span class="operator">=</span> <span class="string">&quot;查询套餐列表数据失败&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUERY_SETMEAL_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;查询套餐数据成功&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUERY_SETMEAL_FAIL</span> <span class="operator">=</span> <span class="string">&quot;查询套餐数据失败&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SEND_VALIDATECODE_FAIL</span> <span class="operator">=</span> <span class="string">&quot;验证码发送失败&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SEND_VALIDATECODE_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;验证码发送成功&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SELECTED_DATE_CANNOT_ORDER</span> <span class="operator">=</span> <span class="string">&quot;所选日期不能进行体检预约&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ORDER_FULL</span> <span class="operator">=</span> <span class="string">&quot;预约已满&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">HAS_ORDERED</span> <span class="operator">=</span> <span class="string">&quot;已经完成预约，不能重复预约&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ORDER_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;预约成功&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">GET_USERNAME_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;获取当前登录用户名称成功&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">GET_USERNAME_FAIL</span> <span class="operator">=</span> <span class="string">&quot;获取当前登录用户名称失败&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">GET_MENU_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;获取当前登录用户菜单成功&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">GET_MENU_FAIL</span> <span class="operator">=</span> <span class="string">&quot;获取当前登录用户菜单失败&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">GET_MEMBER_NUMBER_REPORT_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;获取会员统计数据成功&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">GET_MEMBER_NUMBER_REPORT_FAIL</span> <span class="operator">=</span> <span class="string">&quot;获取会员统计数据失败&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">GET_SETMEAL_COUNT_REPORT_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;获取套餐统计数据成功&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">GET_SETMEAL_COUNT_REPORT_FAIL</span> <span class="operator">=</span> <span class="string">&quot;获取套餐统计数据失败&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">GET_BUSINESS_REPORT_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;获取运营统计数据成功&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">GET_BUSINESS_REPORT_FAIL</span> <span class="operator">=</span> <span class="string">&quot;获取运营统计数据失败&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">GET_SETMEAL_LIST_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;查询套餐列表数据成功&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">GET_SETMEAL_LIST_FAIL</span> <span class="operator">=</span> <span class="string">&quot;查询套餐列表数据失败&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（2）返回结果Result和PageResult类，放到health_common工程中</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.entity;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 封装返回结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> flag;<span class="comment">//执行结果，true为执行成功 false为执行失败</span></span><br><span class="line">    <span class="keyword">private</span> String message;<span class="comment">//返回提示信息，主要用于页面提示信息</span></span><br><span class="line">    <span class="keyword">private</span> Object data;<span class="comment">//返回数据</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Result</span><span class="params">(<span class="type">boolean</span> flag, String message)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="built_in">this</span>.flag = flag;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Result</span><span class="params">(<span class="type">boolean</span> flag, String message, Object data)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.flag = flag;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFlag</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> flag;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFlag</span><span class="params">(<span class="type">boolean</span> flag)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.flag = flag;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMessage</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setData</span><span class="params">(Object data)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.itheima.entity;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分页结果封装对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageResult</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long total;<span class="comment">//总记录数</span></span><br><span class="line">    <span class="keyword">private</span> List rows;<span class="comment">//当前页结果</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PageResult</span><span class="params">(Long total, List rows)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="built_in">this</span>.total = total;</span><br><span class="line">        <span class="built_in">this</span>.rows = rows;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getTotal</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> total;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTotal</span><span class="params">(Long total)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.total = total;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> List <span class="title function_">getRows</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> rows;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRows</span><span class="params">(List rows)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.rows = rows;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（3）封装查询条件的QueryPageBean类，放到health_common工程中</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.entity;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 封装查询条件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QueryPageBean</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer currentPage;<span class="comment">//页码</span></span><br><span class="line">    <span class="keyword">private</span> Integer pageSize;<span class="comment">//每页记录数</span></span><br><span class="line">    <span class="keyword">private</span> String queryString;<span class="comment">//查询条件</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getCurrentPage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> currentPage;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCurrentPage</span><span class="params">(Integer currentPage)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.currentPage = currentPage;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getPageSize</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pageSize;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPageSize</span><span class="params">(Integer pageSize)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.pageSize = pageSize;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getQueryString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> queryString;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setQueryString</span><span class="params">(String queryString)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.queryString = queryString;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（4）html、js、css、图片等静态资源，放到health_backend工程中</p>
<p>注意：后续随着项目开发还会陆续导入其他一些公共资源。</p>
<h2 id="3-新增检查项"><a href="#3-新增检查项" class="headerlink" title="3. 新增检查项"></a>3. 新增检查项</h2><h3 id="3-1-完善页面"><a href="#3-1-完善页面" class="headerlink" title="3.1 完善页面"></a>3.1 完善页面</h3><p>检查项管理页面对应的是checkitem.html页面，根据产品设计的原型已经完成了页面基本结构的编写，现在需要完善页面动态效果。</p>
<h4 id="3-1-1-弹出新增窗口"><a href="#3-1-1-弹出新增窗口" class="headerlink" title="3.1.1 弹出新增窗口"></a>3.1.1 弹出新增窗口</h4><p>页面中已经提供了新增窗口，只是处于隐藏状态。只需要将控制展示状态的属性dialogFormVisible改为true就可以显示出新增窗口。</p>
<p>新建按钮绑定的方法为handleCreate，所以在handleCreate方法中修改dialogFormVisible属性的值为true即可。同时为了增加用户体验度，需要每次点击新建按钮时清空表单输入项。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 重置表单</span></span><br><span class="line"><span class="title function_">resetForm</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="variable language_">this</span>.<span class="property">formData</span> = &#123;&#125;;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 弹出添加窗口</span></span><br><span class="line"><span class="title function_">handleCreate</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="variable language_">this</span>.<span class="title function_">resetForm</span>();</span><br><span class="line">	<span class="variable language_">this</span>.<span class="property">dialogFormVisible</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-1-2-输入校验"><a href="#3-1-2-输入校验" class="headerlink" title="3.1.2 输入校验"></a>3.1.2 输入校验</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="attr">rules</span>: &#123;<span class="comment">//校验规则</span></span><br><span class="line">	<span class="attr">code</span>: [&#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;项目编码为必填项&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;],</span><br><span class="line">	<span class="attr">name</span>: [&#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;项目名称为必填项&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-1-3-提交表单数据"><a href="#3-1-3-提交表单数据" class="headerlink" title="3.1.3 提交表单数据"></a>3.1.3 提交表单数据</h4><p>点击新增窗口中的确定按钮时，触发handleAdd方法，所以需要在handleAdd方法中进行完善。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">handleAdd () &#123;</span><br><span class="line">  <span class="comment">//校验表单输入项是否合法</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">$refs</span>[<span class="string">&#x27;dataAddForm&#x27;</span>].<span class="title function_">validate</span>(<span class="function">(<span class="params">valid</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (valid) &#123;</span><br><span class="line">      <span class="comment">//表单数据校验通过，发送ajax请求将表单数据提交到后台</span></span><br><span class="line">      axios.<span class="title function_">post</span>(<span class="string">&quot;/checkitem/add.do&quot;</span>,<span class="variable language_">this</span>.<span class="property">formData</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>)=&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//隐藏新增窗口</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">dialogFormVisible</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">//判断后台返回的flag值，true表示添加操作成功，false为添加操作失败</span></span><br><span class="line">        <span class="keyword">if</span>(response.<span class="property">data</span>.<span class="property">flag</span>)&#123;</span><br><span class="line">          <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">            <span class="attr">message</span>: response.<span class="property">data</span>.<span class="property">message</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(response.<span class="property">data</span>.<span class="property">message</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;).<span class="title function_">finally</span>(<span class="function">()=&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">findPage</span>();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&quot;表单数据校验失败&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-后台代码"><a href="#3-2-后台代码" class="headerlink" title="3.2 后台代码"></a>3.2 后台代码</h3><h4 id="3-2-1-Controller"><a href="#3-2-1-Controller" class="headerlink" title="3.2.1 Controller"></a>3.2.1 Controller</h4><p>在health_backend工程中创建CheckItemController</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.controller;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Reference;</span><br><span class="line"><span class="keyword">import</span> com.itheima.constant.MessageConstant;</span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.PageResult;</span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.QueryPageBean;</span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.Result;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.CheckItem;</span><br><span class="line"><span class="keyword">import</span> com.itheima.service.CheckItemService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 体检检查项管理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/checkitem&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CheckItemController</span> &#123;</span><br><span class="line">    <span class="meta">@Reference</span></span><br><span class="line">    <span class="keyword">private</span> CheckItemService checkItemService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//新增</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/add&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">add</span><span class="params">(<span class="meta">@RequestBody</span> CheckItem checkItem)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            checkItemService.add(checkItem);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>,MessageConstant.ADD_CHECKITEM_FAIL);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>,MessageConstant.ADD_CHECKITEM_SUCCESS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-服务接口"><a href="#3-2-2-服务接口" class="headerlink" title="3.2.2 服务接口"></a>3.2.2 服务接口</h4><p>在health_interface工程中创建CheckItemService接口</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.service;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.CheckItem;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 检查项服务接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CheckItemService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(CheckItem checkItem)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-3-服务实现类"><a href="#3-2-3-服务实现类" class="headerlink" title="3.2.3 服务实现类"></a>3.2.3 服务实现类</h4><p>在health_service_provider工程中创建CheckItemServiceImpl实现类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.service;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Service;</span><br><span class="line"><span class="keyword">import</span> com.itheima.dao.CheckItemDao;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.CheckItem;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 检查项服务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service(interfaceClass = CheckItemService.class)</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CheckItemServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">CheckItemService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CheckItemDao checkItemDao;</span><br><span class="line">  	<span class="comment">//新增</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(CheckItem checkItem)</span> &#123;</span><br><span class="line">        checkItemDao.add(checkItem);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-4-Dao接口"><a href="#3-2-4-Dao接口" class="headerlink" title="3.2.4 Dao接口"></a>3.2.4 Dao接口</h4><p>在health_service_provider工程中创建CheckItemDao接口，本项目是基于Mybatis的Mapper代理技术实现持久层操作，故只需要提供接口和Mapper映射文件，无须提供实现类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.dao;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.CheckItem;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 持久层Dao接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CheckItemDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(CheckItem checkItem)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-5-Mapper映射文件"><a href="#3-2-5-Mapper映射文件" class="headerlink" title="3.2.5 Mapper映射文件"></a>3.2.5 Mapper映射文件</h4><p>在health_service_provider工程中创建CheckItemDao.xml映射文件，需要和CheckItemDao接口在同一目录下</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.dao.CheckItemDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--新增--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;add&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.itheima.pojo.CheckItem&quot;</span>&gt;</span></span><br><span class="line">        insert into t_checkitem(code,name,sex,age,price,type,remark,attention)</span><br><span class="line">                      values </span><br><span class="line">        (#&#123;code&#125;,#&#123;name&#125;,#&#123;sex&#125;,#&#123;age&#125;,#&#123;price&#125;,#&#123;type&#125;,#&#123;remark&#125;,#&#123;attention&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="4-检查项分页"><a href="#4-检查项分页" class="headerlink" title="4. 检查项分页"></a>4. 检查项分页</h2><p>本项目所有分页功能都是基于ajax的异步请求来完成的，请求参数和后台响应数据格式都使用json数据格式。</p>
<p>请求参数包括页码、每页显示记录数、查询条件。</p>
<p>请求参数的json格式为：{currentPage:1,pageSize:10,queryString:‘‘itcast’’}</p>
<p>后台响应数据包括总记录数、当前页需要展示的数据集合。</p>
<p>响应数据的json格式为：{total:1000,rows:[]}</p>
<p>如下图：</p>
<p><img src="/../../assets/image-20220907095210364.png" alt="image-20220907095210364"></p>
<h3 id="4-1-完善页面"><a href="#4-1-完善页面" class="headerlink" title="4.1 完善页面"></a>4.1 完善页面</h3><h4 id="4-1-1-定义分页相关模型数据"><a href="#4-1-1-定义分页相关模型数据" class="headerlink" title="4.1.1 定义分页相关模型数据"></a>4.1.1 定义分页相关模型数据</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="attr">pagination</span>: &#123;<span class="comment">//分页相关模型数据</span></span><br><span class="line">  <span class="attr">currentPage</span>: <span class="number">1</span>,<span class="comment">//当前页码</span></span><br><span class="line">  <span class="attr">pageSize</span>:<span class="number">10</span>,<span class="comment">//每页显示的记录数</span></span><br><span class="line">  <span class="attr">total</span>:<span class="number">0</span>,<span class="comment">//总记录数</span></span><br><span class="line">  <span class="attr">queryString</span>:<span class="literal">null</span><span class="comment">//查询条件</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">dataList</span>: [],<span class="comment">//当前页要展示的分页列表数据</span></span><br></pre></td></tr></table></figure>

<h4 id="4-1-2-定义分页方法"><a href="#4-1-2-定义分页方法" class="headerlink" title="4.1.2 定义分页方法"></a>4.1.2 定义分页方法</h4><p>在页面中提供了findPage方法用于分页查询，为了能够在checkitem.html页面加载后直接可以展示分页数据，可以在VUE提供的钩子函数created中调用findPage方法</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//钩子函数，VUE对象初始化完成后自动执行</span></span><br><span class="line"><span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">findPage</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">1234</span></span><br><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="title function_">findPage</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">//分页参数</span></span><br><span class="line">  <span class="keyword">var</span> param = &#123;</span><br><span class="line">    <span class="attr">currentPage</span>:<span class="variable language_">this</span>.<span class="property">pagination</span>.<span class="property">currentPage</span>,<span class="comment">//页码</span></span><br><span class="line">    <span class="attr">pageSize</span>:<span class="variable language_">this</span>.<span class="property">pagination</span>.<span class="property">pageSize</span>,<span class="comment">//每页显示的记录数</span></span><br><span class="line">    <span class="attr">queryString</span>:<span class="variable language_">this</span>.<span class="property">pagination</span>.<span class="property">queryString</span><span class="comment">//查询条件</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">//请求后台</span></span><br><span class="line">  axios.<span class="title function_">post</span>(<span class="string">&quot;/checkitem/findPage.do&quot;</span>,param).<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>)=&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//为模型数据赋值，基于VUE的双向绑定展示到页面</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dataList</span> = response.<span class="property">data</span>.<span class="property">rows</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">pagination</span>.<span class="property">total</span> = response.<span class="property">data</span>.<span class="property">total</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-1-3-完善分页方法执行时机"><a href="#4-1-3-完善分页方法执行时机" class="headerlink" title="4.1.3 完善分页方法执行时机"></a>4.1.3 完善分页方法执行时机</h4><p>除了在created钩子函数中调用findPage方法查询分页数据之外，当用户点击查询按钮或者点击分页条中的页码时也需要调用findPage方法重新发起查询请求。</p>
<p>为查询按钮绑定单击事件，调用findPage方法</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;findPage()&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dalfBut&quot;</span>&gt;</span>查询<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>为分页条组件绑定current-change事件，此事件是分页条组件自己定义的事件，当页码改变时触发，对应的处理函数为handleCurrentChange</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-pagination</span></span></span><br><span class="line"><span class="tag">               <span class="attr">class</span>=<span class="string">&quot;pagiantion&quot;</span></span></span><br><span class="line"><span class="tag">               @<span class="attr">current-change</span>=<span class="string">&quot;handleCurrentChange&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">:current-page</span>=<span class="string">&quot;pagination.currentPage&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">:page-size</span>=<span class="string">&quot;pagination.pageSize&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">layout</span>=<span class="string">&quot;total, prev, pager, next, jumper&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">:total</span>=<span class="string">&quot;pagination.total&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-pagination</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>定义handleCurrentChange方法</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//切换页码</span></span><br><span class="line"><span class="title function_">handleCurrentChange</span>(<span class="params">currentPage</span>) &#123;</span><br><span class="line">  <span class="comment">//currentPage为切换后的页码</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">pagination</span>.<span class="property">currentPage</span> = currentPage;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">findPage</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-后台代码"><a href="#4-2-后台代码" class="headerlink" title="4.2 后台代码"></a>4.2 后台代码</h3><h4 id="4-2-1-Controller"><a href="#4-2-1-Controller" class="headerlink" title="4.2.1 Controller"></a>4.2.1 Controller</h4><p>在CheckItemController中增加分页查询方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/findPage&quot;)</span></span><br><span class="line"><span class="keyword">public</span> PageResult <span class="title function_">findPage</span><span class="params">(<span class="meta">@RequestBody</span> QueryPageBean queryPageBean)</span>&#123;</span><br><span class="line">    <span class="type">PageResult</span> <span class="variable">pageResult</span> <span class="operator">=</span> checkItemService.pageQuery(</span><br><span class="line">    queryPageBean.getCurrentPage(), </span><br><span class="line">    queryPageBean.getPageSize(), </span><br><span class="line">    queryPageBean.getQueryString());</span><br><span class="line">    <span class="keyword">return</span> pageResult;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-2-2-服务接口"><a href="#4-2-2-服务接口" class="headerlink" title="4.2.2 服务接口"></a>4.2.2 服务接口</h4><p>在CheckItemService服务接口中扩展分页查询方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> PageResult <span class="title function_">pageQuery</span><span class="params">(Integer currentPage, Integer pageSize, String queryString)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="4-2-3-服务实现类"><a href="#4-2-3-服务实现类" class="headerlink" title="4.2.3 服务实现类"></a>4.2.3 服务实现类</h4><p>在CheckItemServiceImpl服务实现类中实现分页查询方法，基于Mybatis分页助手插件实现分页</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> PageResult <span class="title function_">pageQuery</span><span class="params">(Integer currentPage, Integer pageSize, String queryString)</span> &#123;</span><br><span class="line">  PageHelper.startPage(currentPage,pageSize);</span><br><span class="line">  Page&lt;CheckItem&gt; page = checkItemDao.selectByCondition(queryString);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>(page.getTotal(),page.getResult());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-2-4-Dao接口"><a href="#4-2-4-Dao接口" class="headerlink" title="4.2.4 Dao接口"></a>4.2.4 Dao接口</h4><p>在CheckItemDao接口中扩展分页查询方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Page&lt;CheckItem&gt; <span class="title function_">selectByCondition</span><span class="params">(String queryString)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="4-2-5-Mapper映射文件"><a href="#4-2-5-Mapper映射文件" class="headerlink" title="4.2.5 Mapper映射文件"></a>4.2.5 Mapper映射文件</h4><p>在CheckItemDao.xml文件中增加SQL定义</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByCondition&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;string&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.pojo.CheckItem&quot;</span>&gt;</span></span><br><span class="line">  select * from t_checkitem</span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;value != null and value.length &gt; 0&quot;</span>&gt;</span></span><br><span class="line">    where code = #&#123;value&#125; or name = #&#123;value&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-删除检查项"><a href="#5-删除检查项" class="headerlink" title="5. 删除检查项"></a>5. 删除检查项</h2><h3 id="5-1-完善页面"><a href="#5-1-完善页面" class="headerlink" title="5.1 完善页面"></a>5.1 完善页面</h3><p>为了防止用户误操作，点击删除按钮时需要弹出确认删除的提示，用户点击取消则不做任何操作，用户点击确定按钮再提交删除请求。</p>
<h4 id="5-1-1-绑定单击事件"><a href="#5-1-1-绑定单击事件" class="headerlink" title="5.1.1 绑定单击事件"></a>5.1.1 绑定单击事件</h4><p>需要为删除按钮绑定单击事件，并且将当前行数据作为参数传递给处理函数</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleDelete(scope.row)&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// 删除</span><br><span class="line">handleDelete(row) &#123;</span><br><span class="line">  alert(row.id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-1-2-弹出确认操作提示"><a href="#5-1-2-弹出确认操作提示" class="headerlink" title="5.1.2 弹出确认操作提示"></a>5.1.2 弹出确认操作提示</h4><p>用户点击删除按钮会执行handleDelete方法，此处需要完善handleDelete方法，弹出确认提示信息。ElementUI提供了$confirm方法来实现确认提示信息弹框效果</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 删除</span></span><br><span class="line"><span class="title function_">handleDelete</span>(<span class="params">row</span>) &#123;</span><br><span class="line">  <span class="comment">//alert(row.id);</span></span><br><span class="line">  <span class="variable language_">this</span>.$confirm(<span class="string">&quot;确认删除当前选中记录吗？&quot;</span>,<span class="string">&quot;提示&quot;</span>,&#123;<span class="attr">type</span>:<span class="string">&#x27;warning&#x27;</span>&#125;).<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//点击确定按钮时只需此处代码</span></span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;用户点击的是确定按钮&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-1-3-发送请求"><a href="#5-1-3-发送请求" class="headerlink" title="5.1.3 发送请求"></a>5.1.3 发送请求</h4><p>如果用户点击确定按钮就需要发送ajax请求，并且将当前检查项的id作为参数提交到后台进行删除操作</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 删除</span></span><br><span class="line"><span class="title function_">handleDelete</span>(<span class="params">row</span>) &#123;</span><br><span class="line">  <span class="comment">//alert(row.id);</span></span><br><span class="line">  <span class="variable language_">this</span>.$confirm(<span class="string">&quot;确认删除吗？&quot;</span>,<span class="string">&quot;提示&quot;</span>,&#123;<span class="attr">type</span>:<span class="string">&#x27;warning&#x27;</span>&#125;).<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//点击确定按钮时只需此处代码</span></span><br><span class="line">    <span class="comment">//alert(&#x27;用户点击的是确定按钮&#x27;);</span></span><br><span class="line">    axios.<span class="title function_">get</span>(<span class="string">&quot;/checkitem/delete.do?id=&quot;</span> + row.<span class="property">id</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(!res.<span class="property">data</span>.<span class="property">flag</span>)&#123;</span><br><span class="line">        <span class="comment">//删除失败</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(res.<span class="property">data</span>.<span class="property">message</span>);</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//删除成功</span></span><br><span class="line">        <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">          <span class="attr">message</span>: res.<span class="property">data</span>.<span class="property">message</span>,</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//调用分页，获取最新分页数据</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">findPage</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-后台代码"><a href="#5-2-后台代码" class="headerlink" title="5.2 后台代码"></a>5.2 后台代码</h3><h4 id="5-2-1-Controller"><a href="#5-2-1-Controller" class="headerlink" title="5.2.1 Controller"></a>5.2.1 Controller</h4><p>在CheckItemController中增加删除方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//删除</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/delete&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">delete</span><span class="params">(Integer id)</span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    checkItemService.delete(id);</span><br><span class="line">  &#125;<span class="keyword">catch</span> (RuntimeException e)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>,e.getMessage());</span><br><span class="line">  &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>, MessageConstant.DELETE_CHECKITEM_FAIL);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>,MessageConstant.DELETE_CHECKITEM_SUCCESS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-2-2-服务接口"><a href="#5-2-2-服务接口" class="headerlink" title="5.2.2 服务接口"></a>5.2.2 服务接口</h4><p>在CheckItemService服务接口中扩展删除方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(Integer id)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="5-2-3-服务实现类"><a href="#5-2-3-服务实现类" class="headerlink" title="5.2.3 服务实现类"></a>5.2.3 服务实现类</h4><p>注意：不能直接删除，需要判断当前检查项是否和检查组关联，如果已经和检查组进行了关联则不允许删除</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//删除</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(Integer id)</span> <span class="keyword">throws</span> RuntimeException&#123;</span><br><span class="line">  <span class="comment">//查询当前检查项是否和检查组关联</span></span><br><span class="line">  <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> checkItemDao.findCountByCheckItemId(id);</span><br><span class="line">  <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="comment">//当前检查项被引用，不能删除</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;当前检查项被引用，不能删除&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  checkItemDao.deleteById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-2-4-Dao接口"><a href="#5-2-4-Dao接口" class="headerlink" title="5.2.4 Dao接口"></a>5.2.4 Dao接口</h4><p>在CheckItemDao接口中扩展方法findCountByCheckItemId和deleteById</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Integer id)</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="type">long</span> <span class="title function_">findCountByCheckItemId</span><span class="params">(Integer checkItemId)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="5-2-5-Mapper映射文件"><a href="#5-2-5-Mapper映射文件" class="headerlink" title="5.2.5 Mapper映射文件"></a>5.2.5 Mapper映射文件</h4><p>在CheckItemDao.xml中扩展SQL语句</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--删除--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">  delete from t_checkitem where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--根据检查项id查询中间关系表--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findCountByCheckItemId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;long&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">  select count(*) from t_checkgroup_checkitem where checkitem_id = #&#123;checkitem_id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="6-编辑检查项"><a href="#6-编辑检查项" class="headerlink" title="6. 编辑检查项"></a>6. 编辑检查项</h2><h3 id="6-1-完善页面"><a href="#6-1-完善页面" class="headerlink" title="6.1 完善页面"></a>6.1 完善页面</h3><p>用户点击编辑按钮时，需要弹出编辑窗口并且将当前记录的数据进行回显，用户修改完成后点击确定按钮将修改后的数据提交到后台进行数据库操作。</p>
<h4 id="6-1-1-绑定单击事件"><a href="#6-1-1-绑定单击事件" class="headerlink" title="6.1.1 绑定单击事件"></a>6.1.1 绑定单击事件</h4><p>需要为编辑按钮绑定单击事件，并且将当前行数据作为参数传递给处理函数</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleUpdate(scope.row)&quot;</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">handleUpdate(row) &#123;</span><br><span class="line">  alert(row);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-1-2-弹出编辑窗口回显数据"><a href="#6-1-2-弹出编辑窗口回显数据" class="headerlink" title="6.1.2 弹出编辑窗口回显数据"></a>6.1.2 弹出编辑窗口回显数据</h4><p>当前页面中的编辑窗口已经提供好了，默认处于隐藏状态。在handleUpdate方法中需要将编辑窗口展示出来，并且需要发送ajax请求查询当前检查项数据用于回显</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 弹出编辑窗口</span></span><br><span class="line"><span class="title function_">handleUpdate</span>(<span class="params">row</span>) &#123;</span><br><span class="line">  <span class="comment">//发送请求获取检查项信息</span></span><br><span class="line">  axios.<span class="title function_">get</span>(<span class="string">&quot;/checkitem/findById.do?id=&quot;</span> + row.<span class="property">id</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">flag</span>)&#123;</span><br><span class="line">      <span class="comment">//设置编辑窗口属性，dialogFormVisible4Edit为true表示显示</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">dialogFormVisible4Edit</span> = <span class="literal">true</span>;</span><br><span class="line">      <span class="comment">//为模型数据设置值，基于VUE双向数据绑定回显到页面</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">formData</span> = res.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&quot;获取数据失败，请刷新当前页面&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-1-3-发送请求"><a href="#6-1-3-发送请求" class="headerlink" title="6.1.3 发送请求"></a>6.1.3 发送请求</h4><p>在编辑窗口中修改完成后，点击确定按钮需要提交请求，所以需要为确定按钮绑定事件并提供处理函数handleEdit</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleEdit()&quot;</span>&gt;</span>确定<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">//编辑</span><br><span class="line">handleEdit() &#123;</span><br><span class="line">  //表单校验</span><br><span class="line">  this.$refs[&#x27;dataEditForm&#x27;].validate((valid)=&gt;&#123;</span><br><span class="line">    if(valid)&#123;</span><br><span class="line">      //表单校验通过，发送请求</span><br><span class="line">      axios.post(&quot;/checkitem/edit.do&quot;,this.formData).then((response)=&gt; &#123;</span><br><span class="line">        //隐藏编辑窗口</span><br><span class="line">        this.dialogFormVisible4Edit = false;</span><br><span class="line">        if(response.data.flag)&#123;</span><br><span class="line">          //编辑成功，弹出成功提示信息</span><br><span class="line">          this.$message(&#123;</span><br><span class="line">            message: response.data.message,</span><br><span class="line">            type: &#x27;success&#x27;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">          //编辑失败，弹出错误提示信息</span><br><span class="line">          this.$message.error(response.data.message);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;).finally(()=&gt; &#123;</span><br><span class="line">        //重新发送请求查询分页数据</span><br><span class="line">        this.findPage();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">      //表单校验失败</span><br><span class="line">      this.$message.error(&quot;表单数据校验失败&quot;);</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-2-后台代码"><a href="#6-2-后台代码" class="headerlink" title="6.2 后台代码"></a>6.2 后台代码</h3><h4 id="6-2-1-Controller"><a href="#6-2-1-Controller" class="headerlink" title="6.2.1 Controller"></a>6.2.1 Controller</h4><p>在CheckItemController中增加编辑方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//编辑</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/edit&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">edit</span><span class="params">(<span class="meta">@RequestBody</span> CheckItem checkItem)</span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    checkItemService.edit(checkItem);</span><br><span class="line">  &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>,MessageConstant.EDIT_CHECKITEM_FAIL);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>,MessageConstant.EDIT_CHECKITEM_SUCCESS);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/findById&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">findById</span><span class="params">(Integer id)</span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="type">CheckItem</span> <span class="variable">checkItem</span> <span class="operator">=</span> checkItemService.findById(id);</span><br><span class="line">        <span class="keyword">return</span>  <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>, MessageConstant.QUERY_CHECKITEM_SUCCESS,checkItem);</span><br><span class="line">    &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="comment">//服务调用失败</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>, MessageConstant.QUERY_CHECKITEM_FAIL);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-2-2-服务接口"><a href="#6-2-2-服务接口" class="headerlink" title="6.2.2 服务接口"></a>6.2.2 服务接口</h4><p>在CheckItemService服务接口中扩展编辑方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">edit</span><span class="params">(CheckItem checkItem)</span>;</span><br><span class="line"><span class="keyword">public</span> CheckItem <span class="title function_">findById</span><span class="params">(Integer id)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="6-2-3-服务实现类"><a href="#6-2-3-服务实现类" class="headerlink" title="6.2.3 服务实现类"></a>6.2.3 服务实现类</h4><p>在CheckItemServiceImpl实现类中实现编辑方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//编辑</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">edit</span><span class="params">(CheckItem checkItem)</span> &#123;</span><br><span class="line">  checkItemDao.edit(checkItem);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> CheckItem <span class="title function_">findById</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> checkItemDao.findById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-2-4-Dao接口"><a href="#6-2-4-Dao接口" class="headerlink" title="6.2.4 Dao接口"></a>6.2.4 Dao接口</h4><p>在CheckItemDao接口中扩展edit方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">edit</span><span class="params">(CheckItem checkItem)</span>;</span><br><span class="line"><span class="keyword">public</span> CheckItem <span class="title function_">findById</span><span class="params">(Integer id)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="6-2-5-Mapper映射文件"><a href="#6-2-5-Mapper映射文件" class="headerlink" title="6.2.5 Mapper映射文件"></a>6.2.5 Mapper映射文件</h4><p>在CheckItemDao.xml中扩展SQL语句</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--编辑--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;edit&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.itheima.pojo.CheckItem&quot;</span>&gt;</span></span><br><span class="line">  update t_checkitem</span><br><span class="line">  <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span></span><br><span class="line">      name = #&#123;name&#125;,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;sex != null&quot;</span>&gt;</span></span><br><span class="line">      sex = #&#123;sex&#125;,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;code != null&quot;</span>&gt;</span></span><br><span class="line">      code = #&#123;code&#125;,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age != null&quot;</span>&gt;</span></span><br><span class="line">      age = #&#123;age&#125;,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;price != null&quot;</span>&gt;</span></span><br><span class="line">      price = #&#123;price&#125;,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;type != null&quot;</span>&gt;</span></span><br><span class="line">      type = #&#123;type&#125;,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;attention != null&quot;</span>&gt;</span></span><br><span class="line">      attention = #&#123;attention&#125;,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;remark != null&quot;</span>&gt;</span></span><br><span class="line">      remark = #&#123;remark&#125;,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">  where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.pojo.CheckItem&quot;</span>&gt;</span></span><br><span class="line">    select * from t_checkitem where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="第3章-预约管理-检查组管理"><a href="#第3章-预约管理-检查组管理" class="headerlink" title="第3章 预约管理-检查组管理"></a>第3章 预约管理-检查组管理</h1><h2 id="1-需求分析-1"><a href="#1-需求分析-1" class="headerlink" title="1. 需求分析"></a>1. 需求分析</h2><p>检查组其实就是多个检查项的集合，例如有一个检查组为“一般检查”，这个检查组可以包括多个检查项：身高、体重、收缩压、舒张压等。所以在添加检查组时需要选择这个检查组包括的检查项。</p>
<p>检查组对应的实体类为CheckGroup，对应的数据表为t_checkgroup。检查组和检查项为多对多关系，所以需要中间表t_checkgroup_checkitem进行关联。</p>
<h2 id="2-新增检查组"><a href="#2-新增检查组" class="headerlink" title="2. 新增检查组"></a>2. 新增检查组</h2><h3 id="2-1-完善页面"><a href="#2-1-完善页面" class="headerlink" title="2.1 完善页面"></a>2.1 完善页面</h3><p>检查组管理页面对应的是checkgroup.html页面，根据产品设计的原型已经完成了页面基本结构的编写，现在需要完善页面动态效果。</p>
<h4 id="2-1-1-弹出新增窗口"><a href="#2-1-1-弹出新增窗口" class="headerlink" title="2.1.1 弹出新增窗口"></a>2.1.1 弹出新增窗口</h4><p>页面中已经提供了新增窗口，只是出于隐藏状态。只需要将控制展示状态的属性dialogFormVisible改为true即可显示出新增窗口。点击新建按钮时绑定的方法为handleCreate，所以在handleCreate方法中修改dialogFormVisible属性的值为true即可。同时为了增加用户体验度，需要每次点击新建按钮时清空表单输入项。</p>
<p>由于新增检查组时还需要选择此检查组包含的检查项，所以新增检查组窗口分为两部分信息：基本信息和检查项信息，如下图：</p>
<p><img src="/../../assets/2143930-20210826111027898-1484280306.png" alt="img"></p>
<p><img src="/../../assets/2143930-20210826111034926-52537537.png" alt="img"></p>
<p>新建按钮绑定单击事件，对应的处理函数为handleCreate</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">class</span>=<span class="string">&quot;butT&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleCreate()&quot;</span>&gt;</span>新建<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">// 重置表单</span><br><span class="line">resetForm() &#123;</span><br><span class="line">	this.formData = &#123;&#125;;</span><br><span class="line">&#125;,</span><br><span class="line">// 弹出添加窗口</span><br><span class="line">handleCreate() &#123;</span><br><span class="line">	this.resetForm();</span><br><span class="line">	this.dialogFormVisible = true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-1-2-动态展示检查项列表"><a href="#2-1-2-动态展示检查项列表" class="headerlink" title="2.1.2 动态展示检查项列表"></a>2.1.2 动态展示检查项列表</h4><p>现在虽然已经完成了新增窗口的弹出，但是在检查项信息标签页中需要动态展示所有的检查项信息列表数据，并且可以进行勾选。具体操作步骤如下：</p>
<p>（1）定义模型数据</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="attr">tableData</span>:[],<span class="comment">//新增和编辑表单中对应的检查项列表数据</span></span><br><span class="line"><span class="attr">checkitemIds</span>:[],<span class="comment">//新增和编辑表单中检查项对应的复选框，基于双向绑定可以进行回显和数据提交</span></span><br></pre></td></tr></table></figure>

<p>（2）动态展示检查项列表数据，数据来源于上面定义的tableData模型数据</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;datatable&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>选择<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>项目编码<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>项目名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>项目说明<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">v-for</span>=<span class="string">&quot;c in tableData&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">:id</span>=<span class="string">&quot;c.id&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;checkitemIds&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;c.id&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">label</span> <span class="attr">:for</span>=<span class="string">&quot;c.id&quot;</span>&gt;</span>&#123;&#123;c.code&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">label</span> <span class="attr">:for</span>=<span class="string">&quot;c.id&quot;</span>&gt;</span>&#123;&#123;c.name&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">label</span> <span class="attr">:for</span>=<span class="string">&quot;c.id&quot;</span>&gt;</span>&#123;&#123;c.remark&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（3）完善handleCreate方法，发送ajax请求查询所有检查项数据并将结果赋值给tableData模型数据用于页面表格展示</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 弹出添加窗口</span></span><br><span class="line"><span class="title function_">handleCreate</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">dialogFormVisible</span> = <span class="literal">true</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">resetForm</span>();</span><br><span class="line">  <span class="comment">//默认切换到第一个标签页（基本信息）</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">activeName</span>=<span class="string">&#x27;first&#x27;</span>;</span><br><span class="line">  <span class="comment">//重置</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">checkitemIds</span> = [];</span><br><span class="line">  <span class="comment">//发送ajax请求查询所有检查项信息</span></span><br><span class="line">  axios.<span class="title function_">get</span>(<span class="string">&quot;/checkitem/findAll.do&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">flag</span>)&#123;</span><br><span class="line">      <span class="comment">//将检查项列表数据赋值给模型数据用于页面表格展示</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">tableData</span> = res.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(res.<span class="property">data</span>.<span class="property">message</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（4）分别在CheckItemController、CheckItemService、CheckItemServiceImpl、CheckItemDao、CheckItemDao.xml中扩展方法查询所有检查项数据</p>
<p>CheckItemController：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//查询所有</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/findAll&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">findAll</span><span class="params">()</span>&#123;</span><br><span class="line">  List&lt;CheckItem&gt; checkItemList = checkItemService.findAll();</span><br><span class="line">  <span class="keyword">if</span>(checkItemList != <span class="literal">null</span> &amp;&amp; checkItemList.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>, MessageConstant.QUERY_CHECKITEM_SUCCESS);</span><br><span class="line">    result.setData(checkItemList);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>,MessageConstant.QUERY_CHECKITEM_FAIL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CheckItemService：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;CheckItem&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<p>CheckItemServiceImpl：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;CheckItem&gt; <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> checkItemDao.findAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CheckItemDao：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;CheckItem&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<p>CheckItemDao.xml：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.pojo.CheckItem&quot;</span>&gt;</span></span><br><span class="line">  select * from t_checkitem</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-1-3-提交请求"><a href="#2-1-3-提交请求" class="headerlink" title="2.1.3 提交请求"></a>2.1.3 提交请求</h4><p>当用户点击新增窗口中的确定按钮时发送ajax请求将数据提交到后台进行数据库操作。提交到后台的数据分为两部分：检查组基本信息（对应的模型数据为formData）和检查项id数组（对应的模型数据为checkitemIds）。</p>
<p>为确定按钮绑定单击事件，对应的处理函数为handleAdd</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleAdd()&quot;</span>&gt;</span>确定<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>完善handleAdd方法</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 弹出添加窗口</span></span><br><span class="line"><span class="comment">//添加</span></span><br><span class="line">handleAdd () &#123;</span><br><span class="line">  <span class="comment">//发送ajax请求将模型数据提交到后台处理</span></span><br><span class="line">  axios.<span class="title function_">post</span>(</span><br><span class="line">    		<span class="string">&quot;/checkgroup/add.do?checkitemIds=&quot;</span> + <span class="variable language_">this</span>.<span class="property">checkitemIds</span>,</span><br><span class="line">    		<span class="variable language_">this</span>.<span class="property">formData</span></span><br><span class="line">  			)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>)=&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//关闭新增窗口</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">dialogFormVisible</span> = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">if</span>(response.<span class="property">data</span>.<span class="property">flag</span>)&#123;</span><br><span class="line">        <span class="comment">//新增成功，弹出成功提示</span></span><br><span class="line">        <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">          <span class="attr">message</span>: response.<span class="property">data</span>.<span class="property">message</span>,</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//新增失败，弹出错误提示</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(response.<span class="property">data</span>.<span class="property">message</span>);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;).<span class="title function_">finally</span>(<span class="function">()=&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">findPage</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-后台代码"><a href="#2-2-后台代码" class="headerlink" title="2.2 后台代码"></a>2.2 后台代码</h3><h4 id="2-2-1-Controller"><a href="#2-2-1-Controller" class="headerlink" title="2.2.1 Controller"></a>2.2.1 Controller</h4><p>在health_backend工程中创建CheckGroupController</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.controller;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Reference;</span><br><span class="line"><span class="keyword">import</span> com.itheima.constant.MessageConstant;</span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.PageResult;</span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.QueryPageBean;</span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.Result;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.CheckGroup;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.CheckItem;</span><br><span class="line"><span class="keyword">import</span> com.itheima.service.CheckGroupService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 检查组管理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/checkgroup&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CheckGroupController</span> &#123;</span><br><span class="line">    <span class="meta">@Reference</span></span><br><span class="line">    <span class="keyword">private</span> CheckGroupService checkGroupService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//新增</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/add&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">add</span><span class="params">(<span class="meta">@RequestBody</span> CheckGroup checkGroup,Integer[] checkitemIds)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            checkGroupService.add(checkGroup,checkitemIds);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            <span class="comment">//新增失败</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>, MessageConstant.ADD_CHECKGROUP_FAIL);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//新增成功</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>,MessageConstant.ADD_CHECKGROUP_SUCCESS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-2-服务接口"><a href="#2-2-2-服务接口" class="headerlink" title="2.2.2 服务接口"></a>2.2.2 服务接口</h4><p>在health_interface工程中创建CheckGroupService接口</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.service;</span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.PageResult;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.CheckGroup;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 检查组服务接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CheckGroupService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(CheckGroup checkGroup,Integer[] checkitemIds)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-3-服务实现类"><a href="#2-2-3-服务实现类" class="headerlink" title="2.2.3 服务实现类"></a>2.2.3 服务实现类</h4><p>在health_service_provider工程中创建CheckGroupServiceImpl实现类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.service;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Service;</span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.Page;</span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.PageHelper;</span><br><span class="line"><span class="keyword">import</span> com.itheima.dao.CheckGroupDao;</span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.PageResult;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.CheckGroup;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.CheckItem;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 检查组服务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service(interfaceClass = CheckGroupService.class)</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CheckGroupServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">CheckGroupService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CheckGroupDao checkGroupDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加检查组合，同时需要设置检查组合和检查项的关联关系</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(CheckGroup checkGroup, Integer[] checkitemIds)</span> &#123;</span><br><span class="line">        checkGroupDao.add(checkGroup);</span><br><span class="line">        setCheckGroupAndCheckItem(checkGroup.getId(),checkitemIds);</span><br><span class="line">    &#125;</span><br><span class="line">  	<span class="comment">//设置检查组合和检查项的关联关系</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCheckGroupAndCheckItem</span><span class="params">(Integer checkGroupId,Integer[] checkitemIds)</span>&#123;</span><br><span class="line">          <span class="keyword">if</span>(checkitemIds != <span class="literal">null</span> &amp;&amp; checkitemIds.length &gt; <span class="number">0</span>)&#123;</span><br><span class="line">              <span class="keyword">for</span> (Integer checkitemId : checkitemIds) &#123;</span><br><span class="line">                  Map&lt;String,Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">                  map.put(<span class="string">&quot;checkgroup_id&quot;</span>,checkGroupId);</span><br><span class="line">                  map.put(<span class="string">&quot;checkitem_id&quot;</span>,checkitemId);</span><br><span class="line">                  checkGroupDao.setCheckGroupAndCheckItem(map);</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-4-Dao接口"><a href="#2-2-4-Dao接口" class="headerlink" title="2.2.4 Dao接口"></a>2.2.4 Dao接口</h4><p>创建CheckGroupDao接口</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.dao;</span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.Page;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.CheckGroup;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 持久层Dao接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CheckGroupDao</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(CheckGroup checkGroup)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setCheckGroupAndCheckItem</span><span class="params">(Map map)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-5-Mapper映射文件"><a href="#2-2-5-Mapper映射文件" class="headerlink" title="2.2.5 Mapper映射文件"></a>2.2.5 Mapper映射文件</h4><p>创建CheckGroupDao.xml映射文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.dao.CheckGroupDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--新增--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;add&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.itheima.pojo.CheckGroup&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Integer&quot;</span> <span class="attr">order</span>=<span class="string">&quot;AFTER&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">            SELECT LAST_INSERT_ID()</span><br><span class="line">        <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">        insert into t_checkgroup(code,name,sex,helpCode,remark,attention)</span><br><span class="line">            values </span><br><span class="line">      	(#&#123;code&#125;,#&#123;name&#125;,#&#123;sex&#125;,#&#123;helpCode&#125;,#&#123;remark&#125;,#&#123;attention&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--设置检查组和检查项的关联关系--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;setCheckGroupAndCheckItem&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;hashmap&quot;</span>&gt;</span></span><br><span class="line">        insert into t_checkgroup_checkitem(checkgroup_id,checkitem_id) </span><br><span class="line">      		values</span><br><span class="line">      	(#&#123;checkgroup_id&#125;,#&#123;checkitem_id&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-检查组分页"><a href="#3-检查组分页" class="headerlink" title="3. 检查组分页"></a>3. 检查组分页</h2><h3 id="3-1-完善页面-1"><a href="#3-1-完善页面-1" class="headerlink" title="3.1 完善页面"></a>3.1 完善页面</h3><h4 id="3-1-1-定义分页相关模型数据"><a href="#3-1-1-定义分页相关模型数据" class="headerlink" title="3.1.1 定义分页相关模型数据"></a>3.1.1 定义分页相关模型数据</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="attr">pagination</span>: &#123;<span class="comment">//分页相关模型数据</span></span><br><span class="line">  <span class="attr">currentPage</span>: <span class="number">1</span>,<span class="comment">//当前页码</span></span><br><span class="line">  <span class="attr">pageSize</span>:<span class="number">10</span>,<span class="comment">//每页显示的记录数</span></span><br><span class="line">  <span class="attr">total</span>:<span class="number">0</span>,<span class="comment">//总记录数</span></span><br><span class="line">  <span class="attr">queryString</span>:<span class="literal">null</span><span class="comment">//查询条件</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">dataList</span>: [],<span class="comment">//当前页要展示的分页列表数据</span></span><br></pre></td></tr></table></figure>

<h4 id="3-1-2-定义分页方法"><a href="#3-1-2-定义分页方法" class="headerlink" title="3.1.2 定义分页方法"></a>3.1.2 定义分页方法</h4><p>在页面中提供了findPage方法用于分页查询，为了能够在checkgroup.html页面加载后直接可以展示分页数据，可以在VUE提供的钩子函数created中调用findPage方法</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//钩子函数，VUE对象初始化完成后自动执行</span></span><br><span class="line"><span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">findPage</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="title function_">findPage</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">//分页参数</span></span><br><span class="line">  <span class="keyword">var</span> param = &#123;</span><br><span class="line">    <span class="attr">currentPage</span>:<span class="variable language_">this</span>.<span class="property">pagination</span>.<span class="property">currentPage</span>,<span class="comment">//页码</span></span><br><span class="line">    <span class="attr">pageSize</span>:<span class="variable language_">this</span>.<span class="property">pagination</span>.<span class="property">pageSize</span>,<span class="comment">//每页显示的记录数</span></span><br><span class="line">    <span class="attr">queryString</span>:<span class="variable language_">this</span>.<span class="property">pagination</span>.<span class="property">queryString</span><span class="comment">//查询条件</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">//请求后台</span></span><br><span class="line">  axios.<span class="title function_">post</span>(<span class="string">&quot;/checkgroup/findPage.do&quot;</span>,param).<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>)=&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//为模型数据赋值，基于VUE的双向绑定展示到页面</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dataList</span> = response.<span class="property">data</span>.<span class="property">rows</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">pagination</span>.<span class="property">total</span> = response.<span class="property">data</span>.<span class="property">total</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-1-3-完善分页方法执行时机"><a href="#3-1-3-完善分页方法执行时机" class="headerlink" title="3.1.3 完善分页方法执行时机"></a>3.1.3 完善分页方法执行时机</h4><p>除了在created钩子函数中调用findPage方法查询分页数据之外，当用户点击查询按钮或者点击分页条中的页码时也需要调用findPage方法重新发起查询请求。</p>
<p>为查询按钮绑定单击事件，调用findPage方法</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;findPage()&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dalfBut&quot;</span>&gt;</span>查询<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>为分页条组件绑定current-change事件，此事件是分页条组件自己定义的事件，当页码改变时触发，对应的处理函数为handleCurrentChange</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-pagination</span></span></span><br><span class="line"><span class="tag">               <span class="attr">class</span>=<span class="string">&quot;pagiantion&quot;</span></span></span><br><span class="line"><span class="tag">               @<span class="attr">current-change</span>=<span class="string">&quot;handleCurrentChange&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">:current-page</span>=<span class="string">&quot;pagination.currentPage&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">:page-size</span>=<span class="string">&quot;pagination.pageSize&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">layout</span>=<span class="string">&quot;total, prev, pager, next, jumper&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">:total</span>=<span class="string">&quot;pagination.total&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-pagination</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>定义handleCurrentChange方法</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//切换页码handleCurrentChange(currentPage) &#123;</span></span><br><span class="line">  <span class="comment">//currentPage为切换后的页码</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">pagination</span>.<span class="property">currentPage</span> = currentPage;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">findPage</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-后台代码-1"><a href="#3-2-后台代码-1" class="headerlink" title="3.2 后台代码"></a>3.2 后台代码</h3><h4 id="3-2-1-Controller-1"><a href="#3-2-1-Controller-1" class="headerlink" title="3.2.1 Controller"></a>3.2.1 Controller</h4><p>在CheckGroupController中增加分页查询方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/findPage&quot;)</span></span><br><span class="line"><span class="keyword">public</span> PageResult <span class="title function_">findPage</span><span class="params">(<span class="meta">@RequestBody</span> QueryPageBean queryPageBean)</span>&#123;</span><br><span class="line">  <span class="type">PageResult</span> <span class="variable">pageResult</span> <span class="operator">=</span> checkGroupService.pageQuery(</span><br><span class="line">    queryPageBean.getCurrentPage(), </span><br><span class="line">    queryPageBean.getPageSize(), </span><br><span class="line">    queryPageBean.getQueryString()</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> pageResult;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-服务接口-1"><a href="#3-2-2-服务接口-1" class="headerlink" title="3.2.2 服务接口"></a>3.2.2 服务接口</h4><p>在CheckGroupService服务接口中扩展分页查询方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> PageResult <span class="title function_">pageQuery</span><span class="params">(Integer currentPage, Integer pageSize, String queryString)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-3-服务实现类-1"><a href="#3-2-3-服务实现类-1" class="headerlink" title="3.2.3 服务实现类"></a>3.2.3 服务实现类</h4><p>在CheckGroupServiceImpl服务实现类中实现分页查询方法，基于Mybatis分页助手插件实现分页</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> PageResult <span class="title function_">pageQuery</span><span class="params">(Integer currentPage, Integer pageSize, String queryString)</span> &#123;</span><br><span class="line">  PageHelper.startPage(currentPage,pageSize);</span><br><span class="line">  Page&lt;CheckItem&gt; page = checkGroupDao.selectByCondition(queryString);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>(page.getTotal(),page.getResult());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-4-Dao接口-1"><a href="#3-2-4-Dao接口-1" class="headerlink" title="3.2.4 Dao接口"></a>3.2.4 Dao接口</h4><p>在CheckGroupDao接口中扩展分页查询方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Page&lt;CheckGroup&gt; <span class="title function_">selectByCondition</span><span class="params">(String queryString)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-5-Mapper映射文件-1"><a href="#3-2-5-Mapper映射文件-1" class="headerlink" title="3.2.5 Mapper映射文件"></a>3.2.5 Mapper映射文件</h4><p>在CheckGroupDao.xml文件中增加SQL定义</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByCondition&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;string&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.pojo.CheckGroup&quot;</span>&gt;</span></span><br><span class="line">  select * from t_checkgroup</span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;value != null and value.length &gt; 0&quot;</span>&gt;</span></span><br><span class="line">    where code = #&#123;value&#125; or name = #&#123;value&#125; or helpCode = #&#123;value&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="4-编辑检查组"><a href="#4-编辑检查组" class="headerlink" title="4. 编辑检查组"></a>4. 编辑检查组</h2><h3 id="4-1-完善页面-1"><a href="#4-1-完善页面-1" class="headerlink" title="4.1 完善页面"></a>4.1 完善页面</h3><p>用户点击编辑按钮时，需要弹出编辑窗口并且将当前记录的数据进行回显，用户修改完成后点击确定按钮将修改后的数据提交到后台进行数据库操作。此处进行数据回显的时候，除了需要检查组基本信息的回显之外，还需要回显当前检查组包含的检查项（以复选框勾选的形式回显）。</p>
<h4 id="4-1-1-绑定单击事件"><a href="#4-1-1-绑定单击事件" class="headerlink" title="4.1.1 绑定单击事件"></a>4.1.1 绑定单击事件</h4><p>需要为编辑按钮绑定单击事件，并且将当前行数据作为参数传递给处理函数</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleUpdate(scope.row)&quot;</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">handleUpdate(row) &#123;</span><br><span class="line">  alert(row);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-1-2-弹出编辑窗口回显数据"><a href="#4-1-2-弹出编辑窗口回显数据" class="headerlink" title="4.1.2 弹出编辑窗口回显数据"></a>4.1.2 弹出编辑窗口回显数据</h4><p>当前页面的编辑窗口已经提供好了，默认处于隐藏状态。在handleUpdate方法中需要将编辑窗口展示出来，并且需要发送多个ajax请求分别查询当前检查组数据、所有检查项数据、当前检查组包含的检查项id用于基本数据回显</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">handleUpdate</span>(<span class="params">row</span>) &#123;</span><br><span class="line">  <span class="comment">//发送ajax请求根据id查询检查组信息，用于基本信息回显</span></span><br><span class="line">  axios.<span class="title function_">get</span>(<span class="string">&quot;/checkgroup/findById.do?id=&quot;</span> + row.<span class="property">id</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">flag</span>)&#123;</span><br><span class="line">      <span class="comment">//弹出编辑窗口</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">dialogFormVisible4Edit</span> = <span class="literal">true</span>;</span><br><span class="line">      <span class="comment">//默认选中第一个标签页</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">activeName</span>=<span class="string">&#x27;first&#x27;</span>;</span><br><span class="line">      <span class="comment">//为模型数据赋值，通过VUE数据双向绑定进行信息的回显</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">formData</span> = res.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">      <span class="comment">//发送ajax请求查询所有的检查项信息，用于检查项表格展示</span></span><br><span class="line">      axios.<span class="title function_">get</span>(<span class="string">&quot;/checkitem/findAll.do&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">flag</span>)&#123;</span><br><span class="line">          <span class="comment">//为模型数据赋值，通过VUE数据双向绑定进行信息的回显</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">tableData</span> = res.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">          <span class="comment">//查询当前检查组包含的所有检查项id，用于页面回显</span></span><br><span class="line">          axios.<span class="title function_">get</span>(<span class="string">&quot;/checkgroup/findCheckItemIdsByCheckGroupId.do?id=&quot;</span> + row.<span class="property">id</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span> &#123;</span><br><span class="line">            <span class="comment">//为模型数据赋值，通过VUE数据双向绑定进行信息的回显</span></span><br><span class="line">            <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">flag</span>)&#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">checkitemIds</span> = res.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(res.<span class="property">data</span>.<span class="property">message</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(res.<span class="property">data</span>.<span class="property">message</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&quot;获取数据失败，请刷新当前页面&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-1-3-发送请求"><a href="#4-1-3-发送请求" class="headerlink" title="4.1.3 发送请求"></a>4.1.3 发送请求</h4><p>在编辑窗口中修改完成后，点击确定按钮需要提交请求，所以需要为确定按钮绑定事件并提供处理函数handleEdit</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleEdit()&quot;</span>&gt;</span>确定<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">//编辑</span><br><span class="line">handleEdit() &#123;</span><br><span class="line">  //发送ajax请求，提交模型数据</span><br><span class="line">  axios.post(&quot;/checkgroup/edit.do?checkitemIds=&quot;+this.checkitemIds,this.formData).</span><br><span class="line">  then((response)=&gt; &#123;</span><br><span class="line">    //隐藏编辑窗口</span><br><span class="line">    this.dialogFormVisible4Edit = false;</span><br><span class="line">    if(response.data.flag)&#123;</span><br><span class="line">      this.$message(&#123;</span><br><span class="line">        message: response.data.message,</span><br><span class="line">        type: &#x27;success&#x27;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">      this.$message.error(response.data.message);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;).finally(()=&gt; &#123;</span><br><span class="line">    this.findPage();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-后台代码-1"><a href="#4-2-后台代码-1" class="headerlink" title="4.2 后台代码"></a>4.2 后台代码</h3><h4 id="4-2-1-Controller-1"><a href="#4-2-1-Controller-1" class="headerlink" title="4.2.1 Controller"></a>4.2.1 Controller</h4><p>在CheckGroupController中增加方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//根据id查询</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/findById&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">findById</span><span class="params">(Integer id)</span>&#123;</span><br><span class="line">  <span class="type">CheckGroup</span> <span class="variable">checkGroup</span> <span class="operator">=</span> checkGroupService.findById(id);</span><br><span class="line">  <span class="keyword">if</span>(checkGroup != <span class="literal">null</span>)&#123;</span><br><span class="line">    <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>, MessageConstant.QUERY_CHECKGROUP_SUCCESS);</span><br><span class="line">    result.setData(checkGroup);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>,MessageConstant.QUERY_CHECKGROUP_FAIL);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据检查组合id查询对应的所有检查项id</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/findCheckItemIdsByCheckGroupId&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">findCheckItemIdsByCheckGroupId</span><span class="params">(Integer id)</span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        List&lt;Integer&gt; checkitemIds = </span><br><span class="line">            checkGroupService.findCheckItemIdsByCheckGroupId(id);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>,MessageConstant.QUERY_CHECKITEM_SUCCESS,checkitemIds);</span><br><span class="line">    &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>, MessageConstant.QUERY_CHECKITEM_FAIL);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//编辑</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/edit&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">edit</span><span class="params">(<span class="meta">@RequestBody</span> CheckGroup checkGroup,Integer[] checkitemIds)</span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    checkGroupService.edit(checkGroup,checkitemIds);</span><br><span class="line">  &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>,MessageConstant.EDIT_CHECKGROUP_FAIL);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>,MessageConstant.EDIT_CHECKGROUP_SUCCESS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-2-2-服务接口-1"><a href="#4-2-2-服务接口-1" class="headerlink" title="4.2.2 服务接口"></a>4.2.2 服务接口</h4><p>在CheckGroupService服务接口中扩展方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">CheckGroup <span class="title function_">findById</span><span class="params">(Integer id)</span>;</span><br><span class="line">List&lt;Integer&gt; <span class="title function_">findCheckItemIdsByCheckGroupId</span><span class="params">(Integer id)</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">edit</span><span class="params">(CheckGroup checkGroup,Integer[] checkitemIds)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="4-2-3-服务实现类-1"><a href="#4-2-3-服务实现类-1" class="headerlink" title="4.2.3 服务实现类"></a>4.2.3 服务实现类</h4><p>在CheckGroupServiceImpl实现类中实现编辑方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> CheckGroup <span class="title function_">findById</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> checkGroupDao.findById(id);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">findCheckItemIdsByCheckGroupId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> checkGroupDao.findCheckItemIdsByCheckGroupId(id);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//编辑检查组，同时需要更新和检查项的关联关系</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">edit</span><span class="params">(CheckGroup checkGroup, Integer[] checkitemIds)</span> &#123;</span><br><span class="line">  <span class="comment">//根据检查组id删除中间表数据（清理原有关联关系）</span></span><br><span class="line">  checkGroupDao.deleteAssociation(checkGroup.getId());</span><br><span class="line">  <span class="comment">//向中间表(t_checkgroup_checkitem)插入数据（建立检查组和检查项关联关系）</span></span><br><span class="line">  setCheckGroupAndCheckItem(checkGroup.getId(),checkitemIds);</span><br><span class="line">  <span class="comment">//更新检查组基本信息</span></span><br><span class="line">  checkGroupDao.edit(checkGroup);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//向中间表(t_checkgroup_checkitem)插入数据（建立检查组和检查项关联关系）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCheckGroupAndCheckItem</span><span class="params">(Integer checkGroupId,Integer[] checkitemIds)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(checkitemIds != <span class="literal">null</span> &amp;&amp; checkitemIds.length &gt; <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">for</span> (Integer checkitemId : checkitemIds) &#123;</span><br><span class="line">      Map&lt;String,Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">      map.put(<span class="string">&quot;checkgroup_id&quot;</span>,checkGroupId);</span><br><span class="line">      map.put(<span class="string">&quot;checkitem_id&quot;</span>,checkitemId);</span><br><span class="line">      checkGroupDao.setCheckGroupAndCheckItem(map);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-2-4-Dao接口-1"><a href="#4-2-4-Dao接口-1" class="headerlink" title="4.2.4 Dao接口"></a>4.2.4 Dao接口</h4><p>在CheckGroupDao接口中扩展方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">CheckGroup <span class="title function_">findById</span><span class="params">(Integer id)</span>;</span><br><span class="line">List&lt;Integer&gt; <span class="title function_">findCheckItemIdsByCheckGroupId</span><span class="params">(Integer id)</span>;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setCheckGroupAndCheckItem</span><span class="params">(Map map)</span>;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteAssociation</span><span class="params">(Integer id)</span>;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">edit</span><span class="params">(CheckGroup checkGroup)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="4-2-5-Mapper映射文件-1"><a href="#4-2-5-Mapper映射文件-1" class="headerlink" title="4.2.5 Mapper映射文件"></a>4.2.5 Mapper映射文件</h4><p>在CheckGroupDao.xml中扩展SQL语句</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.pojo.CheckGroup&quot;</span>&gt;</span></span><br><span class="line">  select * from t_checkgroup where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findCheckItemIdsByCheckGroupId&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">  select checkitem_id from t_checkgroup_checkitem where checkgroup_id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--向中间表插入数据（建立检查组和检查项关联关系）--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;setCheckGroupAndCheckItem&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;hashmap&quot;</span>&gt;</span></span><br><span class="line">  insert into t_checkgroup_checkitem(checkgroup_id,checkitem_id) </span><br><span class="line">  	values</span><br><span class="line">  (#&#123;checkgroup_id&#125;,#&#123;checkitem_id&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--根据检查组id删除中间表数据（清理原有关联关系）--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteAssociation&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">  delete from t_checkgroup_checkitem where checkgroup_id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--编辑--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;edit&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.itheima.pojo.CheckGroup&quot;</span>&gt;</span></span><br><span class="line">  update t_checkgroup</span><br><span class="line">  <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span></span><br><span class="line">      name = #&#123;name&#125;,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;sex != null&quot;</span>&gt;</span></span><br><span class="line">      sex = #&#123;sex&#125;,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;code != null&quot;</span>&gt;</span></span><br><span class="line">      code = #&#123;code&#125;,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;helpCode != null&quot;</span>&gt;</span></span><br><span class="line">      helpCode = #&#123;helpCode&#125;,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;attention != null&quot;</span>&gt;</span></span><br><span class="line">      attention = #&#123;attention&#125;,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;remark != null&quot;</span>&gt;</span></span><br><span class="line">      remark = #&#123;remark&#125;,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">  where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="第4章-预约管理-套餐管理"><a href="#第4章-预约管理-套餐管理" class="headerlink" title="第4章 预约管理-套餐管理"></a>第4章 预约管理-套餐管理</h1><h2 id="1-图片存储方案"><a href="#1-图片存储方案" class="headerlink" title="1. 图片存储方案"></a>1. 图片存储方案</h2><h3 id="1-1-介绍"><a href="#1-1-介绍" class="headerlink" title="1.1 介绍"></a>1.1 介绍</h3><p>在实际开发中，我们会有很多处理不同功能的服务器。例如：</p>
<p>应用服务器：负责部署我们的应用</p>
<p>数据库服务器：运行我们的数据库</p>
<p>文件服务器：负责存储用户上传文件的服务器</p>
<p><img src="/../../assets/image-20220907103607666.png" alt="image-20220907103607666"></p>
<p>分服务器处理的目的是让服务器各司其职，从而提高我们项目的运行效率。</p>
<p>常见的图片存储方案：</p>
<p>方案一：使用nginx搭建图片服务器</p>
<p>方案二：使用开源的分布式文件存储系统，例如Fastdfs、HDFS等</p>
<p>方案三：使用云存储，例如阿里云、七牛云等</p>
<h3 id="1-2-七牛云存储"><a href="#1-2-七牛云存储" class="headerlink" title="1.2 七牛云存储"></a>1.2 七牛云存储</h3><p>七牛云（隶属于上海七牛信息技术有限公司）是国内领先的以视觉智能和数据智能为核心的企业级云计算服务商，同时也是国内知名智能视频云服务商，累计为 70 多万家企业提供服务，覆盖了国内80%网民。围绕富媒体场景推出了对象存储、融合 CDN 加速、容器云、大数据平台、深度学习平台等产品、并提供一站式智能视频云解决方案。为各行业及应用提供可持续发展的智能视频云生态，帮助企业快速上云，创造更广阔的商业价值。</p>
<p>官网：<a target="_blank" rel="noopener" href="https://www.qiniu.com/">https://www.qiniu.com/</a></p>
<p>通过七牛云官网介绍我们可以知道其提供了多种服务，我们主要使用的是七牛云提供的对象存储服务来存储图片。</p>
<h4 id="1-2-1-注册、登录"><a href="#1-2-1-注册、登录" class="headerlink" title="1.2.1 注册、登录"></a>1.2.1 注册、登录</h4><p>要使用七牛云的服务，首先需要注册成为会员。地址：<a target="_blank" rel="noopener" href="https://portal.qiniu.com/signup">https://portal.qiniu.com/signup</a></p>
<p><img src="/../../assets/image-20220907103626199.png" alt="image-20220907103626199"></p>
<p>注册完成后就可以使用刚刚注册的邮箱和密码登录到七牛云：</p>
<p><img src="/../../assets/image-20220907103646595.png" alt="image-20220907103646595"></p>
<p>登录成功后点击页面右上角管理控制台：</p>
<p><img src="/../../assets/image-20220907103700164.png" alt="image-20220907103700164"></p>
<p>注意：登录成功后还需要进行实名认证才能进行相关操作。</p>
<h4 id="1-2-2-新建存储空间"><a href="#1-2-2-新建存储空间" class="headerlink" title="1.2.2 新建存储空间"></a>1.2.2 新建存储空间</h4><p>要进行图片存储，我们需要在七牛云管理控制台新建存储空间。点击管理控制台首页对象存储下的立即添加按钮，页面跳转到新建存储空间页面：</p>
<p><img src="/../../assets/image-20220907103741223.png" alt="image-20220907103741223"></p>
<p>可以创建多个存储空间，各个存储空间是相互独立的。</p>
<h4 id="1-2-3-查看存储空间信息"><a href="#1-2-3-查看存储空间信息" class="headerlink" title="1.2.3 查看存储空间信息"></a>1.2.3 查看存储空间信息</h4><p>存储空间创建后，会在左侧的存储空间列表菜单中展示创建的存储空间名称，点击存储空间名称可以查看当前存储空间的相关信息</p>
<p><img src="/../../assets/10(1).png" alt="10(1)"></p>
<h4 id="1-2-4-开发者中心"><a href="#1-2-4-开发者中心" class="headerlink" title="1.2.4 开发者中心"></a>1.2.4 开发者中心</h4><p>可以通过七牛云提供的开发者中心学习如何操作七牛云服务，地址：<a target="_blank" rel="noopener" href="https://developer.qiniu.com/">https://developer.qiniu.com/</a></p>
<p><img src="/../../assets/11.png" alt="11"></p>
<p>点击对象存储，跳转到对象存储开发页面，地址：<a target="_blank" rel="noopener" href="https://developer.qiniu.com/kodo">https://developer.qiniu.com/kodo</a></p>
<p><img src="/../../assets/image-20220907103825628.png" alt="image-20220907103825628"></p>
<p>七牛云提供了多种方式操作对象存储服务，本项目采用Java SDK方式，地址：<a target="_blank" rel="noopener" href="https://developer.qiniu.com/kodo/sdk/1239/java">https://developer.qiniu.com/kodo/sdk/1239/java</a></p>
<p><img src="/../../assets/image-20220907103837301.png" alt="image-20220907103837301"></p>
<p>使用Java SDK操作七牛云需要导入如下maven坐标：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.qiniu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>qiniu-java-sdk<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="1-2-5-鉴权"><a href="#1-2-5-鉴权" class="headerlink" title="1.2.5 鉴权"></a>1.2.5 鉴权</h4><p>Java SDK的所有的功能，都需要合法的授权。授权凭证的签算需要七牛账号下的一对有效的Access Key和Secret Key，这对密钥可以在七牛云管理控制台的个人中心（<a target="_blank" rel="noopener" href="https://portal.qiniu.com/user/key%EF%BC%89%E8%8E%B7%E5%BE%97%EF%BC%8C%E5%A6%82%E4%B8%8B%E5%9B%BE%EF%BC%9A">https://portal.qiniu.com/user/key）获得，如下图：</a></p>
<p><img src="/../../assets/image-20220907103854226.png" alt="image-20220907103854226"></p>
<h4 id="1-2-6-Java-SDK操作七牛云"><a href="#1-2-6-Java-SDK操作七牛云" class="headerlink" title="1.2.6 Java SDK操作七牛云"></a>1.2.6 Java SDK操作七牛云</h4><p>本章节我们就需要使用七牛云提供的Java SDK完成图片上传和删除，我们可以参考官方提供的例子。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//构造一个带指定Zone对象的配置类</span></span><br><span class="line"><span class="type">Configuration</span> <span class="variable">cfg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>(Zone.zone0());</span><br><span class="line"><span class="comment">//...其他参数参考类注释</span></span><br><span class="line"><span class="type">UploadManager</span> <span class="variable">uploadManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UploadManager</span>(cfg);</span><br><span class="line"><span class="comment">//...生成上传凭证，然后准备上传</span></span><br><span class="line"><span class="type">String</span> <span class="variable">accessKey</span> <span class="operator">=</span> <span class="string">&quot;your access key&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">secretKey</span> <span class="operator">=</span> <span class="string">&quot;your secret key&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">bucket</span> <span class="operator">=</span> <span class="string">&quot;your bucket name&quot;</span>;</span><br><span class="line"><span class="comment">//如果是Windows情况下，格式是 D:\\qiniu\\test.png</span></span><br><span class="line"><span class="type">String</span> <span class="variable">localFilePath</span> <span class="operator">=</span> <span class="string">&quot;/home/qiniu/test.png&quot;</span>;</span><br><span class="line"><span class="comment">//默认不指定key的情况下，以文件内容的hash值作为文件名</span></span><br><span class="line"><span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="type">Auth</span> <span class="variable">auth</span> <span class="operator">=</span> Auth.create(accessKey, secretKey);</span><br><span class="line"><span class="type">String</span> <span class="variable">upToken</span> <span class="operator">=</span> auth.uploadToken(bucket);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="type">Response</span> <span class="variable">response</span> <span class="operator">=</span> uploadManager.put(localFilePath, key, upToken);</span><br><span class="line">    <span class="comment">//解析上传成功的结果</span></span><br><span class="line">    <span class="type">DefaultPutRet</span> <span class="variable">putRet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Gson</span>().fromJson(response.bodyString(), DefaultPutRet.class);</span><br><span class="line">    System.out.println(putRet.key);</span><br><span class="line">    System.out.println(putRet.hash);</span><br><span class="line">&#125; <span class="keyword">catch</span> (QiniuException ex) &#123;</span><br><span class="line">    <span class="type">Response</span> <span class="variable">r</span> <span class="operator">=</span> ex.response;</span><br><span class="line">    System.err.println(r.toString());</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        System.err.println(r.bodyString());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (QiniuException ex2) &#123;</span><br><span class="line">        <span class="comment">//ignore</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//构造一个带指定Zone对象的配置类</span></span><br><span class="line"><span class="type">Configuration</span> <span class="variable">cfg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>(Zone.zone0());</span><br><span class="line"><span class="comment">//...其他参数参考类注释</span></span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">accessKey</span> <span class="operator">=</span> <span class="string">&quot;your access key&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">secretKey</span> <span class="operator">=</span> <span class="string">&quot;your secret key&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">bucket</span> <span class="operator">=</span> <span class="string">&quot;your bucket name&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;your file key&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">Auth</span> <span class="variable">auth</span> <span class="operator">=</span> Auth.create(accessKey, secretKey);</span><br><span class="line"><span class="type">BucketManager</span> <span class="variable">bucketManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BucketManager</span>(auth, cfg);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    bucketManager.delete(bucket, key);</span><br><span class="line">&#125; <span class="keyword">catch</span> (QiniuException ex) &#123;</span><br><span class="line">    <span class="comment">//如果遇到异常，说明删除失败</span></span><br><span class="line">    System.err.println(ex.code());</span><br><span class="line">    System.err.println(ex.response.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-2-7-封装工具类"><a href="#1-2-7-封装工具类" class="headerlink" title="1.2.7 封装工具类"></a>1.2.7 封装工具类</h4><p>为了方便操作七牛云存储服务，我们可以将官方提供的案例简单改造成一个工具类，在我们的项目中直接使用此工具类来操作就可以：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.gson.Gson;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.common.QiniuException;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.common.Zone;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.http.Response;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.BucketManager;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.Configuration;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.UploadManager;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.model.DefaultPutRet;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.util.Auth;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 七牛云工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QiniuUtils</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> <span class="type">String</span> <span class="variable">accessKey</span> <span class="operator">=</span> <span class="string">&quot;dulF9Wze9bxujtuRvu3yyYb9JX1Sp23jzd3tO708&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> <span class="type">String</span> <span class="variable">secretKey</span> <span class="operator">=</span> <span class="string">&quot;vZkhW7iot3uWwcWz9vXfbaP4JepdWADFDHVLMZOe&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> <span class="type">String</span> <span class="variable">bucket</span> <span class="operator">=</span> <span class="string">&quot;qiniutest&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">upload2Qiniu</span><span class="params">(String filePath,String fileName)</span>&#123;</span><br><span class="line">        <span class="comment">//构造一个带指定Zone对象的配置类</span></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">cfg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>(Zone.zone0());</span><br><span class="line">        <span class="type">UploadManager</span> <span class="variable">uploadManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UploadManager</span>(cfg);</span><br><span class="line">        <span class="type">Auth</span> <span class="variable">auth</span> <span class="operator">=</span> Auth.create(accessKey, secretKey);</span><br><span class="line">        <span class="type">String</span> <span class="variable">upToken</span> <span class="operator">=</span> auth.uploadToken(bucket);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Response</span> <span class="variable">response</span> <span class="operator">=</span> uploadManager.put(filePath, fileName, upToken);</span><br><span class="line">            <span class="comment">//解析上传成功的结果</span></span><br><span class="line">            <span class="type">DefaultPutRet</span> <span class="variable">putRet</span> <span class="operator">=</span> </span><br><span class="line">              <span class="keyword">new</span> <span class="title class_">Gson</span>().fromJson(response.bodyString(), DefaultPutRet.class);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (QiniuException ex) &#123;</span><br><span class="line">            <span class="type">Response</span> <span class="variable">r</span> <span class="operator">=</span> ex.response;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.err.println(r.bodyString());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (QiniuException ex2) &#123;</span><br><span class="line">                <span class="comment">//ignore</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//上传文件</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">upload2Qiniu</span><span class="params">(<span class="type">byte</span>[] bytes, String fileName)</span>&#123;</span><br><span class="line">        <span class="comment">//构造一个带指定Zone对象的配置类</span></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">cfg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>(Zone.zone0());</span><br><span class="line">        <span class="comment">//...其他参数参考类注释</span></span><br><span class="line">        <span class="type">UploadManager</span> <span class="variable">uploadManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UploadManager</span>(cfg);</span><br><span class="line">        <span class="comment">//默认不指定key的情况下，以文件内容的hash值作为文件名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> fileName;</span><br><span class="line">        <span class="type">Auth</span> <span class="variable">auth</span> <span class="operator">=</span> Auth.create(accessKey, secretKey);</span><br><span class="line">        <span class="type">String</span> <span class="variable">upToken</span> <span class="operator">=</span> auth.uploadToken(bucket);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Response</span> <span class="variable">response</span> <span class="operator">=</span> uploadManager.put(bytes, key, upToken);</span><br><span class="line">            <span class="comment">//解析上传成功的结果</span></span><br><span class="line">            <span class="type">DefaultPutRet</span> <span class="variable">putRet</span> <span class="operator">=</span> </span><br><span class="line">              <span class="keyword">new</span> <span class="title class_">Gson</span>().fromJson(response.bodyString(), DefaultPutRet.class);</span><br><span class="line">            System.out.println(putRet.key);</span><br><span class="line">            System.out.println(putRet.hash);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (QiniuException ex) &#123;</span><br><span class="line">            <span class="type">Response</span> <span class="variable">r</span> <span class="operator">=</span> ex.response;</span><br><span class="line">            System.err.println(r.toString());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.err.println(r.bodyString());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (QiniuException ex2) &#123;</span><br><span class="line">                <span class="comment">//ignore</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除文件</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">deleteFileFromQiniu</span><span class="params">(String fileName)</span>&#123;</span><br><span class="line">        <span class="comment">//构造一个带指定Zone对象的配置类</span></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">cfg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>(Zone.zone0());</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> fileName;</span><br><span class="line">        <span class="type">Auth</span> <span class="variable">auth</span> <span class="operator">=</span> Auth.create(accessKey, secretKey);</span><br><span class="line">        <span class="type">BucketManager</span> <span class="variable">bucketManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BucketManager</span>(auth, cfg);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            bucketManager.delete(bucket, key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (QiniuException ex) &#123;</span><br><span class="line">            <span class="comment">//如果遇到异常，说明删除失败</span></span><br><span class="line">            System.err.println(ex.code());</span><br><span class="line">            System.err.println(ex.response.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将此工具类放在health_common工程中，后续会使用到。</p>
<h2 id="2-新增套餐"><a href="#2-新增套餐" class="headerlink" title="2. 新增套餐"></a>2. 新增套餐</h2><h3 id="2-1-需求分析"><a href="#2-1-需求分析" class="headerlink" title="2.1 需求分析"></a>2.1 需求分析</h3><p>套餐其实就是检查组的集合，例如有一个套餐为“入职体检套餐”，这个体检套餐可以包括多个检查组：一般检查、血常规、尿常规、肝功三项等。所以在添加套餐时需要选择这个套餐包括的检查组。</p>
<p>套餐对应的实体类为Setmeal，对应的数据表为t_setmeal。套餐和检查组为多对多关系，所以需要中间表t_setmeal_checkgroup进行关联。</p>
<h3 id="2-2-完善页面"><a href="#2-2-完善页面" class="headerlink" title="2.2 完善页面"></a>2.2 完善页面</h3><p>套餐管理页面对应的是setmeal.html页面，根据产品设计的原型已经完成了页面基本结构的编写，现在需要完善页面动态效果。</p>
<h4 id="2-2-1-弹出新增窗口"><a href="#2-2-1-弹出新增窗口" class="headerlink" title="2.2.1 弹出新增窗口"></a>2.2.1 弹出新增窗口</h4><p>页面中已经提供了新增窗口，只是出于隐藏状态。只需要将控制展示状态的属性dialogFormVisible改为true接口显示出新增窗口。点击新建按钮时绑定的方法为handleCreate，所以在handleCreate方法中修改dialogFormVisible属性的值为true即可。同时为了增加用户体验度，需要每次点击新建按钮时清空表单输入项。</p>
<p>由于新增套餐时还需要选择此套餐包含的检查组，所以新增套餐窗口分为两部分信息：基本信息和检查组信息，如下图：</p>
<p><img src="/../../assets/image-20220907103920772.png" alt="image-20220907103920772"></p>
<p><img src="/../../assets/image-20220907103932038.png" alt="image-20220907103932038"></p>
<p>新建按钮绑定单击事件，对应的处理函数为handleCreate</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">class</span>=<span class="string">&quot;butT&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleCreate()&quot;</span>&gt;</span>新建<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// 重置表单</span><br><span class="line">resetForm() &#123;</span><br><span class="line">  this.formData = &#123;&#125;;</span><br><span class="line">  this.activeName=&#x27;first&#x27;;</span><br><span class="line">  this.checkgroupIds = [];</span><br><span class="line">  this.imageUrl = null;</span><br><span class="line">&#125;</span><br><span class="line">// 弹出添加窗口</span><br><span class="line">handleCreate() &#123;</span><br><span class="line">  this.dialogFormVisible = true;</span><br><span class="line">  this.resetForm();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-2-动态展示检查组列表"><a href="#2-2-2-动态展示检查组列表" class="headerlink" title="2.2.2 动态展示检查组列表"></a>2.2.2 动态展示检查组列表</h4><p>现在虽然已经完成了新增窗口的弹出，但是在检查组信息标签页中需要动态展示所有的检查组信息列表数据，并且可以进行勾选。具体操作步骤如下：</p>
<p>（1）定义模型数据</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="attr">tableData</span>:[],<span class="comment">//添加表单窗口中检查组列表数据</span></span><br><span class="line"><span class="attr">checkgroupIds</span>:[],<span class="comment">//添加表单窗口中检查组复选框对应id</span></span><br></pre></td></tr></table></figure>

<p>（2）动态展示检查组列表数据，数据来源于上面定义的tableData模型数据</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;datatable&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>选择<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>项目编码<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>项目名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>项目说明<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">v-for</span>=<span class="string">&quot;c in tableData&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">:id</span>=<span class="string">&quot;c.id&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;checkgroupIds&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;c.id&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">label</span> <span class="attr">:for</span>=<span class="string">&quot;c.id&quot;</span>&gt;</span>&#123;&#123;c.code&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">label</span> <span class="attr">:for</span>=<span class="string">&quot;c.id&quot;</span>&gt;</span>&#123;&#123;c.name&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">label</span> <span class="attr">:for</span>=<span class="string">&quot;c.id&quot;</span>&gt;</span>&#123;&#123;c.remark&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（3）完善handleCreate方法，发送ajax请求查询所有检查组数据并将结果赋值给tableData模型数据用于页面表格展示</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 弹出添加窗口</span></span><br><span class="line"><span class="title function_">handleCreate</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">dialogFormVisible</span> = <span class="literal">true</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">resetForm</span>();</span><br><span class="line">  axios.<span class="title function_">get</span>(<span class="string">&quot;/checkgroup/findAll.do&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">flag</span>)&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">tableData</span> = res.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(res.<span class="property">data</span>.<span class="property">message</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（4）分别在CheckGroupController、CheckGroupService、CheckGroupServiceImpl、CheckGroupDao、CheckGroupDao.xml中扩展方法查询所有检查组数据</p>
<p>CheckGroupController：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//查询所有</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/findAll&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">findAll</span><span class="params">()</span>&#123;</span><br><span class="line">  List&lt;CheckGroup&gt; checkGroupList = checkGroupService.findAll();</span><br><span class="line">  <span class="keyword">if</span>(checkGroupList != <span class="literal">null</span> &amp;&amp; checkGroupList.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>, MessageConstant.QUERY_CHECKGROUP_SUCCESS);</span><br><span class="line">    result.setData(checkGroupList);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>,MessageConstant.QUERY_CHECKGROUP_FAIL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CheckGroupService：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;CheckGroup&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<p>CheckGroupServiceImpl：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;CheckGroup&gt; <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> checkGroupDao.findAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CheckGroupDao：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;CheckGroup&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<p>CheckGroupDao.xml：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.pojo.CheckGroup&quot;</span>&gt;</span></span><br><span class="line">  select * from t_checkgroup</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-2-3-图片上传并预览"><a href="#2-2-3-图片上传并预览" class="headerlink" title="2.2.3 图片上传并预览"></a>2.2.3 图片上传并预览</h4><p>此处使用的是ElementUI提供的上传组件el-upload，提供了多种不同的上传效果，上传成功后可以进行预览。</p>
<p>实现步骤：</p>
<p>（1）定义模型数据，用于后面上传文件的图片预览：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="attr">imageUrl</span>:<span class="literal">null</span>,<span class="comment">//模型数据，用于上传图片完成后图片预览</span></span><br></pre></td></tr></table></figure>

<p>（2）定义上传组件：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  el-upload：上传组件</span></span><br><span class="line"><span class="comment">  action：上传的提交地址</span></span><br><span class="line"><span class="comment">  auto-upload：选中文件后是否自动上传</span></span><br><span class="line"><span class="comment">  name：上传文件的名称，服务端可以根据名称获得上传的文件对象</span></span><br><span class="line"><span class="comment">  show-file-list：是否显示已上传文件列表</span></span><br><span class="line"><span class="comment">  on-success：文件上传成功时的钩子</span></span><br><span class="line"><span class="comment">  before-upload：上传文件之前的钩子</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-upload</span></span></span><br><span class="line"><span class="tag">           <span class="attr">class</span>=<span class="string">&quot;avatar-uploader&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">action</span>=<span class="string">&quot;/setmeal/upload.do&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">:auto-upload</span>=<span class="string">&quot;autoUpload&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">name</span>=<span class="string">&quot;imgFile&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">:show-file-list</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">:on-success</span>=<span class="string">&quot;handleAvatarSuccess&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">:before-upload</span>=<span class="string">&quot;beforeAvatarUpload&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--用于上传图片预览--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">v-if</span>=<span class="string">&quot;imageUrl&quot;</span> <span class="attr">:src</span>=<span class="string">&quot;imageUrl&quot;</span> <span class="attr">class</span>=<span class="string">&quot;avatar&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--用于展示上传图标--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">i</span> <span class="attr">v-else</span> <span class="attr">class</span>=<span class="string">&quot;el-icon-plus avatar-uploader-icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-upload</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（3）定义对应的钩子函数：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//文件上传成功后的钩子，response为服务端返回的值，file为当前上传的文件封装成的js对象</span></span><br><span class="line"><span class="title function_">handleAvatarSuccess</span>(<span class="params">response, file</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">imageUrl</span> = <span class="string">&quot;http://pqjroc654.bkt.clouddn.com/&quot;</span>+response.<span class="property">data</span>;</span><br><span class="line">  <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">    <span class="attr">message</span>: response.<span class="property">message</span>,</span><br><span class="line">    <span class="attr">type</span>: response.<span class="property">flag</span> ? <span class="string">&#x27;success&#x27;</span> : <span class="string">&#x27;error&#x27;</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//设置模型数据（图片名称），后续提交ajax请求时会提交到后台最终保存到数据库</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">formData</span>.<span class="property">img</span> = response.<span class="property">data</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//上传文件之前的钩子</span></span><br><span class="line"><span class="title function_">beforeAvatarUpload</span>(<span class="params">file</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> isJPG = file.<span class="property">type</span> === <span class="string">&#x27;image/jpeg&#x27;</span>;</span><br><span class="line">  <span class="keyword">const</span> isLt2M = file.<span class="property">size</span> / <span class="number">1024</span> / <span class="number">1024</span> &lt; <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">if</span> (!isJPG) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&#x27;上传套餐图片只能是 JPG 格式!&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!isLt2M) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&#x27;上传套餐图片大小不能超过 2MB!&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> isJPG &amp;&amp; isLt2M;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（4）创建SetmealController，接收上传的文件</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Reference;</span><br><span class="line"><span class="keyword">import</span> com.itheima.constant.MessageConstant;</span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.PageResult;</span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.QueryPageBean;</span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.Result;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.CheckGroup;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Setmeal;</span><br><span class="line"><span class="keyword">import</span> com.itheima.service.CheckGroupService;</span><br><span class="line"><span class="keyword">import</span> com.itheima.service.SetmealService;</span><br><span class="line"><span class="keyword">import</span> com.itheima.utils.QiniuUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 套餐管理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/setmeal&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetmealController</span> &#123;</span><br><span class="line">    <span class="meta">@Reference</span></span><br><span class="line">    <span class="keyword">private</span> SetmealService setmealService;</span><br><span class="line">  </span><br><span class="line">  	<span class="comment">//图片上传</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">upload</span><span class="params">(<span class="meta">@RequestParam(&quot;imgFile&quot;)</span>MultipartFile imgFile)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//获取原始文件名</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> imgFile.getOriginalFilename();</span><br><span class="line">            <span class="type">int</span> <span class="variable">lastIndexOf</span> <span class="operator">=</span> originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">            <span class="comment">//获取文件后缀</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">suffix</span> <span class="operator">=</span> originalFilename.substring(lastIndexOf - <span class="number">1</span>);</span><br><span class="line">            <span class="comment">//使用UUID随机产生文件名称，防止同名文件覆盖</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> UUID.randomUUID().toString() + suffix;</span><br><span class="line">            QiniuUtils.upload2Qiniu(imgFile.getBytes(),fileName);</span><br><span class="line">            <span class="comment">//图片上传成功</span></span><br><span class="line">            <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>, MessageConstant.PIC_UPLOAD_SUCCESS);</span><br><span class="line">            result.setData(fileName);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="comment">//图片上传失败</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>,MessageConstant.PIC_UPLOAD_FAIL);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：别忘了在spring配置文件中配置文件上传组件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--文件上传组件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;multipartResolver&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxUploadSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;104857600&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxInMemorySize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;4096&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultEncoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-2-4-提交请求"><a href="#2-2-4-提交请求" class="headerlink" title="2.2.4 提交请求"></a>2.2.4 提交请求</h4><p>当用户点击新增窗口中的确定按钮时发送ajax请求将数据提交到后台进行数据库操作。提交到后台的数据分为两部分：套餐基本信息（对应的模型数据为formData）和检查组id数组（对应的模型数据为checkgroupIds）。</p>
<p>为确定按钮绑定单击事件，对应的处理函数为handleAdd</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleAdd()&quot;</span>&gt;</span>确定<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>完善handleAdd方法</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//添加</span></span><br><span class="line">handleAdd () &#123;</span><br><span class="line">  axios.<span class="title function_">post</span>(<span class="string">&quot;/setmeal/add.do?checkgroupIds=&quot;</span> + <span class="variable language_">this</span>.<span class="property">checkgroupIds</span>,<span class="variable language_">this</span>.<span class="property">formData</span>).</span><br><span class="line">  <span class="title function_">then</span>(<span class="function">(<span class="params">response</span>)=&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dialogFormVisible</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span>(response.<span class="property">data</span>.<span class="property">flag</span>)&#123;</span><br><span class="line">      <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">        <span class="attr">message</span>: response.<span class="property">data</span>.<span class="property">message</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(response.<span class="property">data</span>.<span class="property">message</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;).<span class="title function_">finally</span>(<span class="function">()=&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">findPage</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-后台代码"><a href="#2-3-后台代码" class="headerlink" title="2.3 后台代码"></a>2.3 后台代码</h3><h4 id="2-3-1-Controller"><a href="#2-3-1-Controller" class="headerlink" title="2.3.1 Controller"></a>2.3.1 Controller</h4><p>在SetmealController中增加方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//新增</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/add&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">add</span><span class="params">(<span class="meta">@RequestBody</span> Setmeal setmeal, Integer[] checkgroupIds)</span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    setmealService.add(setmeal,checkgroupIds);</span><br><span class="line">  &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">    <span class="comment">//新增套餐失败</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>,MessageConstant.ADD_SETMEAL_FAIL);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//新增套餐成功</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>,MessageConstant.ADD_SETMEAL_SUCCESS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-3-2-服务接口"><a href="#2-3-2-服务接口" class="headerlink" title="2.3.2 服务接口"></a>2.3.2 服务接口</h4><p>创建SetmealService接口并提供新增方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.PageResult;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.CheckGroup;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Setmeal;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 体检套餐服务接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SetmealService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Setmeal setmeal, Integer[] checkgroupIds)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-3-3-服务实现类"><a href="#2-3-3-服务实现类" class="headerlink" title="2.3.3 服务实现类"></a>2.3.3 服务实现类</h4><p>创建SetmealServiceImpl服务实现类并实现新增方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Service;</span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.Page;</span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.PageHelper;</span><br><span class="line"><span class="keyword">import</span> com.itheima.dao.SetmealDao;</span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.PageResult;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Setmeal;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 体检套餐服务实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service(interfaceClass = SetmealService.class)</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetmealServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SetmealService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SetmealDao setmealDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//新增套餐</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Setmeal setmeal, Integer[] checkgroupIds)</span> &#123;</span><br><span class="line">        setmealDao.add(setmeal);</span><br><span class="line">        <span class="keyword">if</span>(checkgroupIds != <span class="literal">null</span> &amp;&amp; checkgroupIds.length &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//绑定套餐和检查组的多对多关系</span></span><br><span class="line">            setSetmealAndCheckGroup(setmeal.getId(),checkgroupIds);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//绑定套餐和检查组的多对多关系</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setSetmealAndCheckGroup</span><span class="params">(Integer id, Integer[] checkgroupIds)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Integer checkgroupId : checkgroupIds) &#123;</span><br><span class="line">            Map&lt;String,Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">            map.put(<span class="string">&quot;setmeal_id&quot;</span>,id);</span><br><span class="line">            map.put(<span class="string">&quot;checkgroup_id&quot;</span>,checkgroupId);</span><br><span class="line">            setmealDao.setSetmealAndCheckGroup(map);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-3-4-Dao接口"><a href="#2-3-4-Dao接口" class="headerlink" title="2.3.4 Dao接口"></a>2.3.4 Dao接口</h4><p>创建SetmealDao接口并提供相关方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Setmeal;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SetmealDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Setmeal setmeal)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSetmealAndCheckGroup</span><span class="params">(Map&lt;String, Integer&gt; map)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-3-5-Mapper映射文件"><a href="#2-3-5-Mapper映射文件" class="headerlink" title="2.3.5 Mapper映射文件"></a>2.3.5 Mapper映射文件</h4><p>创建SetmealDao.xml文件并定义相关SQL语句</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.dao.SetmealDao&quot;</span> &gt;</span></span><br><span class="line">    <span class="comment">&lt;!--新增--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;add&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.itheima.pojo.Setmeal&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Integer&quot;</span> <span class="attr">order</span>=<span class="string">&quot;AFTER&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">            SELECT LAST_INSERT_ID()</span><br><span class="line">        <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">        insert into t_setmeal</span><br><span class="line">      		(code,name,sex,age,helpCode,price,remark,attention,img)</span><br><span class="line">        		values </span><br><span class="line">      		(#&#123;code&#125;,#&#123;name&#125;,#&#123;sex&#125;,#&#123;age&#125;,#&#123;helpCode&#125;,#&#123;price&#125;,#&#123;remark&#125;,#&#123;attention&#125;,#&#123;img&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--绑定套餐和检查组多对多关系--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;setSetmealAndCheckGroup&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;hashmap&quot;</span>&gt;</span></span><br><span class="line">        insert into t_setmeal_checkgroup</span><br><span class="line">      		(setmeal_id,checkgroup_id) </span><br><span class="line">      			values</span><br><span class="line">      		(#&#123;setmeal_id&#125;,#&#123;checkgroup_id&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-4-完善文件上传"><a href="#2-4-完善文件上传" class="headerlink" title="2.4 完善文件上传"></a>2.4 完善文件上传</h3><p>前面我们已经完成了文件上传，将图片存储在了七牛云服务器中。但是这个过程存在一个问题，就是如果用户只上传了图片而没有最终保存套餐信息到我们的数据库，这时我们上传的图片就变为了垃圾图片。对于这些垃圾图片我们需要定时清理来释放磁盘空间。这就需要我们能够区分出来哪些是垃圾图片，哪些不是垃圾图片。如何实现呢？</p>
<p>方案就是利用redis来保存图片名称，具体做法为：</p>
<p>1、当用户上传图片后，将图片名称保存到redis的一个Set集合中，例如集合名称为setmealPicResources</p>
<p>2、当用户添加套餐后，将图片名称保存到redis的另一个Set集合中，例如集合名称为setmealPicDbResources</p>
<p>3、计算setmealPicResources集合与setmealPicDbResources集合的差值，结果就是垃圾图片的名称集合，清理这些图片即可</p>
<p>本小节我们先来完成前面2个环节，第3个环节（清理图片环节）在后面会通过定时任务再实现。</p>
<p>实现步骤：</p>
<p>（1）在health_backend项目中提供Spring配置文件spring-redis.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:dubbo</span>=<span class="string">&quot;http://code.alibabatech.com/schema/dubbo&quot;</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">                         http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        				http://www.springframework.org/schema/mvc </span></span></span><br><span class="line"><span class="string"><span class="tag">                         http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        				http://code.alibabatech.com/schema/dubbo </span></span></span><br><span class="line"><span class="string"><span class="tag">                         http://code.alibabatech.com/schema/dubbo/dubbo.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        				http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="string"><span class="tag">                         http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--Jedis连接池的相关配置--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jedisPoolConfig&quot;</span> <span class="attr">class</span>=<span class="string">&quot;redis.clients.jedis.JedisPoolConfig&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxTotal&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>200<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxIdle&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>50<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;testOnBorrow&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;testOnReturn&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jedisPool&quot;</span> <span class="attr">class</span>=<span class="string">&quot;redis.clients.jedis.JedisPool&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;poolConfig&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;jedisPoolConfig&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;host&quot;</span> <span class="attr">value</span>=<span class="string">&quot;127.0.0.1&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;port&quot;</span> <span class="attr">value</span>=<span class="string">&quot;6379&quot;</span> <span class="attr">type</span>=<span class="string">&quot;int&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;timeout&quot;</span> <span class="attr">value</span>=<span class="string">&quot;30000&quot;</span> <span class="attr">type</span>=<span class="string">&quot;int&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（2）在health_common工程中提供Redis常量类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.constant;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConstant</span> &#123;</span><br><span class="line">    <span class="comment">//套餐图片所有图片名称</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SETMEAL_PIC_RESOURCES</span> <span class="operator">=</span> <span class="string">&quot;setmealPicResources&quot;</span>;</span><br><span class="line">    <span class="comment">//套餐图片保存在数据库中的图片名称</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SETMEAL_PIC_DB_RESOURCES</span> <span class="operator">=</span> <span class="string">&quot;setmealPicDbResources&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（3）完善SetmealController，在文件上传成功后将图片名称保存到redis集合中</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> JedisPool jedisPool;</span><br><span class="line"><span class="comment">//图片上传</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/upload&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">upload</span><span class="params">(<span class="meta">@RequestParam(&quot;imgFile&quot;)</span>MultipartFile imgFile)</span>&#123;</span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="comment">//获取原始文件名</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> imgFile.getOriginalFilename();</span><br><span class="line">    <span class="type">int</span> <span class="variable">lastIndexOf</span> <span class="operator">=</span> originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="comment">//获取文件后缀</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">suffix</span> <span class="operator">=</span> originalFilename.substring(lastIndexOf - <span class="number">1</span>);</span><br><span class="line">    <span class="comment">//使用UUID随机产生文件名称，防止同名文件覆盖</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> UUID.randomUUID().toString() + suffix;</span><br><span class="line">    QiniuUtils.upload2Qiniu(imgFile.getBytes(),fileName);</span><br><span class="line">    <span class="comment">//图片上传成功</span></span><br><span class="line">    <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>, MessageConstant.PIC_UPLOAD_SUCCESS);</span><br><span class="line">    result.setData(fileName);</span><br><span class="line">    <span class="comment">//将上传图片名称存入Redis，基于Redis的Set集合存储</span></span><br><span class="line">    jedisPool.getResource().sadd(RedisConstant.SETMEAL_PIC_RESOURCES,fileName);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    <span class="comment">//图片上传失败</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>,MessageConstant.PIC_UPLOAD_FAIL);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（4）在health_service_provider项目中提供Spring配置文件applicationContext-redis.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:dubbo</span>=<span class="string">&quot;http://code.alibabatech.com/schema/dubbo&quot;</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">                         http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        				http://www.springframework.org/schema/mvc </span></span></span><br><span class="line"><span class="string"><span class="tag">                         http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        				http://code.alibabatech.com/schema/dubbo </span></span></span><br><span class="line"><span class="string"><span class="tag">                         http://code.alibabatech.com/schema/dubbo/dubbo.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        				http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="string"><span class="tag">                         http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--Jedis连接池的相关配置--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jedisPoolConfig&quot;</span> <span class="attr">class</span>=<span class="string">&quot;redis.clients.jedis.JedisPoolConfig&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxTotal&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>200<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxIdle&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>50<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;testOnBorrow&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;testOnReturn&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jedisPool&quot;</span> <span class="attr">class</span>=<span class="string">&quot;redis.clients.jedis.JedisPool&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;poolConfig&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;jedisPoolConfig&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;host&quot;</span> <span class="attr">value</span>=<span class="string">&quot;127.0.0.1&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;port&quot;</span> <span class="attr">value</span>=<span class="string">&quot;6379&quot;</span> <span class="attr">type</span>=<span class="string">&quot;int&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;timeout&quot;</span> <span class="attr">value</span>=<span class="string">&quot;30000&quot;</span> <span class="attr">type</span>=<span class="string">&quot;int&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（5）完善SetmealServiceImpl服务类，在保存完成套餐信息后将图片名称存储到redis集合中</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> JedisPool jedisPool;</span><br><span class="line"><span class="comment">//新增套餐</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Setmeal setmeal, Integer[] checkgroupIds)</span> &#123;</span><br><span class="line">  setmealDao.add(setmeal);</span><br><span class="line">  <span class="keyword">if</span>(checkgroupIds != <span class="literal">null</span> &amp;&amp; checkgroupIds.length &gt; <span class="number">0</span>)&#123;</span><br><span class="line">    setSetmealAndCheckGroup(setmeal.getId(),checkgroupIds);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//将图片名称保存到Redis</span></span><br><span class="line">  savePic2Redis(setmeal.getImg());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//将图片名称保存到Redis</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">savePic2Redis</span><span class="params">(String pic)</span>&#123;</span><br><span class="line">  jedisPool.getResource().sadd(RedisConstant.SETMEAL_PIC_DB_RESOURCES,pic);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-体检套餐分页"><a href="#3-体检套餐分页" class="headerlink" title="3. 体检套餐分页"></a>3. 体检套餐分页</h2><h3 id="3-1-完善页面-2"><a href="#3-1-完善页面-2" class="headerlink" title="3.1 完善页面"></a>3.1 完善页面</h3><h4 id="3-1-1-定义分页相关模型数据-1"><a href="#3-1-1-定义分页相关模型数据-1" class="headerlink" title="3.1.1 定义分页相关模型数据"></a>3.1.1 定义分页相关模型数据</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="attr">pagination</span>: &#123;<span class="comment">//分页相关模型数据</span></span><br><span class="line">  <span class="attr">currentPage</span>: <span class="number">1</span>,<span class="comment">//当前页码</span></span><br><span class="line">  <span class="attr">pageSize</span>:<span class="number">10</span>,<span class="comment">//每页显示的记录数</span></span><br><span class="line">  <span class="attr">total</span>:<span class="number">0</span>,<span class="comment">//总记录数</span></span><br><span class="line">  <span class="attr">queryString</span>:<span class="literal">null</span><span class="comment">//查询条件</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">dataList</span>: [],<span class="comment">//当前页要展示的分页列表数据</span></span><br></pre></td></tr></table></figure>

<h4 id="3-1-2-定义分页方法-1"><a href="#3-1-2-定义分页方法-1" class="headerlink" title="3.1.2 定义分页方法"></a>3.1.2 定义分页方法</h4><p>在页面中提供了findPage方法用于分页查询，为了能够在setmeal.html页面加载后直接可以展示分页数据，可以在VUE提供的钩子函数created中调用findPage方法</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//钩子函数，VUE对象初始化完成后自动执行</span></span><br><span class="line"><span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">findPage</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="title function_">findPage</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">//分页参数</span></span><br><span class="line">  <span class="keyword">var</span> param = &#123;</span><br><span class="line">    <span class="attr">currentPage</span>:<span class="variable language_">this</span>.<span class="property">pagination</span>.<span class="property">currentPage</span>,<span class="comment">//页码</span></span><br><span class="line">    <span class="attr">pageSize</span>:<span class="variable language_">this</span>.<span class="property">pagination</span>.<span class="property">pageSize</span>,<span class="comment">//每页显示的记录数</span></span><br><span class="line">    <span class="attr">queryString</span>:<span class="variable language_">this</span>.<span class="property">pagination</span>.<span class="property">queryString</span><span class="comment">//查询条件</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">//请求后台</span></span><br><span class="line">  axios.<span class="title function_">post</span>(<span class="string">&quot;/setmeal/findPage.do&quot;</span>,param).<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>)=&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//为模型数据赋值，基于VUE的双向绑定展示到页面</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dataList</span> = response.<span class="property">data</span>.<span class="property">rows</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">pagination</span>.<span class="property">total</span> = response.<span class="property">data</span>.<span class="property">total</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-1-3-完善分页方法执行时机-1"><a href="#3-1-3-完善分页方法执行时机-1" class="headerlink" title="3.1.3 完善分页方法执行时机"></a>3.1.3 完善分页方法执行时机</h4><p>除了在created钩子函数中调用findPage方法查询分页数据之外，当用户点击查询按钮或者点击分页条中的页码时也需要调用findPage方法重新发起查询请求。</p>
<p>为查询按钮绑定单击事件，调用findPage方法</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;findPage()&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dalfBut&quot;</span>&gt;</span>查询<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>为分页条组件绑定current-change事件，此事件是分页条组件自己定义的事件，当页码改变时触发，对应的处理函数为handleCurrentChange</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-pagination</span></span></span><br><span class="line"><span class="tag">               <span class="attr">class</span>=<span class="string">&quot;pagiantion&quot;</span></span></span><br><span class="line"><span class="tag">               @<span class="attr">current-change</span>=<span class="string">&quot;handleCurrentChange&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">:current-page</span>=<span class="string">&quot;pagination.currentPage&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">:page-size</span>=<span class="string">&quot;pagination.pageSize&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">layout</span>=<span class="string">&quot;total, prev, pager, next, jumper&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">:total</span>=<span class="string">&quot;pagination.total&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-pagination</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>定义handleCurrentChange方法</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//切换页码</span></span><br><span class="line"><span class="title function_">handleCurrentChange</span>(<span class="params">currentPage</span>) &#123;</span><br><span class="line">  <span class="comment">//currentPage为切换后的页码</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">pagination</span>.<span class="property">currentPage</span> = currentPage;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">findPage</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-后台代码-2"><a href="#3-2-后台代码-2" class="headerlink" title="3.2 后台代码"></a>3.2 后台代码</h3><h4 id="3-2-1-Controller-2"><a href="#3-2-1-Controller-2" class="headerlink" title="3.2.1 Controller"></a>3.2.1 Controller</h4><p>在SetmealController中增加分页查询方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/findPage&quot;)</span></span><br><span class="line"><span class="keyword">public</span> PageResult <span class="title function_">findPage</span><span class="params">(<span class="meta">@RequestBody</span> QueryPageBean queryPageBean)</span>&#123;</span><br><span class="line">  <span class="type">PageResult</span> <span class="variable">pageResult</span> <span class="operator">=</span> setmealService.pageQuery(</span><br><span class="line">    queryPageBean.getCurrentPage(), </span><br><span class="line">    queryPageBean.getPageSize(), </span><br><span class="line">    queryPageBean.getQueryString()</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> pageResult;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-服务接口-2"><a href="#3-2-2-服务接口-2" class="headerlink" title="3.2.2 服务接口"></a>3.2.2 服务接口</h4><p>在SetmealService服务接口中扩展分页查询方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> PageResult <span class="title function_">pageQuery</span><span class="params">(Integer currentPage, Integer pageSize, String queryString)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-3-服务实现类-2"><a href="#3-2-3-服务实现类-2" class="headerlink" title="3.2.3 服务实现类"></a>3.2.3 服务实现类</h4><p>在SetmealServiceImpl服务实现类中实现分页查询方法，基于Mybatis分页助手插件实现分页</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> PageResult <span class="title function_">pageQuery</span><span class="params">(Integer currentPage, Integer pageSize, String queryString)</span> &#123;</span><br><span class="line">  PageHelper.startPage(currentPage,pageSize);</span><br><span class="line">  Page&lt;CheckItem&gt; page = checkGroupDao.selectByCondition(queryString);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>(page.getTotal(),page.getResult());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-4-Dao接口-2"><a href="#3-2-4-Dao接口-2" class="headerlink" title="3.2.4 Dao接口"></a>3.2.4 Dao接口</h4><p>在SetmealDao接口中扩展分页查询方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Page&lt;Setmeal&gt; <span class="title function_">selectByCondition</span><span class="params">(String queryString)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-5-Mapper映射文件-2"><a href="#3-2-5-Mapper映射文件-2" class="headerlink" title="3.2.5 Mapper映射文件"></a>3.2.5 Mapper映射文件</h4><p>在SetmealDao.xml文件中增加SQL定义</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--根据条件查询--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByCondition&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;string&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.pojo.Setmeal&quot;</span>&gt;</span></span><br><span class="line">  select * from t_setmeal</span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;value != null and value.length &gt; 0&quot;</span>&gt;</span></span><br><span class="line">    where code = #&#123;value&#125; or name = #&#123;value&#125; or helpCode = #&#123;value&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="4-定时任务组件Quartz"><a href="#4-定时任务组件Quartz" class="headerlink" title="4. 定时任务组件Quartz"></a>4. 定时任务组件Quartz</h2><h3 id="4-1-Quartz介绍"><a href="#4-1-Quartz介绍" class="headerlink" title="4.1 Quartz介绍"></a>4.1 Quartz介绍</h3><p>Quartz是Job scheduling（作业调度）领域的一个开源项目，Quartz既可以单独使用也可以跟spring框架整合使用，在实际开发中一般会使用后者。使用Quartz可以开发一个或者多个定时任务，每个定时任务可以单独指定执行的时间，例如每隔1小时执行一次、每个月第一天上午10点执行一次、每个月最后一天下午5点执行一次等。</p>
<p>官网：<a target="_blank" rel="noopener" href="http://www.quartz-scheduler.org/">http://www.quartz-scheduler.org/</a></p>
<p>maven坐标：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.quartz-scheduler<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>quartz<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.quartz-scheduler<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>quartz-jobs<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-Quartz入门案例"><a href="#4-2-Quartz入门案例" class="headerlink" title="4.2 Quartz入门案例"></a>4.2 Quartz入门案例</h3><p>本案例基于Quartz和spring整合的方式使用。具体步骤：</p>
<p>（1）创建maven工程quartzdemo，导入Quartz和spring相关坐标，pom.xml文件如下</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itheima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>quartdemo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.quartz-scheduler<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>quartz<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.quartz-scheduler<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>quartz-jobs<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（2）自定义一个Job</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.jobs;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义Job</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JobDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;job execute...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（3）提供Spring配置文件spring-jobs.xml，配置自定义Job、任务描述、触发器、调度工厂等</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:dubbo</span>=<span class="string">&quot;http://code.alibabatech.com/schema/dubbo&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://code.alibabatech.com/schema/dubbo</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://code.alibabatech.com/schema/dubbo/dubbo.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 注册自定义Job --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jobDemo&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.jobs.JobDemo&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 注册JobDetail,作用是负责通过反射调用指定的Job --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jobDetail&quot;</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 注入目标对象 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;targetObject&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;jobDemo&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 注入目标方法 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;targetMethod&quot;</span> <span class="attr">value</span>=<span class="string">&quot;run&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 注册一个触发器，指定任务触发的时间 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myTrigger&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.scheduling.quartz.CronTriggerFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 注入JobDetail --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jobDetail&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;jobDetail&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定触发的时间，基于Cron表达式 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;cronExpression&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>0/10 * * * * ?<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 注册一个统一的调度工厂，通过这个调度工厂调度任务 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;scheduler&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.scheduling.quartz.SchedulerFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 注入多个触发器 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;triggers&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;myTrigger&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（4）编写main方法进行测试</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.jobs.com.itheima.app;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;spring-jobs.xml&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行上面main方法观察控制台，可以发现每隔10秒会输出一次，说明每隔10秒自定义Job被调用一次。</p>
<h3 id="4-3-cron表达式"><a href="#4-3-cron表达式" class="headerlink" title="4.3 cron表达式"></a>4.3 cron表达式</h3><p>上面的入门案例中我们指定了一个表达式：0&#x2F;10 * * * * ?</p>
<p>这种表达式称为cron表达式，通过cron表达式可以灵活的定义出符合要求的程序执行的时间。本小节我们就来学习一下cron表达式的使用方法。如下图：</p>
<p><img src="/../../assets/image-20220907104018984.png" alt="image-20220907104018984"></p>
<p>cron表达式分为七个域，之间使用空格分隔。其中最后一个域（年）可以为空。每个域都有自己允许的值和一些特殊字符构成。使用这些特殊字符可以使我们定义的表达式更加灵活。</p>
<p>下面是对这些特殊字符的介绍：</p>
<p>逗号（,）：指定一个值列表，例如使用在月域上1,4,5,7表示1月、4月、5月和7月</p>
<p>横杠（-）：指定一个范围，例如在时域上3-6表示3点到6点（即3点、4点、5点、6点）</p>
<p>星号（*）：表示这个域上包含所有合法的值。例如，在月份域上使用星号意味着每个月都会触发</p>
<p>斜线（&#x2F;）：表示递增，例如使用在秒域上0&#x2F;15表示每15秒</p>
<p>问号（?）：只能用在日和周域上，但是不能在这两个域上同时使用。表示不指定</p>
<p>井号（#）：只能使用在周域上，用于指定月份中的第几周的哪一天，例如6#3，意思是某月的第三个周五 (6&#x3D;星期五，3意味着月份中的第三周)</p>
<p>L：某域上允许的最后一个值。只能使用在日和周域上。当用在日域上，表示的是在月域上指定的月份的最后一天。用于周域上时，表示周的最后一天，就是星期六</p>
<p>W：W 字符代表着工作日 (星期一到星期五)，只能用在日域上，它用来指定离指定日的最近的一个工作日</p>
<h3 id="4-4-cron表达式在线生成器"><a href="#4-4-cron表达式在线生成器" class="headerlink" title="4.4 cron表达式在线生成器"></a>4.4 cron表达式在线生成器</h3><p>前面介绍了cron表达式，但是自己编写表达式还是有一些困难的，我们可以借助一些cron表达式在线生成器来根据我们的需求生成表达式即可。</p>
<p><a target="_blank" rel="noopener" href="http://cron.qqe2.com/">http://cron.qqe2.com/</a></p>
<p><img src="/../../assets/image-20220907104032651.png" alt="image-20220907104032651"></p>
<h2 id="5-定时清理垃圾图片"><a href="#5-定时清理垃圾图片" class="headerlink" title="5. 定时清理垃圾图片"></a>5. 定时清理垃圾图片</h2><p>前面我们已经完成了体检套餐的管理，在新增套餐时套餐的基本信息和图片是分两次提交到后台进行操作的。也就是用户首先将图片上传到七牛云服务器，然后再提交新增窗口中录入的其他信息。如果用户只是上传了图片而没有提交录入的其他信息，此时的图片就变为了垃圾图片，因为在数据库中并没有记录它的存在。此时我们要如何处理这些垃圾图片呢？</p>
<p>解决方案就是通过定时任务组件定时清理这些垃圾图片。为了能够区分出来哪些图片是垃圾图片，我们在文件上传成功后将图片保存到了一个redis集合中，当套餐数据插入到数据库后我们又将图片名称保存到了另一个redis集合中，通过计算这两个集合的差值就可以获得所有垃圾图片的名称。</p>
<p>本章节我们就会基于Quartz定时任务，通过计算redis两个集合的差值找出所有的垃圾图片，就可以将垃圾图片清理掉。</p>
<p>操作步骤：</p>
<p>（1）创建maven工程health_jobs，打包方式为war，导入Quartz等相关坐标</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 </span></span></span><br><span class="line"><span class="string"><span class="tag">                             http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>health_parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itheima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>health_jobs<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>health_jobs Maven Webapp<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://www.example.com<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itheima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>health_interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.quartz-scheduler<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>quartz<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.quartz-scheduler<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>quartz-jobs<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 指定端口 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>83<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 请求路径 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">path</span>&gt;</span>/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（2）配置web.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">web-app</span> <span class="keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta"> <span class="string">&quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot;</span></span></span><br><span class="line"><span class="meta"> <span class="string">&quot;http://java.sun.com/dtd/web-app_2_3.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Archetype Created Web Application<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 加载spring容器 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath*:applicationContext*.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（3）配置log4j.properties</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">### direct log messages to stdout ###</span></span><br><span class="line"><span class="attr">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.Target</span>=<span class="string">System.err</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%d&#123;ABSOLUTE&#125; %5p %c&#123;1&#125;:%L - %m%n</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">### direct messages to file mylog.log ###</span></span><br><span class="line"><span class="attr">log4j.appender.file</span>=<span class="string">org.apache.log4j.FileAppender</span></span><br><span class="line"><span class="attr">log4j.appender.file.File</span>=<span class="string">c:\\mylog.log</span></span><br><span class="line"><span class="attr">log4j.appender.file.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.file.layout.ConversionPattern</span>=<span class="string">%d&#123;ABSOLUTE&#125; %5p %c&#123;1&#125;:%L - %m%n</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">### set log levels - for more verbose logging change &#x27;info&#x27; to &#x27;debug&#x27; ###</span></span><br><span class="line"></span><br><span class="line"><span class="attr">log4j.rootLogger</span>=<span class="string">info, stdout</span></span><br></pre></td></tr></table></figure>

<p>（4）配置applicationContext-redis.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:dubbo</span>=<span class="string">&quot;http://code.alibabatech.com/schema/dubbo&quot;</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">                         http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        				http://www.springframework.org/schema/mvc </span></span></span><br><span class="line"><span class="string"><span class="tag">                          http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        				http://code.alibabatech.com/schema/dubbo </span></span></span><br><span class="line"><span class="string"><span class="tag">                          http://code.alibabatech.com/schema/dubbo/dubbo.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        				http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">                          http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--Jedis连接池的相关配置--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jedisPoolConfig&quot;</span> <span class="attr">class</span>=<span class="string">&quot;redis.clients.jedis.JedisPoolConfig&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxTotal&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>200<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxIdle&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>50<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;testOnBorrow&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;testOnReturn&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jedisPool&quot;</span> <span class="attr">class</span>=<span class="string">&quot;redis.clients.jedis.JedisPool&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;poolConfig&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;jedisPoolConfig&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;host&quot;</span> <span class="attr">value</span>=<span class="string">&quot;127.0.0.1&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;port&quot;</span> <span class="attr">value</span>=<span class="string">&quot;6379&quot;</span> <span class="attr">type</span>=<span class="string">&quot;int&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;timeout&quot;</span> <span class="attr">value</span>=<span class="string">&quot;30000&quot;</span> <span class="attr">type</span>=<span class="string">&quot;int&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（5）配置applicationContext-jobs.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:dubbo</span>=<span class="string">&quot;http://code.alibabatech.com/schema/dubbo&quot;</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">							http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">							http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">							http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">							http://code.alibabatech.com/schema/dubbo</span></span></span><br><span class="line"><span class="string"><span class="tag">							http://code.alibabatech.com/schema/dubbo/dubbo.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">							http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">							http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:annotation-config</span>&gt;</span><span class="tag">&lt;/<span class="name">context:annotation-config</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;clearImgJob&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.jobs.ClearImgJob&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jobDetail&quot;</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 注入目标对象 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;targetObject&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;clearImgJob&quot;</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 注入目标方法 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;targetMethod&quot;</span> <span class="attr">value</span>=<span class="string">&quot;clearImg&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 注册一个触发器，指定任务触发的时间 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myTrigger&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.scheduling.quartz.CronTriggerFactoryBean&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 注入JobDetail --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jobDetail&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;jobDetail&quot;</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 指定触发的时间，基于Cron表达式 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;cronExpression&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>0 0 2 * * ?<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 注册一个统一的调度工厂，通过这个调度工厂调度任务 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;scheduler&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.scheduling.quartz.SchedulerFactoryBean&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 注入多个触发器 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;triggers&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;myTrigger&quot;</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（6）创建ClearImgJob定时任务类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.jobs;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.constant.RedisConstant;</span><br><span class="line"><span class="keyword">import</span> com.itheima.utils.QiniuUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义Job，实现定时清理垃圾图片</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClearImgJob</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JedisPool jedisPool;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clearImg</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//根据Redis中保存的两个set集合进行差值计算，获得垃圾图片名称集合</span></span><br><span class="line">        Set&lt;String&gt; set = </span><br><span class="line">            jedisPool.getResource().sdiff(RedisConstant.SETMEAL_PIC_RESOURCES, </span><br><span class="line">                                          RedisConstant.SETMEAL_PIC_DB_RESOURCES);</span><br><span class="line">        <span class="keyword">if</span>(set != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span> (String picName : set) &#123;</span><br><span class="line">                <span class="comment">//删除七牛云服务器上的图片</span></span><br><span class="line">                QiniuUtils.deleteFileFromQiniu(picName);</span><br><span class="line">                <span class="comment">//从Redis集合中删除图片名称</span></span><br><span class="line">                jedisPool.getResource().</span><br><span class="line">                    srem(RedisConstant.SETMEAL_PIC_RESOURCES,picName);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="第5章-预约管理-预约设置"><a href="#第5章-预约管理-预约设置" class="headerlink" title="第5章 预约管理-预约设置"></a>第5章 预约管理-预约设置</h1><h2 id="1-需求分析-2"><a href="#1-需求分析-2" class="headerlink" title="1. 需求分析"></a>1. 需求分析</h2><p>前面我们已经完成了检查项管理、检查组管理、套餐管理等。接下来我们需要进行预约设置，其实就是设置每一天的体检预约最大数量。客户可以通过微信端在线预约，在线预约时需要选择体检的时间，如果客户选择的时间已经预约满则无法进行预约。</p>
<h2 id="2-Apache-POI"><a href="#2-Apache-POI" class="headerlink" title="2. Apache POI"></a>2. Apache POI</h2><h3 id="2-1-POI介绍"><a href="#2-1-POI介绍" class="headerlink" title="2.1 POI介绍"></a>2.1 POI介绍</h3><p>Apache POI是用Java编写的免费开源的跨平台的Java API，Apache POI提供API给Java程序对Microsoft Office格式档案读和写的功能，其中使用最多的就是使用POI操作Excel文件。</p>
<p>jxl：专门操作Excel</p>
<p>maven坐标：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>POI结构：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">HSSF － 提供读写Microsoft Excel XLS格式档案的功能</span><br><span class="line">XSSF － 提供读写Microsoft Excel OOXML XLSX格式档案的功能</span><br><span class="line">HWPF － 提供读写Microsoft Word DOC格式档案的功能</span><br><span class="line">HSLF － 提供读写Microsoft PowerPoint格式档案的功能</span><br><span class="line">HDGF － 提供读Microsoft Visio格式档案的功能</span><br><span class="line">HPBF － 提供读Microsoft Publisher格式档案的功能</span><br><span class="line">HSMF － 提供读Microsoft Outlook格式档案的功能</span><br></pre></td></tr></table></figure>

<h3 id="2-2-入门案例"><a href="#2-2-入门案例" class="headerlink" title="2.2 入门案例"></a>2.2 入门案例</h3><h4 id="2-2-1-从Excel文件读取数据"><a href="#2-2-1-从Excel文件读取数据" class="headerlink" title="2.2.1 从Excel文件读取数据"></a>2.2.1 从Excel文件读取数据</h4><p>使用POI可以从一个已经存在的Excel文件中读取数据</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//创建工作簿</span></span><br><span class="line"><span class="type">XSSFWorkbook</span> <span class="variable">workbook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XSSFWorkbook</span>(<span class="string">&quot;D:\\hello.xlsx&quot;</span>);</span><br><span class="line"><span class="comment">//获取工作表，既可以根据工作表的顺序获取，也可以根据工作表的名称获取</span></span><br><span class="line"><span class="type">XSSFSheet</span> <span class="variable">sheet</span> <span class="operator">=</span> workbook.getSheetAt(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//遍历工作表获得行对象</span></span><br><span class="line"><span class="keyword">for</span> (Row row : sheet) &#123;</span><br><span class="line">  <span class="comment">//遍历行对象获取单元格对象</span></span><br><span class="line">  <span class="keyword">for</span> (Cell cell : row) &#123;</span><br><span class="line">    <span class="comment">//获得单元格中的值</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> cell.getStringCellValue();</span><br><span class="line">    System.out.println(value);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">workbook.close();</span><br></pre></td></tr></table></figure>

<p>通过上面的入门案例可以看到，POI操作Excel表格封装了几个核心对象：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">XSSFWorkbook：工作簿</span><br><span class="line">XSSFSheet：工作表</span><br><span class="line">Row：行</span><br><span class="line">Cell：单元格</span><br></pre></td></tr></table></figure>

<p>上面案例是通过遍历工作表获得行，遍历行获得单元格，最终获取单元格中的值。</p>
<p>还有一种方式就是获取工作表最后一个行号，从而根据行号获得行对象，通过行获取最后一个单元格索引，从而根据单元格索引获取每行的一个单元格对象，代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//创建工作簿</span></span><br><span class="line"><span class="type">XSSFWorkbook</span> <span class="variable">workbook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XSSFWorkbook</span>(<span class="string">&quot;D:\\hello.xlsx&quot;</span>);</span><br><span class="line"><span class="comment">//获取工作表，既可以根据工作表的顺序获取，也可以根据工作表的名称获取</span></span><br><span class="line"><span class="type">XSSFSheet</span> <span class="variable">sheet</span> <span class="operator">=</span> workbook.getSheetAt(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//获取当前工作表最后一行的行号，行号从0开始</span></span><br><span class="line"><span class="type">int</span> <span class="variable">lastRowNum</span> <span class="operator">=</span> sheet.getLastRowNum();</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=lastRowNum;i++)&#123;</span><br><span class="line">  <span class="comment">//根据行号获取行对象</span></span><br><span class="line">  <span class="type">XSSFRow</span> <span class="variable">row</span> <span class="operator">=</span> sheet.getRow(i);</span><br><span class="line">  <span class="type">short</span> <span class="variable">lastCellNum</span> <span class="operator">=</span> row.getLastCellNum();</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">short</span> j=<span class="number">0</span>;j&lt;lastCellNum;j++)&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> row.getCell(j).getStringCellValue();</span><br><span class="line">    System.out.println(value);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">workbook.close();</span><br></pre></td></tr></table></figure>

<h4 id="2-2-2-向Excel文件写入数据"><a href="#2-2-2-向Excel文件写入数据" class="headerlink" title="2.2.2 向Excel文件写入数据"></a>2.2.2 向Excel文件写入数据</h4><p>使用POI可以在内存中创建一个Excel文件并将数据写入到这个文件，最后通过输出流将内存中的Excel文件下载到磁盘</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在内存中创建一个Excel文件</span></span><br><span class="line"><span class="type">XSSFWorkbook</span> <span class="variable">workbook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XSSFWorkbook</span>();</span><br><span class="line"><span class="comment">//创建工作表，指定工作表名称</span></span><br><span class="line"><span class="type">XSSFSheet</span> <span class="variable">sheet</span> <span class="operator">=</span> workbook.createSheet(<span class="string">&quot;传智播客&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建行，0表示第一行</span></span><br><span class="line"><span class="type">XSSFRow</span> <span class="variable">row</span> <span class="operator">=</span> sheet.createRow(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//创建单元格，0表示第一个单元格</span></span><br><span class="line">row.createCell(<span class="number">0</span>).setCellValue(<span class="string">&quot;编号&quot;</span>);</span><br><span class="line">row.createCell(<span class="number">1</span>).setCellValue(<span class="string">&quot;名称&quot;</span>);</span><br><span class="line">row.createCell(<span class="number">2</span>).setCellValue(<span class="string">&quot;年龄&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">XSSFRow</span> <span class="variable">row1</span> <span class="operator">=</span> sheet.createRow(<span class="number">1</span>);</span><br><span class="line">row1.createCell(<span class="number">0</span>).setCellValue(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">row1.createCell(<span class="number">1</span>).setCellValue(<span class="string">&quot;小明&quot;</span>);</span><br><span class="line">row1.createCell(<span class="number">2</span>).setCellValue(<span class="string">&quot;10&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">XSSFRow</span> <span class="variable">row2</span> <span class="operator">=</span> sheet.createRow(<span class="number">2</span>);</span><br><span class="line">row2.createCell(<span class="number">0</span>).setCellValue(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">row2.createCell(<span class="number">1</span>).setCellValue(<span class="string">&quot;小王&quot;</span>);</span><br><span class="line">row2.createCell(<span class="number">2</span>).setCellValue(<span class="string">&quot;20&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过输出流将workbook对象下载到磁盘</span></span><br><span class="line"><span class="type">FileOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;D:\\itcast.xlsx&quot;</span>);</span><br><span class="line">workbook.write(out);</span><br><span class="line">out.flush();</span><br><span class="line">out.close();</span><br><span class="line">workbook.close();</span><br></pre></td></tr></table></figure>

<h2 id="3-批量导入预约设置信息"><a href="#3-批量导入预约设置信息" class="headerlink" title="3. 批量导入预约设置信息"></a>3. 批量导入预约设置信息</h2><p>预约设置信息对应的数据表为t_ordersetting，预约设置操作对应的页面为ordersetting.html</p>
<p>t_ordersetting表结构：</p>
<p><img src="/../../assets/image-20220907104116597.png" alt="image-20220907104116597"></p>
<p>orderDate：预约日期</p>
<p>number：可预约人数</p>
<p>reservations：已预约人数</p>
<p>批量导入预约设置信息操作过程：</p>
<p>1、点击模板下载按钮下载Excel模板文件</p>
<p>2、将预约设置信息录入到模板文件中</p>
<p>3、点击上传文件按钮将录入完信息的模板文件上传到服务器</p>
<p>4、通过POI读取上传文件的数据并保存到数据库</p>
<h3 id="3-1-完善页面-3"><a href="#3-1-完善页面-3" class="headerlink" title="3.1 完善页面"></a>3.1 完善页面</h3><h4 id="3-1-1-提供模板文件"><a href="#3-1-1-提供模板文件" class="headerlink" title="3.1.1 提供模板文件"></a>3.1.1 提供模板文件</h4><p>资料中已经提供了Excel模板文件ordersetting_template.xlsx，将文件放在health_backend工程的template目录</p>
<h4 id="3-1-2-实现模板文件下载"><a href="#3-1-2-实现模板文件下载" class="headerlink" title="3.1.2 实现模板文件下载"></a>3.1.2 实现模板文件下载</h4><p>为模板下载按钮绑定事件实现模板文件下载</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">style</span>=<span class="string">&quot;margin-bottom: 20px;margin-right: 20px&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> </span></span><br><span class="line"><span class="tag">           @<span class="attr">click</span>=<span class="string">&quot;downloadTemplate()&quot;</span>&gt;</span>模板下载<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">//模板文件下载</span><br><span class="line">downloadTemplate()&#123;</span><br><span class="line">	window.location.href=&quot;../../template/ordersetting_template.xlsx&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-1-3-文件上传"><a href="#3-1-3-文件上传" class="headerlink" title="3.1.3 文件上传"></a>3.1.3 文件上传</h4><p>使用ElementUI的上传组件实现文件上传并绑定相关事件</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-upload</span> <span class="attr">action</span>=<span class="string">&quot;/ordersetting/upload.do&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">name</span>=<span class="string">&quot;excelFile&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">:show-file-list</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">:on-success</span>=<span class="string">&quot;handleSuccess&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">:before-upload</span>=<span class="string">&quot;beforeUpload&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>上传文件<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-upload</span>&gt;</span></span><br><span class="line"></span><br><span class="line">handleSuccess(response, file) &#123;</span><br><span class="line">  if(response.flag)&#123;</span><br><span class="line">    this.$message(&#123;</span><br><span class="line">      message: response.message,</span><br><span class="line">      type: &#x27;success&#x27;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">    this.$message.error(response.message);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">beforeUpload(file)&#123;</span><br><span class="line">  const isXLS = file.type === &#x27;application/vnd.ms-excel&#x27;;</span><br><span class="line">  if(isXLS)&#123;</span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line">  const isXLSX = file.type === &#x27;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#x27;;</span><br><span class="line">  if (isXLSX) &#123;</span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line">  this.$message.error(&#x27;上传文件只能是xls或者xlsx格式!&#x27;);</span><br><span class="line">  return false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-后台代码-3"><a href="#3-2-后台代码-3" class="headerlink" title="3.2 后台代码"></a>3.2 后台代码</h3><h4 id="3-2-1-Controller-3"><a href="#3-2-1-Controller-3" class="headerlink" title="3.2.1 Controller"></a>3.2.1 Controller</h4><p>将资料中的POIUtils工具类复制到health_common工程</p>
<p>在health_backend工程创建OrderSettingController并提供upload方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Reference;</span><br><span class="line"><span class="keyword">import</span> com.itheima.constant.MessageConstant;</span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.Result;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.OrderSetting;</span><br><span class="line"><span class="keyword">import</span> com.itheima.service.OrderSettingService;</span><br><span class="line"><span class="keyword">import</span> com.itheima.utils.POIUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 预约设置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/ordersetting&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderSettingController</span> &#123;</span><br><span class="line">    <span class="meta">@Reference</span></span><br><span class="line">    <span class="keyword">private</span> OrderSettingService orderSettingService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Excel文件上传，并解析文件内容保存到数据库</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> excelFile</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">upload</span><span class="params">(<span class="meta">@RequestParam(&quot;excelFile&quot;)</span>MultipartFile excelFile)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//读取Excel文件数据</span></span><br><span class="line">            List&lt;String[]&gt; list = POIUtils.readExcel(excelFile);</span><br><span class="line">            <span class="keyword">if</span>(list != <span class="literal">null</span> &amp;&amp; list.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                List&lt;OrderSetting&gt; orderSettingList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">                <span class="keyword">for</span> (String[] strings : list) &#123;</span><br><span class="line">                    <span class="type">OrderSetting</span> <span class="variable">orderSetting</span> <span class="operator">=</span> </span><br><span class="line">                      <span class="keyword">new</span> <span class="title class_">OrderSetting</span>(<span class="keyword">new</span> <span class="title class_">Date</span>(strings[<span class="number">0</span>]), Integer.parseInt(strings[<span class="number">1</span>]));</span><br><span class="line">                    orderSettingList.add(orderSetting);</span><br><span class="line">                &#125;</span><br><span class="line">                orderSettingService.add(orderSettingList);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>, MessageConstant.IMPORT_ORDERSETTING_FAIL);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>,MessageConstant.IMPORT_ORDERSETTING_SUCCESS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-服务接口-3"><a href="#3-2-2-服务接口-3" class="headerlink" title="3.2.2 服务接口"></a>3.2.2 服务接口</h4><p>创建OrderSettingService服务接口并提供新增方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.OrderSetting;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderSettingService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(List&lt;OrderSetting&gt; list)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-3-服务实现类-3"><a href="#3-2-3-服务实现类-3" class="headerlink" title="3.2.3 服务实现类"></a>3.2.3 服务实现类</h4><p>创建服务实现类OrderSettingServiceImpl并实现新增方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Service;</span><br><span class="line"><span class="keyword">import</span> com.itheima.dao.OrderSettingDao;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.OrderSetting;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 预约设置服务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service(interfaceClass = OrderSettingService.class)</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderSettingServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">OrderSettingService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderSettingDao orderSettingDao;</span><br><span class="line">    <span class="comment">//批量添加</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(List&lt;OrderSetting&gt; list)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(list != <span class="literal">null</span> &amp;&amp; list.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span> (OrderSetting orderSetting : list) &#123;</span><br><span class="line">                <span class="comment">//检查此数据（日期）是否存在</span></span><br><span class="line">                <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> orderSettingDao.findCountByOrderDate(orderSetting.getOrderDate());</span><br><span class="line">                <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="comment">//已经存在，执行更新操作</span></span><br><span class="line">                    orderSettingDao.editNumberByOrderDate(orderSetting);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="comment">//不存在，执行添加操作</span></span><br><span class="line">                    orderSettingDao.add(orderSetting);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-4-Dao接口-3"><a href="#3-2-4-Dao接口-3" class="headerlink" title="3.2.4 Dao接口"></a>3.2.4 Dao接口</h4><p>创建Dao接口OrderSettingDao并提供更新和新增方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.OrderSetting;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderSettingDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(OrderSetting orderSetting)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">editNumberByOrderDate</span><span class="params">(OrderSetting orderSetting)</span>;</span><br><span class="line">  	<span class="keyword">public</span> <span class="type">long</span> <span class="title function_">findCountByOrderDate</span><span class="params">(Date orderDate)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-5-Mapper映射文件-3"><a href="#3-2-5-Mapper映射文件-3" class="headerlink" title="3.2.5 Mapper映射文件"></a>3.2.5 Mapper映射文件</h4><p>创建Mapper映射文件OrderSettingDao.xml并提供相关SQL</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.dao.OrderSettingDao&quot;</span> &gt;</span></span><br><span class="line">    <span class="comment">&lt;!--新增--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;add&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.itheima.pojo.OrderSetting&quot;</span>&gt;</span></span><br><span class="line">        insert into t_ordersetting</span><br><span class="line">      		(orderDate,number,reservations)</span><br><span class="line">                      values </span><br><span class="line">      		(#&#123;orderDate&#125;,#&#123;number&#125;,#&#123;reservations&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--根据日期更新预约人数--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;editNumberByOrderDate&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.itheima.pojo.OrderSetting&quot;</span>&gt;</span></span><br><span class="line">        update t_ordersetting set number = #&#123;number&#125; where orderDate = #&#123;orderDate&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--根据预约日期查询--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findCountByOrderDate&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.util.Date&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;long&quot;</span>&gt;</span></span><br><span class="line">        select count(*) from t_ordersetting where orderDate = #&#123;orderDate&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="4-日历展示预约设置信息"><a href="#4-日历展示预约设置信息" class="headerlink" title="4. 日历展示预约设置信息"></a>4. 日历展示预约设置信息</h2><p>前面已经完成了预约设置功能，现在就需要通过日历的方式展示出来每天设置的预约人数。</p>
<p>在页面中已经完成了日历的动态展示，我们只需要查询当前月份的预约设置信息并展示到日历中即可，同时在日历中还需要展示已经预约的人数，效果如下：</p>
<p><img src="/../../assets/1(1).png" alt="1(1)"></p>
<h3 id="4-1-完善页面-2"><a href="#4-1-完善页面-2" class="headerlink" title="4.1 完善页面"></a>4.1 完善页面</h3><h4 id="4-1-1-使用静态数据调试"><a href="#4-1-1-使用静态数据调试" class="headerlink" title="4.1.1 使用静态数据调试"></a>4.1.1 使用静态数据调试</h4><p>为了能够快速看到效果，我们可以先使用静态数据模拟，然后再改为发送ajax请求查询数据库。</p>
<p>实现步骤：</p>
<p>（1）预约设置数据对应的模型数据为leftobj，在initData方法最后为leftobj模型数据赋值：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">leftobj</span> = [</span><br><span class="line">                  &#123; <span class="attr">date</span>: <span class="number">1</span>, <span class="attr">number</span>: <span class="number">120</span>, <span class="attr">reservations</span>: <span class="number">1</span> &#125;,</span><br><span class="line">                  &#123; <span class="attr">date</span>: <span class="number">3</span>, <span class="attr">number</span>: <span class="number">120</span>, <span class="attr">reservations</span>: <span class="number">1</span> &#125;,</span><br><span class="line">                  &#123; <span class="attr">date</span>: <span class="number">4</span>, <span class="attr">number</span>: <span class="number">120</span>, <span class="attr">reservations</span>: <span class="number">120</span> &#125;,</span><br><span class="line">                  &#123; <span class="attr">date</span>: <span class="number">6</span>, <span class="attr">number</span>: <span class="number">120</span>, <span class="attr">reservations</span>: <span class="number">1</span> &#125;,</span><br><span class="line">                  &#123; <span class="attr">date</span>: <span class="number">8</span>, <span class="attr">number</span>: <span class="number">120</span>, <span class="attr">reservations</span>: <span class="number">1</span> &#125;</span><br><span class="line">                ];</span><br></pre></td></tr></table></figure>

<p>其中date表示日期，number表示可预约人数，reservations表示已预约人数</p>
<p>（2）使用VUE的v-for标签遍历上面的leftobj模型数据，展示到日历上：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-for</span>=<span class="string">&quot;obj in leftobj&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-if</span>=<span class="string">&quot;obj.date == dayobject.day.getDate()&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-if</span>=<span class="string">&quot;obj.number &gt; obj.reservations&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;usual&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>可预约&#123;&#123;obj.number&#125;&#125;人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>已预约&#123;&#123;obj.reservations&#125;&#125;人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;fulled&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>可预约&#123;&#123;obj.number&#125;&#125;人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>已预约&#123;&#123;obj.reservations&#125;&#125;人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>已满<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-if</span>=<span class="string">&quot;dayobject.day &gt; today&quot;</span> </span></span><br><span class="line"><span class="tag">          @<span class="attr">click</span>=<span class="string">&quot;handleOrderSet(dayobject.day)&quot;</span> <span class="attr">class</span>=<span class="string">&quot;orderbtn&quot;</span>&gt;</span>设置<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-1-2-发送ajax获取动态数据"><a href="#4-1-2-发送ajax获取动态数据" class="headerlink" title="4.1.2 发送ajax获取动态数据"></a>4.1.2 发送ajax获取动态数据</h4><p>将上面的静态模拟数据去掉，改为发送ajax请求，根据当前页面对应的月份查询数据库获取预约设置信息，将查询结果赋值给leftobj模型数据</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//发送ajax请求，根据当前页面对应的月份查询预约设置信息</span></span><br><span class="line">axios.<span class="title function_">post</span>(</span><br><span class="line">  <span class="string">&quot;/ordersetting/getOrderSettingByMonth.do?date=&quot;</span>+<span class="variable language_">this</span>.<span class="property">currentYear</span>+<span class="string">&#x27;-&#x27;</span>+<span class="variable language_">this</span>.<span class="property">currentMonth</span></span><br><span class="line">		  ).<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(response.<span class="property">data</span>.<span class="property">flag</span>)&#123;</span><br><span class="line">    <span class="comment">//为模型数据赋值，通过双向绑定展示到日历中</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">leftobj</span> = response.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(response.<span class="property">data</span>.<span class="property">message</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="4-2-后台代码-2"><a href="#4-2-后台代码-2" class="headerlink" title="4.2 后台代码"></a>4.2 后台代码</h3><h4 id="4-2-1-Controller-2"><a href="#4-2-1-Controller-2" class="headerlink" title="4.2.1 Controller"></a>4.2.1 Controller</h4><p>在OrderSettingController中提供getOrderSettingByMonth方法，根据月份查询预约设置信息</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 根据日期查询预约设置数据(获取指定日期所在月份的预约设置数据)</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> date</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/getOrderSettingByMonth&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">getOrderSettingByMonth</span><span class="params">(String date)</span>&#123;<span class="comment">//参数格式为：2019-03</span></span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">    List&lt;Map&gt; list = orderSettingService.getOrderSettingByMonth(date);</span><br><span class="line">    <span class="comment">//获取预约设置数据成功</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>,MessageConstant.GET_ORDERSETTING_SUCCESS,list);</span><br><span class="line">  &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    <span class="comment">//获取预约设置数据失败</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>,MessageConstant.GET_ORDERSETTING_FAIL);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-2-2-服务接口-2"><a href="#4-2-2-服务接口-2" class="headerlink" title="4.2.2 服务接口"></a>4.2.2 服务接口</h4><p>在OrderSettingService服务接口中扩展方法getOrderSettingByMonth</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Map&gt; <span class="title function_">getOrderSettingByMonth</span><span class="params">(String date)</span>;<span class="comment">//参数格式为：2019-03</span></span><br></pre></td></tr></table></figure>

<h4 id="4-2-3-服务实现类-2"><a href="#4-2-3-服务实现类-2" class="headerlink" title="4.2.3 服务实现类"></a>4.2.3 服务实现类</h4><p>在OrderSettingServiceImpl服务实现类中实现方法getOrderSettingByMonth</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//根据日期查询预约设置数据</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Map&gt; <span class="title function_">getOrderSettingByMonth</span><span class="params">(String date)</span> &#123;<span class="comment">//2019-3</span></span><br><span class="line">  <span class="type">String</span> <span class="variable">dateBegin</span> <span class="operator">=</span> date + <span class="string">&quot;-1&quot;</span>;<span class="comment">//2019-3-1</span></span><br><span class="line">  <span class="type">String</span> <span class="variable">dateEnd</span> <span class="operator">=</span> date + <span class="string">&quot;-31&quot;</span>;<span class="comment">//2019-3-31</span></span><br><span class="line">  <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">  map.put(<span class="string">&quot;dateBegin&quot;</span>,dateBegin);</span><br><span class="line">  map.put(<span class="string">&quot;dateEnd&quot;</span>,dateEnd);</span><br><span class="line">  List&lt;OrderSetting&gt; list = orderSettingDao.getOrderSettingByMonth(map);</span><br><span class="line">  List&lt;Map&gt; data = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">  <span class="keyword">for</span> (OrderSetting orderSetting : list) &#123;</span><br><span class="line">    <span class="type">Map</span> <span class="variable">orderSettingMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">    orderSettingMap.put(<span class="string">&quot;date&quot;</span>,orderSetting.getOrderDate().getDate());<span class="comment">//获得日期（几号）</span></span><br><span class="line">    orderSettingMap.put(<span class="string">&quot;number&quot;</span>,orderSetting.getNumber());<span class="comment">//可预约人数</span></span><br><span class="line">    orderSettingMap.put(<span class="string">&quot;reservations&quot;</span>,orderSetting.getReservations());<span class="comment">//已预约人数</span></span><br><span class="line">    data.add(orderSettingMap);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-2-4-Dao接口-2"><a href="#4-2-4-Dao接口-2" class="headerlink" title="4.2.4 Dao接口"></a>4.2.4 Dao接口</h4><p>在OrderSettingDao接口中扩展方法getOrderSettingByMonth</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;OrderSetting&gt; <span class="title function_">getOrderSettingByMonth</span><span class="params">(Map date)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="4-2-5-Mapper映射文件-2"><a href="#4-2-5-Mapper映射文件-2" class="headerlink" title="4.2.5 Mapper映射文件"></a>4.2.5 Mapper映射文件</h4><p>在OrderSettingDao.xml文件中扩展SQL</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--根据月份查询预约设置信息--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getOrderSettingByMonth&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">parameterType</span>=<span class="string">&quot;hashmap&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.pojo.OrderSetting&quot;</span>&gt;</span></span><br><span class="line">  select * from t_ordersetting where orderDate between #&#123;dateBegin&#125; and #&#123;dateEnd&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-基于日历实现预约设置"><a href="#5-基于日历实现预约设置" class="headerlink" title="5. 基于日历实现预约设置"></a>5. 基于日历实现预约设置</h2><p>本章节要完成的功能为通过点击日历中的设置按钮来设置对应日期的可预约人数。效果如下：</p>
<p><img src="/../../assets/image-20220907104243371.png" alt="image-20220907104243371"></p>
<h3 id="5-1-完善页面-1"><a href="#5-1-完善页面-1" class="headerlink" title="5.1 完善页面"></a>5.1 完善页面</h3><h4 id="5-1-1-为设置按钮绑定事件"><a href="#5-1-1-为设置按钮绑定事件" class="headerlink" title="5.1.1 为设置按钮绑定事件"></a>5.1.1 为设置按钮绑定事件</h4><p>为日历中的设置按钮绑定单击事件，当前日期作为参数</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">v-if</span>=<span class="string">&quot;dayobject.day &gt; today&quot;</span> </span></span><br><span class="line"><span class="tag">        @<span class="attr">click</span>=<span class="string">&quot;handleOrderSet(dayobject.day)&quot;</span> <span class="attr">class</span>=<span class="string">&quot;orderbtn&quot;</span>&gt;</span>设置<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">//预约设置</span><br><span class="line">handleOrderSet(day)&#123;</span><br><span class="line">	alert(day);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-1-2-弹出预约设置窗口并发送ajax请求"><a href="#5-1-2-弹出预约设置窗口并发送ajax请求" class="headerlink" title="5.1.2 弹出预约设置窗口并发送ajax请求"></a>5.1.2 弹出预约设置窗口并发送ajax请求</h4><p>完善handleOrderSet方法，弹出预约设置窗口，用户点击确定按钮则发送ajax请求</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//预约设置</span></span><br><span class="line"><span class="title function_">handleOrderSet</span>(<span class="params">day</span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.$prompt(<span class="string">&#x27;请输入可预约人数&#x27;</span>, <span class="string">&#x27;预约设置&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">confirmButtonText</span>: <span class="string">&#x27;确定&#x27;</span>,</span><br><span class="line">    <span class="attr">cancelButtonText</span>: <span class="string">&#x27;取消&#x27;</span>,</span><br><span class="line">    <span class="attr">inputPattern</span>: <span class="regexp">/^[0-9]*[1-9][0-9]*$/</span>,</span><br><span class="line">    <span class="attr">inputErrorMessage</span>: <span class="string">&#x27;只能输入正整数&#x27;</span></span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; value &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//发送ajax请求根据日期修改可预约人数</span></span><br><span class="line">    axios.<span class="title function_">post</span>(<span class="string">&quot;/ordersetting/editNumberByDate.do&quot;</span>,&#123;</span><br><span class="line">      <span class="attr">orderDate</span>:<span class="variable language_">this</span>.<span class="title function_">formatDate</span>(day.<span class="title function_">getFullYear</span>(),day.<span class="title function_">getMonth</span>()+<span class="number">1</span>,day.<span class="title function_">getDate</span>()), <span class="comment">//日期</span></span><br><span class="line">      <span class="attr">number</span>:value   <span class="comment">//可预约人数</span></span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>)=&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(response.<span class="property">data</span>.<span class="property">flag</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">initData</span>(<span class="variable language_">this</span>.<span class="title function_">formatDate</span>(day.<span class="title function_">getFullYear</span>(), day.<span class="title function_">getMonth</span>() + <span class="number">1</span>, <span class="number">1</span>));</span><br><span class="line">        <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">          <span class="attr">message</span>: response.<span class="property">data</span>.<span class="property">message</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(response.<span class="property">data</span>.<span class="property">message</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;info&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;已取消&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-后台代码-1"><a href="#5-2-后台代码-1" class="headerlink" title="5.2 后台代码"></a>5.2 后台代码</h3><h4 id="5-2-1-Controller-1"><a href="#5-2-1-Controller-1" class="headerlink" title="5.2.1 Controller"></a>5.2.1 Controller</h4><p>在OrderSettingController中提供方法editNumberByDate</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 根据指定日期修改可预约人数</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> orderSetting</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/editNumberByDate&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">editNumberByDate</span><span class="params">(<span class="meta">@RequestBody</span> OrderSetting orderSetting)</span>&#123;</span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">    orderSettingService.editNumberByDate(orderSetting);</span><br><span class="line">    <span class="comment">//预约设置成功</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>,MessageConstant.ORDERSETTING_SUCCESS);</span><br><span class="line">  &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    <span class="comment">//预约设置失败</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>,MessageConstant.ORDERSETTING_FAIL);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-2-2-服务接口-1"><a href="#5-2-2-服务接口-1" class="headerlink" title="5.2.2 服务接口"></a>5.2.2 服务接口</h4><p>在OrderSettingService服务接口中提供方法editNumberByDate</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">editNumberByDate</span><span class="params">(OrderSetting orderSetting)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="5-2-3-服务实现类-1"><a href="#5-2-3-服务实现类-1" class="headerlink" title="5.2.3 服务实现类"></a>5.2.3 服务实现类</h4><p>在OrderSettingServiceImpl服务实现类中实现editNumberByDate</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//根据日期修改可预约人数</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">editNumberByDate</span><span class="params">(OrderSetting orderSetting)</span> &#123;</span><br><span class="line">  <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> orderSettingDao.findCountByOrderDate(orderSetting.getOrderDate());</span><br><span class="line">  <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="comment">//当前日期已经进行了预约设置，需要进行修改操作</span></span><br><span class="line">    orderSettingDao.editNumberByOrderDate(orderSetting);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//当前日期没有进行预约设置，进行添加操作</span></span><br><span class="line">    orderSettingDao.add(orderSetting);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-2-4-Dao接口-1"><a href="#5-2-4-Dao接口-1" class="headerlink" title="5.2.4 Dao接口"></a>5.2.4 Dao接口</h4><p>在OrderSettingDao接口中提供方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">editNumberByOrderDate</span><span class="params">(OrderSetting orderSetting)</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="type">long</span> <span class="title function_">findCountByOrderDate</span><span class="params">(Date orderDate)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="5-2-5-Mapper映射文件-1"><a href="#5-2-5-Mapper映射文件-1" class="headerlink" title="5.2.5 Mapper映射文件"></a>5.2.5 Mapper映射文件</h4><p>在OrderSettingDao.xml映射文件中提供SQL</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--根据日期更新可预约人数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;editNumberByOrderDate&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.itheima.pojo.OrderSetting&quot;</span>&gt;</span></span><br><span class="line">  update t_ordersetting set number = #&#123;number&#125; where orderDate = #&#123;orderDate&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--根据预约日期查询--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findCountByOrderDate&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.util.Date&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;long&quot;</span>&gt;</span></span><br><span class="line">  select count(*) from t_ordersetting where orderDate = #&#123;orderDate&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="第6章-移动端开发-体检预约"><a href="#第6章-移动端开发-体检预约" class="headerlink" title="第6章 移动端开发-体检预约"></a>第6章 移动端开发-体检预约</h1><h2 id="1-移动端开发"><a href="#1-移动端开发" class="headerlink" title="1. 移动端开发"></a>1. 移动端开发</h2><h3 id="1-1-移动端开发方式"><a href="#1-1-移动端开发方式" class="headerlink" title="1.1 移动端开发方式"></a>1.1 移动端开发方式</h3><p>随着移动互联网的兴起和手机的普及，目前移动端应用变得愈发重要，成为了各个商家的必争之地。例如，我们可以使用手机购物、支付、打车、玩游戏、订酒店、购票等，以前只能通过PC端完成的事情，现在通过手机都能够实现，而且更加方便，而这些都需要移动端开发进行支持，那如何进行移动端开发呢？</p>
<p>移动端开发主要有三种方式：</p>
<p>1、基于手机API开发（原生APP）</p>
<p>2、基于手机浏览器开发（移动web）</p>
<p>3、混合开发（混合APP）</p>
<h4 id="1-1-1-基于手机API开发"><a href="#1-1-1-基于手机API开发" class="headerlink" title="1.1.1 基于手机API开发"></a>1.1.1 基于手机API开发</h4><p>手机端使用手机API，例如使用Android、ios 等进行开发，服务端只是一个数据提供者。手机端请求服务端获取数据（json、xml格式）并在界面进行展示。这种方式相当于传统开发中的C&#x2F;S模式，即需要在手机上安装一个客户端软件。</p>
<p>这种方式需要针对不同的手机系统分别进行开发，目前主要有以下几个平台：</p>
<p>1、苹果ios系统版本，开发语言是Objective-C</p>
<p>2、安卓Android系统版本，开发语言是Java</p>
<p>3、微软Windows phone系统版本，开发语言是C#</p>
<p>4、塞班symbian系统版本，开发语言是C++</p>
<p>此种开发方式举例：手机淘宝、抖音、今日头条、大众点评</p>
<h4 id="1-1-2-基于手机浏览器开发"><a href="#1-1-2-基于手机浏览器开发" class="headerlink" title="1.1.2 基于手机浏览器开发"></a>1.1.2 基于手机浏览器开发</h4><p>生存在浏览器中的应用，基本上可以说是触屏版的网页应用。这种开发方式相当于传统开发中的B&#x2F;S模式，也就是手机上不需要额外安装软件，直接基于手机上的浏览器进行访问。这就需要我们编写的html页面需要根据不同手机的尺寸进行自适应调节，目前比较流行的是html5开发。除了直接通过手机浏览器访问，还可以将页面内嵌到一些应用程序中，例如通过微信公众号访问html5页面。</p>
<p>这种开发方式不需要针对不同的手机系统分别进行开发，只需要开发一个版本，就可以在不同的手机上正常访问。</p>
<p>本项目会通过将我们开发的html5页面内嵌到微信公众号这种方式进行开发。</p>
<h4 id="1-1-3-混合开发"><a href="#1-1-3-混合开发" class="headerlink" title="1.1.3 混合开发"></a>1.1.3 混合开发</h4><p>是半原生半Web的混合类App。需要下载安装，看上去类似原生App，访问的内容是Web网页。其实就是把HTML5页面嵌入到一个原生容器里面。</p>
<h3 id="1-2-微信公众号开发"><a href="#1-2-微信公众号开发" class="headerlink" title="1.2 微信公众号开发"></a>1.2 微信公众号开发</h3><p>要进行微信公众号开发，首先需要访问微信公众平台，官网：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/%E3%80%82">https://mp.weixin.qq.com/。</a></p>
<h4 id="1-2-1-帐号分类"><a href="#1-2-1-帐号分类" class="headerlink" title="1.2.1 帐号分类"></a>1.2.1 帐号分类</h4><p>在微信公众平台可以看到，有四种帐号类型：服务号、订阅号、小程序、企业微信（原企业号）。</p>
<p><img src="/../../assets/2143930-20210826120859472-922067926.png" alt="img"></p>
<p><img src="/../../assets/2143930-20210826120906627-429601157.png" alt="img"></p>
<p>本项目会选择订阅号这种方式进行公众号开发。</p>
<h4 id="1-2-2-注册帐号"><a href="#1-2-2-注册帐号" class="headerlink" title="1.2.2 注册帐号"></a>1.2.2 注册帐号</h4><p>要开发微信公众号，首先需要注册成为会员，然后就可以登录微信公众平台进行自定义菜单的设置。</p>
<p>注册页面：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/cgi-bin/registermidpage?action=index&amp;lang=zh_CN&amp;token=">https://mp.weixin.qq.com/cgi-bin/registermidpage?action=index&amp;lang=zh_CN&amp;token=</a></p>
<p><img src="/../../assets/2143930-20210826120914340-607375467.png" alt="img"></p>
<p>选择订阅号进行注册：</p>
<p><img src="/../../assets/2143930-20210826120920118-511695951.png" alt="img"></p>
<p>输入邮箱、邮箱验证码、密码、确认密码等按照页面流程进行注册</p>
<h4 id="1-2-3-自定义菜单"><a href="#1-2-3-自定义菜单" class="headerlink" title="1.2.3 自定义菜单"></a>1.2.3 自定义菜单</h4><p>注册成功后就可以使用注册的邮箱和设置的密码进行登录，登录成功后点击左侧“自定义菜单”进入自定义菜单页面</p>
<p><img src="/../../assets/2143930-20210826120928287-1414207880.png" alt="img"></p>
<p>在自定义菜单页面可以根据需求创建一级菜单和二级菜单，其中一级菜单最多可以创建3个，每个一级菜单下面最多可以创建5个二级菜单。每个菜单由菜单名称和菜单内容组成，其中菜单内容有3中形式：发送消息、跳转网页、跳转小程序。</p>
<h4 id="1-2-4-上线要求"><a href="#1-2-4-上线要求" class="headerlink" title="1.2.4 上线要求"></a>1.2.4 上线要求</h4><p>如果是个人用户身份注册的订阅号，则自定义菜单的菜单内容不能进行跳转网页，因为个人用户目前不支持微信认证，而跳转网页需要微信认证之后才有权限。</p>
<p>如果是企业用户，首先需要进行微信认证，通过后就可以进行跳转网页了，跳转网页的地址要求必须有域名并且域名需要备案通过。</p>
<h2 id="2-需求分析和环境搭建"><a href="#2-需求分析和环境搭建" class="headerlink" title="2. 需求分析和环境搭建"></a>2. 需求分析和环境搭建</h2><h3 id="2-1-需求分析-1"><a href="#2-1-需求分析-1" class="headerlink" title="2.1 需求分析"></a>2.1 需求分析</h3><p>用户在体检之前需要进行预约，可以通过电话方式进行预约，此时会由体检中心客服人员通过后台系统录入预约信息。用户也可以通过手机端自助预约。本章节开发的功能为用户通过手机自助预约。</p>
<p>预约流程如下：</p>
<p>1、访问移动端首页</p>
<p>2、点击体检预约进入体检套餐列表页面</p>
<p>3、在体检套餐列表页面点击具体套餐进入套餐详情页面</p>
<p>4、在套餐详情页面点击立即预约进入预约页面</p>
<p>5、在预约页面录入体检人相关信息点击提交预约</p>
<p>效果如下图：</p>
<p><img src="/../../assets/2143930-20210826120938410-579478690.png" alt="img"></p>
<p><img src="/../../assets/2143930-20210826120943627-254173533.png" alt="img"></p>
<p><img src="/../../assets/2143930-20210826120949788-570724317.png" alt="img"></p>
<p><img src="/../../assets/2143930-20210826120957326-1709666878.png" alt="img"></p>
<h3 id="2-2-搭建移动端工程"><a href="#2-2-搭建移动端工程" class="headerlink" title="2.2 搭建移动端工程"></a>2.2 搭建移动端工程</h3><p>本项目是基于SOA架构进行开发，前面我们已经完成了后台系统的部分功能开发，在后台系统中都是通过Dubbo调用服务层发布的服务进行相关的操作。本章节我们开发移动端工程也是同样的模式，所以我们也需要在移动端工程中通过Dubbo调用服务层发布的服务，如下图：</p>
<p><img src="/../../assets/2143930-20210826121005067-405953044.png" alt="img"></p>
<h4 id="2-2-1-导入maven坐标"><a href="#2-2-1-导入maven坐标" class="headerlink" title="2.2.1 导入maven坐标"></a>2.2.1 导入maven坐标</h4><p>在health_common工程的pom.xml文件中导入阿里短信发送的maven坐标</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-dysmsapi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-2-2-导入通用组件"><a href="#2-2-2-导入通用组件" class="headerlink" title="2.2.2 导入通用组件"></a>2.2.2 导入通用组件</h4><p>在health_common工程中导入如下通用组件</p>
<p>ValidateCodeUtils工具类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 随机生成验证码工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ValidateCodeUtils</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 随机生成验证码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> length 长度为4位或者6位</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title function_">generateValidateCode</span><span class="params">(<span class="type">int</span> length)</span>&#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">code</span> <span class="operator">=</span><span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(length == <span class="number">4</span>)&#123;</span><br><span class="line">            code = <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">9999</span>);<span class="comment">//生成随机数，最大为9999</span></span><br><span class="line">            <span class="keyword">if</span>(code &lt; <span class="number">1000</span>)&#123;</span><br><span class="line">                code = code + <span class="number">1000</span>;<span class="comment">//保证随机数为4位数字</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(length == <span class="number">6</span>)&#123;</span><br><span class="line">            code = <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">999999</span>);<span class="comment">//生成随机数，最大为999999</span></span><br><span class="line">            <span class="keyword">if</span>(code &lt; <span class="number">100000</span>)&#123;</span><br><span class="line">                code = code + <span class="number">100000</span>;<span class="comment">//保证随机数为6位数字</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;只能生成4位或6位数字验证码&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 随机生成指定长度字符串验证码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> length 长度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">generateValidateCode4String</span><span class="params">(<span class="type">int</span> length)</span>&#123;</span><br><span class="line">        <span class="type">Random</span> <span class="variable">rdm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">hash1</span> <span class="operator">=</span> Integer.toHexString(rdm.nextInt());</span><br><span class="line">        <span class="type">String</span> <span class="variable">capstr</span> <span class="operator">=</span> hash1.substring(<span class="number">0</span>, length);</span><br><span class="line">        <span class="keyword">return</span> capstr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SMSUtils工具类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.DefaultAcsClient;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.IAcsClient;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.dysmsapi.model.v20170525.SendSmsRequest;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.dysmsapi.model.v20170525.SendSmsResponse;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.exceptions.ClientException;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.http.MethodType;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.profile.DefaultProfile;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.profile.IClientProfile;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 短信发送工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SMSUtils</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">VALIDATE_CODE</span> <span class="operator">=</span> <span class="string">&quot;SMS_159620392&quot;</span>;<span class="comment">//发送短信验证码</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ORDER_NOTICE</span> <span class="operator">=</span> <span class="string">&quot;SMS_159771588&quot;</span>;<span class="comment">//体检预约成功通知</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 发送短信</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> phoneNumbers</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> param</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> ClientException</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sendShortMessage</span><span class="params">(String templateCode,String phoneNumbers,String param)</span> <span class="keyword">throws</span> ClientException&#123;</span><br><span class="line">		<span class="comment">// 设置超时时间-可自行调整</span></span><br><span class="line">		System.setProperty(<span class="string">&quot;sun.net.client.defaultConnectTimeout&quot;</span>, <span class="string">&quot;10000&quot;</span>);</span><br><span class="line">		System.setProperty(<span class="string">&quot;sun.net.client.defaultReadTimeout&quot;</span>, <span class="string">&quot;10000&quot;</span>);</span><br><span class="line">		<span class="comment">// 初始化ascClient需要的几个参数</span></span><br><span class="line">		<span class="keyword">final</span> <span class="type">String</span> <span class="variable">product</span> <span class="operator">=</span> <span class="string">&quot;Dysmsapi&quot;</span>;<span class="comment">// 短信API产品名称（短信产品名固定，无需修改）</span></span><br><span class="line">		<span class="keyword">final</span> <span class="type">String</span> <span class="variable">domain</span> <span class="operator">=</span> <span class="string">&quot;dysmsapi.aliyuncs.com&quot;</span>;<span class="comment">// 短信API产品域名（接口地址固定，无需修改）</span></span><br><span class="line">		<span class="comment">// 替换成你的AK</span></span><br><span class="line">		<span class="keyword">final</span> <span class="type">String</span> <span class="variable">accessKeyId</span> <span class="operator">=</span> <span class="string">&quot;accessKeyId&quot;</span>;<span class="comment">// 你的accessKeyId,参考本文档步骤2</span></span><br><span class="line">		<span class="keyword">final</span> <span class="type">String</span> <span class="variable">accessKeySecret</span> <span class="operator">=</span> <span class="string">&quot;accessKeySecret&quot;</span>;<span class="comment">// 你的accessKeySecret，参考本文档步骤2</span></span><br><span class="line">		<span class="comment">// 初始化ascClient,暂时不支持多region（请勿修改）</span></span><br><span class="line">		<span class="type">IClientProfile</span> <span class="variable">profile</span> <span class="operator">=</span> DefaultProfile.getProfile(<span class="string">&quot;cn-hangzhou&quot;</span>, accessKeyId, accessKeySecret);</span><br><span class="line">		DefaultProfile.addEndpoint(<span class="string">&quot;cn-hangzhou&quot;</span>, <span class="string">&quot;cn-hangzhou&quot;</span>, product, domain);</span><br><span class="line">		<span class="type">IAcsClient</span> <span class="variable">acsClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultAcsClient</span>(profile);</span><br><span class="line">		<span class="comment">// 组装请求对象</span></span><br><span class="line">		<span class="type">SendSmsRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SendSmsRequest</span>();</span><br><span class="line">		<span class="comment">// 使用post提交</span></span><br><span class="line">		request.setMethod(MethodType.POST);</span><br><span class="line">		<span class="comment">// 必填:待发送手机号。支持以逗号分隔的形式进行批量调用，批量上限为1000个手机号码,批量调用相对于单条调用及时性稍有延迟,验证码类型的短信推荐使用单条调用的方式</span></span><br><span class="line">		request.setPhoneNumbers(phoneNumbers);</span><br><span class="line">		<span class="comment">// 必填:短信签名-可在短信控制台中找到</span></span><br><span class="line">		request.setSignName(<span class="string">&quot;传智健康&quot;</span>);</span><br><span class="line">		<span class="comment">// 必填:短信模板-可在短信控制台中找到</span></span><br><span class="line">		request.setTemplateCode(templateCode);</span><br><span class="line">		<span class="comment">// 可选:模板中的变量替换JSON串,如模板内容为&quot;亲爱的$&#123;name&#125;,您的验证码为$&#123;code&#125;&quot;时,此处的值为</span></span><br><span class="line">		<span class="comment">// 友情提示:如果JSON中需要带换行符,请参照标准的JSON协议对换行符的要求,比如短信内容中包含\r\n的情况在JSON中需要表示成\\r\\n,否则会导致JSON在服务端解析失败</span></span><br><span class="line">		request.setTemplateParam(<span class="string">&quot;&#123;\&quot;code\&quot;:\&quot;&quot;</span>+param+<span class="string">&quot;\&quot;&#125;&quot;</span>);</span><br><span class="line">		<span class="comment">// 可选-上行短信扩展码(扩展码字段控制在7位或以下，无特殊需求用户请忽略此字段)</span></span><br><span class="line">		<span class="comment">// request.setSmsUpExtendCode(&quot;90997&quot;);</span></span><br><span class="line">		<span class="comment">// 可选:outId为提供给业务方扩展字段,最终在短信回执消息中将此值带回给调用者</span></span><br><span class="line">		<span class="comment">// request.setOutId(&quot;yourOutId&quot;);</span></span><br><span class="line">		<span class="comment">// 请求失败这里会抛ClientException异常</span></span><br><span class="line">		<span class="type">SendSmsResponse</span> <span class="variable">sendSmsResponse</span> <span class="operator">=</span> acsClient.getAcsResponse(request);</span><br><span class="line">		<span class="keyword">if</span> (sendSmsResponse.getCode() != <span class="literal">null</span> &amp;&amp; sendSmsResponse.getCode().equals(<span class="string">&quot;OK&quot;</span>)) &#123;</span><br><span class="line">			<span class="comment">// 请求成功</span></span><br><span class="line">			System.out.println(<span class="string">&quot;请求成功&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>RedisMessageConstant常量类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.constant;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisMessageConstant</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SENDTYPE_ORDER</span> <span class="operator">=</span> <span class="string">&quot;001&quot;</span>;<span class="comment">//用于缓存体检预约时发送的验证码</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SENDTYPE_LOGIN</span> <span class="operator">=</span> <span class="string">&quot;002&quot;</span>;<span class="comment">//用于缓存手机号快速登录时发送的验证码</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SENDTYPE_GETPWD</span> <span class="operator">=</span> <span class="string">&quot;003&quot;</span>;<span class="comment">//用于缓存找回密码时发送的验证码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-3-health-mobile"><a href="#2-2-3-health-mobile" class="headerlink" title="2.2.3 health_mobile"></a>2.2.3 health_mobile</h4><p>创建移动端工程health_mobile，打包方式为war，用于存放Controller，在Controller中通过Dubbo可以远程访问服务层相关服务，所以需要依赖health_interface接口工程。</p>
<p>pom.xml：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 </span></span></span><br><span class="line"><span class="string"><span class="tag">                             http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>health_parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itheima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>health_mobile<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>healthmobile_web Maven Webapp<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://www.example.com<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itheima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>health_interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 指定端口 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>80<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 请求路径 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">path</span>&gt;</span>/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>静态资源（CSS、html、img等，详见资料）：</p>
<p><img src="/../../assets/2143930-20210826121024225-1315372073.png" alt="img"></p>
<p>web.xml：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">web-app</span> <span class="keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta"> <span class="string">&quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot;</span></span></span><br><span class="line"><span class="meta"> <span class="string">&quot;http://java.sun.com/dtd/web-app_2_3.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Archetype Created Web Application<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 解决post乱码 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定加载的配置文件 ，通过参数contextConfigLocation加载 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>/pages/index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>springmvc.xml：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:dubbo</span>=<span class="string">&quot;http://code.alibabatech.com/schema/dubbo&quot;</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">		 http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">          http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">          http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">          http://code.alibabatech.com/schema/dubbo</span></span></span><br><span class="line"><span class="string"><span class="tag">          http://code.alibabatech.com/schema/dubbo/dubbo.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">          http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">          http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">mvc:message-converters</span> <span class="attr">register-defaults</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.fastjson.support.spring.FastJsonHttpMessageConverter&quot;</span>&gt;</span></span><br><span class="line">	      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;supportedMediaTypes&quot;</span> <span class="attr">value</span>=<span class="string">&quot;application/json&quot;</span>/&gt;</span></span><br><span class="line">	      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;features&quot;</span>&gt;</span></span><br><span class="line">	        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">	          <span class="tag">&lt;<span class="name">value</span>&gt;</span>WriteMapNullValue<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	          <span class="tag">&lt;<span class="name">value</span>&gt;</span>WriteDateUseDateFormat<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">	      <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;/<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 指定应用名称 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">&quot;health_mobile&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--指定服务注册中心地址--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">&quot;zookeeper://127.0.0.1:2181&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--批量扫描--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dubbo:annotation</span> <span class="attr">package</span>=<span class="string">&quot;com.itheima.controller&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        超时全局设置 10分钟</span></span><br><span class="line"><span class="comment">        check=false 不检查服务提供方，开发阶段建议设置为false</span></span><br><span class="line"><span class="comment">        check=true 启动时检查服务提供方，如果服务提供方没有启动则报错</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dubbo:consumer</span> <span class="attr">timeout</span>=<span class="string">&quot;600000&quot;</span> <span class="attr">check</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;spring-redis.xml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">import</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>spring-redis.xml：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:dubbo</span>=<span class="string">&quot;http://code.alibabatech.com/schema/dubbo&quot;</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">		 http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">          http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">          http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">          http://code.alibabatech.com/schema/dubbo</span></span></span><br><span class="line"><span class="string"><span class="tag">          http://code.alibabatech.com/schema/dubbo/dubbo.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">          http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">          http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">	<span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:redis.properties&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--Jedis连接池的相关配置--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jedisPoolConfig&quot;</span> <span class="attr">class</span>=<span class="string">&quot;redis.clients.jedis.JedisPoolConfig&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxTotal&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>$&#123;redis.pool.maxActive&#125;<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxIdle&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>$&#123;redis.pool.maxIdle&#125;<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;testOnBorrow&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;testOnReturn&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jedisPool&quot;</span> <span class="attr">class</span>=<span class="string">&quot;redis.clients.jedis.JedisPool&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;poolConfig&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;jedisPoolConfig&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;host&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;redis.host&#125;&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;port&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;redis.port&#125;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;int&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;timeout&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;redis.timeout&#125;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;int&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>redis.properties：</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#最大分配的对象数</span></span><br><span class="line"><span class="attr">redis.pool.maxActive</span>=<span class="string">200</span></span><br><span class="line"><span class="comment">#最大能够保持idel状态的对象数</span></span><br><span class="line"><span class="attr">redis.pool.maxIdle</span>=<span class="string">50</span></span><br><span class="line"><span class="attr">redis.pool.minIdle</span>=<span class="string">10</span></span><br><span class="line"><span class="attr">redis.pool.maxWaitMillis</span>=<span class="string">20000</span></span><br><span class="line"><span class="comment">#当池内没有返回对象时，最大等待时间</span></span><br><span class="line"><span class="attr">redis.pool.maxWait</span>=<span class="string">300</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#格式：redis://:[密码]@[服务器地址]:[端口]/[db index]</span></span><br><span class="line"><span class="comment">#redis.uri = redis://:12345@127.0.0.1:6379/0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">redis.host</span> = <span class="string">127.0.0.1</span></span><br><span class="line"><span class="attr">redis.port</span> = <span class="string">6379</span></span><br><span class="line"><span class="attr">redis.timeout</span> = <span class="string">30000</span></span><br></pre></td></tr></table></figure>

<p>log4j.properties：</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">### direct log messages to stdout ###</span></span><br><span class="line"><span class="attr">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.Target</span>=<span class="string">System.err</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%d&#123;ABSOLUTE&#125; %5p %c&#123;1&#125;:%L - %m%n</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">### direct messages to file mylog.log ###</span></span><br><span class="line"><span class="attr">log4j.appender.file</span>=<span class="string">org.apache.log4j.FileAppender</span></span><br><span class="line"><span class="attr">log4j.appender.file.File</span>=<span class="string">c:\\mylog.log</span></span><br><span class="line"><span class="attr">log4j.appender.file.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.file.layout.ConversionPattern</span>=<span class="string">%d&#123;ABSOLUTE&#125; %5p %c&#123;1&#125;:%L - %m%n</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">### set log levels - for more verbose logging change &#x27;info&#x27; to &#x27;debug&#x27; ###</span></span><br><span class="line"></span><br><span class="line"><span class="attr">log4j.rootLogger</span>=<span class="string">info, stdout</span></span><br></pre></td></tr></table></figure>

<h2 id="3-套餐列表页面动态展示"><a href="#3-套餐列表页面动态展示" class="headerlink" title="3. 套餐列表页面动态展示"></a>3. 套餐列表页面动态展示</h2><p>移动端首页为&#x2F;pages&#x2F;index.html，效果如下：</p>
<p><img src="/../../assets/2143930-20210826121037713-1254637614.png" alt="img"></p>
<p>点击体检预约直接跳转到体检套餐列表页面（&#x2F;pages&#x2F;setmeal.html）</p>
<h3 id="3-1-完善页面-4"><a href="#3-1-完善页面-4" class="headerlink" title="3.1 完善页面"></a>3.1 完善页面</h3><h4 id="3-1-1-展示套餐信息"><a href="#3-1-1-展示套餐信息" class="headerlink" title="3.1.1 展示套餐信息"></a>3.1.1 展示套餐信息</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;list-item&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;setmeal in setmealList&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;link-page&quot;</span> <span class="attr">:href</span>=<span class="string">&quot;&#x27;setmeal_detail.html?id=&#x27;+setmeal.id&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;img-object f-left&quot;</span> </span></span><br><span class="line"><span class="tag">           <span class="attr">:src</span>=<span class="string">&quot;&#x27;http://pqjroc654.bkt.clouddn.com/&#x27;+setmeal.img&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item-body&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h4</span> <span class="attr">class</span>=<span class="string">&quot;ellipsis item-title&quot;</span>&gt;</span>&#123;&#123;setmeal.name&#125;&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;ellipsis-more item-desc&quot;</span>&gt;</span>&#123;&#123;setmeal.remark&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;item-keywords&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;setmeal.sex == &#x27;0&#x27; ? &#x27;性别不限&#x27; : setmeal.sex == &#x27;1&#x27; ? &#x27;男&#x27;:&#x27;女&#x27;&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;setmeal.age&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-1-2-获取套餐列表数据"><a href="#3-1-2-获取套餐列表数据" class="headerlink" title="3.1.2 获取套餐列表数据"></a>3.1.2 获取套餐列表数据</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> vue = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>:<span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>:&#123;</span><br><span class="line">    <span class="attr">setmealList</span>:[]</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted ()&#123;</span><br><span class="line">      <span class="comment">//发送ajax请求，获取所有的套餐数据，赋值给setmealList模型数据，用于页面展示</span></span><br><span class="line">      axios.<span class="title function_">get</span>(<span class="string">&quot;/setmeal/getAllSetmeal.do&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">flag</span>)&#123;</span><br><span class="line">              <span class="comment">//查询成功，给模型数据赋值</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">setmealList</span> = res.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">          &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">              <span class="comment">//查询失败，弹出提示信息</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(res.<span class="property">data</span>.<span class="property">message</span>);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="3-2-后台代码-4"><a href="#3-2-后台代码-4" class="headerlink" title="3.2 后台代码"></a>3.2 后台代码</h3><h4 id="3-2-1-Controller-4"><a href="#3-2-1-Controller-4" class="headerlink" title="3.2.1 Controller"></a>3.2.1 Controller</h4><p>在health_mobile工程中创建SetmealController并提供getSetmeal方法，在此方法中通过Dubbo远程调用套餐服务获取套餐列表数据</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Reference;</span><br><span class="line"><span class="keyword">import</span> com.itheima.constant.MessageConstant;</span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.Result;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Setmeal;</span><br><span class="line"><span class="keyword">import</span> com.itheima.service.SetmealService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/setmeal&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetmealController</span> &#123;</span><br><span class="line">    <span class="meta">@Reference</span><span class="comment">//(check = false)</span></span><br><span class="line">    <span class="keyword">private</span> SetmealService setmealService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取所有套餐信息</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/getSetmeal&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">getSetmeal</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            List&lt;Setmeal&gt; list = setmealService.findAll();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>, MessageConstant.GET_SETMEAL_LIST_SUCCESS,list);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>,MessageConstant.GET_SETMEAL_LIST_FAIL);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-服务接口-4"><a href="#3-2-2-服务接口-4" class="headerlink" title="3.2.2 服务接口"></a>3.2.2 服务接口</h4><p>在SetmealService服务接口中扩展findAll方法</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public List&lt;Setmeal&gt; findAll();</span><br></pre></td></tr></table></figure>

<h4 id="3-2-3-服务实现类-4"><a href="#3-2-3-服务实现类-4" class="headerlink" title="3.2.3 服务实现类"></a>3.2.3 服务实现类</h4><p>在SetmealServiceImpl服务实现类中实现findAll方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Setmeal&gt; <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> setmealDao.findAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-4-Dao接口-4"><a href="#3-2-4-Dao接口-4" class="headerlink" title="3.2.4 Dao接口"></a>3.2.4 Dao接口</h4><p>在SetmealDao接口中扩展findAll方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Setmeal&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-5-Mapper映射文件-4"><a href="#3-2-5-Mapper映射文件-4" class="headerlink" title="3.2.5 Mapper映射文件"></a>3.2.5 Mapper映射文件</h4><p>在SetmealDao.xml映射文件中扩展SQL语句</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.pojo.Setmeal&quot;</span>&gt;</span></span><br><span class="line">  select * from t_setmeal</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="4-套餐详情页面动态展示"><a href="#4-套餐详情页面动态展示" class="headerlink" title="4. 套餐详情页面动态展示"></a>4. 套餐详情页面动态展示</h2><p>前面我们已经完成了体检套餐列表页面动态展示，点击其中任意一个套餐则跳转到对应的套餐详情页面（&#x2F;pages&#x2F;setmeal_detail.html），并且会携带此套餐的id作为参数提交。</p>
<p>请求路径格式：<a target="_blank" rel="noopener" href="http://localhost/pages/setmeal_detail.html?id=10">http://localhost/pages/setmeal_detail.html?id=10</a></p>
<p>在套餐详情页面需要展示当前套餐的信息（包括图片、套餐名称、套餐介绍、适用性别、适用年龄）、此套餐包含的检查组信息、检查组包含的检查项信息等。</p>
<h3 id="4-1-完善页面-3"><a href="#4-1-完善页面-3" class="headerlink" title="4.1 完善页面"></a>4.1 完善页面</h3><h4 id="4-1-1-获取请求参数中套餐id"><a href="#4-1-1-获取请求参数中套餐id" class="headerlink" title="4.1.1 获取请求参数中套餐id"></a>4.1.1 获取请求参数中套餐id</h4><p>在页面中已经引入了healthmobile.js文件，此文件中已经封装了getUrlParam方法可以根据URL请求路径中的参数名获取对应的值</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getUrlParam</span>(<span class="params">paraName</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> url = <span class="variable language_">document</span>.<span class="property">location</span>.<span class="title function_">toString</span>();</span><br><span class="line">    <span class="comment">//alert(url);</span></span><br><span class="line">    <span class="keyword">var</span> arrObj = url.<span class="title function_">split</span>(<span class="string">&quot;?&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (arrObj.<span class="property">length</span> &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> arrPara = arrObj[<span class="number">1</span>].<span class="title function_">split</span>(<span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> arr;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arrPara.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            arr = arrPara[i].<span class="title function_">split</span>(<span class="string">&quot;=&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (arr != <span class="literal">null</span> &amp;&amp; arr[<span class="number">0</span>] == paraName) &#123;</span><br><span class="line">                <span class="keyword">return</span> arr[<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在setmeal_detail.html中调用上面定义的方法获取套餐id的值</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">var</span> id = <span class="title function_">getUrlParam</span>(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h4 id="4-1-2-获取套餐详细信息"><a href="#4-1-2-获取套餐详细信息" class="headerlink" title="4.1.2 获取套餐详细信息"></a>4.1.2 获取套餐详细信息</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">var</span> vue = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">        <span class="attr">el</span>:<span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>:&#123;</span><br><span class="line">            <span class="attr">imgUrl</span>:<span class="literal">null</span>,<span class="comment">//套餐对应的图片链接</span></span><br><span class="line">            <span class="attr">setmeal</span>:&#123;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">mounted</span>(<span class="params"></span>)&#123;</span><br><span class="line">            axios.<span class="title function_">post</span>(<span class="string">&quot;/setmeal/findById.do?id=&quot;</span> + id).<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(response.<span class="property">data</span>.<span class="property">flag</span>)&#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">setmeal</span> = response.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">imgUrl</span> = <span class="string">&#x27;http://pqjroc654.bkt.clouddn.com/&#x27;</span> + <span class="variable language_">this</span>.<span class="property">setmeal</span>.<span class="property">img</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h4 id="4-1-3-展示套餐信息"><a href="#4-1-3-展示套餐信息" class="headerlink" title="4.1.3 展示套餐信息"></a>4.1.3 展示套餐信息</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;contentBox&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;project-img&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;imgUrl&quot;</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">height</span>=<span class="string">&quot;100%&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;project-text&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h4</span> <span class="attr">class</span>=<span class="string">&quot;tit&quot;</span>&gt;</span>&#123;&#123;setmeal.name&#125;&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;subtit&quot;</span>&gt;</span>&#123;&#123;setmeal.remark&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;keywords&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;setmeal.sex == &#x27;0&#x27; ? &#x27;性别不限&#x27; : setmeal.sex == &#x27;1&#x27; ? &#x27;男&#x27;:&#x27;女&#x27;&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;setmeal.age&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;table-listbox&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box-title&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;icon-zhen&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;path1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;path2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>套餐详情<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box-table&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;table-title&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tit-item flex2&quot;</span>&gt;</span>项目名称<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tit-item  flex3&quot;</span>&gt;</span>项目内容<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tit-item  flex3&quot;</span>&gt;</span>项目解读<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;table-content&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;table-list&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;table-item&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;checkgroup in setmeal.checkGroups&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item flex2&quot;</span>&gt;</span>&#123;&#123;checkgroup.name&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item flex3&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">label</span> <span class="attr">v-for</span>=<span class="string">&quot;checkitem in checkgroup.checkItems&quot;</span>&gt;</span></span><br><span class="line">                &#123;&#123;checkitem.name&#125;&#125;</span><br><span class="line">              <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item flex3&quot;</span>&gt;</span>&#123;&#123;checkgroup.remark&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box-button&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> @<span class="attr">click</span>=<span class="string">&quot;toOrderInfo()&quot;</span> <span class="attr">class</span>=<span class="string">&quot;order-btn&quot;</span>&gt;</span>立即预约<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-后台代码-3"><a href="#4-2-后台代码-3" class="headerlink" title="4.2 后台代码"></a>4.2 后台代码</h3><h4 id="4-2-1-Controller-3"><a href="#4-2-1-Controller-3" class="headerlink" title="4.2.1 Controller"></a>4.2.1 Controller</h4><p>在SetmealController中提供findById方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//根据id查询套餐信息</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/findById&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">findById</span><span class="params">(<span class="type">int</span> id)</span>&#123;</span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> setmealService.findById(id);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>,MessageConstant.QUERY_SETMEAL_SUCCESS,setmeal);</span><br><span class="line">  &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>,MessageConstant.QUERY_SETMEAL_FAIL);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-2-2-服务接口-3"><a href="#4-2-2-服务接口-3" class="headerlink" title="4.2.2 服务接口"></a>4.2.2 服务接口</h4><p>在SetmealService服务接口中提供findById方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Setmeal <span class="title function_">findById</span><span class="params">(<span class="type">int</span> id)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="4-2-3-服务实现类-3"><a href="#4-2-3-服务实现类-3" class="headerlink" title="4.2.3 服务实现类"></a>4.2.3 服务实现类</h4><p>在SetmealServiceImpl服务实现类中实现findById方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Setmeal <span class="title function_">findById</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> setmealDao.findById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-2-4-Dao接口-3"><a href="#4-2-4-Dao接口-3" class="headerlink" title="4.2.4 Dao接口"></a>4.2.4 Dao接口</h4><p>在SetmealDao接口中提供findById方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Setmeal <span class="title function_">findById</span><span class="params">(<span class="type">int</span> id)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="4-2-5-Mapper映射文件-3"><a href="#4-2-5-Mapper映射文件-3" class="headerlink" title="4.2.5 Mapper映射文件"></a>4.2.5 Mapper映射文件</h4><p>此处会使用mybatis提供的关联查询，在根据id查询套餐时，同时将此套餐包含的检查组都查询出来，并且将检查组包含的检查项都查询出来。</p>
<p>SetmealDao.xml文件：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.itheima.pojo.Setmeal&quot;</span> <span class="attr">id</span>=<span class="string">&quot;baseResultMap&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;code&quot;</span> <span class="attr">property</span>=<span class="string">&quot;code&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;helpCode&quot;</span> <span class="attr">property</span>=<span class="string">&quot;helpCode&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">property</span>=<span class="string">&quot;sex&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;price&quot;</span> <span class="attr">property</span>=<span class="string">&quot;price&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;remark&quot;</span> <span class="attr">property</span>=<span class="string">&quot;remark&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;attention&quot;</span> <span class="attr">property</span>=<span class="string">&quot;attention&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;img&quot;</span> <span class="attr">property</span>=<span class="string">&quot;img&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.itheima.pojo.Setmeal&quot;</span> </span></span><br><span class="line"><span class="tag">           <span class="attr">id</span>=<span class="string">&quot;findByIdResultMap&quot;</span> </span></span><br><span class="line"><span class="tag">           <span class="attr">extends</span>=<span class="string">&quot;baseResultMap&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;checkGroups&quot;</span> </span></span><br><span class="line"><span class="tag">              <span class="attr">javaType</span>=<span class="string">&quot;ArrayList&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">ofType</span>=<span class="string">&quot;com.itheima.pojo.CheckGroup&quot;</span> </span></span><br><span class="line"><span class="tag">              <span class="attr">column</span>=<span class="string">&quot;id&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">select</span>=<span class="string">&quot;com.itheima.dao.CheckGroupDao.findCheckGroupById&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;findByIdResultMap&quot;</span>&gt;</span></span><br><span class="line">  select * from t_setmeal  where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>CheckGroupDao.xml文件：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.itheima.pojo.CheckGroup&quot;</span> <span class="attr">id</span>=<span class="string">&quot;baseResultMap&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;code&quot;</span> <span class="attr">property</span>=<span class="string">&quot;code&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;helpCode&quot;</span> <span class="attr">property</span>=<span class="string">&quot;helpCode&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">property</span>=<span class="string">&quot;sex&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;remark&quot;</span> <span class="attr">property</span>=<span class="string">&quot;remark&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;attention&quot;</span> <span class="attr">property</span>=<span class="string">&quot;attention&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.itheima.pojo.CheckGroup&quot;</span> </span></span><br><span class="line"><span class="tag">           <span class="attr">id</span>=<span class="string">&quot;findByIdResultMap&quot;</span> </span></span><br><span class="line"><span class="tag">           <span class="attr">extends</span>=<span class="string">&quot;baseResultMap&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;checkItems&quot;</span> </span></span><br><span class="line"><span class="tag">              <span class="attr">javaType</span>=<span class="string">&quot;ArrayList&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">ofType</span>=<span class="string">&quot;com.itheima.pojo.CheckItem&quot;</span> </span></span><br><span class="line"><span class="tag">              <span class="attr">column</span>=<span class="string">&quot;id&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">select</span>=<span class="string">&quot;com.itheima.dao.CheckItemDao.findCheckItemById&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--根据套餐id查询检查项信息--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findCheckGroupById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;findByIdResultMap&quot;</span>&gt;</span></span><br><span class="line">  select * from t_checkgroup  </span><br><span class="line">    where id</span><br><span class="line">  	in (select checkgroup_id from t_setmeal_checkgroup where setmeal_id=#&#123;id&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>CheckItemDao.xml文件：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--根据检查组id查询检查项信息--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findCheckItemById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.pojo.CheckItem&quot;</span>&gt;</span></span><br><span class="line">  select * from t_checkitem  </span><br><span class="line">    where id</span><br><span class="line">  	in (select checkitem_id from t_checkgroup_checkitem where checkgroup_id=#&#123;id&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-短信发送"><a href="#5-短信发送" class="headerlink" title="5. 短信发送"></a>5. 短信发送</h2><h3 id="5-1-短信服务介绍"><a href="#5-1-短信服务介绍" class="headerlink" title="5.1 短信服务介绍"></a>5.1 短信服务介绍</h3><p>目前市面上有很多第三方提供的短信服务，这些第三方短信服务会和各个运营商（移动、联通、电信）对接，我们只需要注册成为会员并且按照提供的开发文档进行调用就可以发送短信。需要说明的是这些短信服务都是收费的服务。</p>
<p>本项目短信发送我们选择的是阿里云提供的短信服务。</p>
<p>短信服务（Short Message Service）是阿里云为用户提供的一种通信服务的能力，支持快速发送短信验证码、短信通知等。 三网合一专属通道，与工信部携号转网平台实时互联。电信级运维保障，实时监控自动切换，到达率高达99%。短信服务API提供短信发送、发送状态查询、短信批量发送等能力，在短信服务控制台上添加签名、模板并通过审核之后，可以调用短信服务API完成短信发送等操作。</p>
<h3 id="5-2-注册阿里云账号"><a href="#5-2-注册阿里云账号" class="headerlink" title="5.2 注册阿里云账号"></a>5.2 注册阿里云账号</h3><p>阿里云官网：<a target="_blank" rel="noopener" href="https://www.aliyun.com/">https://www.aliyun.com/</a></p>
<p>点击官网首页免费注册跳转到如下注册页面：</p>
<p><img src="/../../assets/2143930-20210826121103716-746316408.png" alt="img"></p>
<h3 id="5-3-设置短信签名"><a href="#5-3-设置短信签名" class="headerlink" title="5.3 设置短信签名"></a>5.3 设置短信签名</h3><p>注册成功后，点击登录按钮进行登录。登录后进入短信服务管理页面，选择国内消息菜单：</p>
<p><img src="/../../assets/2143930-20210826121113517-1728252678.png" alt="img"></p>
<p>点击添加签名按钮：</p>
<p><img src="/../../assets/2143930-20210826121120607-899392780.png" alt="img"></p>
<p>目前个人用户只能申请适用场景为验证码的签名</p>
<h3 id="5-4-设置短信模板"><a href="#5-4-设置短信模板" class="headerlink" title="5.4 设置短信模板"></a>5.4 设置短信模板</h3><p>在国内消息菜单页面中，点击模板管理标签页：</p>
<p><img src="/../../assets/2143930-20210826121130077-2115665530.png" alt="img"></p>
<p>点击添加模板按钮：</p>
<p><img src="/../../assets/2143930-20210826121137219-355293852.png" alt="img"></p>
<h3 id="5-5-设置access-keys"><a href="#5-5-设置access-keys" class="headerlink" title="5.5 设置access keys"></a>5.5 设置access keys</h3><p>在发送短信时需要进行身份认证，只有认证通过才能发送短信。本小节就是要设置用于发送短信时进行身份认证的key和密钥。鼠标放在页面右上角当前用户头像上，会出现下拉菜单：</p>
<p><img src="/../../assets/2143930-20210826121144716-1099846315.png" alt="img"></p>
<p>点击accesskeys：</p>
<p><img src="/../../assets/2143930-20210826121155518-624283398.png" alt="img"></p>
<p>点击开始使用子用户AccessKey按钮：</p>
<p><img src="/../../assets/2143930-20210826121204468-1970097683.png" alt="img"></p>
<p><img src="/../../assets/2143930-20210826121214257-1397436018.png" alt="img"></p>
<p><img src="/../../assets/2143930-20210826121220891-1217659523.png" alt="img"></p>
<p><img src="/../../assets/2143930-20210826121227815-805698344.png" alt="img"></p>
<p>创建成功，其中AccessKeyID为访问短信服务时使用的ID，AccessKeySecret为密钥。</p>
<p>可以在用户详情页面下禁用刚刚创建的AccessKey：</p>
<p><img src="/../../assets/2143930-20210826121235016-1253599395.png" alt="img"></p>
<p>可以设置每日和每月短信发送上限：</p>
<p><img src="/../../assets/2143930-20210826121241437-13481678.png" alt="img"></p>
<p>由于短信服务是收费服务，所以还需要进行充值才能发送短信：</p>
<p><img src="/../../assets/2143930-20210826121247431-1261848585.png" alt="img"></p>
<h3 id="5-6-发送短信"><a href="#5-6-发送短信" class="headerlink" title="5.6 发送短信"></a>5.6 发送短信</h3><h4 id="5-6-1-导入maven坐标"><a href="#5-6-1-导入maven坐标" class="headerlink" title="5.6.1 导入maven坐标"></a>5.6.1 导入maven坐标</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-dysmsapi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="5-6-2-封装工具类"><a href="#5-6-2-封装工具类" class="headerlink" title="5.6.2 封装工具类"></a>5.6.2 封装工具类</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.DefaultAcsClient;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.IAcsClient;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.dysmsapi.model.v20170525.SendSmsRequest;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.dysmsapi.model.v20170525.SendSmsResponse;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.exceptions.ClientException;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.http.MethodType;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.profile.DefaultProfile;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.profile.IClientProfile;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 短信发送工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SMSUtils</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">VALIDATE_CODE</span> <span class="operator">=</span> <span class="string">&quot;SMS_159620392&quot;</span>;<span class="comment">//发送短信验证码</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ORDER_NOTICE</span> <span class="operator">=</span> <span class="string">&quot;SMS_159771588&quot;</span>;<span class="comment">//体检预约成功通知</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 发送短信</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> phoneNumbers</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> param</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> ClientException</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sendShortMessage</span><span class="params">(String templateCode,String phoneNumbers,String param)</span> <span class="keyword">throws</span> ClientException&#123;</span><br><span class="line">		<span class="comment">// 设置超时时间-可自行调整</span></span><br><span class="line">		System.setProperty(<span class="string">&quot;sun.net.client.defaultConnectTimeout&quot;</span>, <span class="string">&quot;10000&quot;</span>);</span><br><span class="line">		System.setProperty(<span class="string">&quot;sun.net.client.defaultReadTimeout&quot;</span>, <span class="string">&quot;10000&quot;</span>);</span><br><span class="line">		<span class="comment">// 初始化ascClient需要的几个参数</span></span><br><span class="line">		<span class="keyword">final</span> <span class="type">String</span> <span class="variable">product</span> <span class="operator">=</span> <span class="string">&quot;Dysmsapi&quot;</span>;<span class="comment">// 短信API产品名称（短信产品名固定，无需修改）</span></span><br><span class="line">		<span class="keyword">final</span> <span class="type">String</span> <span class="variable">domain</span> <span class="operator">=</span> <span class="string">&quot;dysmsapi.aliyuncs.com&quot;</span>;<span class="comment">// 短信API产品域名（接口地址固定，无需修改）</span></span><br><span class="line">		<span class="comment">// 替换成你的AK</span></span><br><span class="line">		<span class="keyword">final</span> <span class="type">String</span> <span class="variable">accessKeyId</span> <span class="operator">=</span> <span class="string">&quot;accessKeyId&quot;</span>;<span class="comment">// 你的accessKeyId,参考本文档步骤2</span></span><br><span class="line">		<span class="keyword">final</span> <span class="type">String</span> <span class="variable">accessKeySecret</span> <span class="operator">=</span> <span class="string">&quot;accessKeySecret&quot;</span>;<span class="comment">// 你的accessKeySecret，参考本文档步骤2</span></span><br><span class="line">		<span class="comment">// 初始化ascClient,暂时不支持多region（请勿修改）</span></span><br><span class="line">		<span class="type">IClientProfile</span> <span class="variable">profile</span> <span class="operator">=</span> DefaultProfile.getProfile(<span class="string">&quot;cn-hangzhou&quot;</span>, accessKeyId, accessKeySecret);</span><br><span class="line">		DefaultProfile.addEndpoint(<span class="string">&quot;cn-hangzhou&quot;</span>, <span class="string">&quot;cn-hangzhou&quot;</span>, product, domain);</span><br><span class="line">		<span class="type">IAcsClient</span> <span class="variable">acsClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultAcsClient</span>(profile);</span><br><span class="line">		<span class="comment">// 组装请求对象</span></span><br><span class="line">		<span class="type">SendSmsRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SendSmsRequest</span>();</span><br><span class="line">		<span class="comment">// 使用post提交</span></span><br><span class="line">		request.setMethod(MethodType.POST);</span><br><span class="line">		<span class="comment">// 必填:待发送手机号。支持以逗号分隔的形式进行批量调用，批量上限为1000个手机号码,批量调用相对于单条调用及时性稍有延迟,验证码类型的短信推荐使用单条调用的方式</span></span><br><span class="line">		request.setPhoneNumbers(phoneNumbers);</span><br><span class="line">		<span class="comment">// 必填:短信签名-可在短信控制台中找到</span></span><br><span class="line">		request.setSignName(<span class="string">&quot;传智健康&quot;</span>);</span><br><span class="line">		<span class="comment">// 必填:短信模板-可在短信控制台中找到</span></span><br><span class="line">		request.setTemplateCode(templateCode);</span><br><span class="line">		<span class="comment">// 可选:模板中的变量替换JSON串,如模板内容为&quot;亲爱的$&#123;name&#125;,您的验证码为$&#123;code&#125;&quot;时,此处的值为</span></span><br><span class="line">		<span class="comment">// 友情提示:如果JSON中需要带换行符,请参照标准的JSON协议对换行符的要求,比如短信内容中包含\r\n的情况在JSON中需要表示成\\r\\n,否则会导致JSON在服务端解析失败</span></span><br><span class="line">		request.setTemplateParam(<span class="string">&quot;&#123;\&quot;code\&quot;:\&quot;&quot;</span>+param+<span class="string">&quot;\&quot;&#125;&quot;</span>);</span><br><span class="line">		<span class="comment">// 可选-上行短信扩展码(扩展码字段控制在7位或以下，无特殊需求用户请忽略此字段)</span></span><br><span class="line">		<span class="comment">// request.setSmsUpExtendCode(&quot;90997&quot;);</span></span><br><span class="line">		<span class="comment">// 可选:outId为提供给业务方扩展字段,最终在短信回执消息中将此值带回给调用者</span></span><br><span class="line">		<span class="comment">// request.setOutId(&quot;yourOutId&quot;);</span></span><br><span class="line">		<span class="comment">// 请求失败这里会抛ClientException异常</span></span><br><span class="line">		<span class="type">SendSmsResponse</span> <span class="variable">sendSmsResponse</span> <span class="operator">=</span> acsClient.getAcsResponse(request);</span><br><span class="line">		<span class="keyword">if</span> (sendSmsResponse.getCode() != <span class="literal">null</span> &amp;&amp; sendSmsResponse.getCode().equals(<span class="string">&quot;OK&quot;</span>)) &#123;</span><br><span class="line">			<span class="comment">// 请求成功</span></span><br><span class="line">			System.out.println(<span class="string">&quot;请求成功&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-6-3-测试短信发送"><a href="#5-6-3-测试短信发送" class="headerlink" title="5.6.3 测试短信发送"></a>5.6.3 测试短信发送</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span><span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		SMSUtils.sendShortMessage(<span class="string">&quot;SMS_159620392&quot;</span>,<span class="string">&quot;13812345678&quot;</span>,<span class="string">&quot;1234&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="第7章-页面静态化"><a href="#第7章-页面静态化" class="headerlink" title="第7章 页面静态化"></a>第7章 页面静态化</h1><h2 id="1-页面静态化介绍"><a href="#1-页面静态化介绍" class="headerlink" title="1. 页面静态化介绍"></a>1. 页面静态化介绍</h2><p>本章课程中我们已经实现了移动端套餐列表页面和套餐详情页面的动态展示。但是我们需要思考一个问题，就是对于这两个页面来说，每次用户访问这两个页面都需要查询数据库获取动态数据进行展示，而且这两个页面的访问量是比较大的，这就对数据库造成了很大的访问压力，并且数据库中的数据变化频率并不高。那我们需要通过什么方法为数据库减压并提高系统运行性能呢？答案就是页面静态化。</p>
<p>页面静态化其实就是将原来的动态网页(例如通过ajax请求动态获取数据库中的数据并展示的网页)改为通过静态化技术生成的静态网页，这样用户在访问网页时，服务器直接给用户响应静态html页面，没有了动态查询数据库的过程。</p>
<p>那么这些静态HTML页面还需要我们自己去编写吗？其实并不需要，我们可以通过专门的页面静态化技术帮我们生成所需的静态HTML页面，例如：Freemarker、thymeleaf等。</p>
<h2 id="2-Freemarker介绍"><a href="#2-Freemarker介绍" class="headerlink" title="2. Freemarker介绍"></a>2. Freemarker介绍</h2><p>FreeMarker 是一个用 Java 语言编写的模板引擎，它基于模板来生成文本输出。FreeMarker与 Web 容器无关，即在 Web 运行时，它并不知道 Servlet 或 HTTP。它不仅可以用作表现层的实现技术，而且还可以用于生成 XML，JSP 或 Java 等。</p>
<p><img src="/../../assets/2143930-20210826121519148-1081717292.png" alt="img"></p>
<h2 id="3-Freemarker入门案例"><a href="#3-Freemarker入门案例" class="headerlink" title="3. Freemarker入门案例"></a>3. Freemarker入门案例</h2><h3 id="3-1-环境搭建"><a href="#3-1-环境搭建" class="headerlink" title="3.1 环境搭建"></a>3.1 环境搭建</h3><p>创建maven工程并导入Freemarker的maven坐标</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.freemarker<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>freemarker<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.23<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-创建模板文件"><a href="#3-2-创建模板文件" class="headerlink" title="3.2 创建模板文件"></a>3.2 创建模板文件</h3><p>模板文件中有四种元素：</p>
<p>1、文本，直接输出的部分<br>2、注释，即&lt;#–…–&gt;格式不会输出<br>3、插值（Interpolation）：即${..}部分,将使用数据模型中的部分替代输出<br>4、FTL指令：FreeMarker指令，和HTML标记类似，名字前加#予以区分，不会输出</p>
<p>Freemarker的模板文件后缀可以任意，一般建议为ftl。</p>
<p>在D盘创建ftl目录，在ftl目录中创建名称为test.ftl的模板文件，内容如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>Freemarker入门<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    &lt;#--我只是一个注释，我不会有任何输出  --&gt;</span><br><span class="line">    $&#123;name&#125;你好，$&#123;message&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-生成文件"><a href="#3-3-生成文件" class="headerlink" title="3.3 生成文件"></a>3.3 生成文件</h3><p>使用步骤：</p>
<p>第一步：创建一个 Configuration 对象，直接 new 一个对象。构造方法的参数就是 freemarker的版本号。</p>
<p>第二步：设置模板文件所在的路径。</p>
<p>第三步：设置模板文件使用的字符集。一般就是 utf-8。</p>
<p>第四步：加载一个模板，创建一个模板对象。</p>
<p>第五步：创建一个模板使用的数据集，可以是 pojo 也可以是 map。一般是 Map。</p>
<p>第六步：创建一个 Writer 对象，一般创建 FileWriter 对象，指定生成的文件名。</p>
<p>第七步：调用模板对象的 process 方法输出文件。</p>
<p>第八步：关闭流。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">	<span class="comment">//1.创建配置类</span></span><br><span class="line">	Configuration configuration=<span class="keyword">new</span> <span class="title class_">Configuration</span>(Configuration.getVersion());</span><br><span class="line">	<span class="comment">//2.设置模板所在的目录 </span></span><br><span class="line">	configuration.setDirectoryForTemplateLoading(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\ftl&quot;</span>));</span><br><span class="line">	<span class="comment">//3.设置字符集</span></span><br><span class="line">	configuration.setDefaultEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">	<span class="comment">//4.加载模板</span></span><br><span class="line">	<span class="type">Template</span> <span class="variable">template</span> <span class="operator">=</span> configuration.getTemplate(<span class="string">&quot;test.ftl&quot;</span>);</span><br><span class="line">	<span class="comment">//5.创建数据模型</span></span><br><span class="line">	Map map=<span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">	map.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;张三&quot;</span>);</span><br><span class="line">	map.put(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;欢迎来到传智播客！&quot;</span>);</span><br><span class="line">	<span class="comment">//6.创建Writer对象</span></span><br><span class="line">	<span class="type">Writer</span> <span class="variable">out</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;d:\\test.html&quot;</span>));</span><br><span class="line">	<span class="comment">//7.输出</span></span><br><span class="line">	template.process(map, out);</span><br><span class="line">	<span class="comment">//8.关闭Writer对象</span></span><br><span class="line">	out.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的入门案例中Configuration配置对象是自己创建的，字符集和模板文件所在目录也是在Java代码中指定的。在项目中应用时可以将Configuration对象的创建交由Spring框架来完成，并通过依赖注入方式将字符集和模板所在目录注入进去。</p>
<h2 id="4-Freemarker指令"><a href="#4-Freemarker指令" class="headerlink" title="4. Freemarker指令"></a>4. Freemarker指令</h2><h3 id="4-1-assign指令"><a href="#4-1-assign指令" class="headerlink" title="4.1 assign指令"></a>4.1 assign指令</h3><p>assign指令用于在页面上定义一个变量</p>
<p>（1）定义简单类型</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;#assign linkman=&quot;周先生&quot;&gt;</span><br><span class="line">联系人：$&#123;linkman&#125;</span><br></pre></td></tr></table></figure>

<p>（2）定义对象类型</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;#assign info=&#123;&quot;mobile&quot;:&quot;13812345678&quot;,&#x27;address&#x27;:&#x27;北京市昌平区&#x27;&#125; &gt;</span><br><span class="line">电话：$&#123;info.mobile&#125;  地址：$&#123;info.address&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-include指令"><a href="#4-2-include指令" class="headerlink" title="4.2 include指令"></a>4.2 include指令</h3><p>include指令用于模板文件的嵌套</p>
<p>（1）创建模板文件head.ftl</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>黑马程序员<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（2）修改入门案例中的test.ftl，在test.ftl模板文件中使用include指令引入上面的模板文件</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;#include &quot;head.ftl&quot;/&gt;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-if指令"><a href="#4-3-if指令" class="headerlink" title="4.3 if指令"></a>4.3 if指令</h3><p>if指令用于判断</p>
<p>（1）在模板文件中使用if指令进行判断</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;#if success=true&gt;</span><br><span class="line">  你已通过实名认证</span><br><span class="line">&lt;#else&gt;  </span><br><span class="line">  你未通过实名认证</span><br><span class="line">&lt;/#if&gt;</span><br></pre></td></tr></table></figure>

<p>（2）在java代码中为success变量赋值</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">map.put(<span class="string">&quot;success&quot;</span>, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<p>在freemarker的判断中，可以使用&#x3D; 也可以使用&#x3D;&#x3D;</p>
<h3 id="4-4-list指令"><a href="#4-4-list指令" class="headerlink" title="4.4 list指令"></a>4.4 list指令</h3><p>list指令用于遍历</p>
<p>（1）在模板文件中使用list指令进行遍历</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;#list goodsList as goods&gt;</span><br><span class="line">  商品名称： $&#123;goods.name&#125; 价格：$&#123;goods.price&#125;<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">&lt;/#list&gt;</span><br></pre></td></tr></table></figure>

<p>（2）在java代码中为goodsList赋值</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List goodsList=<span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line"></span><br><span class="line">Map goods1=<span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">goods1.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;苹果&quot;</span>);</span><br><span class="line">goods1.put(<span class="string">&quot;price&quot;</span>, <span class="number">5.8</span>);</span><br><span class="line"></span><br><span class="line">Map goods2=<span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">goods2.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;香蕉&quot;</span>);</span><br><span class="line">goods2.put(<span class="string">&quot;price&quot;</span>, <span class="number">2.5</span>);</span><br><span class="line"></span><br><span class="line">Map goods3=<span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">goods3.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;橘子&quot;</span>);</span><br><span class="line">goods3.put(<span class="string">&quot;price&quot;</span>, <span class="number">3.2</span>);</span><br><span class="line"></span><br><span class="line">goodsList.add(goods1);</span><br><span class="line">goodsList.add(goods2);</span><br><span class="line">goodsList.add(goods3);</span><br><span class="line"></span><br><span class="line">map.put(<span class="string">&quot;goodsList&quot;</span>, goodsList);</span><br></pre></td></tr></table></figure>

<h2 id="5-生成移动端静态页面"><a href="#5-生成移动端静态页面" class="headerlink" title="5. 生成移动端静态页面"></a>5. 生成移动端静态页面</h2><p>前面我们已经学习了Freemarker的基本使用方法，下面我们就可以将Freemarker应用到项目中，帮我们生成移动端套餐列表静态页面和套餐详情静态页面。接下来我们需要思考几个问题：</p>
<p>（1）什么时候生成静态页面比较合适呢？</p>
<p>（2）将静态页面生成到什么位置呢？</p>
<p>（3）应该生成几个静态页面呢？</p>
<p>对于第一个问题，应该是当套餐数据发生改变时，需要生成静态页面，即我们通过后台系统修改套餐数据（包括新增、删除、编辑）时。</p>
<p>对于第二个问题，如果是在开发阶段可以将文件生成到项目工程中，如果上线后可以将文件生成到移动端系统运行的tomcat中。</p>
<p>对于第三个问题，套餐列表只需要一个页面就可以了，在这个页面中展示所有的套餐列表数据即可。套餐详情页面需要有多个，即一个套餐应该对应一个静态页面。</p>
<h3 id="5-1-环境搭建"><a href="#5-1-环境搭建" class="headerlink" title="5.1 环境搭建"></a>5.1 环境搭建</h3><p>在health_common工程的pom文件中导入Freemarker的maven坐标</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.freemarker<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>freemarker<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.23<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="5-2-创建模板文件"><a href="#5-2-创建模板文件" class="headerlink" title="5.2 创建模板文件"></a>5.2 创建模板文件</h3><p>在health_service_provider工程的WEB-INF目录中创建ftl目录，在ftl目录中创建模板文件mobile_setmeal.ftl和mobile_setmeal_detail.ftl文件，前者是用于生成套餐列表页面的模板文件，后者是生成套餐详情页面的模板文件</p>
<p>（1）mobile_setmeal.ftl</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0,user-scalable=no,minimal-ui&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;description&quot;</span> <span class="attr">content</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;author&quot;</span> <span class="attr">content</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;../img/asset-favico.ico&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>预约<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;../css/page-health-order.css&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">data-spy</span>=<span class="string">&quot;scroll&quot;</span> <span class="attr">data-target</span>=<span class="string">&quot;#myNavbar&quot;</span> <span class="attr">data-offset</span>=<span class="string">&quot;150&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;app&quot;</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 页面头部 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;top-header&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;f-left&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;icon-back&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;history.go(-1)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;center&quot;</span>&gt;</span>传智健康<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;f-right&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;icon-more&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 页面内容 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;contentBox&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;list-column1&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">                &lt;#list setmealList as setmeal&gt;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;list-item&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;link-page&quot;</span> <span class="attr">href</span>=<span class="string">&quot;setmeal_detail_$&#123;setmeal.id&#125;.html&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;img-object f-left&quot;</span> </span></span><br><span class="line"><span class="tag">                                 <span class="attr">src</span>=<span class="string">&quot;http://puco9aur6.bkt.clouddn.com/$&#123;setmeal.img&#125;&quot;</span> </span></span><br><span class="line"><span class="tag">                                 <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item-body&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">h4</span> <span class="attr">class</span>=<span class="string">&quot;ellipsis item-title&quot;</span>&gt;</span>$&#123;setmeal.name&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;ellipsis-more item-desc&quot;</span>&gt;</span>$&#123;setmeal.remark&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;item-keywords&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">                                        &lt;#if setmeal.sex == &#x27;0&#x27;&gt;</span><br><span class="line">                                            性别不限</span><br><span class="line">                                            &lt;#else&gt;</span><br><span class="line">                                                &lt;#if setmeal.sex == &#x27;1&#x27;&gt;</span><br><span class="line">                                                男</span><br><span class="line">                                                &lt;#else&gt;</span><br><span class="line">                                                女</span><br><span class="line">                                                &lt;/#if&gt;</span><br><span class="line">                                        &lt;/#if&gt;</span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">span</span>&gt;</span>$&#123;setmeal.age&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                &lt;/#list&gt;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 页面 css js --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../plugins/vue/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../plugins/vue/axios-0.18.0.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意上面模板文件中每个套餐对应的超链接如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;link-page&quot;</span> <span class="attr">href</span>=<span class="string">&quot;setmeal_detail_$&#123;setmeal.id&#125;.html&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以看到，链接的地址是动态构成的，如果套餐的id为1，则对应的超链接地址为setmeal_detail_1.html；如果套餐的id为5，则对应的超链接地址为setmeal_detail_5.html。所以我们需要为每个套餐生成一个套餐详情静态页面。</p>
<p>（2）mobile_setmeal_detail.ftl</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0,user-scalable=no,minimal-ui&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;description&quot;</span> <span class="attr">content</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;author&quot;</span> <span class="attr">content</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;../img/asset-favico.ico&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>预约详情<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;../css/page-health-orderDetail.css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../plugins/vue/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../plugins/vue/axios-0.18.0.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../plugins/healthmobile.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">data-spy</span>=<span class="string">&quot;scroll&quot;</span> <span class="attr">data-target</span>=<span class="string">&quot;#myNavbar&quot;</span> <span class="attr">data-offset</span>=<span class="string">&quot;150&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span> <span class="attr">class</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 页面头部 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;top-header&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;f-left&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;icon-back&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;history.go(-1)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;center&quot;</span>&gt;</span>传智健康<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;f-right&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;icon-more&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 页面内容 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;contentBox&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;project-img&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;http://puco9aur6.bkt.clouddn.com/$&#123;setmeal.img&#125;&quot;</span> </span></span><br><span class="line"><span class="tag">                     <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">height</span>=<span class="string">&quot;100%&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;project-text&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h4</span> <span class="attr">class</span>=<span class="string">&quot;tit&quot;</span>&gt;</span>$&#123;setmeal.name&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;subtit&quot;</span>&gt;</span>$&#123;setmeal.remark&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;keywords&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">						&lt;#if setmeal.sex == &#x27;0&#x27;&gt;</span><br><span class="line">							性别不限</span><br><span class="line">							&lt;#else&gt;</span><br><span class="line">								&lt;#if setmeal.sex == &#x27;1&#x27;&gt;</span><br><span class="line">								男</span><br><span class="line">								&lt;#else&gt;</span><br><span class="line">								女</span><br><span class="line">								&lt;/#if&gt;</span><br><span class="line">						&lt;/#if&gt;</span><br><span class="line">					<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">span</span>&gt;</span>$&#123;setmeal.age&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;table-listbox&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box-title&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;icon-zhen&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;path1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;path2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span>&gt;</span>套餐详情<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box-table&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;table-title&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tit-item flex2&quot;</span>&gt;</span>项目名称<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tit-item  flex3&quot;</span>&gt;</span>项目内容<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tit-item  flex3&quot;</span>&gt;</span>项目解读<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;table-content&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;table-list&quot;</span>&gt;</span></span><br><span class="line">						&lt;#list setmeal.checkGroups as checkgroup&gt;</span><br><span class="line">							<span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;table-item&quot;</span>&gt;</span></span><br><span class="line">								<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item flex2&quot;</span>&gt;</span>$&#123;checkgroup.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">								<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item flex3&quot;</span>&gt;</span></span><br><span class="line">									&lt;#list checkgroup.checkItems as checkitem&gt;</span><br><span class="line">										<span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">											$&#123;checkitem.name&#125;</span><br><span class="line">										<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">									&lt;/#list&gt;</span><br><span class="line">								<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">								<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item flex3&quot;</span>&gt;</span>$&#123;checkgroup.remark&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">						&lt;/#list&gt;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box-button&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> @<span class="attr">click</span>=<span class="string">&quot;toOrderInfo()&quot;</span> <span class="attr">class</span>=<span class="string">&quot;order-btn&quot;</span>&gt;</span>立即预约<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> vue = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>:<span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">toOrderInfo</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&quot;orderInfo.html?id=$&#123;setmeal.id&#125;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="5-3-配置文件"><a href="#5-3-配置文件" class="headerlink" title="5.3 配置文件"></a>5.3 配置文件</h3><p>（1）在health_service_provider工程中创建属性文件freemarker.properties</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">out_put_path=D:/ideaProjects/health_parent/health_mobile/src/main/webapp/pages</span><br></pre></td></tr></table></figure>

<p>通过上面的配置可以指定将静态HTML页面生成的目录位置</p>
<p>（2）在health_service_provider工程的Spring配置文件中配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;freemarkerConfig&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--指定模板文件所在目录--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;templateLoaderPath&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/ftl/&quot;</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--指定字符集--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultEncoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:freemarker.properties&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="5-4-生成静态页面"><a href="#5-4-生成静态页面" class="headerlink" title="5.4 生成静态页面"></a>5.4 生成静态页面</h3><p>修改health_service_provider工程中的SetmealServiceImpl类的add方法，加入生成静态页面的逻辑。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service(interfaceClass = SetmealService.class)</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetmealServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SetmealService</span> &#123;</span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> FreeMarkerConfigurer freeMarkerConfigurer;</span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> SetmealDao setmealDao;</span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> JedisPool jedisPool;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Value(&quot;$&#123;out_put_path&#125;&quot;)</span><span class="comment">//从属性文件读取输出目录的路径</span></span><br><span class="line">  <span class="keyword">private</span> String outputpath ;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//新增套餐，同时关联检查组</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Setmeal setmeal, Integer[] checkgroupIds)</span> &#123;</span><br><span class="line">    setmealDao.add(setmeal);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">setmealId</span> <span class="operator">=</span> setmeal.getId();<span class="comment">//获取套餐id</span></span><br><span class="line">    <span class="built_in">this</span>.setSetmealAndCheckGroup(setmealId,checkgroupIds);</span><br><span class="line">    <span class="comment">//完成数据库操作后需要将图片名称保存到redis</span></span><br><span class="line">    jedisPool.getResource().sadd(RedisConstant.SETMEAL_PIC_DB_RESOURCES,setmeal.getImg());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//新增套餐后需要重新生成静态页面</span></span><br><span class="line">    generateMobileStaticHtml();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//生成静态页面</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">generateMobileStaticHtml</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//准备模板文件中所需的数据</span></span><br><span class="line">    List&lt;Setmeal&gt; setmealList = <span class="built_in">this</span>.findAll();</span><br><span class="line">    <span class="comment">//生成套餐列表静态页面</span></span><br><span class="line">    generateMobileSetmealListHtml(setmealList);</span><br><span class="line">    <span class="comment">//生成套餐详情静态页面（多个）</span></span><br><span class="line">    generateMobileSetmealDetailHtml(setmealList);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//生成套餐列表静态页面</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">generateMobileSetmealListHtml</span><span class="params">(List&lt;Setmeal&gt; setmealList)</span> &#123;</span><br><span class="line">    Map&lt;String, Object&gt; dataMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;();</span><br><span class="line">    dataMap.put(<span class="string">&quot;setmealList&quot;</span>, setmealList);</span><br><span class="line">    <span class="built_in">this</span>.generateHtml(<span class="string">&quot;mobile_setmeal.ftl&quot;</span>,<span class="string">&quot;m_setmeal.html&quot;</span>,dataMap);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//生成套餐详情静态页面（多个）</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">generateMobileSetmealDetailHtml</span><span class="params">(List&lt;Setmeal&gt; setmealList)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (Setmeal setmeal : setmealList) &#123;</span><br><span class="line">      Map&lt;String, Object&gt; dataMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;();</span><br><span class="line">      dataMap.put(<span class="string">&quot;setmeal&quot;</span>, <span class="built_in">this</span>.findById(setmeal.getId()));</span><br><span class="line">      <span class="built_in">this</span>.generateHtml(<span class="string">&quot;mobile_setmeal_detail.ftl&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;setmeal_detail_&quot;</span>+setmeal.getId()+<span class="string">&quot;.html&quot;</span>,</span><br><span class="line">                        dataMap);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">generateHtml</span><span class="params">(String templateName,String htmlPageName,Map&lt;String, Object&gt; dataMap)</span>&#123;</span><br><span class="line">    <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> freeMarkerConfigurer.getConfiguration();</span><br><span class="line">    <span class="type">Writer</span> <span class="variable">out</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// 加载模版文件</span></span><br><span class="line">      <span class="type">Template</span> <span class="variable">template</span> <span class="operator">=</span> configuration.getTemplate(templateName);</span><br><span class="line">      <span class="comment">// 生成数据</span></span><br><span class="line">      <span class="type">File</span> <span class="variable">docFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(outputpath + <span class="string">&quot;\\&quot;</span> + htmlPageName);</span><br><span class="line">      out = <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(<span class="keyword">new</span> <span class="title class_">OutputStreamWriter</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(docFile)));</span><br><span class="line">      <span class="comment">// 输出文件</span></span><br><span class="line">      template.process(dataMap, out);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != out) &#123;</span><br><span class="line">          out.flush();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e2) &#123;</span><br><span class="line">        e2.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过上面代码可以看到，我们生成的套餐列表页面名称为m_setmeal.html，为了能够在移动端访问到此页面，需要将移动端工程中的&#x2F;pages&#x2F;index.html页面的超链接地址进行修改：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/pages/m_setmeal.html&quot;</span> <span class="attr">class</span>=<span class="string">&quot;link-page&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;type-title&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>体检预约<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>实时预约<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;type-icon&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;icon-zhen&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;path1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;path2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="第8章-移动端开发-体检预约"><a href="#第8章-移动端开发-体检预约" class="headerlink" title="第8章 移动端开发-体检预约"></a>第8章 移动端开发-体检预约</h1><h2 id="1-体检预约流程"><a href="#1-体检预约流程" class="headerlink" title="1. 体检预约流程"></a>1. 体检预约流程</h2><p>用户可以通过如下操作流程进行体检预约：</p>
<p>1、在移动端首页点击体检预约，页面跳转到套餐列表页面</p>
<p>2、在套餐列表页面点击要预约的套餐，页面跳转到套餐详情页面</p>
<p>3、在套餐详情页面点击立即预约，页面跳转到预约页面</p>
<p>4、在预约页面录入体检人信息，包括手机号，点击发送验证码</p>
<p>5、在预约页面录入收到的手机短信验证码，点击提交预约，完成体检预约</p>
<h2 id="2-体检预约"><a href="#2-体检预约" class="headerlink" title="2. 体检预约"></a>2. 体检预约</h2><h3 id="2-1-页面调整"><a href="#2-1-页面调整" class="headerlink" title="2.1 页面调整"></a>2.1 页面调整</h3><p>在预约页面（&#x2F;pages&#x2F;orderInfo.html）进行调整</p>
<h4 id="2-1-1-展示预约的套餐信息"><a href="#2-1-1-展示预约的套餐信息" class="headerlink" title="2.1.1 展示预约的套餐信息"></a>2.1.1 展示预约的套餐信息</h4><p>第一步：从请求路径中获取当前套餐的id</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">var</span> id = <span class="title function_">getUrlParam</span>(<span class="string">&quot;id&quot;</span>);<span class="comment">//套餐id</span></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>第二步：定义模型数据setmeal，用于套餐数据展示</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> vue = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>:<span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>:&#123;</span><br><span class="line">    <span class="attr">setmeal</span>:&#123;&#125;,<span class="comment">//套餐信息</span></span><br><span class="line">    <span class="attr">orderInfo</span>:&#123;</span><br><span class="line">      <span class="attr">setmealId</span>:id,</span><br><span class="line">      <span class="attr">sex</span>:<span class="string">&#x27;1&#x27;</span></span><br><span class="line">    &#125;<span class="comment">//预约信息</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;&#x27;http://pqjroc654.bkt.clouddn.com/&#x27;+setmeal.img&quot;</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">height</span>=<span class="string">&quot;100%&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;project-text&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h4</span> <span class="attr">class</span>=<span class="string">&quot;tit&quot;</span>&gt;</span>&#123;&#123;setmeal.name&#125;&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;subtit&quot;</span>&gt;</span>&#123;&#123;setmeal.remark&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;keywords&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;setmeal.sex == &#x27;0&#x27; ? &#x27;性别不限&#x27; : setmeal.sex == &#x27;1&#x27; ? &#x27;男&#x27;:&#x27;女&#x27;&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;setmeal.age&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;project-know&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;orderNotice.html&quot;</span> <span class="attr">class</span>=<span class="string">&quot;link-page&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;icon-ask-circle&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;path1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;path2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;word&quot;</span>&gt;</span>预约须知<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;arrow&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;icon-rit-arrow&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>第三步：在VUE的钩子函数中发送ajax请求，根据id查询套餐信息</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">mounted</span>(<span class="params"></span>)&#123;</span><br><span class="line">  axios.<span class="title function_">post</span>(<span class="string">&quot;/setmeal/findById.do?id=&quot;</span> + id).<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">setmeal</span> = response.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-1-2-手机号校验"><a href="#2-1-2-手机号校验" class="headerlink" title="2.1.2 手机号校验"></a>2.1.2 手机号校验</h4><p>第一步：在页面导入的healthmobile.js文件中已经定义了校验手机号的方法</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 手机号校验</span></span><br><span class="line"><span class="comment"> 1--以1为开头；</span></span><br><span class="line"><span class="comment"> 2--第二位可为3,4,5,7,8,中的任意一位；</span></span><br><span class="line"><span class="comment"> 3--最后以0-9的9个整数结尾。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">checkTelephone</span>(<span class="params">telephone</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> reg=<span class="regexp">/^[1][3,4,5,7,8][0-9]&#123;9&#125;$/</span>;</span><br><span class="line">    <span class="keyword">if</span> (!reg.<span class="title function_">test</span>(telephone)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第二步：为发送验证码按钮绑定事件sendValidateCode</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input-row&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span>&gt;</span>手机号<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;orderInfo.telephone&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;input-clear&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入手机号&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">style</span>=<span class="string">&quot;font-size: x-small;&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">id</span>=<span class="string">&quot;validateCodeButton&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;sendValidateCode()&quot;</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;发送验证码&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">//发送验证码</span><br><span class="line">sendValidateCode()&#123;</span><br><span class="line">  //获取用户输入的手机号</span><br><span class="line">  var telephone = this.orderInfo.telephone;</span><br><span class="line">  //校验手机号输入是否正确</span><br><span class="line">  if (!checkTelephone(telephone)) &#123;</span><br><span class="line">    this.$message.error(&#x27;请输入正确的手机号&#x27;);</span><br><span class="line">    return false;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-1-3-30秒倒计时效果"><a href="#2-1-3-30秒倒计时效果" class="headerlink" title="2.1.3 30秒倒计时效果"></a>2.1.3 30秒倒计时效果</h4><p>前面在sendValidateCode方法中进行了手机号校验，如果校验通过，需要显示30秒倒计时效果</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//发送验证码</span></span><br><span class="line"><span class="title function_">sendValidateCode</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">//获取用户输入的手机号</span></span><br><span class="line">  <span class="keyword">var</span> telephone = <span class="variable language_">this</span>.<span class="property">orderInfo</span>.<span class="property">telephone</span>;</span><br><span class="line">  <span class="comment">//校验手机号输入是否正确</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">checkTelephone</span>(telephone)) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&#x27;请输入正确的手机号&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  validateCodeButton = $(<span class="string">&quot;#validateCodeButton&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">  clock = <span class="variable language_">window</span>.<span class="built_in">setInterval</span>(doLoop, <span class="number">1000</span>); <span class="comment">//一秒执行一次</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中，validateCodeButton和clock是在healthmobile.js文件中定义的变量，doLoop是在healthmobile.js文件中定义的方法</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> clock = <span class="string">&#x27;&#x27;</span>;<span class="comment">//定时器对象，用于页面30秒倒计时效果</span></span><br><span class="line"><span class="keyword">var</span> nums = <span class="number">30</span>;</span><br><span class="line"><span class="keyword">var</span> validateCodeButton;</span><br><span class="line"><span class="comment">//基于定时器实现30秒倒计时效果</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">doLoop</span>(<span class="params"></span>) &#123;</span><br><span class="line">    validateCodeButton.<span class="property">disabled</span> = <span class="literal">true</span>;<span class="comment">//将按钮置为不可点击</span></span><br><span class="line">    nums--;</span><br><span class="line">    <span class="keyword">if</span> (nums &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        validateCodeButton.<span class="property">value</span> = nums + <span class="string">&#x27;秒后重新获取&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">clearInterval</span>(clock); <span class="comment">//清除js定时器</span></span><br><span class="line">        validateCodeButton.<span class="property">disabled</span> = <span class="literal">false</span>;</span><br><span class="line">        validateCodeButton.<span class="property">value</span> = <span class="string">&#x27;重新获取验证码&#x27;</span>;</span><br><span class="line">        nums = <span class="number">30</span>; <span class="comment">//重置时间</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-1-4-发送ajax请求"><a href="#2-1-4-发送ajax请求" class="headerlink" title="2.1.4 发送ajax请求"></a>2.1.4 发送ajax请求</h4><p>在按钮上显示30秒倒计时效果的同时，需要发送ajax请求，在后台给用户发送手机验证码</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//发送验证码</span></span><br><span class="line"><span class="title function_">sendValidateCode</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">//获取用户输入的手机号</span></span><br><span class="line">  <span class="keyword">var</span> telephone = <span class="variable language_">this</span>.<span class="property">orderInfo</span>.<span class="property">telephone</span>;</span><br><span class="line">  <span class="comment">//校验手机号输入是否正确</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">checkTelephone</span>(telephone)) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&#x27;请输入正确的手机号&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  validateCodeButton = $(<span class="string">&quot;#validateCodeButton&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">  clock = <span class="variable language_">window</span>.<span class="built_in">setInterval</span>(doLoop, <span class="number">1000</span>); <span class="comment">//一秒执行一次</span></span><br><span class="line">  axios.<span class="title function_">post</span>(<span class="string">&quot;/validateCode/send4Order.do?telephone=&quot;</span> + telephone).<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(!response.<span class="property">data</span>.<span class="property">flag</span>)&#123;</span><br><span class="line">      <span class="comment">//验证码发送失败</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&#x27;验证码发送失败，请检查手机号输入是否正确&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建ValidateCodeController，提供方法发送短信验证码，并将验证码保存到redis</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.exceptions.ClientException;</span><br><span class="line"><span class="keyword">import</span> com.itheima.constant.MessageConstant;</span><br><span class="line"><span class="keyword">import</span> com.itheima.constant.RedisConstant;</span><br><span class="line"><span class="keyword">import</span> com.itheima.constant.RedisMessageConstant;</span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.Result;</span><br><span class="line"><span class="keyword">import</span> com.itheima.utils.JedisUtils;</span><br><span class="line"><span class="keyword">import</span> com.itheima.utils.SMSUtils;</span><br><span class="line"><span class="keyword">import</span> com.itheima.utils.ValidateCodeUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 短信验证码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/validateCode&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ValidateCodeController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JedisPool jedisPool;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">//体检预约时发送手机验证码</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/send4Order&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">send4Order</span><span class="params">(String telephone)</span>&#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">code</span> <span class="operator">=</span> ValidateCodeUtils.generateValidateCode(<span class="number">4</span>);<span class="comment">//生成4位数字验证码</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//发送短信</span></span><br><span class="line">            SMSUtils.sendShortMessage(SMSUtils.VALIDATE_CODE,telephone,code.toString());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClientException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="comment">//验证码发送失败</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>, MessageConstant.SEND_VALIDATECODE_FAIL);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;发送的手机验证码为：&quot;</span> + code);</span><br><span class="line">        <span class="comment">//将生成的验证码缓存到redis</span></span><br><span class="line">        jedisPool.getResource().setex(</span><br><span class="line">          telephone + RedisMessageConstant.SENDTYPE_ORDER,<span class="number">5</span> * <span class="number">60</span>,code.toString());</span><br><span class="line">        <span class="comment">//验证码发送成功</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>,MessageConstant.SEND_VALIDATECODE_SUCCESS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-1-5-日历展示"><a href="#2-1-5-日历展示" class="headerlink" title="2.1.5 日历展示"></a>2.1.5 日历展示</h4><p>页面中使用DatePicker控件来展示日历。根据需求，最多可以提前一个月进行体检预约，所以日历控件只展示未来一个月的日期</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;date&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span>&gt;</span>体检日期<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;icon-date&quot;</span> <span class="attr">class</span>=<span class="string">&quot;picktime&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;orderInfo.orderDate&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;picktime&quot;</span> <span class="attr">readonly</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">//日期控件</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> calendar = <span class="keyword">new</span> <span class="title function_">datePicker</span>();</span></span><br><span class="line"><span class="language-javascript">  calendar.<span class="title function_">init</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="string">&#x27;trigger&#x27;</span>: <span class="string">&#x27;.picktime&#x27;</span>,<span class="comment">/*按钮选择器，用于触发弹出插件*/</span></span></span><br><span class="line"><span class="language-javascript">    <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;date&#x27;</span>,<span class="comment">/*模式：date日期；datetime日期时间；time时间；ym年月；*/</span></span></span><br><span class="line"><span class="language-javascript">    <span class="string">&#x27;minDate&#x27;</span>: <span class="title function_">getSpecifiedDate</span>(<span class="keyword">new</span> <span class="title class_">Date</span>(),<span class="number">1</span>),<span class="comment">/*最小日期*/</span></span></span><br><span class="line"><span class="language-javascript">    <span class="string">&#x27;maxDate&#x27;</span>: <span class="title function_">getSpecifiedDate</span>(<span class="keyword">new</span> <span class="title class_">Date</span>(),<span class="number">30</span>),<span class="comment">/*最大日期*/</span></span></span><br><span class="line"><span class="language-javascript">    <span class="string">&#x27;onSubmit&#x27;</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="comment">/*确认时触发事件*/</span>&#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="string">&#x27;onClose&#x27;</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="comment">/*取消时触发事件*/</span> &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中getSpecifiedDate方法定义在healthmobile.js文件中</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//获得指定日期后指定天数的日期</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getSpecifiedDate</span>(<span class="params">date,days</span>) &#123;</span><br><span class="line">    date.<span class="title function_">setDate</span>(date.<span class="title function_">getDate</span>() + days);<span class="comment">//获取指定天之后的日期</span></span><br><span class="line">    <span class="keyword">var</span> year = date.<span class="title function_">getFullYear</span>();</span><br><span class="line">    <span class="keyword">var</span> month = date.<span class="title function_">getMonth</span>() + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">var</span> day = date.<span class="title function_">getDate</span>();</span><br><span class="line">    <span class="keyword">return</span> (year + <span class="string">&quot;-&quot;</span> + month + <span class="string">&quot;-&quot;</span> + day);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-1-6-提交预约请求"><a href="#2-1-6-提交预约请求" class="headerlink" title="2.1.6 提交预约请求"></a>2.1.6 提交预约请求</h4><p>为提交预约按钮绑定事件</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box-button&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;submitOrder()&quot;</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn order-btn&quot;</span>&gt;</span>提交预约<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">//提交预约</span><br><span class="line">submitOrder()&#123;</span><br><span class="line">  //校验身份证号格式</span><br><span class="line">  if(!checkIdCard(this.orderInfo.idCard))&#123;</span><br><span class="line">    this.$message.error(&#x27;身份证号码输入错误，请重新输入&#x27;);</span><br><span class="line">    return ;</span><br><span class="line">  &#125;</span><br><span class="line">  axios.post(&quot;/order/submit.do&quot;,this.orderInfo).then((response) =&gt; &#123;</span><br><span class="line">    if(response.data.flag)&#123;</span><br><span class="line">      //预约成功，跳转到预约成功页面</span><br><span class="line">      window.location.href=&quot;orderSuccess.html?orderId=&quot; + response.data.data;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">      //预约失败，提示预约失败信息</span><br><span class="line">      this.$message.error(response.data.message);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中checkIdCard方法是在healthmobile.js文件中定义的</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 身份证号码校验</span></span><br><span class="line"><span class="comment"> * 身份证号码为15位或者18位，15位时全为数字，18位前17位为数字，最后一位是校验位，可能为数字或字符X</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">checkIdCard</span>(<span class="params">idCard</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> reg = <span class="regexp">/(^\d&#123;15&#125;$)|(^\d&#123;18&#125;$)|(^\d&#123;17&#125;(\d|X|x)$)/</span>;</span><br><span class="line">    <span class="keyword">if</span>(reg.<span class="title function_">test</span>(idCard))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-后台代码-1"><a href="#2-2-后台代码-1" class="headerlink" title="2.2 后台代码"></a>2.2 后台代码</h3><h4 id="2-2-1-Controller-1"><a href="#2-2-1-Controller-1" class="headerlink" title="2.2.1 Controller"></a>2.2.1 Controller</h4><p>在health_mobile工程中创建OrderController并提供submitOrder方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Reference;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.exceptions.ClientException;</span><br><span class="line"><span class="keyword">import</span> com.itheima.constant.MessageConstant;</span><br><span class="line"><span class="keyword">import</span> com.itheima.constant.RedisConstant;</span><br><span class="line"><span class="keyword">import</span> com.itheima.constant.RedisMessageConstant;</span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.Result;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Member;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Order;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Setmeal;</span><br><span class="line"><span class="keyword">import</span> com.itheima.service.OrderService;</span><br><span class="line"><span class="keyword">import</span> com.itheima.utils.JedisUtils;</span><br><span class="line"><span class="keyword">import</span> com.itheima.utils.SMSUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 体检预约</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/order&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line">    <span class="meta">@Reference</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JedisPool jedisPool;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 体检预约</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/submit&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">submitOrder</span><span class="params">(<span class="meta">@RequestBody</span> Map map)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">telephone</span> <span class="operator">=</span> (String) map.get(<span class="string">&quot;telephone&quot;</span>);</span><br><span class="line">        <span class="comment">//从Redis中获取缓存的验证码，key为手机号+RedisConstant.SENDTYPE_ORDER</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">codeInRedis</span> <span class="operator">=</span> jedisPool.getResource().get(</span><br><span class="line">          telephone + RedisMessageConstant.SENDTYPE_ORDER);</span><br><span class="line">        <span class="type">String</span> <span class="variable">validateCode</span> <span class="operator">=</span> (String) map.get(<span class="string">&quot;validateCode&quot;</span>);</span><br><span class="line">        <span class="comment">//校验手机验证码</span></span><br><span class="line">        <span class="keyword">if</span>(codeInRedis == <span class="literal">null</span> || !codeInRedis.equals(validateCode))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>, MessageConstant.VALIDATECODE_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span><span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//调用体检预约服务</span></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            map.put(<span class="string">&quot;orderType&quot;</span>, Order.ORDERTYPE_WEIXIN);</span><br><span class="line">            result = orderService.order(map);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="comment">//预约失败</span></span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(result.isFlag())&#123;</span><br><span class="line">            <span class="comment">//预约成功，发送短信通知</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">orderDate</span> <span class="operator">=</span> (String) map.get(<span class="string">&quot;orderDate&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                SMSUtils.sendShortMessage(SMSUtils.ORDER_NOTICE,telephone,orderDate);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClientException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-2-服务接口-1"><a href="#2-2-2-服务接口-1" class="headerlink" title="2.2.2 服务接口"></a>2.2.2 服务接口</h4><p>在health_interface工程中创建体检预约服务接口OrderService并提供预约方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.Result;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 体检预约服务接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="comment">//体检预约</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">order</span><span class="params">(Map map)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-3-服务实现类-1"><a href="#2-2-3-服务实现类-1" class="headerlink" title="2.2.3 服务实现类"></a>2.2.3 服务实现类</h4><p>在health_service_provider工程中创建体检预约服务实现类OrderServiceImpl并实现体检预约方法。</p>
<p>体检预约方法处理逻辑比较复杂，需要进行如下业务处理：</p>
<p>1、检查用户所选择的预约日期是否已经提前进行了预约设置，如果没有设置则无法进行预约</p>
<p>2、检查用户所选择的预约日期是否已经约满，如果已经约满则无法预约</p>
<p>3、检查用户是否重复预约（同一个用户在同一天预约了同一个套餐），如果是重复预约则无法完成再次预约</p>
<p>4、检查当前用户是否为会员，如果是会员则直接完成预约，如果不是会员则自动完成注册并进行预约</p>
<p>5、预约成功，更新当日的已预约人数</p>
<p>实现代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Service;</span><br><span class="line"><span class="keyword">import</span> com.itheima.constant.MessageConstant;</span><br><span class="line"><span class="keyword">import</span> com.itheima.dao.MemberDao;</span><br><span class="line"><span class="keyword">import</span> com.itheima.dao.OrderDao;</span><br><span class="line"><span class="keyword">import</span> com.itheima.dao.OrderSettingDao;</span><br><span class="line"><span class="keyword">import</span> com.itheima.dao.SetmealDao;</span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.Result;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Member;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Order;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.OrderSetting;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Setmeal;</span><br><span class="line"><span class="keyword">import</span> com.itheima.utils.DateUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.DateUtil;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"><span class="keyword">import</span> java.text.ParseException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 体检预约服务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service(interfaceClass = OrderService.class)</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">OrderService</span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderSettingDao orderSettingDao;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MemberDao memberDao;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderDao orderDao;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">//体检预约</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">order</span><span class="params">(Map map)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">   		<span class="comment">//检查当前日期是否进行了预约设置</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">orderDate</span> <span class="operator">=</span> (String) map.get(<span class="string">&quot;orderDate&quot;</span>);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> DateUtils.parseString2Date(orderDate);</span><br><span class="line">        <span class="type">OrderSetting</span> <span class="variable">orderSetting</span> <span class="operator">=</span> orderSettingDao.findByOrderDate(date);</span><br><span class="line">        <span class="keyword">if</span>(orderSetting == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>, MessageConstant.SELECTED_DATE_CANNOT_ORDER);</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        <span class="comment">//检查预约日期是否预约已满</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> orderSetting.getNumber();<span class="comment">//可预约人数</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">reservations</span> <span class="operator">=</span> orderSetting.getReservations();<span class="comment">//已预约人数</span></span><br><span class="line">        <span class="keyword">if</span>(reservations &gt;= number)&#123;</span><br><span class="line">            <span class="comment">//预约已满，不能预约</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>,MessageConstant.ORDER_FULL);</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        <span class="comment">//检查当前用户是否为会员，根据手机号判断</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">telephone</span> <span class="operator">=</span> (String) map.get(<span class="string">&quot;telephone&quot;</span>);</span><br><span class="line">        <span class="type">Member</span> <span class="variable">member</span> <span class="operator">=</span> memberDao.findByTelephone(telephone);</span><br><span class="line">        <span class="comment">//防止重复预约</span></span><br><span class="line">        <span class="keyword">if</span>(member != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">memberId</span> <span class="operator">=</span> member.getId();</span><br><span class="line">            <span class="type">int</span> <span class="variable">setmealId</span> <span class="operator">=</span> Integer.parseInt((String) map.get(<span class="string">&quot;setmealId&quot;</span>));</span><br><span class="line">            <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>(memberId,date,<span class="literal">null</span>,<span class="literal">null</span>,setmealId);</span><br><span class="line">            List&lt;Order&gt; list = orderDao.findByCondition(order);</span><br><span class="line">            <span class="keyword">if</span>(list != <span class="literal">null</span> &amp;&amp; list.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="comment">//已经完成了预约，不能重复预约</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>,MessageConstant.HAS_ORDERED);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">      	<span class="comment">//可以预约，设置预约人数加一</span></span><br><span class="line">        orderSetting.setReservations(orderSetting.getReservations()+<span class="number">1</span>);</span><br><span class="line">        orderSettingDao.editReservationsByOrderDate(orderSetting);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(member == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//当前用户不是会员，需要添加到会员表</span></span><br><span class="line">            member = <span class="keyword">new</span> <span class="title class_">Member</span>();</span><br><span class="line">            member.setName((String) map.get(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">            member.setPhoneNumber(telephone);</span><br><span class="line">            member.setIdCard((String) map.get(<span class="string">&quot;idCard&quot;</span>));</span><br><span class="line">            member.setSex((String) map.get(<span class="string">&quot;sex&quot;</span>));</span><br><span class="line">            member.setRegTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">            memberDao.add(member);</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        <span class="comment">//保存预约信息到预约表</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>(member.getId(),</span><br><span class="line">                                date,</span><br><span class="line">                                (String)map.get(<span class="string">&quot;orderType&quot;</span>),</span><br><span class="line">                                Order.ORDERSTATUS_NO,</span><br><span class="line">                                Integer.parseInt((String) map.get(<span class="string">&quot;setmealId&quot;</span>)));</span><br><span class="line">        orderDao.add(order);</span><br><span class="line">      </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>,MessageConstant.ORDER_SUCCESS,order.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-4-Dao接口-1"><a href="#2-2-4-Dao接口-1" class="headerlink" title="2.2.4 Dao接口"></a>2.2.4 Dao接口</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.OrderSetting;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderSettingDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(OrderSetting orderSetting)</span>;</span><br><span class="line">    <span class="comment">//更新可预约人数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">editNumberByOrderDate</span><span class="params">(OrderSetting orderSetting)</span>;</span><br><span class="line">    <span class="comment">//更新已预约人数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">editReservationsByOrderDate</span><span class="params">(OrderSetting orderSetting)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">findCountByOrderDate</span><span class="params">(Date orderDate)</span>;</span><br><span class="line">    <span class="comment">//根据日期范围查询预约设置信息</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;OrderSetting&gt; <span class="title function_">getOrderSettingByMonth</span><span class="params">(Map date)</span>;</span><br><span class="line">    <span class="comment">//根据预约日期查询预约设置信息</span></span><br><span class="line">    <span class="keyword">public</span> OrderSetting <span class="title function_">findByOrderDate</span><span class="params">(Date orderDate)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">package</span> com.itheima.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.Page;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Member;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MemberDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Member&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> Page&lt;Member&gt; <span class="title function_">selectByCondition</span><span class="params">(String queryString)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Member member)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Integer id)</span>;</span><br><span class="line">    <span class="keyword">public</span> Member <span class="title function_">findById</span><span class="params">(Integer id)</span>;</span><br><span class="line">    <span class="keyword">public</span> Member <span class="title function_">findByTelephone</span><span class="params">(String telephone)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">edit</span><span class="params">(Member member)</span>;</span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">findMemberCountBeforeDate</span><span class="params">(String date)</span>;</span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">findMemberCountByDate</span><span class="params">(String date)</span>;</span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">findMemberCountAfterDate</span><span class="params">(String date)</span>;</span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">findMemberTotalCount</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">package</span> com.itheima.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Order;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Order order)</span>;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Order&gt; <span class="title function_">findByCondition</span><span class="params">(Order order)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-5-Mapper映射文件-1"><a href="#2-2-5-Mapper映射文件-1" class="headerlink" title="2.2.5 Mapper映射文件"></a>2.2.5 Mapper映射文件</h4><p>OrderSettingDao.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--根据日期查询预约设置信息--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByOrderDate&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;date&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.pojo.OrderSetting&quot;</span>&gt;</span></span><br><span class="line">  select * from t_ordersetting where orderDate = #&#123;orderDate&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--更新已预约人数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;editReservationsByOrderDate&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.itheima.pojo.OrderSetting&quot;</span>&gt;</span></span><br><span class="line">  update t_ordersetting set reservations = #&#123;reservations&#125; where orderDate = #&#123;orderDate&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>MemberDao.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.dao.MemberDao&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.pojo.Member&quot;</span>&gt;</span></span><br><span class="line">        select * from t_member</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--根据条件查询--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByCondition&quot;</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">parameterType</span>=<span class="string">&quot;string&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.pojo.Member&quot;</span>&gt;</span></span><br><span class="line">        select * from t_member</span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;value != null and value.length &gt; 0&quot;</span>&gt;</span></span><br><span class="line">            where fileNumber = #&#123;value&#125; or phoneNumber = #&#123;value&#125; or name = #&#123;value&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--新增会员--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;add&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.itheima.pojo.Member&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Integer&quot;</span> <span class="attr">order</span>=<span class="string">&quot;AFTER&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">            SELECT LAST_INSERT_ID()</span><br><span class="line">        <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">        insert into </span><br><span class="line">      		t_member</span><br><span class="line">              (fileNumber,name,sex,idCard,phoneNumber,</span><br><span class="line">               regTime,password,email,birthday,remark)</span><br><span class="line">             values</span><br><span class="line">              (#&#123;fileNumber&#125;,#&#123;name&#125;,#&#123;sex&#125;,#&#123;idCard&#125;,#&#123;phoneNumber&#125;,</span><br><span class="line">               #&#123;regTime&#125;,#&#123;password&#125;,#&#123;email&#125;,#&#123;birthday&#125;,#&#123;remark&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--删除会员--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">        delete from t_member where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--根据id查询会员--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.pojo.Member&quot;</span>&gt;</span></span><br><span class="line">        select * from t_member where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--根据id查询会员--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByTelephone&quot;</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">parameterType</span>=<span class="string">&quot;string&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.pojo.Member&quot;</span>&gt;</span></span><br><span class="line">        select * from t_member where phoneNumber = #&#123;phoneNumber&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--编辑会员--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;edit&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.itheima.pojo.Member&quot;</span>&gt;</span></span><br><span class="line">        update t_member</span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;fileNumber != null&quot;</span>&gt;</span></span><br><span class="line">                fileNumber = #&#123;fileNumber&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span></span><br><span class="line">                name = #&#123;name&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;sex != null&quot;</span>&gt;</span></span><br><span class="line">                sex = #&#123;sex&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;idCard != null&quot;</span>&gt;</span></span><br><span class="line">                idCard = #&#123;idCard&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;phoneNumber != null&quot;</span>&gt;</span></span><br><span class="line">                phoneNumber = #&#123;phoneNumber&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;regTime != null&quot;</span>&gt;</span></span><br><span class="line">                regTime = #&#123;regTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;password != null&quot;</span>&gt;</span></span><br><span class="line">                password = #&#123;password&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;email != null&quot;</span>&gt;</span></span><br><span class="line">                email = #&#123;email&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;birthday != null&quot;</span>&gt;</span></span><br><span class="line">                birthday = #&#123;birthday&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;remark != null&quot;</span>&gt;</span></span><br><span class="line">                remark = #&#123;remark&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--根据日期统计会员数，统计指定日期之前的会员数--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findMemberCountBeforeDate&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;string&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">        select count(id) from t_member where regTime <span class="symbol">&amp;lt;</span>= #&#123;value&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--根据日期统计会员数--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findMemberCountByDate&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;string&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">        select count(id) from t_member where regTime = #&#123;value&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--根据日期统计会员数，统计指定日期之后的会员数--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findMemberCountAfterDate&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;string&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">        select count(id) from t_member where regTime <span class="symbol">&amp;gt;</span>= #&#123;value&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--总会员数--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findMemberTotalCount&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">        select count(id) from t_member</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>OrderDao.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.dao.OrderDao&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;baseResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.itheima.pojo.Order&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;member_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;memberId&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;orderDate&quot;</span> <span class="attr">property</span>=<span class="string">&quot;orderDate&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;orderType&quot;</span> <span class="attr">property</span>=<span class="string">&quot;orderType&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;orderStatus&quot;</span> <span class="attr">property</span>=<span class="string">&quot;orderStatus&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;setmeal_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;setmealId&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--新增--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;add&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.itheima.pojo.Order&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Integer&quot;</span> <span class="attr">order</span>=<span class="string">&quot;AFTER&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">            SELECT LAST_INSERT_ID()</span><br><span class="line">        <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">        insert into </span><br><span class="line">      		t_order</span><br><span class="line">      	(member_id,orderDate,orderType,orderStatus,setmeal_id)</span><br><span class="line">        	values </span><br><span class="line">      	(#&#123;memberId&#125;,#&#123;orderDate&#125;,#&#123;orderType&#125;,#&#123;orderStatus&#125;,#&#123;setmealId&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--动态条件查询--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByCondition&quot;</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">parameterType</span>=<span class="string">&quot;com.itheima.pojo.Order&quot;</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">resultMap</span>=<span class="string">&quot;baseResultMap&quot;</span>&gt;</span></span><br><span class="line">        select * from t_order</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id != null&quot;</span>&gt;</span></span><br><span class="line">                and id = #&#123;id&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;memberId != null&quot;</span>&gt;</span></span><br><span class="line">                and member_id = #&#123;memberId&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;orderDate != null&quot;</span>&gt;</span></span><br><span class="line">                and orderDate = #&#123;orderDate&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;orderType != null&quot;</span>&gt;</span></span><br><span class="line">                and orderType = #&#123;orderType&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;orderStatus != null&quot;</span>&gt;</span></span><br><span class="line">                and orderStatus = #&#123;orderStatus&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;setmealId != null&quot;</span>&gt;</span></span><br><span class="line">                and setmeal_id = #&#123;setmealId&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-预约成功页面展示"><a href="#3-预约成功页面展示" class="headerlink" title="3. 预约成功页面展示"></a>3. 预约成功页面展示</h2><p>前面已经完成了体检预约，预约成功后页面会跳转到成功提示页面（orderSuccess.html）并展示预约的相关信息（体检人、体检套餐、体检时间等）。</p>
<h3 id="3-1-页面调整"><a href="#3-1-页面调整" class="headerlink" title="3.1 页面调整"></a>3.1 页面调整</h3><p>提供orderSuccess.html页面，展示预约成功后相关信息</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;info-title&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;name&quot;</span>&gt;</span>体检预约成功<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;notice-item&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item-title&quot;</span>&gt;</span>预约信息<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item-content&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>体检人：&#123;&#123;orderInfo.member&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>体检套餐：&#123;&#123;orderInfo.setmeal&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>体检日期：&#123;&#123;orderInfo.orderDate&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>预约类型：&#123;&#123;orderInfo.orderType&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">//从请求URL根据参数名获取对应值，orderId为预约id</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> id = <span class="title function_">getUrlParam</span>(<span class="string">&quot;orderId&quot;</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> vue = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">el</span>:<span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">data</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">orderInfo</span>:&#123;&#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">mounted</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">      axios.<span class="title function_">post</span>(<span class="string">&quot;/order/findById.do?id=&quot;</span> + id).<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">orderInfo</span> = response.<span class="property">data</span>.<span class="property">data</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-后台代码-5"><a href="#3-2-后台代码-5" class="headerlink" title="3.2 后台代码"></a>3.2 后台代码</h3><h4 id="3-2-1-Controller-5"><a href="#3-2-1-Controller-5" class="headerlink" title="3.2.1 Controller"></a>3.2.1 Controller</h4><p>在OrderController中提供findById方法，根据预约id查询预约相关信息</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据id查询预约信息，包括套餐信息和会员信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/findById&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">findById</span><span class="params">(Integer id)</span>&#123;</span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> orderService.findById(id);</span><br><span class="line">    <span class="comment">//查询预约信息成功</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>,MessageConstant.QUERY_ORDER_SUCCESS,map);</span><br><span class="line">  &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    <span class="comment">//查询预约信息失败</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>,MessageConstant.QUERY_ORDER_FAIL);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-服务接口-5"><a href="#3-2-2-服务接口-5" class="headerlink" title="3.2.2 服务接口"></a>3.2.2 服务接口</h4><p>在OrderService服务接口中扩展findById方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//根据id查询预约信息，包括体检人信息、套餐信息</span></span><br><span class="line"><span class="keyword">public</span> Map <span class="title function_">findById</span><span class="params">(Integer id)</span> <span class="keyword">throws</span> Exception;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-3-服务实现类-5"><a href="#3-2-3-服务实现类-5" class="headerlink" title="3.2.3 服务实现类"></a>3.2.3 服务实现类</h4><p>在OrderServiceImpl服务实现类中实现findById方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//根据id查询预约信息，包括体检人信息、套餐信息</span></span><br><span class="line"><span class="keyword">public</span> Map <span class="title function_">findById</span><span class="params">(Integer id)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">  <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> orderDao.findById4Detail(id);</span><br><span class="line">  <span class="keyword">if</span>(map != <span class="literal">null</span>)&#123;</span><br><span class="line">    <span class="comment">//处理日期格式</span></span><br><span class="line">    <span class="type">Date</span> <span class="variable">orderDate</span> <span class="operator">=</span> (Date) map.get(<span class="string">&quot;orderDate&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;orderDate&quot;</span>,DateUtils.parseDate2String(orderDate));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> map;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-4-Dao接口-5"><a href="#3-2-4-Dao接口-5" class="headerlink" title="3.2.4 Dao接口"></a>3.2.4 Dao接口</h4><p>在OrderDao接口中扩展findById4Detail方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Map <span class="title function_">findById4Detail</span><span class="params">(Integer id)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-5-Mapper映射文件-5"><a href="#3-2-5-Mapper映射文件-5" class="headerlink" title="3.2.5 Mapper映射文件"></a>3.2.5 Mapper映射文件</h4><p>在OrderDao.xml映射文件中提供SQL语句</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--根据预约id查询预约信息，包括体检人信息、套餐信息--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findById4Detail&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  select m.name member ,s.name setmeal,o.orderDate orderDate,o.orderType orderType</span><br><span class="line">  from</span><br><span class="line">  t_order o,</span><br><span class="line">  t_member m,</span><br><span class="line">  t_setmeal s</span><br><span class="line">  where o.member_id=m.id and o.setmeal_id=s.id and o.id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="第9章-移动端开发-手机快速登录、权限控制"><a href="#第9章-移动端开发-手机快速登录、权限控制" class="headerlink" title="第9章 移动端开发-手机快速登录、权限控制"></a>第9章 移动端开发-手机快速登录、权限控制</h1><h2 id="1-需求分析-3"><a href="#1-需求分析-3" class="headerlink" title="1. 需求分析"></a>1. 需求分析</h2><p>手机快速登录功能，就是通过短信验证码的方式进行登录。这种方式相对于用户名密码登录方式，用户不需要记忆自己的密码，只需要通过输入手机号并获取验证码就可以完成登录，是目前比较流行的登录方式。</p>
<p><img src="/../../assets/2143930-20210826121907777-463739585.png" alt="img"></p>
<p><img src="/../../assets/2143930-20210826121913433-1609264363.png" alt="img"></p>
<h2 id="2-手机快速登录"><a href="#2-手机快速登录" class="headerlink" title="2. 手机快速登录"></a>2. 手机快速登录</h2><h3 id="2-1-页面调整-1"><a href="#2-1-页面调整-1" class="headerlink" title="2.1 页面调整"></a>2.1 页面调整</h3><p>登录页面为&#x2F;pages&#x2F;login.html</p>
<h4 id="2-1-1-发送验证码"><a href="#2-1-1-发送验证码" class="headerlink" title="2.1.1 发送验证码"></a>2.1.1 发送验证码</h4><p>为获取验证码按钮绑定事件，并在事件对应的处理函数中校验手机号，如果手机号输入正确则显示30秒倒计时效果并发送ajax请求，发送短信验证码</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input-row&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span>&gt;</span>手机号<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;loginInput&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;loginInfo.telephone&quot;</span> <span class="attr">id</span>=<span class="string">&#x27;account&#x27;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> </span></span><br><span class="line"><span class="tag">           <span class="attr">placeholder</span>=<span class="string">&quot;请输入手机号&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;validateCodeButton&quot;</span> </span></span><br><span class="line"><span class="tag">           @<span class="attr">click</span>=<span class="string">&quot;sendValidateCode()&quot;</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 12px&quot;</span> </span></span><br><span class="line"><span class="tag">           <span class="attr">value</span>=<span class="string">&quot;获取验证码&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> vue = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">el</span>:<span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">data</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">loginInfo</span>:&#123;&#125;<span class="comment">//登录信息</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">//发送验证码</span></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">sendValidateCode</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> telephone = <span class="variable language_">this</span>.<span class="property">loginInfo</span>.<span class="property">telephone</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (!<span class="title function_">checkTelephone</span>(telephone)) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&#x27;请输入正确的手机号&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        validateCodeButton = $(<span class="string">&quot;#validateCodeButton&quot;</span>)[<span class="number">0</span>];</span></span><br><span class="line"><span class="language-javascript">        clock = <span class="variable language_">window</span>.<span class="built_in">setInterval</span>(doLoop, <span class="number">1000</span>); <span class="comment">//一秒执行一次</span></span></span><br><span class="line"><span class="language-javascript">        axios.</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">post</span>(<span class="string">&quot;/validateCode/send4Login.do?telephone=&quot;</span> + telephone).</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span>(!response.<span class="property">data</span>.<span class="property">flag</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//验证码发送失败</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&#x27;验证码发送失败，请检查手机号输入是否正确&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在ValidateCodeController中提供send4Login方法，调用短信服务发送验证码并将验证码保存到redis</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//手机快速登录时发送手机验证码</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/send4Login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">send4Login</span><span class="params">(String telephone)</span>&#123;</span><br><span class="line">  <span class="type">Integer</span> <span class="variable">code</span> <span class="operator">=</span> ValidateCodeUtils.generateValidateCode(<span class="number">6</span>);<span class="comment">//生成6位数字验证码</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">//发送短信</span></span><br><span class="line">    SMSUtils.sendShortMessage(SMSUtils.VALIDATE_CODE,telephone,code.toString());</span><br><span class="line">  &#125; <span class="keyword">catch</span> (ClientException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    <span class="comment">//验证码发送失败</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>, MessageConstant.SEND_VALIDATECODE_FAIL);</span><br><span class="line">  &#125;</span><br><span class="line">  System.out.println(<span class="string">&quot;发送的手机验证码为：&quot;</span> + code);</span><br><span class="line">  <span class="comment">//将生成的验证码缓存到redis</span></span><br><span class="line">  jedisPool.getResource().setex(telephone+RedisMessageConstant.SENDTYPE_LOGIN,</span><br><span class="line">                                <span class="number">5</span> * <span class="number">60</span>,</span><br><span class="line">                                code.toString());</span><br><span class="line">  <span class="comment">//验证码发送成功</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>,MessageConstant.SEND_VALIDATECODE_SUCCESS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-1-2-提交登录请求"><a href="#2-1-2-提交登录请求" class="headerlink" title="2.1.2 提交登录请求"></a>2.1.2 提交登录请求</h4><p>为登录按钮绑定事件</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">&quot;btn yes-btn&quot;</span>&gt;<span class="language-xml"><span class="tag">&lt;<span class="name">a</span> @<span class="attr">click</span>=<span class="string">&quot;login()&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span>&lt;/div&gt;</span><br><span class="line"><span class="comment">//登录</span></span><br><span class="line"><span class="title function_">login</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> telephone = <span class="variable language_">this</span>.<span class="property">loginInfo</span>.<span class="property">telephone</span>;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">checkTelephone</span>(telephone)) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&#x27;请输入正确的手机号&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  axios.<span class="title function_">post</span>(<span class="string">&quot;/member/login.do&quot;</span>,<span class="variable language_">this</span>.<span class="property">loginInfo</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(response.<span class="property">data</span>.<span class="property">flag</span>)&#123;</span><br><span class="line">      <span class="comment">//登录成功,跳转到会员页面</span></span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=<span class="string">&quot;member.html&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="comment">//失败，提示失败信息</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(response.<span class="property">data</span>.<span class="property">message</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-后台代码-2"><a href="#2-2-后台代码-2" class="headerlink" title="2.2 后台代码"></a>2.2 后台代码</h3><h4 id="2-2-1-Controller-2"><a href="#2-2-1-Controller-2" class="headerlink" title="2.2.1 Controller"></a>2.2.1 Controller</h4><p>在health_mobile工程中创建MemberController并提供login方法进行登录检查，处理逻辑为：</p>
<p>1、校验用户输入的短信验证码是否正确，如果验证码错误则登录失败</p>
<p>2、如果验证码正确，则判断当前用户是否为会员，如果不是会员则自动完成会员注册</p>
<p>3、向客户端写入Cookie，内容为用户手机号</p>
<p>4、将会员信息保存到Redis，使用手机号作为key，保存时长为30分钟</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.controller;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Reference;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.exceptions.ClientException;</span><br><span class="line"><span class="keyword">import</span> com.itheima.constant.MessageConstant;</span><br><span class="line"><span class="keyword">import</span> com.itheima.constant.RedisConstant;</span><br><span class="line"><span class="keyword">import</span> com.itheima.constant.RedisMessageConstant;</span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.Result;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Member;</span><br><span class="line"><span class="keyword">import</span> com.itheima.service.MemberService;</span><br><span class="line"><span class="keyword">import</span> com.itheima.utils.JedisUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.Cookie;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 会员登录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/member&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemberController</span> &#123;</span><br><span class="line">    <span class="meta">@Reference</span></span><br><span class="line">    <span class="keyword">private</span> MemberService memberService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JedisPool jedisPool;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">//使用手机号和验证码登录</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">login</span><span class="params">(HttpServletResponse response,<span class="meta">@RequestBody</span> Map map)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">telephone</span> <span class="operator">=</span> (String) map.get(<span class="string">&quot;telephone&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">validateCode</span> <span class="operator">=</span> (String) map.get(<span class="string">&quot;validateCode&quot;</span>);</span><br><span class="line">        <span class="comment">//从Redis中获取缓存的验证码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">codeInRedis</span> <span class="operator">=</span> </span><br><span class="line">            jedisPool.getResource().get(telephone+RedisMessageConstant.SENDTYPE_LOGIN);</span><br><span class="line">        <span class="keyword">if</span>(codeInRedis == <span class="literal">null</span> || !codeInRedis.equals(validateCode))&#123;</span><br><span class="line">            <span class="comment">//验证码输入错误</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>,MessageConstant.VALIDATECODE_ERROR);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//验证码输入正确</span></span><br><span class="line">            <span class="comment">//判断当前用户是否为会员</span></span><br><span class="line">            <span class="type">Member</span> <span class="variable">member</span> <span class="operator">=</span> memberService.findByTelephone(telephone);</span><br><span class="line">            <span class="keyword">if</span>(member == <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="comment">//当前用户不是会员，自动完成注册</span></span><br><span class="line">                member = <span class="keyword">new</span> <span class="title class_">Member</span>();</span><br><span class="line">                member.setPhoneNumber(telephone);</span><br><span class="line">                member.setRegTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">                memberService.add(member);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//登录成功</span></span><br><span class="line">            <span class="comment">//写入Cookie，跟踪用户</span></span><br><span class="line">            <span class="type">Cookie</span> <span class="variable">cookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;login_member_telephone&quot;</span>,telephone);</span><br><span class="line">            cookie.setPath(<span class="string">&quot;/&quot;</span>);<span class="comment">//路径</span></span><br><span class="line">            cookie.setMaxAge(<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>*<span class="number">30</span>);<span class="comment">//有效期30天</span></span><br><span class="line">            response.addCookie(cookie);</span><br><span class="line">            <span class="comment">//保存会员信息到Redis中</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> JSON.toJSON(member).toString();</span><br><span class="line">            jedisPool.getResource().setex(telephone,<span class="number">60</span>*<span class="number">30</span>,json);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>,MessageConstant.LOGIN_SUCCESS);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-2-服务接口-2"><a href="#2-2-2-服务接口-2" class="headerlink" title="2.2.2 服务接口"></a>2.2.2 服务接口</h4><p>在MemberService服务接口中提供findByTelephone和add方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Member member)</span>;</span><br><span class="line"><span class="keyword">public</span> Member <span class="title function_">findByTelephone</span><span class="params">(String telephone)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-3-服务实现类-2"><a href="#2-2-3-服务实现类-2" class="headerlink" title="2.2.3 服务实现类"></a>2.2.3 服务实现类</h4><p>在MemberServiceImpl服务实现类中实现findByTelephone和add方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//根据手机号查询会员</span></span><br><span class="line"><span class="keyword">public</span> Member <span class="title function_">findByTelephone</span><span class="params">(String telephone)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> memberDao.findByTelephone(telephone);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//新增会员</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Member member)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span>(member.getPassword() != <span class="literal">null</span>)&#123;</span><br><span class="line">    member.setPassword(MD5Utils.md5(member.getPassword()));</span><br><span class="line">  &#125;</span><br><span class="line">  memberDao.add(member);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-4-Dao接口-2"><a href="#2-2-4-Dao接口-2" class="headerlink" title="2.2.4 Dao接口"></a>2.2.4 Dao接口</h4><p>在MemberDao接口中声明findByTelephone和add方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Member <span class="title function_">findByTelephone</span><span class="params">(String telephone)</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Member member)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-5-Mapper映射文件-2"><a href="#2-2-5-Mapper映射文件-2" class="headerlink" title="2.2.5 Mapper映射文件"></a>2.2.5 Mapper映射文件</h4><p>在MemberDao.xml映射文件中定义SQL语句</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--新增会员--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;add&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.itheima.pojo.Member&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Integer&quot;</span> <span class="attr">order</span>=<span class="string">&quot;AFTER&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">    SELECT LAST_INSERT_ID()</span><br><span class="line">  <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">  insert into t_member</span><br><span class="line">  (fileNumber,name,sex,idCard,phoneNumber,regTime,password,email,birthday,remark)</span><br><span class="line">  values </span><br><span class="line">  (#&#123;fileNumber&#125;,#&#123;name&#125;,#&#123;sex&#125;,#&#123;idCard&#125;,#&#123;phoneNumber&#125;,#&#123;regTime&#125;,#&#123;password&#125;,#&#123;email&#125;,#&#123;birthday&#125;,#&#123;remark&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--根据手机号查询会员--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByTelephone&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;string&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.pojo.Member&quot;</span>&gt;</span></span><br><span class="line">  select * from t_member where phoneNumber = #&#123;phoneNumber&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-权限控制"><a href="#3-权限控制" class="headerlink" title="3. 权限控制"></a>3. 权限控制</h2><h3 id="3-1-认证和授权概念"><a href="#3-1-认证和授权概念" class="headerlink" title="3.1 认证和授权概念"></a>3.1 认证和授权概念</h3><p>前面我们已经完成了传智健康后台管理系统的部分功能，例如检查项管理、检查组管理、套餐管理、预约设置等。接下来我们需要思考2个问题：</p>
<p>问题1：在生产环境下我们如果不登录后台系统就可以完成这些功能操作吗？</p>
<p>答案显然是否定的，要操作这些功能必须首先登录到系统才可以。</p>
<p>问题2：是不是所有用户，只要登录成功就都可以操作所有功能呢？</p>
<p>答案是否定的，并不是所有的用户都可以操作这些功能。不同的用户可能拥有不同的权限，这就需要进行授权了。</p>
<p>认证：系统提供的用于识别用户身份的功能，通常提供用户名和密码进行登录其实就是在进行认证，认证的目的是让系统知道你是谁。</p>
<p>授权：用户认证成功后，需要为用户授权，其实就是指定当前用户可以操作哪些功能。</p>
<p>本章节就是要对后台系统进行权限控制，其本质就是对用户进行认证和授权。</p>
<h3 id="3-2-权限模块数据模型"><a href="#3-2-权限模块数据模型" class="headerlink" title="3.2 权限模块数据模型"></a>3.2 权限模块数据模型</h3><p>前面已经分析了认证和授权的概念，要实现最终的权限控制，需要有一套表结构支撑：</p>
<p>用户表t_user、权限表t_permission、角色表t_role、菜单表t_menu、用户角色关系表t_user_role、角色权限关系表t_role_permission、角色菜单关系表t_role_menu。</p>
<p>表之间关系如下图：</p>
<p><img src="/../../assets/2143930-20210826121931015-87114230.png" alt="img"></p>
<p>通过上图可以看到，权限模块共涉及到7张表。在这7张表中，角色表起到了至关重要的作用，其处于核心位置，因为用户、权限、菜单都和角色是多对多关系。</p>
<p>接下来我们可以分析一下在认证和授权过程中分别会使用到哪些表：</p>
<p>认证过程：只需要用户表就可以了，在用户登录时可以查询用户表t_user进行校验，判断用户输入的用户名和密码是否正确。</p>
<p>授权过程：用户必须完成认证之后才可以进行授权，首先可以根据用户查询其角色，再根据角色查询对应的菜单，这样就确定了用户能够看到哪些菜单。然后再根据用户的角色查询对应的权限，这样就确定了用户拥有哪些权限。所以授权过程会用到上面7张表。</p>
<h3 id="3-3-Spring-Security简介"><a href="#3-3-Spring-Security简介" class="headerlink" title="3.3 Spring Security简介"></a>3.3 Spring Security简介</h3><p>Spring Security是 Spring提供的安全认证服务的框架。 使用Spring Security可以帮助我们来简化认证和授权的过程。官网：<a target="_blank" rel="noopener" href="https://spring.io/projects/spring-security">https://spring.io/projects/spring-security</a></p>
<p><img src="/../../assets/2143930-20210826121938276-1920392419.png" alt="img"></p>
<p>对应的maven坐标：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.security<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-security-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.security<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-security-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>常用的权限框架除了Spring Security，还有Apache的shiro框架。</p>
<h3 id="3-4-Spring-Security入门案例"><a href="#3-4-Spring-Security入门案例" class="headerlink" title="3.4 Spring Security入门案例"></a>3.4 Spring Security入门案例</h3><h4 id="3-4-1-工程搭建"><a href="#3-4-1-工程搭建" class="headerlink" title="3.4.1 工程搭建"></a>3.4.1 工程搭建</h4><p>创建maven工程，打包方式为war，为了方便起见我们可以让入门案例工程依赖health_interface，这样相关的依赖都继承过来了。</p>
<p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0</span></span></span><br><span class="line"><span class="string"><span class="tag">                             http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itheima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springsecuritydemo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>springsecuritydemo Maven Webapp<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://www.example.com<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itheima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>health_interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 指定端口 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">port</span>&gt;</span>85<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 请求路径 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">path</span>&gt;</span>/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>提供index.html页面，内容为hello Spring Security!!</p>
<h4 id="3-4-2-配置web-xml"><a href="#3-4-2-配置web-xml" class="headerlink" title="3.4.2 配置web.xml"></a>3.4.2 配置web.xml</h4><p>在web.xml中主要配置SpringMVC的DispatcherServlet和用于整合第三方框架的DelegatingFilterProxy，用于整合Spring Security。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">web-app</span> <span class="keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta"> <span class="string">&quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot;</span></span></span><br><span class="line"><span class="meta"> <span class="string">&quot;http://java.sun.com/dtd/web-app_2_3.dtd&quot;</span> &gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Archetype Created Web Application<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      DelegatingFilterProxy用于整合第三方框架</span></span><br><span class="line"><span class="comment">      整合Spring Security时过滤器的名称必须为springSecurityFilterChain，</span></span><br><span class="line"><span class="comment">	  否则会抛出NoSuchBeanDefinitionException异常</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>springSecurityFilterChain<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>springSecurityFilterChain<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定加载的配置文件 ，通过参数contextConfigLocation加载 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-security.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-4-3-配置spring-security-xml"><a href="#3-4-3-配置spring-security-xml" class="headerlink" title="3.4.3 配置spring-security.xml"></a>3.4.3 配置spring-security.xml</h4><p>在spring-security.xml中主要配置Spring Security的拦截规则和认证管理器。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:dubbo</span>=<span class="string">&quot;http://code.alibabatech.com/schema/dubbo&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:security</span>=<span class="string">&quot;http://www.springframework.org/schema/security&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://code.alibabatech.com/schema/dubbo</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://code.alibabatech.com/schema/dubbo/dubbo.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                          http://www.springframework.org/schema/security</span></span></span><br><span class="line"><span class="string"><span class="tag">                          http://www.springframework.org/schema/security/spring-security.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        http：用于定义相关权限控制</span></span><br><span class="line"><span class="comment">        auto-config：是否自动配置</span></span><br><span class="line"><span class="comment">                        设置为true时框架会提供默认的一些配置，例如提供默认的登录页面、登出处理等</span></span><br><span class="line"><span class="comment">                        设置为false时需要显示提供登录表单配置，否则会报错</span></span><br><span class="line"><span class="comment">        use-expressions：用于指定intercept-url中的access属性是否使用表达式</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">security:http</span> <span class="attr">auto-config</span>=<span class="string">&quot;true&quot;</span> <span class="attr">use-expressions</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            intercept-url：定义一个拦截规则</span></span><br><span class="line"><span class="comment">            pattern：对哪些url进行权限控制</span></span><br><span class="line"><span class="comment">            access：在请求对应的URL时需要什么权限，默认配置时它应该是一个以逗号分隔的角色列表，</span></span><br><span class="line"><span class="comment">				  请求的用户只需拥有其中的一个角色就能成功访问对应的URL</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">security:intercept-url</span> <span class="attr">pattern</span>=<span class="string">&quot;/**&quot;</span>  <span class="attr">access</span>=<span class="string">&quot;hasRole(&#x27;ROLE_ADMIN&#x27;)&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">security:http</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- authentication-manager：认证管理器，用于处理认证操作 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">security:authentication-manager</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- uthentication-provider：认证提供者，执行具体的认证逻辑  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">security:authentication-provider</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--  user-service：用于获取用户信息，提供给authentication-provider进行认证  --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">security:user-service</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- user：定义用户信息，可以指定用户名、密码、角色，后期可以改为从数据库查询用户信息</span></span><br><span class="line"><span class="comment">				  &#123;noop&#125;：表示当前使用的密码为明文 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">security:user</span> <span class="attr">name</span>=<span class="string">&quot;admin&quot;</span> </span></span><br><span class="line"><span class="tag">                               <span class="attr">password</span>=<span class="string">&quot;&#123;noop&#125;admin&quot;</span> </span></span><br><span class="line"><span class="tag">                               <span class="attr">authorities</span>=<span class="string">&quot;ROLE_ADMIN&quot;</span>&gt;</span></span><br><span class="line">              	<span class="tag">&lt;/<span class="name">security:user</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">security:user-service</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">security:authentication-provider</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">security:authentication-manager</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-5-对入门案例改进"><a href="#3-5-对入门案例改进" class="headerlink" title="3.5 对入门案例改进"></a>3.5 对入门案例改进</h3><p>前面我们已经完成了Spring Security的入门案例，通过入门案例我们可以看到，Spring Security将我们项目中的所有资源都保护了起来，要访问这些资源必须要完成认证而且需要具有ROLE_ADMIN角色。</p>
<p>但是入门案例中的使用方法离我们真实生产环境还差很远，还存在如下一些问题：</p>
<p>1、项目中我们将所有的资源（所有请求URL）都保护起来，实际环境下往往有一些资源不需要认证也可以访问，也就是可以匿名访问。</p>
<p>2、登录页面是由框架生成的，而我们的项目往往会使用自己的登录页面。</p>
<p>3、直接将用户名和密码配置在了配置文件中，而真实生产环境下的用户名和密码往往保存在数据库中。</p>
<p>4、在配置文件中配置的密码使用明文，这非常不安全，而真实生产环境下密码需要进行加密。</p>
<p>本章节需要对这些问题进行改进。</p>
<h4 id="3-5-1-配置可匿名访问的资源"><a href="#3-5-1-配置可匿名访问的资源" class="headerlink" title="3.5.1 配置可匿名访问的资源"></a>3.5.1 配置可匿名访问的资源</h4><p>第一步：在项目中创建pages目录，在pages目录中创建a.html和b.html</p>
<p>第二步：在spring-security.xml文件中配置，指定哪些资源可以匿名访问</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  http：用于定义相关权限控制</span></span><br><span class="line"><span class="comment">  指定哪些资源不需要进行权限校验，可以使用通配符</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">security:http</span> <span class="attr">security</span>=<span class="string">&quot;none&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;/pages/a.html&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">security:http</span> <span class="attr">security</span>=<span class="string">&quot;none&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;/paegs/b.html&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">security:http</span> <span class="attr">security</span>=<span class="string">&quot;none&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;/pages/**&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">security:http</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>通过上面的配置可以发现，pages目录下的文件可以在没有认证的情况下任意访问。</p>
<h4 id="3-5-2-使用指定的登录页面"><a href="#3-5-2-使用指定的登录页面" class="headerlink" title="3.5.2 使用指定的登录页面"></a>3.5.2 使用指定的登录页面</h4><p>第一步：提供login.html作为项目的登录页面</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/login.do&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">        username：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        password：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第二步：修改spring-security.xml文件，指定login.html页面可以匿名访问</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">security:http</span> <span class="attr">security</span>=<span class="string">&quot;none&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;/login.html&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>第三步：修改spring-security.xml文件，加入表单登录信息的配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  form-login：定义表单登录信息</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">security:form-login</span> <span class="attr">login-page</span>=<span class="string">&quot;/login.html&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">username-parameter</span>=<span class="string">&quot;username&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">password-parameter</span>=<span class="string">&quot;password&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">login-processing-url</span>=<span class="string">&quot;/login.do&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">default-target-url</span>=<span class="string">&quot;/index.html&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">authentication-failure-url</span>=<span class="string">&quot;/login.html&quot;</span></span></span><br><span class="line"><span class="tag">                     /&gt;</span></span><br></pre></td></tr></table></figure>

<p>第四步：修改spring-security.xml文件，关闭CsrfFilter过滤器</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  csrf：对应CsrfFilter过滤器</span></span><br><span class="line"><span class="comment">  disabled：是否启用CsrfFilter过滤器，如果使用自定义登录页面需要关闭此项，否则登录操作会被禁用（403）</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">security:csrf</span> <span class="attr">disabled</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">security:csrf</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-5-3-从数据库查询用户信息"><a href="#3-5-3-从数据库查询用户信息" class="headerlink" title="3.5.3 从数据库查询用户信息"></a>3.5.3 从数据库查询用户信息</h4><p>如果我们要从数据库动态查询用户信息，就必须按照spring security框架的要求提供一个实现UserDetailsService接口的实现类，并按照框架的要求进行配置即可。框架会自动调用实现类中的方法并自动进行密码校验。</p>
<p>实现类代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.security;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.GrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.authority.SimpleGrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UsernameNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> <span class="keyword">implements</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line">    <span class="comment">//模拟数据库中的用户数据</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span>  Map&lt;String, com.itheima.pojo.User&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        com.itheima.pojo.<span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">com</span>.itheima.pojo.User();</span><br><span class="line">        user1.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        user1.setPassword(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line"></span><br><span class="line">        com.itheima.pojo.<span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">com</span>.itheima.pojo.User();</span><br><span class="line">        user2.setUsername(<span class="string">&quot;xiaoming&quot;</span>);</span><br><span class="line">        user2.setPassword(<span class="string">&quot;1234&quot;</span>);</span><br><span class="line"></span><br><span class="line">        map.put(user1.getUsername(),user1);</span><br><span class="line">        map.put(user2.getUsername(),user2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户名加载用户信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> UsernameNotFoundException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;username:&quot;</span> + username);</span><br><span class="line">        com.itheima.pojo.<span class="type">User</span> <span class="variable">userInDb</span> <span class="operator">=</span> map.get(username);<span class="comment">//模拟根据用户名查询数据库</span></span><br><span class="line">        <span class="keyword">if</span>(userInDb == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//根据用户名没有查询到用户</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//模拟数据库中的密码，后期需要查询数据库</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">passwordInDb</span> <span class="operator">=</span> <span class="string">&quot;&#123;noop&#125;&quot;</span> + userInDb.getPassword();</span><br><span class="line"></span><br><span class="line">        List&lt;GrantedAuthority&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//授权，后期需要改为查询数据库动态获得用户拥有的权限和角色</span></span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(<span class="string">&quot;add&quot;</span>));</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(<span class="string">&quot;delete&quot;</span>));</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(<span class="string">&quot;ROLE_ADMIN&quot;</span>));</span><br><span class="line">      	</span><br><span class="line">        <span class="type">UserDetails</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(username,passwordInDb,list);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>spring-security.xml：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  authentication-manager：认证管理器，用于处理认证操作</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">security:authentication-manager</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    authentication-provider：认证提供者，执行具体的认证逻辑</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">security:authentication-provider</span> <span class="attr">user-service-ref</span>=<span class="string">&quot;userService&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">security:authentication-provider</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">security:authentication-manager</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itheima.security.UserService&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>本章节我们提供了UserService实现类，并且按照框架的要求实现了UserDetailsService接口。在spring配置文件中注册UserService，指定其作为认证过程中根据用户名查询用户信息的处理类。当我们进行登录操作时，spring security框架会调用UserService的loadUserByUsername方法查询用户信息，并根据此方法中提供的密码和用户页面输入的密码进行比对来实现认证操作。</p>
<h4 id="3-5-4-对密码进行加密"><a href="#3-5-4-对密码进行加密" class="headerlink" title="3.5.4 对密码进行加密"></a>3.5.4 对密码进行加密</h4><p>前面我们使用的密码都是明文的，这是非常不安全的。一般情况下用户的密码需要进行加密后再保存到数据库中。</p>
<p>常见的密码加密方式有：</p>
<p>3DES、AES、DES：使用对称加密算法，可以通过解密来还原出原始密码</p>
<p>MD5、SHA1：使用单向HASH算法，无法通过计算还原出原始密码，但是可以建立彩虹表进行查表破解</p>
<p>bcrypt：将salt随机并混入最终加密后的密码，验证时也无需单独提供之前的salt，从而无需单独处理salt问题</p>
<p>加密后的格式一般为：</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">$2a$10$/bTVvqqlH9UiE0ZJZ7N2Me3RIgUCdgMheyTgV0B4cMCSokPa.6oCa</span></span><br></pre></td></tr></table></figure>

<p>加密后字符串的长度为固定的60位。其中：$是分割符，无意义；2a是bcrypt加密版本号；10是cost的值；而后的前22位是salt值；再然后的字符串就是密码的密文了。</p>
<p>实现步骤：</p>
<p>第一步：在spring-security.xml文件中指定密码加密对象</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置密码加密对象--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;passwordEncoder&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--认证管理器，用于处理认证操作--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">security:authentication-manager</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--认证提供者，执行具体的认证逻辑--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">security:authentication-provider</span> <span class="attr">user-service-ref</span>=<span class="string">&quot;userService&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--指定密码加密策略--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">security:password-encoder</span> <span class="attr">ref</span>=<span class="string">&quot;passwordEncoder&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">security:authentication-provider</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">security:authentication-manager</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--开启spring注解使用--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:annotation-config</span>&gt;</span><span class="tag">&lt;/<span class="name">context:annotation-config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第二步：修改UserService实现类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.security;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.GrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.authority.SimpleGrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UsernameNotFoundException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> <span class="keyword">implements</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BCryptPasswordEncoder passwordEncoder;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>  Map&lt;String, com.itheima.pojo.User&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();<span class="comment">//模拟数据库中的用户数据</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initData</span><span class="params">()</span>&#123;</span><br><span class="line">        com.itheima.pojo.<span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">com</span>.itheima.pojo.User();</span><br><span class="line">        user1.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        user1.setPassword(passwordEncoder.encode(<span class="string">&quot;admin&quot;</span>));</span><br><span class="line"></span><br><span class="line">        com.itheima.pojo.<span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">com</span>.itheima.pojo.User();</span><br><span class="line">        user2.setUsername(<span class="string">&quot;xiaoming&quot;</span>);</span><br><span class="line">        user2.setPassword(passwordEncoder.encode(<span class="string">&quot;1234&quot;</span>));</span><br><span class="line"></span><br><span class="line">        map.put(user1.getUsername(),user1);</span><br><span class="line">        map.put(user2.getUsername(),user2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户名加载用户信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> UsernameNotFoundException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">        initData();</span><br><span class="line">        System.out.println(<span class="string">&quot;username:&quot;</span> + username);</span><br><span class="line">        com.itheima.pojo.<span class="type">User</span> <span class="variable">userInDb</span> <span class="operator">=</span> map.get(username);<span class="comment">//模拟根据用户名查询数据库</span></span><br><span class="line">        <span class="keyword">if</span>(userInDb == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//根据用户名没有查询到用户</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">passwordInDb</span> <span class="operator">=</span> userInDb.getPassword();<span class="comment">//模拟数据库中的密码，后期需要查询数据库</span></span><br><span class="line"></span><br><span class="line">        List&lt;GrantedAuthority&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//授权，后期需要改为查询数据库动态获得用户拥有的权限和角色</span></span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(<span class="string">&quot;add&quot;</span>));</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(<span class="string">&quot;delete&quot;</span>));</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(<span class="string">&quot;ROLE_ADMIN&quot;</span>));</span><br><span class="line">        <span class="type">UserDetails</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(username,passwordInDb,list);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-5-5-配置多种校验规则"><a href="#3-5-5-配置多种校验规则" class="headerlink" title="3.5.5 配置多种校验规则"></a>3.5.5 配置多种校验规则</h4><p>为了测试方便，首先在项目中创建a.html、b.html、c.html、d.html几个页面</p>
<p>修改spring-security.xml文件：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--只要认证通过就可以访问--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">security:intercept-url</span> <span class="attr">pattern</span>=<span class="string">&quot;/index.jsp&quot;</span>  <span class="attr">access</span>=<span class="string">&quot;isAuthenticated()&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">security:intercept-url</span> <span class="attr">pattern</span>=<span class="string">&quot;/a.html&quot;</span>  <span class="attr">access</span>=<span class="string">&quot;isAuthenticated()&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--拥有add权限就可以访问b.html页面--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">security:intercept-url</span> <span class="attr">pattern</span>=<span class="string">&quot;/b.html&quot;</span>  <span class="attr">access</span>=<span class="string">&quot;hasAuthority(&#x27;add&#x27;)&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--拥有ROLE_ADMIN角色就可以访问c.html页面--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">security:intercept-url</span> <span class="attr">pattern</span>=<span class="string">&quot;/c.html&quot;</span>  <span class="attr">access</span>=<span class="string">&quot;hasRole(&#x27;ROLE_ADMIN&#x27;)&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--拥有ROLE_ADMIN角色就可以访问d.html页面，</span></span><br><span class="line"><span class="comment">	注意：此处虽然写的是ADMIN角色，框架会自动加上前缀ROLE_--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">security:intercept-url</span> <span class="attr">pattern</span>=<span class="string">&quot;/d.html&quot;</span>  <span class="attr">access</span>=<span class="string">&quot;hasRole(&#x27;ADMIN&#x27;)&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-5-6-注解方式权限控制"><a href="#3-5-6-注解方式权限控制" class="headerlink" title="3.5.6 注解方式权限控制"></a>3.5.6 注解方式权限控制</h4><p>Spring Security除了可以在配置文件中配置权限校验规则，还可以使用注解方式控制类中方法的调用。例如Controller中的某个方法要求必须具有某个权限才可以访问，此时就可以使用Spring Security框架提供的注解方式进行控制。</p>
<p>实现步骤：</p>
<p>第一步：在spring-security.xml文件中配置组件扫描，用于扫描Controller</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.itheima.controller&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第二步：在spring-security.xml文件中开启权限注解支持</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--开启注解方式权限控制--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">security:global-method-security</span> <span class="attr">pre-post-annotations</span>=<span class="string">&quot;enabled&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>第三步：创建Controller类并在Controller的方法上加入注解进行权限控制</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.security.access.prepost.PreAuthorize;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/add&quot;)</span></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasAuthority(&#x27;add&#x27;)&quot;)</span><span class="comment">//表示用户必须拥有add权限才能调用当前方法</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">add</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;add...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/delete&quot;)</span></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasRole(&#x27;ROLE_ADMIN&#x27;)&quot;)</span><span class="comment">//表示用户必须拥有ROLE_ADMIN角色才能调用当前方法</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">delete</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;delete...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-5-7-退出登录"><a href="#3-5-7-退出登录" class="headerlink" title="3.5.7 退出登录"></a>3.5.7 退出登录</h4><p>用户完成登录后Spring Security框架会记录当前用户认证状态为已认证状态，即表示用户登录成功了。那用户如何退出登录呢？我们可以在spring-security.xml文件中进行如下配置：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  logout：退出登录</span></span><br><span class="line"><span class="comment">  logout-url：退出登录操作对应的请求路径</span></span><br><span class="line"><span class="comment">  logout-success-url：退出登录后的跳转页面</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">security:logout</span> <span class="attr">logout-url</span>=<span class="string">&quot;/logout.do&quot;</span> </span></span><br><span class="line"><span class="tag">                 <span class="attr">logout-success-url</span>=<span class="string">&quot;/login.html&quot;</span> <span class="attr">invalidate-session</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">       </span><br></pre></td></tr></table></figure>

<p>通过上面的配置可以发现，如果用户要退出登录，只需要请求&#x2F;logout.do这个URL地址就可以，同时会将当前session失效，最后页面会跳转到login.html页面。</p>
<h1 id="第10章-权限控制、图形报表"><a href="#第10章-权限控制、图形报表" class="headerlink" title="第10章 权限控制、图形报表"></a>第10章 权限控制、图形报表</h1><h2 id="1-在项目中应用Spring-Security"><a href="#1-在项目中应用Spring-Security" class="headerlink" title="1. 在项目中应用Spring Security"></a>1. 在项目中应用Spring Security</h2><p>前面我们已经学习了Spring Security框架的使用方法，本章节我们就需要将Spring Security框架应用到后台系统中进行权限控制，其本质就是认证和授权。</p>
<p>要进行认证和授权需要前面课程中提到的权限模型涉及的7张表支撑，因为用户信息、权限信息、菜单信息、角色信息、关联信息等都保存在这7张表中，也就是这些表中的数据是我们进行认证和授权的依据。所以在真正进行认证和授权之前需要对这些数据进行管理，即我们需要开发如下一些功能：</p>
<p>1、权限数据管理（增删改查）</p>
<p>2、菜单数据管理（增删改查）</p>
<p>3、角色数据管理（增删改查、角色关联权限、角色关联菜单）</p>
<p>4、用户数据管理（增删改查、用户关联角色）</p>
<p>鉴于时间关系，我们不再实现这些数据管理的代码开发。我们可以直接将数据导入到数据库中即可。</p>
<h3 id="1-1-导入Spring-Security环境"><a href="#1-1-导入Spring-Security环境" class="headerlink" title="1.1 导入Spring Security环境"></a>1.1 导入Spring Security环境</h3><p>第一步：在health_parent父工程的pom.xml中导入Spring Security的maven坐标</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupid</span>&gt;</span>org.springframework.security<span class="tag">&lt;/<span class="name">groupid</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactid</span>&gt;</span>spring-security-web<span class="tag">&lt;/<span class="name">artifactid</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.security.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupid</span>&gt;</span>org.springframework.security<span class="tag">&lt;/<span class="name">groupid</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactid</span>&gt;</span>spring-security-config<span class="tag">&lt;/<span class="name">artifactid</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.security.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第二步：在health_backend工程的web.xml文件中配置用于整合Spring Security框架的过滤器DelegatingFilterProxy</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--委派过滤器，用于整合其他框架--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--整合spring security时，此过滤器的名称固定springSecurityFilterChain--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>springSecurityFilterChain<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>springSecurityFilterChain<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="1-2-实现认证和授权"><a href="#1-2-实现认证和授权" class="headerlink" title="1.2 实现认证和授权"></a>1.2 实现认证和授权</h3><p>第一步：在health_backend工程中按照Spring Security框架要求提供SpringSecurityUserService，并且实现UserDetailsService接口</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.security;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Reference;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.CheckItem;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Permission;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Role;</span><br><span class="line"><span class="keyword">import</span> com.itheima.service.CheckItemService;</span><br><span class="line"><span class="keyword">import</span> com.itheima.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.GrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.authority.SimpleGrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UsernameNotFoundException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringSecurityUserService</span> <span class="keyword">implements</span> <span class="title class_">UserDetailsService</span>&#123;</span><br><span class="line">    <span class="meta">@Reference</span> <span class="comment">//注意：此处要通过dubbo远程调用用户服务</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">//根据用户名查询用户信息</span></span><br><span class="line">    <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">      	<span class="comment">//远程调用用户服务，根据用户名查询用户信息</span></span><br><span class="line">        com.itheima.pojo.<span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.findByUsername(username);</span><br><span class="line">        <span class="keyword">if</span>(user == <span class="literal">null</span>)&#123;</span><br><span class="line">              <span class="comment">//用户名不存在</span></span><br><span class="line">              <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;grantedauthority&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Set&lt;role&gt; roles = user.getRoles();</span><br><span class="line">        <span class="keyword">for</span>(Role role : roles)&#123;</span><br><span class="line">            <span class="comment">//授予角色</span></span><br><span class="line">            list.add(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(role.getKeyword()));</span><br><span class="line">            Set&lt;permission&gt; permissions = role.getPermissions();</span><br><span class="line">            <span class="keyword">for</span>(Permission permission : permissions)&#123;</span><br><span class="line">              	<span class="comment">//授权</span></span><br><span class="line">                list.add(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(permission.getKeyword()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">UserDetails</span> <span class="variable">userDetails</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(username,user.getPassword(),list);</span><br><span class="line">        <span class="keyword">return</span> userDetails;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第二步：创建UserService服务接口、服务实现类、Dao接口、Mapper映射文件等</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.User;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户服务接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findByUsername</span><span class="params">(String username)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">package</span> com.itheima.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Service;</span><br><span class="line"><span class="keyword">import</span> com.itheima.dao.PermissionDao;</span><br><span class="line"><span class="keyword">import</span> com.itheima.dao.RoleDao;</span><br><span class="line"><span class="keyword">import</span> com.itheima.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Permission;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Role;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service(interfaceClass = UserService.class)</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RoleDao roleDao;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PermissionDao permissionDao;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findByUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userDao.findByUsername(username);</span><br><span class="line">        <span class="keyword">if</span>(user == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">userId</span> <span class="operator">=</span> user.getId();</span><br><span class="line">        Set&lt;role&gt; roles = roleDao.findByUserId(userId);</span><br><span class="line">        <span class="keyword">if</span>(roles != <span class="literal">null</span> &amp;&amp; roles.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(Role role : roles)&#123;</span><br><span class="line">                <span class="type">Integer</span> <span class="variable">roleId</span> <span class="operator">=</span> role.getId();</span><br><span class="line">                Set&lt;permission&gt; permissions = permissionDao.findByRoleId(roleId);</span><br><span class="line">                <span class="keyword">if</span>(permissions != <span class="literal">null</span> &amp;&amp; permissions.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                    role.setPermissions(permissions);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            user.setRoles(roles);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">package</span> com.itheima.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findByUsername</span><span class="params">(String username)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">package</span> com.itheima.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Role;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RoleDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Set&lt;role&gt; <span class="title function_">findByUserId</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">package</span> com.itheima.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Permission;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PermissionDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Set&lt;permission&gt; <span class="title function_">findByRoleId</span><span class="params">(<span class="type">int</span> roleId)</span>;</span><br><span class="line">&#125;</span><br><span class="line">&lt;!--?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?--&gt;</span><br><span class="line"></span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.itheima.dao.UserDao&quot;</span>&gt;</span><br><span class="line">    &lt;select id=<span class="string">&quot;findByUsername&quot;</span> parametertype=<span class="string">&quot;string&quot;</span> resulttype=<span class="string">&quot;com.itheima.pojo.User&quot;</span>&gt;</span><br><span class="line">        select * from t_user <span class="type">where</span> <span class="variable">username</span> <span class="operator">=</span> #&#123;username&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line">&lt;!--?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?--&gt;</span><br><span class="line"></span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.itheima.dao.RoleDao&quot;</span>&gt;</span><br><span class="line">    &lt;select id=<span class="string">&quot;findByUserId&quot;</span> parametertype=<span class="string">&quot;int&quot;</span> resulttype=<span class="string">&quot;com.itheima.pojo.Role&quot;</span>&gt;</span><br><span class="line">        select  r.* </span><br><span class="line">      		from t_role r ,t_user_role ur </span><br><span class="line">      		where r.id = ur.role_id and ur.user_id = #&#123;userId&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line">&lt;!--?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?--&gt;</span><br><span class="line"></span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.itheima.dao.PermissionDao&quot;</span>&gt;</span><br><span class="line">    &lt;select id=<span class="string">&quot;findByRoleId&quot;</span> parametertype=<span class="string">&quot;int&quot;</span> resulttype=<span class="string">&quot;com.itheima.pojo.Permission&quot;</span>&gt;</span><br><span class="line">        select  p.* </span><br><span class="line">      		from t_permission p ,t_role_permission rp </span><br><span class="line">      		where p.id = rp.permission_id and rp.role_id = #&#123;roleId&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>

<p>第三步：修改health_backend工程中的springmvc.xml文件，修改dubbo批量扫描的包路径</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--批量扫描--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:annotation</span> <span class="attr">package</span>=<span class="string">&quot;com.itheima&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong>此处原来扫描的包为com.itheima.controller，现在改为com.itheima包的目的是需要将我们上面定义的SpringSecurityUserService也扫描到，因为在SpringSecurityUserService的loadUserByUsername方法中需要通过dubbo远程调用名称为UserService的服务。</p>
<p>第四步：在health_backend工程中提供spring-security.xml配置文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span> <span class="attr">xmlns:dubbo</span>=<span class="string">&quot;http://code.alibabatech.com/schema/dubbo&quot;</span> <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span> <span class="attr">xmlns:security</span>=<span class="string">&quot;http://www.springframework.org/schema/security&quot;</span> <span class="attr">xsi:schemalocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://code.alibabatech.com/schema/dubbo</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://code.alibabatech.com/schema/dubbo/dubbo.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                          http://www.springframework.org/schema/security</span></span></span><br><span class="line"><span class="string"><span class="tag">                          http://www.springframework.org/schema/security/spring-security.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        http：用于定义相关权限控制</span></span><br><span class="line"><span class="comment">        指定哪些资源不需要进行权限校验，可以使用通配符</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">security:http</span> <span class="attr">security</span>=<span class="string">&quot;none&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;/js/**&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">security:http</span> <span class="attr">security</span>=<span class="string">&quot;none&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;/css/**&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">security:http</span> <span class="attr">security</span>=<span class="string">&quot;none&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;/img/**&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">security:http</span> <span class="attr">security</span>=<span class="string">&quot;none&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;/plugins/**&quot;</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        http：用于定义相关权限控制</span></span><br><span class="line"><span class="comment">        auto-config：是否自动配置</span></span><br><span class="line"><span class="comment">                        设置为true时框架会提供默认的一些配置，例如提供默认的登录页面、登出处理等</span></span><br><span class="line"><span class="comment">                        设置为false时需要显示提供登录表单配置，否则会报错</span></span><br><span class="line"><span class="comment">        use-expressions：用于指定intercept-url中的access属性是否使用表达式</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">security:http</span> <span class="attr">auto-config</span>=<span class="string">&quot;true&quot;</span> <span class="attr">use-expressions</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">security:headers</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--设置在页面可以通过iframe访问受保护的页面，默认为不允许访问--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">security:frame-options</span> <span class="attr">policy</span>=<span class="string">&quot;SAMEORIGIN&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">security:frame-options</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">security:headers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            intercept-url：定义一个拦截规则</span></span><br><span class="line"><span class="comment">            pattern：对哪些url进行权限控制</span></span><br><span class="line"><span class="comment">            access：在请求对应的URL时需要什么权限，默认配置时它应该是一个以逗号分隔的角色列表，</span></span><br><span class="line"><span class="comment">				  请求的用户只需拥有其中的一个角色就能成功访问对应的URL</span></span><br><span class="line"><span class="comment">            isAuthenticated()：已经经过认证（不是匿名用户）</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">security:intercept-url</span> <span class="attr">pattern</span>=<span class="string">&quot;/pages/**&quot;</span> <span class="attr">access</span>=<span class="string">&quot;isAuthenticated()&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--form-login：定义表单登录信息--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">security:form-login</span> <span class="attr">login-page</span>=<span class="string">&quot;/login.html&quot;</span> <span class="attr">username-parameter</span>=<span class="string">&quot;username&quot;</span> <span class="attr">password-parameter</span>=<span class="string">&quot;password&quot;</span> <span class="attr">login-processing-url</span>=<span class="string">&quot;/login.do&quot;</span> <span class="attr">default-target-url</span>=<span class="string">&quot;/pages/main.html&quot;</span> <span class="attr">always-use-default-target</span>=<span class="string">&quot;true&quot;</span> <span class="attr">authentication-failure-url</span>=<span class="string">&quot;/login.html&quot;</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            csrf：对应CsrfFilter过滤器</span></span><br><span class="line"><span class="comment">            disabled：是否启用CsrfFilter过滤器，如果使用自定义登录页面需要关闭此项，</span></span><br><span class="line"><span class="comment">					否则登录操作会被禁用（403）</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">security:csrf</span> <span class="attr">disabled</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">security:csrf</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">security:form-login</span>&gt;</span><span class="tag">&lt;/<span class="name">security:intercept-url</span>&gt;</span><span class="tag">&lt;/<span class="name">security:http</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置密码加密对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;passwordEncoder&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--认证管理器，用于处理认证操作--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">security:authentication-manager</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--认证提供者，执行具体的认证逻辑--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">security:authentication-provider</span> <span class="attr">user-service-ref</span>=<span class="string">&quot;springSecurityUserService&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--指定密码加密策略--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">security:password-encoder</span> <span class="attr">ref</span>=<span class="string">&quot;passwordEncoder&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">security:password-encoder</span>&gt;</span><span class="tag">&lt;/<span class="name">security:authentication-provider</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">security:authentication-manager</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--开启注解方式权限控制--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">security:global-method-security</span> <span class="attr">pre-post-annotations</span>=<span class="string">&quot;enabled&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">security:global-method-security</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span><span class="tag">&lt;/<span class="name">security:http</span>&gt;</span><span class="tag">&lt;/<span class="name">security:http</span>&gt;</span><span class="tag">&lt;/<span class="name">security:http</span>&gt;</span><span class="tag">&lt;/<span class="name">security:http</span>&gt;</span><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第五步：在springmvc.xml文件中引入spring-security.xml文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;spring-security.xml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">import</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第六步：在Controller的方法上加入权限控制注解，此处以CheckItemController为例</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Reference;</span><br><span class="line"><span class="keyword">import</span> com.itheima.constant.MessageConstant;</span><br><span class="line"><span class="keyword">import</span> com.itheima.constant.PermissionConstant;</span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.PageResult;</span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.QueryPageBean;</span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.Result;</span><br><span class="line"><span class="keyword">import</span> com.itheima.exception.CustomException;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.CheckItem;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Member;</span><br><span class="line"><span class="keyword">import</span> com.itheima.service.CheckItemService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.access.annotation.Secured;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.access.prepost.PreAuthorize;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.commons.CommonsMultipartFile;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 体检检查项管理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/checkitem&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CheckItemController</span> &#123;</span><br><span class="line">    <span class="meta">@Reference</span></span><br><span class="line">    <span class="keyword">private</span> CheckItemService checkItemService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//分页查询</span></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasAuthority(&#x27;CHECKITEM_QUERY&#x27;)&quot;)</span><span class="comment">//权限校验</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/findPage&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> PageResult <span class="title function_">findPage</span><span class="params">(<span class="meta">@RequestBody</span> QueryPageBean queryPageBean)</span>&#123;</span><br><span class="line">        <span class="type">PageResult</span> <span class="variable">pageResult</span> <span class="operator">=</span> checkItemService.pageQuery(</span><br><span class="line">                                    queryPageBean.getCurrentPage(), </span><br><span class="line">                                    queryPageBean.getPageSize(), </span><br><span class="line">                                    queryPageBean.getQueryString());</span><br><span class="line">        <span class="keyword">return</span> pageResult;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除</span></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasAuthority(&#x27;CHECKITEM_DELETE&#x27;)&quot;)</span><span class="comment">//权限校验</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/delete&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">delete</span><span class="params">(Integer id)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            checkItemService.delete(id);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (RuntimeException e)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>,e.getMessage());</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>, MessageConstant.DELETE_CHECKITEM_FAIL);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>,MessageConstant.DELETE_CHECKITEM_SUCCESS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//新增</span></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasAuthority(&#x27;CHECKITEM_ADD&#x27;)&quot;)</span><span class="comment">//权限校验</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/add&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">add</span><span class="params">(<span class="meta">@RequestBody</span> CheckItem checkItem)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            checkItemService.add(checkItem);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>,MessageConstant.ADD_CHECKITEM_FAIL);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>,MessageConstant.ADD_CHECKITEM_SUCCESS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//编辑</span></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasAuthority(&#x27;CHECKITEM_EDIT&#x27;)&quot;)</span><span class="comment">//权限校验</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/edit&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">edit</span><span class="params">(<span class="meta">@RequestBody</span> CheckItem checkItem)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            checkItemService.edit(checkItem);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>,MessageConstant.EDIT_CHECKITEM_FAIL);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>,MessageConstant.EDIT_CHECKITEM_SUCCESS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第七步：修改页面，没有权限时提示信息设置，此处以checkitem.html中的handleDelete方法为例</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//权限不足提示</span></span><br><span class="line"><span class="title function_">showMessage</span>(<span class="params">r</span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(r == <span class="string">&#x27;Error: Request failed with status code 403&#x27;</span>)&#123;</span><br><span class="line">    <span class="comment">//权限不足</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&#x27;无访问权限&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&#x27;未知错误&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 删除</span></span><br><span class="line"><span class="title function_">handleDelete</span>(<span class="params">row</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.$confirm(<span class="string">&#x27;此操作将永久当前数据，是否继续?&#x27;</span>, <span class="string">&#x27;提示&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;warning&#x27;</span></span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//点击确定按钮执行此代码</span></span><br><span class="line">    axios.<span class="title function_">get</span>(<span class="string">&quot;/checkitem/delete.do?id=&quot;</span> + row.<span class="property">id</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(!res.<span class="property">data</span>.<span class="property">flag</span>)&#123;</span><br><span class="line">        <span class="comment">//删除失败</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(res.<span class="property">data</span>.<span class="property">message</span>);</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//删除成功</span></span><br><span class="line">        <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">          <span class="attr">message</span>: res.<span class="property">data</span>.<span class="property">message</span>,</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">findPage</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">r</span>)=&gt;</span>&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">showMessage</span>(r);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function">()=&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//点击取消按钮执行此代码</span></span><br><span class="line">    <span class="variable language_">this</span>.$message(<span class="string">&#x27;操作已取消&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-3-显示用户名"><a href="#1-3-显示用户名" class="headerlink" title="1.3 显示用户名"></a>1.3 显示用户名</h3><p>前面我们已经完成了认证和授权操作，如果用户认证成功后需要在页面展示当前用户的用户名。Spring Security在认证成功后会将用户信息保存到框架提供的上下文对象中，所以此处我们就可以调用Spring Security框架提供的API获取当前用户的username并展示到页面上。</p>
<p>实现步骤：</p>
<p>第一步：在main.html页面中修改，定义username模型数据基于VUE的数据绑定展示用户名，发送ajax请求获取username</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">        <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>:&#123;</span><br><span class="line">            <span class="attr">username</span>:<span class="literal">null</span>,<span class="comment">//用户名</span></span><br><span class="line">    	    <span class="attr">menuList</span>:[]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">created</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="comment">//发送请求获取当前登录用户的用户名</span></span><br><span class="line">            axios.<span class="title function_">get</span>(<span class="string">&#x27;/user/getUsername.do&#x27;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>)=&gt;</span>&#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">username</span> = response.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;avatar-wrapper&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;../img/user2-160x160.jpg&quot;</span> <span class="attr">class</span>=<span class="string">&quot;user-avatar&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="comment">&lt;!--展示用户名--&gt;</span></span></span><br><span class="line"><span class="language-xml">  &#123;&#123;username&#125;&#125;</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>第二步：创建UserController并提供getUsername方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.constant.MessageConstant;</span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.Result;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.context.SecurityContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.context.SecurityContextImpl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="comment">//获取当前登录用户的用户名</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/getUsername&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">getUsername</span><span class="params">()</span><span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            org.springframework.security.core.userdetails.<span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span></span><br><span class="line">                    (org.springframework.security.core.userdetails.User)</span><br><span class="line">                    SecurityContextHolder.getContext().getAuthentication().getPrincipal();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>, MessageConstant.GET_USERNAME_SUCCESS,user.getUsername());</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>, MessageConstant.GET_USERNAME_FAIL);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过debug调试可以看到Spring Security框架在其上下文中保存的用户相关信息：</p>
<p><img src="/../../assets/2143930-20210826122444162-1547231698.png" alt="img"></p>
<h3 id="1-4-用户退出"><a href="#1-4-用户退出" class="headerlink" title="1.4 用户退出"></a>1.4 用户退出</h3><p>第一步：在main.html中提供的退出菜单上加入超链接</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-dropdown-item</span> <span class="attr">divided</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;display:block;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/logout.do&quot;</span>&gt;</span>退出<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-dropdown-item</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第二步：在spring-security.xml文件中配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  logout：退出登录</span></span><br><span class="line"><span class="comment">  logout-url：退出登录操作对应的请求路径</span></span><br><span class="line"><span class="comment">  logout-success-url：退出登录后的跳转页面</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">security:logout</span> <span class="attr">logout-url</span>=<span class="string">&quot;/logout.do&quot;</span> <span class="attr">logout-success-url</span>=<span class="string">&quot;/login.html&quot;</span> <span class="attr">invalidate-session</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-图形报表ECharts"><a href="#2-图形报表ECharts" class="headerlink" title="2. 图形报表ECharts"></a>2. 图形报表ECharts</h2><h3 id="2-1-ECharts简介"><a href="#2-1-ECharts简介" class="headerlink" title="2.1 ECharts简介"></a>2.1 ECharts简介</h3><p>ECharts缩写来自Enterprise Charts，商业级数据图表，是百度的一个开源的使用JavaScript实现的数据可视化工具，可以流畅的运行在 PC 和移动设备上，兼容当前绝大部分浏览器（IE8&#x2F;9&#x2F;10&#x2F;11，Chrome，Firefox，Safari等），底层依赖轻量级的矢量图形库 <a target="_blank" rel="noopener" href="https://github.com/ecomfe/zrender">ZRender</a>，提供直观、交互丰富、可高度个性化定制的数据可视化图表。</p>
<p>官网：<a target="_blank" rel="noopener" href="https://echarts.baidu.com/">https://echarts.baidu.com/</a></p>
<p>下载地址：<a target="_blank" rel="noopener" href="https://echarts.baidu.com/download.html">https://echarts.baidu.com/download.html</a></p>
<p><img src="/../../assets/2143930-20210826122503356-1593807669.png" alt="img"></p>
<p>下载完成可以得到如下文件：</p>
<p><img src="/../../assets/2143930-20210826122510985-145090442.png" alt="img"></p>
<p>解压上面的zip文件：</p>
<p><img src="/../../assets/2143930-20210826122516573-1966004505.png" alt="img"></p>
<p>我们只需要将dist目录下的echarts.js文件引入到页面上就可以使用了</p>
<p><img src="/../../assets/2143930-20210826122522262-1147088803.png" alt="img"></p>
<h3 id="2-2-5分钟上手ECharts"><a href="#2-2-5分钟上手ECharts" class="headerlink" title="2.2 5分钟上手ECharts"></a>2.2 5分钟上手ECharts</h3><p>我们可以参考官方提供的5分钟上手ECharts文档感受一下ECharts的使用方式，地址如下：</p>
<p><a target="_blank" rel="noopener" href="https://www.echartsjs.com/tutorial.html#5">https://www.echartsjs.com/tutorial.html#5</a> 分钟上手 ECharts</p>
<p>第一步：创建html页面并引入echarts.js文件</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 引入 ECharts 文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;echarts.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第二步：在页面中准备一个具备宽高的DOM容器。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 为 ECharts 准备一个具备大小（宽高）的 DOM --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;main&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 600px;height:400px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第三步：通过echarts.init方法初始化一个 echarts 实例并通过setOption方法生成一个简单的柱状图</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">  <span class="comment">// 基于准备好的dom，初始化echarts实例</span></span><br><span class="line">  <span class="keyword">var</span> myChart = echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;main&#x27;</span>));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 指定图表的配置项和数据</span></span><br><span class="line">  <span class="keyword">var</span> option = &#123;</span><br><span class="line">    <span class="attr">title</span>: &#123;</span><br><span class="line">      <span class="attr">text</span>: <span class="string">&#x27;ECharts 入门示例&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">tooltip</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">legend</span>: &#123;</span><br><span class="line">      <span class="attr">data</span>:[<span class="string">&#x27;销量&#x27;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">xAxis</span>: &#123;</span><br><span class="line">      <span class="attr">data</span>: [<span class="string">&quot;衬衫&quot;</span>,<span class="string">&quot;羊毛衫&quot;</span>,<span class="string">&quot;雪纺衫&quot;</span>,<span class="string">&quot;裤子&quot;</span>,<span class="string">&quot;高跟鞋&quot;</span>,<span class="string">&quot;袜子&quot;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">yAxis</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">series</span>: [&#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;销量&#x27;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: [<span class="number">5</span>, <span class="number">20</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">20</span>]</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用刚指定的配置项和数据显示图表。</span></span><br><span class="line">myChart.<span class="title function_">setOption</span>(option);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="/../../assets/2143930-20210826122532960-449355402.png" alt="img"></p>
<h3 id="2-3-查看ECharts官方实例"><a href="#2-3-查看ECharts官方实例" class="headerlink" title="2.3 查看ECharts官方实例"></a>2.3 查看ECharts官方实例</h3><p>ECharts提供了很多官方实例，我们可以通过这些官方实例来查看展示效果和使用方法。</p>
<p>官方实例地址：<a target="_blank" rel="noopener" href="https://www.echartsjs.com/examples/">https://www.echartsjs.com/examples/</a></p>
<p><img src="/../../assets/2143930-20210826122538480-800031109.png" alt="img"></p>
<p>可以点击具体的一个图形会跳转到编辑页面，编辑页面左侧展示源码（js部分源码），右侧展示图表效果，如下：</p>
<p><img src="/../../assets/2143930-20210826122544302-2098450476.png" alt="img"></p>
<p>要查看完整代码可以点击右下角的Download按钮将完整页面下载到本地。</p>
<p>通过官方案例我们可以发现，使用ECharts展示图表效果，关键点在于确定此图表所需的数据格式，然后按照此数据格式提供数据就可以了，我们无须关注效果是如何渲染出来的。</p>
<p>在实际应用中，我们要展示的数据往往存储在数据库中，所以我们可以发送ajax请求获取数据库中的数据并转为图表所需的数据即可。</p>
<h2 id="3-会员数量折线图"><a href="#3-会员数量折线图" class="headerlink" title="3. 会员数量折线图"></a>3. 会员数量折线图</h2><h3 id="3-1-需求分析"><a href="#3-1-需求分析" class="headerlink" title="3.1 需求分析"></a>3.1 需求分析</h3><p>会员信息是体检机构的核心数据，其会员数量和增长数量可以反映出机构的部分运营情况。通过折线图可以直观的反映出会员数量的增长趋势。本章节我们需要展示过去一年时间内每个月的会员总数据量。展示效果如下图：</p>
<p><img src="/../../assets/2143930-20210826122550894-2087218695.png" alt="img"></p>
<h3 id="3-2-完善页面"><a href="#3-2-完善页面" class="headerlink" title="3.2 完善页面"></a>3.2 完善页面</h3><p>会员数量折线图对应的页面为&#x2F;pages&#x2F;report_member.html。</p>
<h4 id="3-2-1-导入ECharts库"><a href="#3-2-1-导入ECharts库" class="headerlink" title="3.2.1 导入ECharts库"></a>3.2.1 导入ECharts库</h4><p>第一步：将echarts.js文件复制到health_backend工程的plugins目录下</p>
<p>第二步：在report_member.html页面引入echarts.js文件</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../plugins/echarts/echarts.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-参照官方实例导入折线图"><a href="#3-2-2-参照官方实例导入折线图" class="headerlink" title="3.2.2 参照官方实例导入折线图"></a>3.2.2 参照官方实例导入折线图</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 为 ECharts 准备一个具备大小（宽高）的 DOM --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;chart1&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height:600px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 基于准备好的dom，初始化echarts实例</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> myChart1 = echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;chart1&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">//发送ajax请求获取动态数据</span></span></span><br><span class="line"><span class="language-javascript">  axios.<span class="title function_">get</span>(<span class="string">&quot;/report/getMemberReport.do&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    myChart1.<span class="title function_">setOption</span>(</span></span><br><span class="line"><span class="language-javascript">      &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">title</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">text</span>: <span class="string">&#x27;会员数量&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">tooltip</span>: &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">legend</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">data</span>:[<span class="string">&#x27;会员数量&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">xAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">data</span>: res.<span class="property">data</span>.<span class="property">data</span>.<span class="property">months</span></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">yAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">type</span>:<span class="string">&#x27;value&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">series</span>: [&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">name</span>: <span class="string">&#x27;会员数量&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">data</span>: res.<span class="property">data</span>.<span class="property">data</span>.<span class="property">memberCount</span></span></span><br><span class="line"><span class="language-javascript">        &#125;]</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>根据折线图对数据格式的要求，我们发送ajax请求，服务端需要返回如下格式的数据：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;months&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;2019.01&quot;</span><span class="punctuation">,</span><span class="string">&quot;2019.02&quot;</span><span class="punctuation">,</span><span class="string">&quot;2019.03&quot;</span><span class="punctuation">,</span><span class="string">&quot;2019.04&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;memberCount&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="number">3</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span><span class="number">8</span><span class="punctuation">,</span><span class="number">10</span><span class="punctuation">]</span></span><br><span class="line">		   <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;flag&quot;</span><span class="punctuation">:</span><span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;message&quot;</span><span class="punctuation">:</span><span class="string">&quot;获取会员统计数据成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-后台代码"><a href="#3-3-后台代码" class="headerlink" title="3.3 后台代码"></a>3.3 后台代码</h3><h4 id="3-3-1-Controller"><a href="#3-3-1-Controller" class="headerlink" title="3.3.1 Controller"></a>3.3.1 Controller</h4><p>在health_backend工程中创建ReportController并提供getMemberReport方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Reference;</span><br><span class="line"><span class="keyword">import</span> com.itheima.constant.MessageConstant;</span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.Result;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Setmeal;</span><br><span class="line"><span class="keyword">import</span> com.itheima.service.MemberService;</span><br><span class="line"><span class="keyword">import</span> com.itheima.service.ReportService;</span><br><span class="line"><span class="keyword">import</span> com.itheima.service.SetmealService;</span><br><span class="line"><span class="keyword">import</span> com.itheima.utils.DateUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.xssf.usermodel.XSSFRow;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.xssf.usermodel.XSSFSheet;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.xssf.usermodel.XSSFWorkbook;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletOutputStream;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 统计报表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/report&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReportController</span> &#123;</span><br><span class="line">    <span class="meta">@Reference</span></span><br><span class="line">    <span class="keyword">private</span> MemberService memberService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 会员数量统计</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/getMemberReport&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">getMemberReport</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">calendar</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        calendar.add(Calendar.MONTH,-<span class="number">12</span>);<span class="comment">//获得当前日期之前12个月的日期</span></span><br><span class="line"></span><br><span class="line">        List&lt;string&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">12</span>;i++)&#123;</span><br><span class="line">            calendar.add(Calendar.MONTH,<span class="number">1</span>);</span><br><span class="line">            list.add(<span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy.MM&quot;</span>).format(calendar.getTime()));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Map&lt;string,object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;months&quot;</span>,list);</span><br><span class="line"></span><br><span class="line">        List&lt;integer&gt; memberCount = memberService.findMemberCountByMonth(list);</span><br><span class="line">        map.put(<span class="string">&quot;memberCount&quot;</span>,memberCount);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>, MessageConstant.GET_MEMBER_NUMBER_REPORT_SUCCESS,map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-3-2-服务接口"><a href="#3-3-2-服务接口" class="headerlink" title="3.3.2 服务接口"></a>3.3.2 服务接口</h4><p>在MemberService服务接口中扩展方法findMemberCountByMonth</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;integer&gt; <span class="title function_">findMemberCountByMonth</span><span class="params">(List&lt;string&gt; month)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-3-服务实现类-6"><a href="#3-2-3-服务实现类-6" class="headerlink" title="3.2.3 服务实现类"></a>3.2.3 服务实现类</h4><p>在MemberServiceImpl服务实现类中实现findMemberCountByMonth方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//根据月份统计会员数量</span></span><br><span class="line"><span class="keyword">public</span> List&lt;integer&gt; <span class="title function_">findMemberCountByMonth</span><span class="params">(List&lt;string&gt; month)</span> &#123;</span><br><span class="line">  List&lt;integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">  <span class="keyword">for</span>(String m : month)&#123;</span><br><span class="line">    m = m + <span class="string">&quot;.31&quot;</span>;<span class="comment">//格式：2019.04.31</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> memberDao.findMemberCountBeforeDate(m);</span><br><span class="line">    list.add(count);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-3-4-Dao接口"><a href="#3-3-4-Dao接口" class="headerlink" title="3.3.4 Dao接口"></a>3.3.4 Dao接口</h4><p>在MemberDao接口中扩展方法findMemberCountBeforeDate</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Integer <span class="title function_">findMemberCountBeforeDate</span><span class="params">(String date)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="3-3-5-Mapper映射文件"><a href="#3-3-5-Mapper映射文件" class="headerlink" title="3.3.5 Mapper映射文件"></a>3.3.5 Mapper映射文件</h4><p>在MemberDao.xml映射文件中提供SQL语句</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--根据日期统计会员数，统计指定日期之前的会员数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findMemberCountBeforeDate&quot;</span> <span class="attr">parametertype</span>=<span class="string">&quot;string&quot;</span> <span class="attr">resulttype</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">  select count(id) from t_member where regTime &lt;= #&#123;value&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="第11章-图形报表、POI报表"><a href="#第11章-图形报表、POI报表" class="headerlink" title="第11章 图形报表、POI报表"></a>第11章 图形报表、POI报表</h1><h2 id="1-套餐预约占比饼形图"><a href="#1-套餐预约占比饼形图" class="headerlink" title="1. 套餐预约占比饼形图"></a>1. 套餐预约占比饼形图</h2><h3 id="1-1-需求分析"><a href="#1-1-需求分析" class="headerlink" title="1.1 需求分析"></a>1.1 需求分析</h3><p>会员可以通过移动端自助进行体检预约，在预约时需要选择预约的体检套餐。本章节我们需要通过饼形图直观的展示出会员预约的各个套餐占比情况。展示效果如下图：</p>
<p><img src="/../../assets/2143930-20210826122745885-810161627.png" alt="img"></p>
<h3 id="1-2-完善页面"><a href="#1-2-完善页面" class="headerlink" title="1.2 完善页面"></a>1.2 完善页面</h3><p>套餐预约占比饼形图对应的页面为&#x2F;pages&#x2F;report_setmeal.html。</p>
<h4 id="1-2-1-导入ECharts库"><a href="#1-2-1-导入ECharts库" class="headerlink" title="1.2.1 导入ECharts库"></a>1.2.1 导入ECharts库</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../plugins/echarts/echarts.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="1-2-2-参照官方实例导入饼形图"><a href="#1-2-2-参照官方实例导入饼形图" class="headerlink" title="1.2.2 参照官方实例导入饼形图"></a>1.2.2 参照官方实例导入饼形图</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 为 ECharts 准备一个具备大小（宽高）的 DOM --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;chart1&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height:600px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 基于准备好的dom，初始化echarts实例</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> myChart1 = echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;chart1&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">//发送ajax请求获取动态数据</span></span></span><br><span class="line"><span class="language-javascript">  axios.<span class="title function_">get</span>(<span class="string">&quot;/report/getSetmealReport.do&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    myChart1.<span class="title function_">setOption</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">      title : &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">text</span>: <span class="string">&#x27;套餐预约占比&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">subtext</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">x</span>:<span class="string">&#x27;center&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      tooltip : &#123;<span class="comment">//提示框组件</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">trigger</span>: <span class="string">&#x27;item&#x27;</span>,<span class="comment">//触发类型，在饼形图中为item</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">formatter</span>: <span class="string">&quot;&#123;a&#125; &lt;br/&gt;&#123;b&#125; : &#123;c&#125; (&#123;d&#125;%)&quot;</span><span class="comment">//提示内容格式</span></span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">legend</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">orient</span>: <span class="string">&#x27;vertical&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">left</span>: <span class="string">&#x27;left&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>: res.<span class="property">data</span>.<span class="property">data</span>.<span class="property">setmealNames</span></span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      series : [</span></span><br><span class="line"><span class="language-javascript">        &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">name</span>: <span class="string">&#x27;套餐预约占比&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">type</span>: <span class="string">&#x27;pie&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">          radius : <span class="string">&#x27;55%&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">center</span>: [<span class="string">&#x27;50%&#x27;</span>, <span class="string">&#x27;60%&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">data</span>:res.<span class="property">data</span>.<span class="property">data</span>.<span class="property">setmealCount</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">itemStyle</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">emphasis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">shadowBlur</span>: <span class="number">10</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">shadowOffsetX</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">shadowColor</span>: <span class="string">&#x27;rgba(0, 0, 0, 0.5)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      ]</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>根据饼形图对数据格式的要求，我们发送ajax请求，服务端需要返回如下格式的数据：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;setmealNames&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;套餐1&quot;</span><span class="punctuation">,</span><span class="string">&quot;套餐2&quot;</span><span class="punctuation">,</span><span class="string">&quot;套餐3&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;setmealCount&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">							<span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;套餐1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;套餐2&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span><span class="number">30</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;套餐3&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span><span class="number">25</span><span class="punctuation">&#125;</span></span><br><span class="line">						   <span class="punctuation">]</span></span><br><span class="line">		   <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;flag&quot;</span><span class="punctuation">:</span><span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;message&quot;</span><span class="punctuation">:</span><span class="string">&quot;获取套餐统计数据成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="1-3-后台代码"><a href="#1-3-后台代码" class="headerlink" title="1.3 后台代码"></a>1.3 后台代码</h3><h4 id="1-3-1-Controller"><a href="#1-3-1-Controller" class="headerlink" title="1.3.1 Controller"></a>1.3.1 Controller</h4><p>在health_backend工程的ReportController中提供getSetmealReport方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Reference</span></span><br><span class="line"><span class="keyword">private</span> SetmealService setmealService;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 套餐占比统计</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/getSetmealReport&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">getSetmealReport</span><span class="params">()</span>&#123;</span><br><span class="line">  List&lt;Map&lt;String, Object&gt;&gt; list = setmealService.findSetmealCount();</span><br><span class="line"></span><br><span class="line">  Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">  map.put(<span class="string">&quot;setmealCount&quot;</span>,list);</span><br><span class="line"></span><br><span class="line">  List&lt;String&gt; setmealNames = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">  <span class="keyword">for</span>(Map&lt;String,Object&gt; m : list)&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> (String) m.get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">    setmealNames.add(name);</span><br><span class="line">  &#125;</span><br><span class="line">  map.put(<span class="string">&quot;setmealNames&quot;</span>,setmealNames);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>, MessageConstant.GET_SETMEAL_COUNT_REPORT_SUCCESS,map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-3-2-服务接口"><a href="#1-3-2-服务接口" class="headerlink" title="1.3.2 服务接口"></a>1.3.2 服务接口</h4><p>在SetmealService服务接口中扩展方法findSetmealCount</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Map&lt;String,Object&gt;&gt; <span class="title function_">findSetmealCount</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<h4 id="1-3-3-服务实现类"><a href="#1-3-3-服务实现类" class="headerlink" title="1.3.3 服务实现类"></a>1.3.3 服务实现类</h4><p>在SetmealServiceImpl服务实现类中实现findSetmealCount方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">findSetmealCount</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> setmealDao.findSetmealCount();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-3-4-Dao接口"><a href="#1-3-4-Dao接口" class="headerlink" title="1.3.4 Dao接口"></a>1.3.4 Dao接口</h4><p>在SetmealDao接口中扩展方法findSetmealCount</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Map&lt;String,Object&gt;&gt; <span class="title function_">findSetmealCount</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<h4 id="1-3-5-Mapper映射文件"><a href="#1-3-5-Mapper映射文件" class="headerlink" title="1.3.5 Mapper映射文件"></a>1.3.5 Mapper映射文件</h4><p>在SetmealDao.xml映射文件中提供SQL语句</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findSetmealCount&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  select s.name,count(o.id) as value </span><br><span class="line">  	from t_order o ,t_setmeal s </span><br><span class="line">  	where o.setmeal_id = s.id </span><br><span class="line">  	group by s.name</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-运营数据统计"><a href="#2-运营数据统计" class="headerlink" title="2. 运营数据统计"></a>2. 运营数据统计</h2><h3 id="2-1-需求分析-2"><a href="#2-1-需求分析-2" class="headerlink" title="2.1 需求分析"></a>2.1 需求分析</h3><p>通过运营数据统计可以展示出体检机构的运营情况，包括会员数据、预约到诊数据、热门套餐等信息。本章节就是要通过一个表格的形式来展示这些运营数据。效果如下图：</p>
<p><img src="/../../assets/2143930-20210826122801146-1732377011.png" alt="img"></p>
<h3 id="2-2-完善页面-1"><a href="#2-2-完善页面-1" class="headerlink" title="2.2 完善页面"></a>2.2 完善页面</h3><p>运营数据统计对应的页面为&#x2F;pages&#x2F;report_business.html。</p>
<h4 id="2-2-1-定义模型数据"><a href="#2-2-1-定义模型数据" class="headerlink" title="2.2.1 定义模型数据"></a>2.2.1 定义模型数据</h4><p>定义数据模型，通过VUE的数据绑定展示数据</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">var</span> vue = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>:&#123;</span><br><span class="line">      <span class="attr">reportData</span>:&#123;</span><br><span class="line">        <span class="attr">reportDate</span>:<span class="literal">null</span>,</span><br><span class="line">        todayNewMember :<span class="number">0</span>,</span><br><span class="line">        totalMember :<span class="number">0</span>,</span><br><span class="line">        thisWeekNewMember :<span class="number">0</span>,</span><br><span class="line">        thisMonthNewMember :<span class="number">0</span>,</span><br><span class="line">        todayOrderNumber :<span class="number">0</span>,</span><br><span class="line">        todayVisitsNumber :<span class="number">0</span>,</span><br><span class="line">        thisWeekOrderNumber :<span class="number">0</span>,</span><br><span class="line">        thisWeekVisitsNumber :<span class="number">0</span>,</span><br><span class="line">        thisMonthOrderNumber :<span class="number">0</span>,</span><br><span class="line">        thisMonthVisitsNumber :<span class="number">0</span>,</span><br><span class="line">        hotSetmeal :[]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 900px&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;excelTitle&quot;</span> &gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;exportExcel&quot;</span>&gt;</span>导出Excel<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span>运营数据统计</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;excelTime&quot;</span>&gt;</span>日期：&#123;&#123;reportData.reportDate&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;exceTable&quot;</span> <span class="attr">cellspacing</span>=<span class="string">&quot;0&quot;</span> <span class="attr">cellpadding</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;4&quot;</span> <span class="attr">class</span>=<span class="string">&quot;headBody&quot;</span>&gt;</span>会员数据统计<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">width</span>=<span class="string">&#x27;20%&#x27;</span> <span class="attr">class</span>=<span class="string">&quot;tabletrBg&quot;</span>&gt;</span>新增会员数<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">width</span>=<span class="string">&#x27;30%&#x27;</span>&gt;</span>&#123;&#123;reportData.todayNewMember&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">width</span>=<span class="string">&#x27;20%&#x27;</span> <span class="attr">class</span>=<span class="string">&quot;tabletrBg&quot;</span>&gt;</span>总会员数<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">width</span>=<span class="string">&#x27;30%&#x27;</span>&gt;</span>&#123;&#123;reportData.totalMember&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;tabletrBg&quot;</span>&gt;</span>本周新增会员数<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;reportData.thisWeekNewMember&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;tabletrBg&quot;</span>&gt;</span>本月新增会员数<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;reportData.thisMonthNewMember&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;4&quot;</span> <span class="attr">class</span>=<span class="string">&quot;headBody&quot;</span>&gt;</span>预约到诊数据统计<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;tabletrBg&quot;</span>&gt;</span>今日预约数<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;reportData.todayOrderNumber&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;tabletrBg&quot;</span>&gt;</span>今日到诊数<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;reportData.todayVisitsNumber&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;tabletrBg&quot;</span>&gt;</span>本周预约数<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;reportData.thisWeekOrderNumber&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;tabletrBg&quot;</span>&gt;</span>本周到诊数<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;reportData.thisWeekVisitsNumber&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;tabletrBg&quot;</span>&gt;</span>本月预约数<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;reportData.thisMonthOrderNumber&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;tabletrBg&quot;</span>&gt;</span>本月到诊数<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;reportData.thisMonthVisitsNumber&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;4&quot;</span> <span class="attr">class</span>=<span class="string">&quot;headBody&quot;</span>&gt;</span>热门套餐<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;tabletrBg textCenter&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>套餐名称<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>预约数量<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>占比<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>备注<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">v-for</span>=<span class="string">&quot;s in reportData.hotSetmeal&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;s.name&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;s.setmeal_count&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;s.proportion&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h4 id="2-2-2-发送请求获取动态数据"><a href="#2-2-2-发送请求获取动态数据" class="headerlink" title="2.2.2 发送请求获取动态数据"></a>2.2.2 发送请求获取动态数据</h4><p>在VUE的钩子函数中发送ajax请求获取动态数据，通过VUE的数据绑定将数据展示到页面</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">var</span> vue = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>:&#123;</span><br><span class="line">      <span class="attr">reportData</span>:&#123;</span><br><span class="line">        <span class="attr">reportDate</span>:<span class="literal">null</span>,</span><br><span class="line">        todayNewMember :<span class="number">0</span>,</span><br><span class="line">        totalMember :<span class="number">0</span>,</span><br><span class="line">        thisWeekNewMember :<span class="number">0</span>,</span><br><span class="line">        thisMonthNewMember :<span class="number">0</span>,</span><br><span class="line">        todayOrderNumber :<span class="number">0</span>,</span><br><span class="line">        todayVisitsNumber :<span class="number">0</span>,</span><br><span class="line">        thisWeekOrderNumber :<span class="number">0</span>,</span><br><span class="line">        thisWeekVisitsNumber :<span class="number">0</span>,</span><br><span class="line">        thisMonthOrderNumber :<span class="number">0</span>,</span><br><span class="line">        thisMonthVisitsNumber :<span class="number">0</span>,</span><br><span class="line">        hotSetmeal :[]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">//发送ajax请求获取动态数据</span></span><br><span class="line">      axios.<span class="title function_">get</span>(<span class="string">&quot;/report/getBusinessReportData.do&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">reportData</span> = res.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>根据页面对数据格式的要求，我们发送ajax请求，服务端需要返回如下格式的数据：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;todayVisitsNumber&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;reportDate&quot;</span><span class="punctuation">:</span><span class="string">&quot;2019-04-25&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;todayNewMember&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;thisWeekVisitsNumber&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;thisMonthNewMember&quot;</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;thisWeekNewMember&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;totalMember&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;thisMonthOrderNumber&quot;</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;thisMonthVisitsNumber&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;todayOrderNumber&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;thisWeekOrderNumber&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hotSetmeal&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span><span class="attr">&quot;proportion&quot;</span><span class="punctuation">:</span><span class="number">0.4545</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;粉红珍爱(女)升级TM12项筛查体检套餐&quot;</span><span class="punctuation">,</span><span class="attr">&quot;setmeal_count&quot;</span><span class="punctuation">:</span><span class="number">5</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span><span class="attr">&quot;proportion&quot;</span><span class="punctuation">:</span><span class="number">0.1818</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;阳光爸妈升级肿瘤12项筛查体检套餐&quot;</span><span class="punctuation">,</span><span class="attr">&quot;setmeal_count&quot;</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span><span class="attr">&quot;proportion&quot;</span><span class="punctuation">:</span><span class="number">0.1818</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;珍爱高端升级肿瘤12项筛查&quot;</span><span class="punctuation">,</span><span class="attr">&quot;setmeal_count&quot;</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span><span class="attr">&quot;proportion&quot;</span><span class="punctuation">:</span><span class="number">0.0909</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;孕前检查套餐&quot;</span><span class="punctuation">,</span><span class="attr">&quot;setmeal_count&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;flag&quot;</span><span class="punctuation">:</span><span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span><span class="string">&quot;获取运营统计数据成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-后台代码-1"><a href="#2-3-后台代码-1" class="headerlink" title="2.3 后台代码"></a>2.3 后台代码</h3><h4 id="2-3-1-Controller-1"><a href="#2-3-1-Controller-1" class="headerlink" title="2.3.1 Controller"></a>2.3.1 Controller</h4><p>在ReportController中提供getBusinessReportData方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Reference</span></span><br><span class="line"><span class="keyword">private</span> ReportService reportService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取运营统计数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/getBusinessReportData&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">getBusinessReportData</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    Map&lt;String, Object&gt; result = reportService.getBusinessReport();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>,MessageConstant.GET_BUSINESS_REPORT_SUCCESS,result);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">true</span>,MessageConstant.GET_BUSINESS_REPORT_FAIL);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-3-2-服务接口-1"><a href="#2-3-2-服务接口-1" class="headerlink" title="2.3.2 服务接口"></a>2.3.2 服务接口</h4><p>在health_interface工程中创建ReportService服务接口并声明getBusinessReport方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ReportService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获得运营统计数据</span></span><br><span class="line"><span class="comment">     * Map数据格式：</span></span><br><span class="line"><span class="comment">     *      todayNewMember -&gt; number</span></span><br><span class="line"><span class="comment">     *      totalMember -&gt; number</span></span><br><span class="line"><span class="comment">     *      thisWeekNewMember -&gt; number</span></span><br><span class="line"><span class="comment">     *      thisMonthNewMember -&gt; number</span></span><br><span class="line"><span class="comment">     *      todayOrderNumber -&gt; number</span></span><br><span class="line"><span class="comment">     *      todayVisitsNumber -&gt; number</span></span><br><span class="line"><span class="comment">     *      thisWeekOrderNumber -&gt; number</span></span><br><span class="line"><span class="comment">     *      thisWeekVisitsNumber -&gt; number</span></span><br><span class="line"><span class="comment">     *      thisMonthOrderNumber -&gt; number</span></span><br><span class="line"><span class="comment">     *      thisMonthVisitsNumber -&gt; number</span></span><br><span class="line"><span class="comment">     *      hotSetmeals -&gt; List&lt;Setmeal&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title function_">getBusinessReport</span><span class="params">()</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-3-3-服务实现类-1"><a href="#2-3-3-服务实现类-1" class="headerlink" title="2.3.3 服务实现类"></a>2.3.3 服务实现类</h4><p>在health_service_provider工程中创建服务实现类ReportServiceImpl并实现ReportService接口</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Service;</span><br><span class="line"><span class="keyword">import</span> com.itheima.dao.MemberDao;</span><br><span class="line"><span class="keyword">import</span> com.itheima.dao.OrderDao;</span><br><span class="line"><span class="keyword">import</span> com.itheima.utils.DateUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 统计报表服务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service(interfaceClass = ReportService.class)</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReportServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ReportService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MemberDao memberDao;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderDao orderDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获得运营统计数据</span></span><br><span class="line"><span class="comment">     * Map数据格式：</span></span><br><span class="line"><span class="comment">     *      todayNewMember -&gt; number</span></span><br><span class="line"><span class="comment">     *      totalMember -&gt; number</span></span><br><span class="line"><span class="comment">     *      thisWeekNewMember -&gt; number</span></span><br><span class="line"><span class="comment">     *      thisMonthNewMember -&gt; number</span></span><br><span class="line"><span class="comment">     *      todayOrderNumber -&gt; number</span></span><br><span class="line"><span class="comment">     *      todayVisitsNumber -&gt; number</span></span><br><span class="line"><span class="comment">     *      thisWeekOrderNumber -&gt; number</span></span><br><span class="line"><span class="comment">     *      thisWeekVisitsNumber -&gt; number</span></span><br><span class="line"><span class="comment">     *      thisMonthOrderNumber -&gt; number</span></span><br><span class="line"><span class="comment">     *      thisMonthVisitsNumber -&gt; number</span></span><br><span class="line"><span class="comment">     *      hotSetmeal -&gt; List&lt;Setmeal&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getBusinessReport</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">      	<span class="comment">//获得当前日期</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">today</span> <span class="operator">=</span> DateUtils.parseDate2String(DateUtils.getToday());</span><br><span class="line">        <span class="comment">//获得本周一的日期</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">thisWeekMonday</span> <span class="operator">=</span> DateUtils.parseDate2String(DateUtils.getThisWeekMonday());</span><br><span class="line">        <span class="comment">//获得本月第一天的日期  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">firstDay4ThisMonth</span> <span class="operator">=</span> </span><br><span class="line">          					DateUtils.parseDate2String(DateUtils.getFirstDay4ThisMonth());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//今日新增会员数</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">todayNewMember</span> <span class="operator">=</span> memberDao.findMemberCountByDate(today);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//总会员数</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">totalMember</span> <span class="operator">=</span> memberDao.findMemberTotalCount();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//本周新增会员数</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">thisWeekNewMember</span> <span class="operator">=</span> memberDao.findMemberCountAfterDate(thisWeekMonday);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//本月新增会员数</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">thisMonthNewMember</span> <span class="operator">=</span> memberDao.findMemberCountAfterDate(firstDay4ThisMonth);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//今日预约数</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">todayOrderNumber</span> <span class="operator">=</span> orderDao.findOrderCountByDate(today);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//本周预约数</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">thisWeekOrderNumber</span> <span class="operator">=</span> orderDao.findOrderCountAfterDate(thisWeekMonday);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//本月预约数</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">thisMonthOrderNumber</span> <span class="operator">=</span> orderDao.findOrderCountAfterDate(firstDay4ThisMonth);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//今日到诊数</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">todayVisitsNumber</span> <span class="operator">=</span> orderDao.findVisitsCountByDate(today);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//本周到诊数</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">thisWeekVisitsNumber</span> <span class="operator">=</span> orderDao.findVisitsCountAfterDate(thisWeekMonday);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//本月到诊数</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">thisMonthVisitsNumber</span> <span class="operator">=</span> orderDao.findVisitsCountAfterDate(firstDay4ThisMonth);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//热门套餐（取前4）</span></span><br><span class="line">        List&lt;Map&gt; hotSetmeal = orderDao.findHotSetmeal();</span><br><span class="line"></span><br><span class="line">        Map&lt;String,Object&gt; result = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        result.put(<span class="string">&quot;reportDate&quot;</span>,today);</span><br><span class="line">        result.put(<span class="string">&quot;todayNewMember&quot;</span>,todayNewMember);</span><br><span class="line">        result.put(<span class="string">&quot;totalMember&quot;</span>,totalMember);</span><br><span class="line">        result.put(<span class="string">&quot;thisWeekNewMember&quot;</span>,thisWeekNewMember);</span><br><span class="line">        result.put(<span class="string">&quot;thisMonthNewMember&quot;</span>,thisMonthNewMember);</span><br><span class="line">        result.put(<span class="string">&quot;todayOrderNumber&quot;</span>,todayOrderNumber);</span><br><span class="line">        result.put(<span class="string">&quot;thisWeekOrderNumber&quot;</span>,thisWeekOrderNumber);</span><br><span class="line">        result.put(<span class="string">&quot;thisMonthOrderNumber&quot;</span>,thisMonthOrderNumber);</span><br><span class="line">        result.put(<span class="string">&quot;todayVisitsNumber&quot;</span>,todayVisitsNumber);</span><br><span class="line">        result.put(<span class="string">&quot;thisWeekVisitsNumber&quot;</span>,thisWeekVisitsNumber);</span><br><span class="line">        result.put(<span class="string">&quot;thisMonthVisitsNumber&quot;</span>,thisMonthVisitsNumber);</span><br><span class="line">        result.put(<span class="string">&quot;hotSetmeal&quot;</span>,hotSetmeal);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-3-4-Dao接口-1"><a href="#2-3-4-Dao接口-1" class="headerlink" title="2.3.4 Dao接口"></a>2.3.4 Dao接口</h4><p>在OrderDao和MemberDao中声明相关统计查询方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Order;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Order order)</span>;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Order&gt; <span class="title function_">findByCondition</span><span class="params">(Order order)</span>;</span><br><span class="line">    <span class="keyword">public</span> Map <span class="title function_">findById4Detail</span><span class="params">(Integer id)</span>;</span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">findOrderCountByDate</span><span class="params">(String date)</span>;</span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">findOrderCountAfterDate</span><span class="params">(String date)</span>;</span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">findVisitsCountByDate</span><span class="params">(String date)</span>;</span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">findVisitsCountAfterDate</span><span class="params">(String date)</span>;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Map&gt; <span class="title function_">findHotSetmeal</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">package</span> com.itheima.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.Page;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Member;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MemberDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Member&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> Page&lt;Member&gt; <span class="title function_">selectByCondition</span><span class="params">(String queryString)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Member member)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Integer id)</span>;</span><br><span class="line">    <span class="keyword">public</span> Member <span class="title function_">findById</span><span class="params">(Integer id)</span>;</span><br><span class="line">    <span class="keyword">public</span> Member <span class="title function_">findByTelephone</span><span class="params">(String telephone)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">edit</span><span class="params">(Member member)</span>;</span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">findMemberCountBeforeDate</span><span class="params">(String date)</span>;</span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">findMemberCountByDate</span><span class="params">(String date)</span>;</span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">findMemberCountAfterDate</span><span class="params">(String date)</span>;</span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">findMemberTotalCount</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-3-5-Mapper映射文件-1"><a href="#2-3-5-Mapper映射文件-1" class="headerlink" title="2.3.5 Mapper映射文件"></a>2.3.5 Mapper映射文件</h4><p>在OrderDao.xml和MemberDao.xml中定义SQL语句</p>
<p>OrderDao.xml：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--根据日期统计预约数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findOrderCountByDate&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;string&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">  select count(id) from t_order where orderDate = #&#123;value&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--根据日期统计预约数，统计指定日期之后的预约数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findOrderCountAfterDate&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;string&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">  select count(id) from t_order where orderDate <span class="symbol">&amp;gt;</span>= #&#123;value&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--根据日期统计到诊数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findVisitsCountByDate&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;string&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">  select count(id) from t_order where orderDate = #&#123;value&#125; and orderStatus = &#x27;已到诊&#x27;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--根据日期统计到诊数，统计指定日期之后的到诊数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findVisitsCountAfterDate&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;string&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">  select count(id) from t_order where orderDate <span class="symbol">&amp;gt;</span>= #&#123;value&#125; and orderStatus = &#x27;已到诊&#x27;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--热门套餐，查询前4条--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findHotSetmeal&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  select </span><br><span class="line">      s.name, </span><br><span class="line">      count(o.id) setmeal_count ,</span><br><span class="line">      count(o.id)/(select count(id) from t_order) proportion</span><br><span class="line">    from t_order o inner join t_setmeal s on s.id = o.setmeal_id</span><br><span class="line">    group by o.setmeal_id</span><br><span class="line">    order by setmeal_count desc </span><br><span class="line">  	limit 0,4</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>MemberDao.xml：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--根据日期统计会员数，统计指定日期之前的会员数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findMemberCountBeforeDate&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;string&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">  select count(id) from t_member where regTime <span class="symbol">&amp;lt;</span>= #&#123;value&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--根据日期统计会员数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findMemberCountByDate&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;string&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">  select count(id) from t_member where regTime = #&#123;value&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--根据日期统计会员数，统计指定日期之后的会员数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findMemberCountAfterDate&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;string&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">  select count(id) from t_member where regTime <span class="symbol">&amp;gt;</span>= #&#123;value&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--总会员数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findMemberTotalCount&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">  select count(id) from t_member</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-运营数据统计报表导出"><a href="#3-运营数据统计报表导出" class="headerlink" title="3. 运营数据统计报表导出"></a>3. 运营数据统计报表导出</h2><h3 id="3-1-需求分析-1"><a href="#3-1-需求分析-1" class="headerlink" title="3.1 需求分析"></a>3.1 需求分析</h3><p>运营数据统计报表导出就是将统计数据写入到Excel并提供给客户端浏览器进行下载，以便体检机构管理人员对运营数据的查看和存档。</p>
<h3 id="3-2-提供模板文件"><a href="#3-2-提供模板文件" class="headerlink" title="3.2 提供模板文件"></a>3.2 提供模板文件</h3><p>本章节我们需要将运营统计数据通过POI写入到Excel文件，对应的Excel效果如下：</p>
<p><img src="/../../assets/2143930-20210826122828883-1045661049.png" alt="img"></p>
<p>通过上面的Excel效果可以看到，表格比较复杂，涉及到合并单元格、字体、字号、字体加粗、对齐方式等的设置。如果我们通过POI编程的方式来设置这些效果代码会非常繁琐。</p>
<p>在企业实际开发中，对于这种比较复杂的表格导出一般我们会提前设计一个Excel模板文件，在这个模板文件中提前将表格的结构和样式设置好，我们的程序只需要读取这个文件并在文件中的相应位置写入具体的值就可以了。</p>
<p>在本章节资料中已经提供了一个名为report_template.xlsx的模板文件，需要将这个文件复制到health_backend工程的template目录中</p>
<h3 id="3-3-完善页面"><a href="#3-3-完善页面" class="headerlink" title="3.3 完善页面"></a>3.3 完善页面</h3><p>在report_business.html页面提供导出按钮并绑定事件</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;excelTitle&quot;</span> &gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;exportExcel&quot;</span>&gt;</span>导出Excel<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span>运营数据统计</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">methods:&#123;</span><br><span class="line">  //导出Excel报表</span><br><span class="line">  exportExcel()&#123;</span><br><span class="line">    window.location.href = &#x27;/report/exportBusinessReport.do&#x27;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-后台代码"><a href="#3-4-后台代码" class="headerlink" title="3.4 后台代码"></a>3.4 后台代码</h3><p>在ReportController中提供exportBusinessReport方法，基于POI将数据写入到Excel中并通过输出流下载到客户端</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 导出Excel报表</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/exportBusinessReport&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">exportBusinessReport</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span>&#123;</span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="comment">//远程调用报表服务获取报表数据</span></span><br><span class="line">    Map&lt;String, Object&gt; result = reportService.getBusinessReport();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//取出返回结果数据，准备将报表数据写入到Excel文件中</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">reportDate</span> <span class="operator">=</span> (String) result.get(<span class="string">&quot;reportDate&quot;</span>);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">todayNewMember</span> <span class="operator">=</span> (Integer) result.get(<span class="string">&quot;todayNewMember&quot;</span>);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">totalMember</span> <span class="operator">=</span> (Integer) result.get(<span class="string">&quot;totalMember&quot;</span>);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">thisWeekNewMember</span> <span class="operator">=</span> (Integer) result.get(<span class="string">&quot;thisWeekNewMember&quot;</span>);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">thisMonthNewMember</span> <span class="operator">=</span> (Integer) result.get(<span class="string">&quot;thisMonthNewMember&quot;</span>);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">todayOrderNumber</span> <span class="operator">=</span> (Integer) result.get(<span class="string">&quot;todayOrderNumber&quot;</span>);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">thisWeekOrderNumber</span> <span class="operator">=</span> (Integer) result.get(<span class="string">&quot;thisWeekOrderNumber&quot;</span>);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">thisMonthOrderNumber</span> <span class="operator">=</span> (Integer) result.get(<span class="string">&quot;thisMonthOrderNumber&quot;</span>);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">todayVisitsNumber</span> <span class="operator">=</span> (Integer) result.get(<span class="string">&quot;todayVisitsNumber&quot;</span>);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">thisWeekVisitsNumber</span> <span class="operator">=</span> (Integer) result.get(<span class="string">&quot;thisWeekVisitsNumber&quot;</span>);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">thisMonthVisitsNumber</span> <span class="operator">=</span> (Integer) result.get(<span class="string">&quot;thisMonthVisitsNumber&quot;</span>);</span><br><span class="line">    List&lt;Map&gt; hotSetmeal = (List&lt;Map&gt;) result.get(<span class="string">&quot;hotSetmeal&quot;</span>);</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//获得Excel模板文件绝对路径</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">temlateRealPath</span> <span class="operator">=</span> request.getSession().getServletContext().getRealPath(<span class="string">&quot;template&quot;</span>) +</span><br><span class="line">      											File.separator + <span class="string">&quot;report_template.xlsx&quot;</span>;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//读取模板文件创建Excel表格对象</span></span><br><span class="line">    <span class="type">XSSFWorkbook</span> <span class="variable">workbook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XSSFWorkbook</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(temlateRealPath)));</span><br><span class="line">    <span class="type">XSSFSheet</span> <span class="variable">sheet</span> <span class="operator">=</span> workbook.getSheetAt(<span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="type">XSSFRow</span> <span class="variable">row</span> <span class="operator">=</span> sheet.getRow(<span class="number">2</span>);</span><br><span class="line">    row.getCell(<span class="number">5</span>).setCellValue(reportDate);<span class="comment">//日期</span></span><br><span class="line"></span><br><span class="line">    row = sheet.getRow(<span class="number">4</span>);</span><br><span class="line">    row.getCell(<span class="number">5</span>).setCellValue(todayNewMember);<span class="comment">//新增会员数（本日）</span></span><br><span class="line">    row.getCell(<span class="number">7</span>).setCellValue(totalMember);<span class="comment">//总会员数</span></span><br><span class="line"></span><br><span class="line">    row = sheet.getRow(<span class="number">5</span>);</span><br><span class="line">    row.getCell(<span class="number">5</span>).setCellValue(thisWeekNewMember);<span class="comment">//本周新增会员数</span></span><br><span class="line">    row.getCell(<span class="number">7</span>).setCellValue(thisMonthNewMember);<span class="comment">//本月新增会员数</span></span><br><span class="line"></span><br><span class="line">    row = sheet.getRow(<span class="number">7</span>);</span><br><span class="line">    row.getCell(<span class="number">5</span>).setCellValue(todayOrderNumber);<span class="comment">//今日预约数	</span></span><br><span class="line">    row.getCell(<span class="number">7</span>).setCellValue(todayVisitsNumber);<span class="comment">//今日到诊数</span></span><br><span class="line"></span><br><span class="line">    row = sheet.getRow(<span class="number">8</span>);</span><br><span class="line">    row.getCell(<span class="number">5</span>).setCellValue(thisWeekOrderNumber);<span class="comment">//本周预约数</span></span><br><span class="line">    row.getCell(<span class="number">7</span>).setCellValue(thisWeekVisitsNumber);<span class="comment">//本周到诊数</span></span><br><span class="line"></span><br><span class="line">    row = sheet.getRow(<span class="number">9</span>);</span><br><span class="line">    row.getCell(<span class="number">5</span>).setCellValue(thisMonthOrderNumber);<span class="comment">//本月预约数</span></span><br><span class="line">    row.getCell(<span class="number">7</span>).setCellValue(thisMonthVisitsNumber);<span class="comment">//本月到诊数</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">rowNum</span> <span class="operator">=</span> <span class="number">12</span>;</span><br><span class="line">    <span class="keyword">for</span>(Map map : hotSetmeal)&#123;<span class="comment">//热门套餐</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> (String) map.get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">      <span class="type">Long</span> <span class="variable">setmeal_count</span> <span class="operator">=</span> (Long) map.get(<span class="string">&quot;setmeal_count&quot;</span>);</span><br><span class="line">      <span class="type">BigDecimal</span> <span class="variable">proportion</span> <span class="operator">=</span> (BigDecimal) map.get(<span class="string">&quot;proportion&quot;</span>);</span><br><span class="line">      row = sheet.getRow(rowNum ++);</span><br><span class="line">      row.getCell(<span class="number">4</span>).setCellValue(name);<span class="comment">//套餐名称</span></span><br><span class="line">      row.getCell(<span class="number">5</span>).setCellValue(setmeal_count);<span class="comment">//预约数量</span></span><br><span class="line">      row.getCell(<span class="number">6</span>).setCellValue(proportion.doubleValue());<span class="comment">//占比</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//通过输出流进行文件下载</span></span><br><span class="line">    <span class="type">ServletOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> response.getOutputStream();</span><br><span class="line">    response.setContentType(<span class="string">&quot;application/vnd.ms-excel&quot;</span>);</span><br><span class="line">    response.setHeader(<span class="string">&quot;content-Disposition&quot;</span>, <span class="string">&quot;attachment;filename=report.xlsx&quot;</span>);</span><br><span class="line">    workbook.write(out);</span><br><span class="line">    </span><br><span class="line">    out.flush();</span><br><span class="line">    out.close();</span><br><span class="line">    workbook.close();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>, MessageConstant.GET_BUSINESS_REPORT_FAIL,<span class="literal">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="第12章-PDF报表"><a href="#第12章-PDF报表" class="headerlink" title="第12章 PDF报表"></a>第12章 PDF报表</h1><p>在前面的课程中我们完成了将运营数据导出到Excel文件的功能。在企业开发中，除了常见的Excel形式报表，还有PDF形式的报表。那么如何导出PDF形式的报表呢？</p>
<h2 id="1-常见的PDF报表生成方式"><a href="#1-常见的PDF报表生成方式" class="headerlink" title="1. 常见的PDF报表生成方式"></a>1. 常见的PDF报表生成方式</h2><h3 id="1-1-iText"><a href="#1-1-iText" class="headerlink" title="1.1 iText"></a>1.1 iText</h3><p>iText是著名的开放源码的站点sourceforge一个项目，是用于生成PDF文档的一个java类库。通过iText不仅可以生成PDF或rtf的文档，而且可以将XML、Html文件转化为PDF文件。 iText的安装非常方便，下载iText.jar文件后，只需要在系统的CLASSPATH中加入iText.jar的路径，在程序中就可以使用iText类库了。</p>
<p>maven坐标：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.lowagie<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>itext<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>示例代码:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.app;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lowagie.text.Document;</span><br><span class="line"><span class="keyword">import</span> com.lowagie.text.DocumentException;</span><br><span class="line"><span class="keyword">import</span> com.lowagie.text.Paragraph;</span><br><span class="line"><span class="keyword">import</span> com.lowagie.text.pdf.PdfWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ItextDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">            PdfWriter.getInstance(document, <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;D:\\test.pdf&quot;</span>));</span><br><span class="line">            document.open();</span><br><span class="line">            document.add(<span class="keyword">new</span> <span class="title class_">Paragraph</span>(<span class="string">&quot;hello itext&quot;</span>));</span><br><span class="line">            document.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (DocumentException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-2-JasperReports"><a href="#1-2-JasperReports" class="headerlink" title="1.2 JasperReports"></a>1.2 JasperReports</h3><p>JasperReports是一个强大、灵活的报表生成工具，能够展示丰富的页面内容，并将之转换成PDF，HTML，或者XML格式。该库完全由Java写成，可以用于在各种Java应用程序，包括J2EE，Web应用程序中生成动态内容。一般情况下，JasperReports会结合Jaspersoft Studio(模板设计器)使用导出PDF报表。</p>
<p>maven坐标:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.sf.jasperreports<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jasperreports<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-JasperReports概述"><a href="#2-JasperReports概述" class="headerlink" title="2. JasperReports概述"></a>2. JasperReports概述</h2><h3 id="2-1-JasperReports快速体验"><a href="#2-1-JasperReports快速体验" class="headerlink" title="2.1 JasperReports快速体验"></a>2.1 JasperReports快速体验</h3><p>本小节我们先通过一个快速体验来感受一下JasperReports的开发过程。</p>
<p>第一步：创建maven工程，导入JasperReports的maven坐标</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.sf.jasperreports<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jasperreports<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第二步：将提前准备好的jrxml文件复制到maven工程中(后面会详细讲解如何创建jrxml文件)</p>
<p><img src="/../../assets/2143930-20210826123326153-1116927167.png" alt="img"></p>
<p>第三步：编写单元测试，输出PDF报表</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testJasperReports</span><span class="params">()</span><span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">jrxmlPath</span> <span class="operator">=</span> </span><br><span class="line">        <span class="string">&quot;D:\\ideaProjects\\projects111\\jasperdemo\\src\\main\\resources\\demo.jrxml&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">jasperPath</span> <span class="operator">=</span> </span><br><span class="line">        <span class="string">&quot;D:\\ideaProjects\\projects111\\jasperdemo\\src\\main\\resources\\demo.jasper&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//编译模板</span></span><br><span class="line">    JasperCompileManager.compileReportToFile(jrxmlPath,jasperPath);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造数据</span></span><br><span class="line">    <span class="type">Map</span> <span class="variable">paramters</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">    paramters.put(<span class="string">&quot;reportDate&quot;</span>,<span class="string">&quot;2019-10-10&quot;</span>);</span><br><span class="line">    paramters.put(<span class="string">&quot;company&quot;</span>,<span class="string">&quot;itcast&quot;</span>);</span><br><span class="line">    List&lt;Map&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">    <span class="type">Map</span> <span class="variable">map1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">    map1.put(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;xiaoming&quot;</span>);</span><br><span class="line">    map1.put(<span class="string">&quot;address&quot;</span>,<span class="string">&quot;beijing&quot;</span>);</span><br><span class="line">    map1.put(<span class="string">&quot;email&quot;</span>,<span class="string">&quot;xiaoming@itcast.cn&quot;</span>);</span><br><span class="line">    <span class="type">Map</span> <span class="variable">map2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">    map2.put(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;xiaoli&quot;</span>);</span><br><span class="line">    map2.put(<span class="string">&quot;address&quot;</span>,<span class="string">&quot;nanjing&quot;</span>);</span><br><span class="line">    map2.put(<span class="string">&quot;email&quot;</span>,<span class="string">&quot;xiaoli@itcast.cn&quot;</span>);</span><br><span class="line">    list.add(map1);</span><br><span class="line">    list.add(map2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//填充数据</span></span><br><span class="line">    <span class="type">JasperPrint</span> <span class="variable">jasperPrint</span> <span class="operator">=</span> </span><br><span class="line">        JasperFillManager.fillReport(jasperPath, </span><br><span class="line">                                     paramters, </span><br><span class="line">                                     <span class="keyword">new</span> <span class="title class_">JRBeanCollectionDataSource</span>(list));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//输出文件</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">pdfPath</span> <span class="operator">=</span> <span class="string">&quot;D:\\test.pdf&quot;</span>;</span><br><span class="line">    JasperExportManager.exportReportToPdfFile(jasperPrint,pdfPath);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-JasperReports原理"><a href="#2-2-JasperReports原理" class="headerlink" title="2.2 JasperReports原理"></a>2.2 JasperReports原理</h3><p><img src="/../../assets/2143930-20210826123338278-1727038568.png" alt="img"></p>
<ul>
<li>JRXML：报表填充模板，本质是一个xml文件</li>
<li>Jasper：由JRXML模板编译成的二进制文件，用于代码填充数据</li>
<li>Jrprint：当用数据填充完Jasper后生成的对象，用于输出报表</li>
<li>Exporter：报表输出的管理类，可以指定要输出的报表为何种格式</li>
<li>PDF&#x2F;HTML&#x2F;XML：报表形式</li>
</ul>
<h3 id="2-3-开发流程"><a href="#2-3-开发流程" class="headerlink" title="2.3 开发流程"></a>2.3 开发流程</h3><p>使用JasperReports导出pdf报表，开发流程如下：</p>
<ol>
<li>制作报表模板</li>
<li>模板编译</li>
<li>构造数据</li>
<li>填充数据</li>
<li>输出文件</li>
</ol>
<h2 id="3-模板设计器Jaspersoft-Studio"><a href="#3-模板设计器Jaspersoft-Studio" class="headerlink" title="3. 模板设计器Jaspersoft Studio"></a>3. 模板设计器Jaspersoft Studio</h2><p>Jaspersoft Studio是一个图形化的报表设计工具，可以非常方便的设计出PDF报表模板文件(其实就是一个xml文件)，再结合JasperReports使用，就可以渲染出PDF文件。</p>
<p>下载地址:<a target="_blank" rel="noopener" href="https://community.jaspersoft.com/community-download">https://community.jaspersoft.com/community-download</a></p>
<p><img src="/../../assets/2143930-20210826123345906-188450573.png" alt="img"></p>
<p>下载完成后会得到如下安装文件：</p>
<p><img src="/../../assets/2143930-20210826123351331-1836821684.png" alt="img"></p>
<p>直接双击安装即可。</p>
<h3 id="3-1-Jaspersoft-Studio面板介绍"><a href="#3-1-Jaspersoft-Studio面板介绍" class="headerlink" title="3.1 Jaspersoft Studio面板介绍"></a>3.1 Jaspersoft Studio面板介绍</h3><p><img src="/../../assets/2143930-20210826123400432-356297333.png" alt="img"></p>
<h3 id="3-2-创建工程和模板文件"><a href="#3-2-创建工程和模板文件" class="headerlink" title="3.2 创建工程和模板文件"></a>3.2 创建工程和模板文件</h3><p>打开Jaspersoft Studio工具，首先需要创建一个工程，创建过程如下：</p>
<p><img src="/../../assets/2143930-20210826123407372-1342319791.png" alt="img"></p>
<p><img src="/../../assets/2143930-20210826123413116-2051980424.png" alt="img"></p>
<p><img src="/../../assets/2143930-20210826123418897-1388484071.png" alt="img"></p>
<p><img src="/../../assets/2143930-20210826123426894-1502834698.png" alt="img"></p>
<p>创建完工程后，可以在工程上点击右键，创建模板文件：</p>
<p><img src="/../../assets/2143930-20210826123434120-1349843518.png" alt="img"></p>
<p><img src="/../../assets/2143930-20210826123440835-1581436465.png" alt="img"></p>
<p><img src="/../../assets/2143930-20210826123446892-451024945.png" alt="img"></p>
<p><img src="/../../assets/2143930-20210826123453452-308927035.png" alt="img"></p>
<p><img src="/../../assets/2143930-20210826123459485-545807458.png" alt="img"></p>
<p><img src="/../../assets/2143930-20210826123507571-1326044476.png" alt="img"></p>
<p>可以看到创建处理的模板文件后缀为jrxml，从设计区面板可以看到如下效果：</p>
<p><img src="/../../assets/2143930-20210826123514564-1438842690.png" alt="img"></p>
<p>可以看到整个文件是可视化的，分为几大区域（Title、Page Header、Column Header等），如果某些区域不需要也可以删除。</p>
<p>在面板左下角可以看到有三种视图方式：Design（设计模式）、Source（源码模式）、Preview（预览模式）:</p>
<ul>
<li>通过Design视图可以看到模板的直观结构和样式</li>
<li>通过Source视图可以看到文件xml源码</li>
<li>通过Preview视图可以预览PDF文件输出后的效果</li>
</ul>
<p>通过右侧Palette窗口可以看到常用的元素：</p>
<p><img src="/../../assets/2143930-20210826123523199-257806343.png" alt="img"></p>
<h3 id="3-3-设计模板文件"><a href="#3-3-设计模板文件" class="headerlink" title="3.3 设计模板文件"></a>3.3 设计模板文件</h3><h4 id="3-3-1-增减Band"><a href="#3-3-1-增减Band" class="headerlink" title="3.3.1 增减Band"></a>3.3.1 增减Band</h4><p>可以根据情况删除或者增加模板文件中的区域（称为Band），例如在Page Header区域上点击右键，选择删除菜单：</p>
<p><img src="/../../assets/2143930-20210826123532973-1206441878.png" alt="img"></p>
<p>其中Detail区域可以添加多个，其他区域只能有一个。</p>
<h4 id="3-3-2-将元素应用到模板中"><a href="#3-3-2-将元素应用到模板中" class="headerlink" title="3.3.2 将元素应用到模板中"></a>3.3.2 将元素应用到模板中</h4><h5 id="3-3-2-1-Image元素"><a href="#3-3-2-1-Image元素" class="headerlink" title="3.3.2.1 Image元素"></a>3.3.2.1 Image元素</h5><p>从右侧Palette面板中选择Image元素（图片元素），拖动到Title区域：</p>
<p><img src="/../../assets/2143930-20210826123541900-1625814062.png" alt="img"></p>
<p>弹出如下对话框，有多种创建模式，选择URL模式，并在下面输入框中输入一个网络图片的连接地址：</p>
<p><img src="/../../assets/2143930-20210826123548365-245211442.png" alt="img"></p>
<p><img src="/../../assets/2143930-20210826123554426-1120030856.png" alt="img"></p>
<p>可以选中图片元素，鼠标拖动调整位置，也可以通过鼠标调整图片的大小。</p>
<p>调整完成后，可以点击Preview进入预览视图，查看PDF输出效果：</p>
<p><img src="/../../assets/2143930-20210826123600825-503570818.png" alt="img"></p>
<p>点击Source进入源码视图，查看xml文件内容：</p>
<p><img src="/../../assets/2143930-20210826123606867-1815909773.png" alt="img"></p>
<p>其实我们上面创建的demo1.jrxml模板文件，本质上就是一个xml文件，只不过我们不需要自己编写xml文件的内容，而是通过Jaspersoft Studio这个设计器软件进行可视化设计即可。</p>
<h5 id="3-3-2-2-Static-Text元素"><a href="#3-3-2-2-Static-Text元素" class="headerlink" title="3.3.2.2 Static Text元素"></a>3.3.2.2 Static Text元素</h5><p>Static Text元素就是静态文本元素，用于在PDF文件上展示静态文本信息：</p>
<p><img src="/../../assets/2143930-20210826123613849-1563472957.png" alt="img"></p>
<p>双击Title面板中的Static Text元素，可以修改文本内容：</p>
<p><img src="/../../assets/2143930-20210826123622740-161044450.png" alt="img"></p>
<p>选中元素，也可以调整文本的字体和字号：</p>
<p><img src="/../../assets/2143930-20210826123631552-83408885.png" alt="img"></p>
<p>点击Preview进入预览视图，查看效果：</p>
<p><img src="/../../assets/2143930-20210826123638416-876890596.png" alt="img"></p>
<h5 id="3-3-2-3-Current-Date元素"><a href="#3-3-2-3-Current-Date元素" class="headerlink" title="3.3.2.3 Current Date元素"></a>3.3.2.3 Current Date元素</h5><p>Current Date元素用于在报表中输出当前系统日期，将改元素拖动到Title区域：</p>
<p><img src="/../../assets/2143930-20210826123648144-760279152.png" alt="img"></p>
<p>预览输出效果：</p>
<p><img src="/../../assets/2143930-20210826123654989-1901871885.png" alt="img"></p>
<p>默认日期输出格式如上图所示，可以回到设计视图并选中元素，在Properties面板中的Text Field子标签中修改日期输出格式：</p>
<p><img src="/../../assets/2143930-20210826123702450-487120277.png" alt="img"></p>
<p>修改日期格式：</p>
<p><img src="/../../assets/2143930-20210826123709591-1809647402.png" alt="img"></p>
<p>保存文件后重新预览：</p>
<p><img src="/../../assets/2143930-20210826123717515-1645604439.png" alt="img"></p>
<h4 id="3-3-3-动态数据填充"><a href="#3-3-3-动态数据填充" class="headerlink" title="3.3.3 动态数据填充"></a>3.3.3 动态数据填充</h4><p>上面我们在PDF文件中展示的都是一些静态数据，那么如果需要动态展示一些数据应该如何实现呢？我们可以使用Outline面板中的Parameters和Fields来实现。</p>
<p><img src="/../../assets/2143930-20210826123729661-1744985926.png" alt="img"></p>
<p>Parameters通常用来展示单个数据，Fields通常用来展示需要循环的列表数据。</p>
<h5 id="3-3-3-1-Parameters"><a href="#3-3-3-1-Parameters" class="headerlink" title="3.3.3.1 Parameters"></a>3.3.3.1 Parameters</h5><p>在Parameters上点击右键，创建一个Parameter参数：</p>
<p><img src="/../../assets/2143930-20210826123738920-324459032.png" alt="img"></p>
<p>可以在右侧的Properties面板中修改刚才创建的参数名称：</p>
<p><img src="/../../assets/2143930-20210826123746530-1708698505.png" alt="img"></p>
<p>将刚才创建的Parameter参数拖动到面板中：</p>
<p><img src="/../../assets/2143930-20210826123754314-1679645655.png" alt="img"></p>
<p>进入预览视图，查看效果：</p>
<p><img src="/../../assets/2143930-20210826123801562-2108032458.png" alt="img"></p>
<p>由于模板中我们使用了Parameter动态元素，所以在预览之前需要为其动态赋值：</p>
<p><img src="/../../assets/2143930-20210826123811504-979209160.png" alt="img"></p>
<p>注意：由于我们是在Jaspersoft Studio软件中进行预览，所以需要通过上面的输入框动态为Parameter赋值，在后期项目使用时，需要我们在Java程序中动态为Parameter赋值进行数据填充。</p>
<h5 id="3-3-3-2-Fields"><a href="#3-3-3-2-Fields" class="headerlink" title="3.3.3.2 Fields"></a>3.3.3.2 Fields</h5><p>使用Fields方式进行数据填充，既可以使用jdbc数据源方式也可以使用JavaBean数据源方式。</p>
<ul>
<li>jdbc数据源数据填充</li>
</ul>
<p>第一步：在Repository Explorer面板中，在Data Adapters点击右键，创建一个数据适配器</p>
<p><img src="/../../assets/2143930-20210826123822855-1797370369.png" alt="img"></p>
<p>第二步：选择Database JDBC Connection</p>
<p><img src="/../../assets/2143930-20210826123829804-1083491128.png" alt="img"></p>
<p>第三步：选择mysql数据库，并完善jdbc连接信息</p>
<p><img src="/../../assets/2143930-20210826123838233-1269165315.png" alt="img"></p>
<p>为了能够在Jaspersoft Studio中预览到数据库中的数据，需要加入MySQL的驱动包</p>
<p><img src="/../../assets/2143930-20210826123847096-1759166264.png" alt="img"></p>
<p>第四步：在Outline视图中，右键点击工程名，选择Database and Query菜单</p>
<p><img src="/../../assets/2143930-20210826123855584-704323731.png" alt="img"></p>
<p>第五步：在弹出的对话框中选择刚刚创建的JDBC数据库连接选项</p>
<p><img src="/../../assets/2143930-20210826123906527-1293322217.png" alt="img"></p>
<p>第六步：在弹出对话框中Language选择sql，在右侧区域输入SQL语句并点击Read Fields按钮</p>
<p><img src="/../../assets/2143930-20210826123915062-1294138600.png" alt="img"></p>
<p>可以看到通过点击上面的Read Fields按钮，已经读取到了t_setmeal表中的所有字段信息并展示在了下面，这些字段可以根据需要进行删除或者调整位置</p>
<p>第七步：在Outline视图中的Fields下可以看到t_setmeal表中相关字段信息，拖动某个字段到设计区的Detail区域并调整位置</p>
<p><img src="/../../assets/2143930-20210826123924802-1887013158.png" alt="img"></p>
<p>可以看到，在拖动Fields到设计区时，同时会产生两个元素，一个是静态文本，一个是动态元素。静态文本相当于表格的表头，可以根据需要修改文本内容。最终设计完的效果如下：</p>
<p><img src="/../../assets/2143930-20210826123932358-446522561.png" alt="img"></p>
<p>第八步：使用Preview预览视图进行预览</p>
<p><img src="/../../assets/2143930-20210826123949241-1958651062.png" alt="img"></p>
<p>通过上图可以看到，虽然列表数据展示出来了，但是展示的还存在问题。在每条数据遍历时表头也跟着遍历了一遍。这是怎么回事呢？这是由于我们设计的表头和动态Fields都在Detail区域。为了能够解决上面的问题，需要将表头放在Column Header区域，将动态Fields放在Detail区域。具体操作如下：</p>
<p>1、在Outline视图的Column Header点击右键创建出一个区域</p>
<p><img src="/../../assets/2143930-20210826123957828-1135377977.png" alt="img"></p>
<p>2、将Detail下的静态文本拖动到Column Header下</p>
<p><img src="/../../assets/2143930-20210826124007481-1439198384.png" alt="img"></p>
<p>拖动完成后如下：</p>
<p><img src="/../../assets/2143930-20210826124016351-1424676942.png" alt="img"></p>
<p>3、调整静态文本在Column Header区域的位置，最终效果如下<br><img src="/../../assets/2143930-20210826124023863-1039527747.png" alt="img"></p>
<p>4、预览查看效果</p>
<p><img src="/../../assets/2143930-20210826124031422-834658810.png" alt="img"></p>
<ul>
<li>JavaBean数据源数据填充</li>
</ul>
<p>第一步：复制上面的demo1.jrxml文件，名称改为demo2.jrxml</p>
<p><img src="/../../assets/2143930-20210826124040913-1547402875.png" alt="img"></p>
<p>修改Report Name：</p>
<p><img src="/../../assets/2143930-20210826124051411-463011616.png" alt="img"></p>
<p>第二步：打开demo2.jrxml文件，将detail区域中的动态Fields元素删除</p>
<p><img src="/../../assets/2143930-20210826124058923-1312076502.png" alt="img"></p>
<p>第三步：将Outline面板中Fields下的字段全部删除</p>
<p><img src="/../../assets/2143930-20210826124105773-1718974655.png" alt="img"></p>
<p>第四步：清除JDBC数据源和相关SQL语句</p>
<p><img src="/../../assets/2143930-20210826124116291-1072989880.png" alt="img"></p>
<p><img src="/../../assets/2143930-20210826124124983-1932606575.png" alt="img"></p>
<p>第五步：在Fields处点击右键创建新的Field</p>
<p><img src="/../../assets/2143930-20210826124135033-1364484144.png" alt="img"></p>
<p>创建完成后在Properties属性面板中修改Field的名称</p>
<p><img src="/../../assets/2143930-20210826124146968-849876863.png" alt="img"></p>
<p><img src="/../../assets/2143930-20210826124157301-1385335208.png" alt="img"></p>
<p>第六步：将创建的Fields拖动到Detail区域并调整好位置</p>
<p><img src="/../../assets/2143930-20210826124206152-1371485413.png" alt="img"></p>
<p>注意：使用此种JavaBean数据源数据填充方式，无法正常进行预览，因为这些动态Fields需要在Java程序中动态进行数据填充。</p>
<h3 id="3-4-结合JasperReports输出报表"><a href="#3-4-结合JasperReports输出报表" class="headerlink" title="3.4 结合JasperReports输出报表"></a>3.4 结合JasperReports输出报表</h3><p>前面我们已经使用Jaspersoft Studio设计了两个模板文件：demo1.jrxml和demo2.jrxml。其中demo1.jrxml的动态列表数据是基于JDBC数据源方式进行数据填充，demo2.jrxml的动态列表数据是基于JavaBean数据源方式进行数据填充。本小节我们就结合JasperReports的Java API来完成pdf报表输出。</p>
<h4 id="3-4-1-JDBC数据源方式填充数据"><a href="#3-4-1-JDBC数据源方式填充数据" class="headerlink" title="3.4.1 JDBC数据源方式填充数据"></a>3.4.1 JDBC数据源方式填充数据</h4><p>第一步：创建maven工程，导入相关maven坐标</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.sf.jasperreports<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jasperreports<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第二步：将设计好的demo1.jrxml文件复制到当前工程的resources目录下</p>
<p><img src="/../../assets/2143930-20210826124217747-127881544.png" alt="img"></p>
<p>第三步：编写单元测试</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testReport_JDBC</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> </span><br><span class="line">        DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://localhost:3306/health&quot;</span>, </span><br><span class="line">                                    <span class="string">&quot;root&quot;</span>, </span><br><span class="line">                                    <span class="string">&quot;root&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">jrxmlPath</span> <span class="operator">=</span> <span class="string">&quot;D:\\ideaProjects\\projects111\\jasperreports_test\\src\\main\\resources\\demo1.jrxml&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">jasperPath</span> <span class="operator">=</span> <span class="string">&quot;D:\\ideaProjects\\projects111\\jasperreports_test\\src\\main\\resources\\demo1.jasper&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//编译模板</span></span><br><span class="line">    JasperCompileManager.compileReportToFile(jrxmlPath,jasperPath);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造数据</span></span><br><span class="line">    <span class="type">Map</span> <span class="variable">paramters</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">    paramters.put(<span class="string">&quot;company&quot;</span>,<span class="string">&quot;传智播客&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//填充数据---使用JDBC数据源方式填充</span></span><br><span class="line">    <span class="type">JasperPrint</span> <span class="variable">jasperPrint</span> <span class="operator">=</span> </span><br><span class="line">        JasperFillManager.fillReport(jasperPath, </span><br><span class="line">                                    paramters, </span><br><span class="line">                                    connection);</span><br><span class="line">    <span class="comment">//输出文件</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">pdfPath</span> <span class="operator">=</span> <span class="string">&quot;D:\\test.pdf&quot;</span>;</span><br><span class="line">    JasperExportManager.exportReportToPdfFile(jasperPrint,pdfPath);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过上面的操作步骤可以输出pdf文件，但是中文的地方无法正常显示。这是因为JasperReports默认情况下对中文支持并不友好，需要我们自己进行修复。具体操作步骤如下：</p>
<p>1、在Jaspersoft Studio中打开demo1.jrxml文件，选中中文相关元素，统一将字体设置为“华文宋体”并将修改后的demo1.jrxml重新复制到maven工程中</p>
<p>2、将本章资源&#x2F;解决中文无法显示问题目录下的文件复制到maven工程的resources目录中</p>
<p><img src="/../../assets/2143930-20210826124226980-992916758.png" alt="img"></p>
<p>按照上面步骤操作后重新执行单元测试导出PDF文件：</p>
<p><img src="/../../assets/2143930-20210826124235293-1602476623.png" alt="img"></p>
<h4 id="3-4-2-JavaBean数据源方式填充数据"><a href="#3-4-2-JavaBean数据源方式填充数据" class="headerlink" title="3.4.2 JavaBean数据源方式填充数据"></a>3.4.2 JavaBean数据源方式填充数据</h4><p>第一步：为了能够避免中文无法显示问题，首先需要将demo2.jrxml文件相关元素字体改为“华文宋体”并将demo2.jrxml文件复制到maven工程的resources目录下</p>
<p><img src="/../../assets/2143930-20210826124243337-78188306.png" alt="img"></p>
<p>第二步：编写单元测试方法输出PDF文件</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testReport_JavaBean</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">jrxmlPath</span> <span class="operator">=</span> <span class="string">&quot;D:\\ideaProjects\\projects111\\jasperreports_test\\src\\main\\resources\\demo2.jrxml&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">jasperPath</span> <span class="operator">=</span> <span class="string">&quot;D:\\ideaProjects\\projects111\\jasperreports_test\\src\\main\\resources\\demo2.jasper&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//编译模板</span></span><br><span class="line">    JasperCompileManager.compileReportToFile(jrxmlPath,jasperPath);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造数据</span></span><br><span class="line">    <span class="type">Map</span> <span class="variable">paramters</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">    paramters.put(<span class="string">&quot;company&quot;</span>,<span class="string">&quot;传智播客&quot;</span>);</span><br><span class="line"></span><br><span class="line">    List&lt;Map&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">    <span class="type">Map</span> <span class="variable">map1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">    map1.put(<span class="string">&quot;tName&quot;</span>,<span class="string">&quot;入职体检套餐&quot;</span>);</span><br><span class="line">    map1.put(<span class="string">&quot;tCode&quot;</span>,<span class="string">&quot;RZTJ&quot;</span>);</span><br><span class="line">    map1.put(<span class="string">&quot;tAge&quot;</span>,<span class="string">&quot;18-60&quot;</span>);</span><br><span class="line">    map1.put(<span class="string">&quot;tPrice&quot;</span>,<span class="string">&quot;500&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">Map</span> <span class="variable">map2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">    map2.put(<span class="string">&quot;tName&quot;</span>,<span class="string">&quot;阳光爸妈老年健康体检&quot;</span>);</span><br><span class="line">    map2.put(<span class="string">&quot;tCode&quot;</span>,<span class="string">&quot;YGBM&quot;</span>);</span><br><span class="line">    map2.put(<span class="string">&quot;tAge&quot;</span>,<span class="string">&quot;55-60&quot;</span>);</span><br><span class="line">    map2.put(<span class="string">&quot;tPrice&quot;</span>,<span class="string">&quot;500&quot;</span>);</span><br><span class="line">    list.add(map1);</span><br><span class="line">    list.add(map2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//填充数据---使用JavaBean数据源方式填充</span></span><br><span class="line">    <span class="type">JasperPrint</span> <span class="variable">jasperPrint</span> <span class="operator">=</span> </span><br><span class="line">        JasperFillManager.fillReport(jasperPath, </span><br><span class="line">                                     paramters, </span><br><span class="line">                                     <span class="keyword">new</span> <span class="title class_">JRBeanCollectionDataSource</span>(list));</span><br><span class="line">    <span class="comment">//输出文件</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">pdfPath</span> <span class="operator">=</span> <span class="string">&quot;D:\\test.pdf&quot;</span>;</span><br><span class="line">    JasperExportManager.exportReportToPdfFile(jasperPrint,pdfPath);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>查看输出效果：</p>
<p><img src="/../../assets/2143930-20210826124251690-1762840201.png" alt="img"></p>
<h2 id="4-在项目中输出运营数据PDF报表"><a href="#4-在项目中输出运营数据PDF报表" class="headerlink" title="4. 在项目中输出运营数据PDF报表"></a>4. 在项目中输出运营数据PDF报表</h2><p>本小节我们将在项目中实现运营数据的PDF报表导出功能。</p>
<h3 id="4-1-设计PDF模板文件"><a href="#4-1-设计PDF模板文件" class="headerlink" title="4.1 设计PDF模板文件"></a>4.1 设计PDF模板文件</h3><p>使用Jaspersoft Studio设计运营数据PDF报表模板文件health_business3.jrxml，设计后的效果如下：</p>
<p><img src="/../../assets/2143930-20210826124304680-1961150138.png" alt="img"></p>
<p>在资源中已经提供好了此文件，直接使用即可。</p>
<h3 id="4-2-搭建环境"><a href="#4-2-搭建环境" class="headerlink" title="4.2 搭建环境"></a>4.2 搭建环境</h3><p>第一步：在health_common工程的pom.xml中导入JasperReports的maven坐标</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.sf.jasperreports<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jasperreports<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第二步：将资源中提供的模板文件health_business3.jrxml复制到health_backend工程的template目录下</p>
<p><img src="/../../assets/2143930-20210826124313333-1908695285.png" alt="img"></p>
<p>第三步：将解决中问题的相关资源文件复制到项目中</p>
<p><img src="/../../assets/2143930-20210826124319596-1983576562.png" alt="img"></p>
<h3 id="4-3-修改页面"><a href="#4-3-修改页面" class="headerlink" title="4.3 修改页面"></a>4.3 修改页面</h3><p>修改health_backend工程的report_business.html页面，添加导出PDF的按钮并绑定事件</p>
<p><img src="/../../assets/2143930-20210826124326876-716045578.png" alt="img"></p>
<p><img src="/../../assets/2143930-20210826124334178-1013965075.png" alt="img"></p>
<h3 id="4-4-Java代码实现"><a href="#4-4-Java代码实现" class="headerlink" title="4.4 Java代码实现"></a>4.4 Java代码实现</h3><p>在health_backend工程的ReportController中提供exportBusinessReport4PDF方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//导出运营数据到pdf并提供客户端下载</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/exportBusinessReport4PDF&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">exportBusinessReport4PDF</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; result = reportService.getBusinessReportData();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//取出返回结果数据，准备将报表数据写入到PDF文件中</span></span><br><span class="line">        List&lt;Map&gt; hotSetmeal = (List&lt;Map&gt;) result.get(<span class="string">&quot;hotSetmeal&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//动态获取模板文件绝对磁盘路径</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">jrxmlPath</span> <span class="operator">=</span> </span><br><span class="line">            request.getSession().getServletContext().getRealPath(<span class="string">&quot;template&quot;</span>) + File.separator + <span class="string">&quot;health_business3.jrxml&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">jasperPath</span> <span class="operator">=</span> </span><br><span class="line">            request.getSession().getServletContext().getRealPath(<span class="string">&quot;template&quot;</span>) + File.separator + <span class="string">&quot;health_business3.jasper&quot;</span>;</span><br><span class="line">        <span class="comment">//编译模板</span></span><br><span class="line">        JasperCompileManager.compileReportToFile(jrxmlPath, jasperPath);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//填充数据---使用JavaBean数据源方式填充</span></span><br><span class="line">        <span class="type">JasperPrint</span> <span class="variable">jasperPrint</span> <span class="operator">=</span></span><br><span class="line">            JasperFillManager.fillReport(jasperPath,result,</span><br><span class="line">                                         <span class="keyword">new</span> <span class="title class_">JRBeanCollectionDataSource</span>(hotSetmeal));</span><br><span class="line"></span><br><span class="line">        <span class="type">ServletOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> response.getOutputStream();</span><br><span class="line">        response.setContentType(<span class="string">&quot;application/pdf&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;content-Disposition&quot;</span>, <span class="string">&quot;attachment;filename=report.pdf&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//输出文件</span></span><br><span class="line">        JasperExportManager.exportReportToPdfStream(jasperPrint,out);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="literal">false</span>, MessageConstant.GET_BUSINESS_REPORT_FAIL);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="第13章-Redis缓存"><a href="#第13章-Redis缓存" class="headerlink" title="第13章 Redis缓存"></a>第13章 Redis缓存</h1><p>本章内容我们的主题为Redis，目前Redis在企业中的应用已经非常广泛，同时Redis也是面试中的重点内容。</p>
<h2 id="1-Redis缓存相关问题"><a href="#1-Redis缓存相关问题" class="headerlink" title="1. Redis缓存相关问题"></a>1. Redis缓存相关问题</h2><h3 id="1-1-缓存穿透"><a href="#1-1-缓存穿透" class="headerlink" title="1.1 缓存穿透"></a>1.1 缓存穿透</h3><p><strong>缓存穿透</strong>是指查询一个数据库一定不存在的数据。</p>
<p>我们以前正常的使用Redis缓存的流程大致是：</p>
<p>1、数据查询首先进行缓存查询</p>
<p>2、如果数据存在则直接返回缓存数据</p>
<p>3、如果数据不存在，就对数据库进行查询，并把查询到的数据放进缓存</p>
<p>4、如果数据库查询数据为空，则不放进缓存</p>
<p>例如我们的数据表中主键是自增产生的，所有的主键值都大于0。此时如果用户传入的参数为-1，会是怎么样？这个-1，就是一定不存在的对象。程序就会每次都去查询数据库，而每次查询都是空，每次又都不会进行缓存。假如有人恶意攻击，就可以利用这个漏洞，对数据库造成压力，甚至压垮我们的数据库。</p>
<p>为了防止有人利用这个漏洞恶意攻击我们的数据库，我们可以采取如下措施：</p>
<p>如果从数据库查询的对象为空，也放入缓存，key为用户提交过来的主键值，value为null，只是设定的缓存过期时间较短，比如设置为60秒。这样下次用户再根据这个key查询redis缓存就可以查询到值了（当然值为null），从而保护我们的数据库免遭攻击。</p>
<h3 id="1-2-缓存雪崩"><a href="#1-2-缓存雪崩" class="headerlink" title="1.2 缓存雪崩"></a>1.2 缓存雪崩</h3><p>缓存雪崩，是指在某一个时间段，缓存集中过期失效。在缓存集中失效的这个时间段对数据的访问查询，都落到了数据库上，对于数据库而言，就会产生周期性的压力波峰。</p>
<p>为了避免缓存雪崩的发生，我们可以将缓存的数据设置不同的失效时间，这样就可以避免缓存数据在某个时间段集中失效。例如对于热门的数据（访问频率高的数据）可以缓存的时间长一些，对于冷门的数据可以缓存的时间段一些。甚至对于一些特别热门的数据可以设置永不过期。</p>
<h3 id="1-3-缓存击穿"><a href="#1-3-缓存击穿" class="headerlink" title="1.3 缓存击穿"></a>1.3 缓存击穿</h3><p>缓存击穿，是指一个key非常热点（例如双十一期间进行抢购的商品数据），在不停的扛着大并发，大并发集中对这一个点进行访问，当这个key在失效的瞬间，持续的大并发就穿破缓存，直接请求到数据库上，就像在一个屏障上凿开了一个洞。</p>
<p>我们同样可以将这些热点数据设置永不过期就可以解决缓存击穿的问题了。</p>
<h2 id="2-Redis集群方案"><a href="#2-Redis集群方案" class="headerlink" title="2. Redis集群方案"></a>2. Redis集群方案</h2><p>单机Redis的读写速度非常快，能够支持大量用户的访问。虽然Redis的性能很高，但是对于大型网站来说，每秒需要获取的数据远远超过单台redis服务所能承受的压力，所以我们迫切需要一种方案能够解决单台Redis服务性能不足的问题。这就需要使用到Redis的集群了。Redis集群有多种方案，下面分别进行讲解。</p>
<h3 id="2-1-主从复制Replication"><a href="#2-1-主从复制Replication" class="headerlink" title="2.1 主从复制Replication"></a>2.1 主从复制Replication</h3><p>redis支持主从复制的模式。</p>
<p>在主从复制模式下Redis节点分为两种角色：主节点(也称为master)和从节点(也称为slave)。这种模式集群是由一个主节点和多个从节点构成。</p>
<p>原则：Master会将数据同步到slave，而slave不会将数据同步到master。Slave启动时会连接master来同步数据。</p>
<p><img src="/../../assets/2143930-20210826124720009-1706751419.png" alt="img"></p>
<p>这是一个典型的分布式读写分离模型。我们可以利用master来处理写操作，slave提供读操作。这样可以有效减少单个机器的并发访问数量。</p>
<p>要实现主从复制这种模式非常简单，主节点不用做任何修改，直接启动服务即可。从节点需要修改redis.conf配置文件，加入配置：slaveof &lt;主节点ip地址&gt; &lt;主节点端口号&gt;，例如master的ip地址为192.168.200.129，端口号为6379，那么slave只需要在redis.conf文件中配置slaveof 192.168.200.129 6379即可。</p>
<p>分别连接主节点和从节点，测试发现主节点的写操作，从节点立刻就能看到相同的数据。但是在从节点进行写操作，提示 <code>READONLY You can&#39;t write against a read only slave</code> 不能写数据到从节点。</p>
<p>现在我们就可以通过这种方式配置多个从节点进行读操作，主节点进行写操作，实现读写分离。</p>
<h3 id="2-2-哨兵sentinel"><a href="#2-2-哨兵sentinel" class="headerlink" title="2.2 哨兵sentinel"></a>2.2 哨兵sentinel</h3><p>我们现在已经给Redis实现了主从复制，可将主节点数据同步给从节点，实现了读写分离，提高Redis的性能。但是现在还存在一个问题，就是在主从复制这种模式下只有一个主节点，一旦主节点宕机，就无法再进行写操作了。也就是说主从复制这种模式没有实现高可用。那么什么是高可用呢？如何实现高可用呢？</p>
<h4 id="2-2-1-高可用介绍"><a href="#2-2-1-高可用介绍" class="headerlink" title="2.2.1 高可用介绍"></a>2.2.1 高可用介绍</h4><p>高可用(HA)是分布式系统架构设计中必须考虑的因素之一，它是通过架构设计减少系统不能提供服务的时间。保证高可用通常遵循下面几点：</p>
<ol>
<li>单点是系统高可用的大敌，应该尽量在系统设计的过程中避免单点。</li>
<li>通过架构设计而保证系统高可用的，其核心准则是：冗余。</li>
<li>实现自动故障转移。</li>
</ol>
<h4 id="2-2-2-Redis-sentinel介绍"><a href="#2-2-2-Redis-sentinel介绍" class="headerlink" title="2.2.2 Redis sentinel介绍"></a>2.2.2 Redis sentinel介绍</h4><p>sentinel(哨兵)是用于监控redis集群中Master状态的工具，其本身也是一个独立运行的进程，是Redis 的高可用解决方案，sentinel哨兵模式已经被集成在redis2.4之后的版本中。</p>
<p>sentinel可以监视一个或者多个redis master服务，以及这些master服务的所有从服务；当某个master服务下线时，自动将该master下的某个从服务升级为master服务替代已下线的master服务继续处理请求，并且其余从节点开始从新的主节点复制数据。</p>
<p>在redis安装完成后，会有一个redis-sentinel的文件，这就是启动sentinel的脚本文件，同时还有一个sentinel.conf文件，这个是sentinel的配置文件。</p>
<p>sentinel工作模式：</p>
<p><img src="/../../assets/2143930-20210826124728845-697346755.png" alt="img"></p>
<p>注意：可能有些同学会有疑问，现在我们已经基于sentinel实现了高可用，但是如果sentinel挂了怎么办呢？其实sentinel本身也可以实现集群，也就是说sentinel也是高可用的。</p>
<h4 id="2-2-3-Redis-sentinel使用"><a href="#2-2-3-Redis-sentinel使用" class="headerlink" title="2.2.3 Redis sentinel使用"></a>2.2.3 Redis sentinel使用</h4><h5 id="2-2-3-1-配置sentinel"><a href="#2-2-3-1-配置sentinel" class="headerlink" title="2.2.3.1 配置sentinel"></a>2.2.3.1 配置sentinel</h5><p>Sentinel在redis的安装包中有，我们直接使用就可以了，但是先需要修改配置文件，执行命令：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/local/redis/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制sentinel配置文件</span></span><br><span class="line"><span class="built_in">cp</span> /root/redis-4.0.14/sentinel.conf sentinel01.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改配置文件：</span></span><br><span class="line">vi sentinel01.conf</span><br></pre></td></tr></table></figure>

<p>在sentinel01.conf配置文件中添加：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 外部可以访问</span></span><br><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line">sentinel monitor mymaster 127.0.0.1 6379 1</span><br><span class="line">sentinel down-after-milliseconds mymaster 10000</span><br><span class="line">sentinel failover-timeout mymaster 60000</span><br><span class="line">sentinel parallel-syncs mymaster 1</span><br><span class="line">注意：如果有sentinel monitor mymaster 127.0.0.1 6379 2配置，则注释掉。</span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<ul>
<li><p>sentinel monitor mymaster 192.168.200.129 6379 1</p>
<p><code>mymaster</code> 主节点名,可以任意起名，但必须和后面的配置保持一致。</p>
<p><code>192.168.200.128 6379</code> 主节点连接地址。</p>
<p><code>1</code> 将主服务器判断为失效需要投票，这里设置至少需要 1个 Sentinel 同意。</p>
</li>
<li><p>sentinel down-after-milliseconds mymaster 10000</p>
<p>设置Sentinel认为服务器已经断线所需的毫秒数。</p>
</li>
<li><p>sentinel failover-timeout mymaster 60000</p>
<p>设置failover（故障转移）的过期时间。当failover开始后，在此时间内仍然没有触发任何failover操作，当前<br>sentinel 会认为此次failover失败。</p>
</li>
<li><p>sentinel parallel-syncs mymaster 1</p>
<p>设置在执行故障转移时， 最多可以有多少个从服务器同时对新的主服务器进行同步， 这个数字越小，表示同时进行同步的从服务器越少，那么完成故障转移所需的时间就越长。</p>
</li>
</ul>
<h5 id="2-2-3-2-启动sentinel"><a href="#2-2-3-2-启动sentinel" class="headerlink" title="2.2.3.2 启动sentinel"></a>2.2.3.2 启动sentinel</h5><p>配置文件修改后，执行以下命令，启动sentinel：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/root/redis-4.0.14/src/redis-sentinel sentinel01.conf</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="/../../assets/2143930-20210826124740674-1905817887.png" alt="img"></p>
<p>可以看到，6379是主服务，6380和6381是从服务。</p>
<h5 id="2-2-3-3-测试sentinel"><a href="#2-2-3-3-测试sentinel" class="headerlink" title="2.2.3.3 测试sentinel"></a>2.2.3.3 测试sentinel</h5><p>我们在6379执行shutdown，关闭主服务，Sentinel提示如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">+sdown master mymaster 192.168.200.129 6379	<span class="comment">#主节点宕机</span></span><br><span class="line">+odown master mymaster 192.168.200.129 6379 <span class="comment">#quorum 1/1 </span></span><br><span class="line">+new-epoch 1</span><br><span class="line">+try-failover master mymaster 192.168.200.129 6379 <span class="comment">#尝试故障转移</span></span><br><span class="line">+vote-for-leader 00a6933e0cfa2b1bf0c3aab0d6b7a1a6455832ec 1 <span class="comment">#选举领导</span></span><br><span class="line">+elected-leader master mymaster 192.168.200.129 6379</span><br><span class="line">+failover-state-select-slave master mymaster 192.168.200.129 6379 <span class="comment">#故障转移选择从服务</span></span><br><span class="line">+selected-slave slave 192.168.200.129:6380 192.168.200.129 6380 @ mymaster 192.168.200.129 6379</span><br><span class="line"><span class="comment">#故障转移状态发送 发送到6380</span></span><br><span class="line">+failover-state-send-slaveof-noone slave 192.168.200.129:6380 192.168.200.129 6380 @ mymaster 192.168.200.129 6379</span><br><span class="line">+failover-state-wait-promotion slave 192.168.200.129:6380 192.168.200.129 6380 @ mymaster 192.168.200.129 6379</span><br><span class="line">+promoted-slave slave 192.168.200.129:6380 192.168.200.129 6380 @ mymaster 192.168.200.129 6379</span><br><span class="line">+failover-state-reconf-slaves master mymaster 192.168.200.129 6379</span><br><span class="line">+slave-reconf-sent slave 192.168.200.129:6381 192.168.200.129 6381 @ mymaster 192.168.200.129 6379</span><br><span class="line">+slave-reconf-inprog slave 192.168.200.129:6381 192.168.200.129 6381 @ mymaster 192.168.200.129 6379</span><br><span class="line">+slave-reconf-done slave 192.168.200.129:6381 192.168.200.129 6381 @ mymaster 192.168.200.129 6379</span><br><span class="line">+failover-end master mymaster 192.168.200.129 6379 <span class="comment">#故障转移结束，原来的主服务是6379</span></span><br><span class="line">+switch-master mymaster 192.168.200.129 6379 192.168.200.129 6380 <span class="comment">#转换主服务，由原来的6379转为现在的6380</span></span><br><span class="line">+slave slave 192.168.200.129:6381 192.168.200.129 6381 @ mymaster 192.168.200.129 6380</span><br><span class="line">+slave slave 192.168.200.129:6379 192.168.200.129 6379 @ mymaster 192.168.200.129 6380</span><br><span class="line">+sdown slave 192.168.200.129:6379 192.168.200.129 6379 @ mymaster 192.168.200.129 6380</span><br></pre></td></tr></table></figure>

<p>根据提示信息，我们可以看到，6379故障转移到了6380，通过投票选择6380为新的主服务器。</p>
<p>在6380执行info</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:1</span><br><span class="line">slave0:ip=127.0.0.1,port=6381,state=online,offset=80531,lag=1</span><br></pre></td></tr></table></figure>

<p>在6381执行info</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave</span><br><span class="line">master_host:127.0.0.1</span><br><span class="line">master_port:6380</span><br><span class="line">master_link_status:up</span><br></pre></td></tr></table></figure>

<p>故障转移如下图：</p>
<p><img src="/../../assets/2143930-20210826124749207-265082394.png" alt="img"></p>
<h3 id="2-3-Redis内置集群cluster"><a href="#2-3-Redis内置集群cluster" class="headerlink" title="2.3 Redis内置集群cluster"></a>2.3 Redis内置集群cluster</h3><h4 id="2-3-1-Redis-cluster介绍"><a href="#2-3-1-Redis-cluster介绍" class="headerlink" title="2.3.1 Redis cluster介绍"></a>2.3.1 Redis cluster介绍</h4><p>Redis Cluster是Redis的内置集群，在Redis3.0推出的实现方案。在Redis3.0之前是没有这个内置集群的。Redis Cluster是无中心节点的集群架构，依靠Gossip协议协同自动化修复集群的状态。</p>
<p>Redis cluster在设计的时候，就考虑到了去中心化，去中间件，也就是说，集群中的每个节点都是平等的关系，都是对等的，每个节点都保存各自的数据和整个集群的状态。每个节点都和其他所有节点连接，而且这些连接保持活跃，这样就保证了我们只需要连接集群中的任意一个节点，就可以获取到其他节点的数据。</p>
<p>Redis cluster集群架构图如下：</p>
<p><img src="/../../assets/2143930-20210826124755738-1868715804.png" alt="img"></p>
<h4 id="2-3-2-哈希槽方式分配数据"><a href="#2-3-2-哈希槽方式分配数据" class="headerlink" title="2.3.2 哈希槽方式分配数据"></a>2.3.2 哈希槽方式分配数据</h4><p>需要注意的是，这种集群模式下集群中每个节点保存的数据并不是所有的数据，而只是一部分数据。那么数据是如何合理的分配到不同的节点上的呢？</p>
<p>Redis 集群是采用一种叫做<code>哈希槽 (hash slot)</code>的方式来分配数据的。redis cluster 默认分配了 16384 个slot，当我们set一个key 时，会用<code>CRC16</code>算法来取模得到所属的<code>slot</code>，然后将这个key 分到哈希槽区间的节点上，具体算法就是：<code>CRC16(key) % 16384</code>。</p>
<p>假设现在有3个节点已经组成了集群，分别是：A, B, C 三个节点，它们可以是一台机器上的三个端口，也可以是三台不同的服务器。那么，采用<code>哈希槽 (hash slot)</code>的方式来分配16384个slot 的话，它们三个节点分别承担的slot 区间是：</p>
<blockquote>
<ul>
<li>节点A覆盖0－5460</li>
<li>节点B覆盖5461－10922</li>
<li>节点C覆盖10923－16383</li>
</ul>
</blockquote>
<p>那么，现在要设置一个key ,比如叫<code>my_name</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">set my_name itcast</span><br></pre></td></tr></table></figure>

<p>按照redis cluster的哈希槽算法：<code>CRC16(&#39;my_name&#39;)%16384 = 2412</code>。 那么就会把这个key 的存储分配到 节点A 上了。</p>
<h4 id="2-3-3-Redis-cluster的主从模式"><a href="#2-3-3-Redis-cluster的主从模式" class="headerlink" title="2.3.3 Redis cluster的主从模式"></a>2.3.3 Redis cluster的主从模式</h4><p>redis cluster 为了保证数据的高可用性，加入了主从模式，一个主节点对应一个或多个从节点，主节点提供数据存取，从节点则是从主节点拉取数据备份，当这个主节点挂掉后，就会在这些从节点中选取一个来充当主节点，从而保证集群不会挂掉。</p>
<p>redis cluster加入了主从模式后的效果如下：</p>
<p><img src="/../../assets/2143930-20210826124804648-874019440.png" alt="img"></p>
<h4 id="2-3-4-Redis-cluster搭建"><a href="#2-3-4-Redis-cluster搭建" class="headerlink" title="2.3.4 Redis cluster搭建"></a>2.3.4 Redis cluster搭建</h4><h5 id="2-3-4-1-准备Redis节点"><a href="#2-3-4-1-准备Redis节点" class="headerlink" title="2.3.4.1 准备Redis节点"></a>2.3.4.1 准备Redis节点</h5><p>为了保证可以进行投票，需要至少3个主节点。</p>
<p>每个主节点都需要至少一个从节点,所以需要至少3个从节点。</p>
<p>一共需要6台redis服务器，我们这里使用6个redis实例，端口号为7001~7006。</p>
<p>先准备一个干净的redis环境，复制原来的bin文件夹，清理后作为第一个redis节点，具体命令如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 进入redis安装目录</span></span><br><span class="line"><span class="built_in">cd</span> /usr/local/redis</span><br><span class="line"><span class="comment"># 复制redis</span></span><br><span class="line"><span class="built_in">mkdir</span> cluster</span><br><span class="line"><span class="built_in">cp</span> -R bin/ cluster/node1</span><br><span class="line"><span class="comment"># 删除持久化文件</span></span><br><span class="line"><span class="built_in">cd</span> cluster/node1</span><br><span class="line"><span class="built_in">rm</span> -rf dump.rdb</span><br><span class="line"><span class="built_in">rm</span> -rf appendonly.aof</span><br><span class="line"><span class="comment"># 删除原来的配置文件</span></span><br><span class="line"><span class="built_in">rm</span> -rf redis.conf</span><br><span class="line"><span class="comment"># 复制新的配置文件</span></span><br><span class="line"><span class="built_in">cp</span> /root/redis-4.0.14/redis.conf ./</span><br><span class="line"><span class="comment"># 修改配置文件</span></span><br><span class="line">vi redis.conf</span><br></pre></td></tr></table></figure>

<p>集群环境redis节点的配置文件如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 不能设置密码，否则集群启动时会连接不上</span></span><br><span class="line"><span class="comment"># Redis服务器可以跨网络访问</span></span><br><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line"><span class="comment"># 修改端口号</span></span><br><span class="line">port 7001</span><br><span class="line"><span class="comment"># Redis后台启动</span></span><br><span class="line">daemonize <span class="built_in">yes</span></span><br><span class="line"><span class="comment"># 开启aof持久化</span></span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line"><span class="comment"># 开启集群</span></span><br><span class="line">cluster-enabled <span class="built_in">yes</span></span><br><span class="line"><span class="comment"># 集群的配置 配置文件首次启动自动生成</span></span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line"><span class="comment"># 请求超时</span></span><br><span class="line">cluster-node-timeout 5000</span><br></pre></td></tr></table></figure>

<p>第一个redis节点node1准备好之后，再分别复制5份，</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> -R node1/ node2</span><br></pre></td></tr></table></figure>

<p>修改六个节点的端口号为7001~7006，修改redis.conf配置文件即可</p>
<p>编写启动节点的脚本：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vi start-all.sh</span><br></pre></td></tr></table></figure>

<p>内容为：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> node1</span><br><span class="line">./redis-server redis.conf</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"><span class="built_in">cd</span> node2</span><br><span class="line">./redis-server redis.conf</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"><span class="built_in">cd</span> node3</span><br><span class="line">./redis-server redis.conf</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"><span class="built_in">cd</span> node4</span><br><span class="line">./redis-server redis.conf</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"><span class="built_in">cd</span> node5</span><br><span class="line">./redis-server redis.conf</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"><span class="built_in">cd</span> node6</span><br><span class="line">./redis-server redis.conf</span><br><span class="line"><span class="built_in">cd</span> ..</span><br></pre></td></tr></table></figure>

<p>设置脚本的权限，并启动：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 744 start-all.sh</span><br><span class="line">./start-all.sh</span><br></pre></td></tr></table></figure>

<p>使用命令 ps -ef | grep redis 查看效果如下：</p>
<p><img src="/../../assets/2143930-20210826124815834-1936200519.png" alt="img"></p>
<h5 id="2-3-4-2-启动Redis集群"><a href="#2-3-4-2-启动Redis集群" class="headerlink" title="2.3.4.2 启动Redis集群"></a>2.3.4.2 启动Redis集群</h5><p>redis集群的管理工具使用的是ruby脚本语言，安装集群需要ruby环境，先安装ruby环境：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 安装ruby</span></span><br><span class="line">yum -y install ruby ruby-devel rubygems rpm-build</span><br><span class="line"></span><br><span class="line"><span class="comment"># 升级ruby版本，redis4.0.14集群环境需要2.2.2以上的ruby版本</span></span><br><span class="line">yum install centos-release-scl-rh</span><br><span class="line">yum install rh-ruby23  -y</span><br><span class="line">scl <span class="built_in">enable</span> rh-ruby23 bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看ruby版本</span></span><br><span class="line">ruby -v</span><br></pre></td></tr></table></figure>

<p>下载符合环境要求的gem，下载地址如下：</p>
<p><a target="_blank" rel="noopener" href="https://rubygems.org/gems/redis/versions/4.1.0">https://rubygems.org/gems/redis/versions/4.1.0</a></p>
<p>课程资料中已经提供了redis-4.1.0.gem，直接上传安装即可，安装命令：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gem install redis-4.1.0.gem</span><br></pre></td></tr></table></figure>

<p>进入redis安装目录，使用redis自带的集群管理脚本，执行命令：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 进入redis安装包</span></span><br><span class="line"><span class="built_in">cd</span> /root/redis-4.0.14/src/</span><br><span class="line"><span class="comment"># 查看集群管理脚本</span></span><br><span class="line">ll *.rb</span><br><span class="line"><span class="comment"># 使用集群管理脚本启动集群，下面命令中的1表示为每个主节点创建1个从节点</span></span><br><span class="line">./redis-trib.rb create --replicas 1 127.0.0.1:7001 127.0.0.1:7002 \</span><br><span class="line">127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005 127.0.0.1:7006</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; Creating cluster</span><br><span class="line">&gt;&gt;&gt; Performing <span class="built_in">hash</span> slots allocation on 6 nodes...</span><br><span class="line">Using 3 masters:</span><br><span class="line">192.168.200.129:7001</span><br><span class="line">192.168.200.129:7002</span><br><span class="line">192.168.200.129:7003</span><br><span class="line">Adding replica 192.168.200.129:7005 to 192.168.200.129:7001</span><br><span class="line">Adding replica 192.168.200.129:7006 to 192.168.200.129:7002</span><br><span class="line">Adding replica 192.168.200.129:7004 to 192.168.200.129:7003</span><br><span class="line">&gt;&gt;&gt; Trying to optimize slaves allocation <span class="keyword">for</span> anti-affinity</span><br><span class="line">[WARNING] Some slaves are <span class="keyword">in</span> the same host as their master</span><br><span class="line">M: f0094f14b59c023acd38098336e2adcd3d434497 192.168.200.129:7001</span><br><span class="line">   slots:0-5460 (5461 slots) master</span><br><span class="line">M: 0eba44418d7e88f4d819f89f90da2e6e0be9c680 192.168.200.129:7002</span><br><span class="line">   slots:5461-10922 (5462 slots) master</span><br><span class="line">M: ac16c5545d9b099348085ad8b3253145912ee985 192.168.200.129:7003</span><br><span class="line">   slots:10923-16383 (5461 slots) master</span><br><span class="line">S: edc7a799e1cfd75e4d80767958930d86516ffc9b 192.168.200.129:7004</span><br><span class="line">   replicates ac16c5545d9b099348085ad8b3253145912ee985</span><br><span class="line">S: cbd415973b3e85d6f3ad967441f6bcb5b7da506a 192.168.200.129:7005</span><br><span class="line">   replicates f0094f14b59c023acd38098336e2adcd3d434497</span><br><span class="line">S: 40fdde45b16e1ac85c8a4c84db75b43978d1e4d2 192.168.200.129:7006</span><br><span class="line">   replicates 0eba44418d7e88f4d819f89f90da2e6e0be9c680</span><br><span class="line">Can I <span class="built_in">set</span> the above configuration? (<span class="built_in">type</span> <span class="string">&#x27;yes&#x27;</span> to accept): <span class="built_in">yes</span> <span class="comment">#注意选择为yes</span></span><br><span class="line">&gt;&gt;&gt; Nodes configuration updated</span><br><span class="line">&gt;&gt;&gt; Assign a different config epoch to each node</span><br><span class="line">&gt;&gt;&gt; Sending CLUSTER MEET messages to <span class="built_in">join</span> the cluster</span><br><span class="line">Waiting <span class="keyword">for</span> the cluster to <span class="built_in">join</span>..</span><br><span class="line">&gt;&gt;&gt; Performing Cluster Check (using node 192.168.200.129:7001)</span><br><span class="line">M: f0094f14b59c023acd38098336e2adcd3d434497 192.168.200.129:7001</span><br><span class="line">   slots:0-5460 (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: ac16c5545d9b099348085ad8b3253145912ee985 192.168.200.129:7003</span><br><span class="line">   slots:10923-16383 (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: cbd415973b3e85d6f3ad967441f6bcb5b7da506a 192.168.200.129:7005</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates f0094f14b59c023acd38098336e2adcd3d434497</span><br><span class="line">S: 40fdde45b16e1ac85c8a4c84db75b43978d1e4d2 192.168.200.129:7006</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 0eba44418d7e88f4d819f89f90da2e6e0be9c680</span><br><span class="line">M: 0eba44418d7e88f4d819f89f90da2e6e0be9c680 192.168.200.129:7002</span><br><span class="line">   slots:5461-10922 (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: edc7a799e1cfd75e4d80767958930d86516ffc9b 192.168.200.129:7004</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates ac16c5545d9b099348085ad8b3253145912ee985</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line">&gt;&gt;&gt; Check <span class="keyword">for</span> open slots...</span><br><span class="line">&gt;&gt;&gt; Check slots coverage...</span><br><span class="line">[OK] All 16384 slots covered.</span><br></pre></td></tr></table></figure>

<h4 id="2-3-5-使用Redis集群"><a href="#2-3-5-使用Redis集群" class="headerlink" title="2.3.5 使用Redis集群"></a>2.3.5 使用Redis集群</h4><p>按照redis cluster的特点，它是去中心化的，每个节点都是对等的，所以连接哪个节点都可以获取和设置数据。</p>
<p>使用redis的客户端连接redis集群，命令如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./redis-cli -h 192.168.200.129 -p 7001 -c</span><br></pre></td></tr></table></figure>

<p>其中-c 一定要加，这个是redis集群连接时，进行节点跳转的参数。</p>
<p>连接到集群后可以设置一些值，可以看到这些值根据前面提到的哈希槽方式分散存储在不同的节点上了。</p>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/posts/8f9c/" rel="prev" title="每日4K壁纸">
                  <i class="fa fa-angle-left"></i> 每日4K壁纸
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/posts/f19a/" rel="next" title="【项目】瑞吉外卖">
                  【项目】瑞吉外卖 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>





  <a target="_blank" rel="noopener" href="https://zxalive.com" class="special-link">新站点zxalive.com</a>


</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">zhangxin</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">1.8m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">26:53</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
